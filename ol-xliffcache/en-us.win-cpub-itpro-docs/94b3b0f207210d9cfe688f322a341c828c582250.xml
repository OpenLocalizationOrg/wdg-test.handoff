{"nodes":[{"content":"Impersonate a client after authentication (Windows 10)","pos":[11,65]},{"content":"Describes the best practices, location, values, policy management, and security considerations for the Impersonate a client after authentication security policy setting.","pos":[79,248]},{"content":"Impersonate a client after authentication","pos":[404,445]},{"content":"Applies to","pos":[449,459]},{"content":"Windows 10","pos":[466,476]},{"pos":[478,651],"content":"Describes the best practices, location, values, policy management, and security considerations for the <bpt id=\"p1\">**</bpt>Impersonate a client after authentication<ept id=\"p1\">**</ept> security policy setting."},{"content":"Reference","pos":[656,665]},{"content":"This policy setting determines which programs are allowed to impersonate a user or another specified account and act on behalf of the user.","pos":[667,806]},{"content":"If this user right is required for this type of impersonation, an unauthorized user cannot cause a client to connect (for example, by remote procedure call (RPC) or named pipes) to a service that they have created to impersonate that client.","pos":[807,1048]},{"content":"(Such an action could elevate the unauthorized user's permissions to administrative or system levels.)","pos":[1049,1151]},{"content":"Impersonation is the ability of a thread to run in a security context that is different from the context of the process that owns the thread.","pos":[1153,1294]},{"content":"Impersonation is designed to meet the security requirements of client/server applications.","pos":[1295,1385]},{"content":"When running in a client's security context, a service \"is\" the client, to some degree.","pos":[1386,1473]},{"content":"One of the service's threads uses an access token representing the client's credentials to obtain access to the objects to which the client has access.","pos":[1474,1625]},{"content":"The primary reason for impersonation is to cause access checks to be performed against the client's identity.","pos":[1626,1735]},{"content":"Using the client's identity for access checks can cause access to be either restricted or expanded, depending on what the client has permission to do.","pos":[1736,1886]},{"content":"Services that are started by the Service Control Manager have the built-in Service group added by default to their access tokens.","pos":[1888,2017]},{"content":"COM servers that are started by the COM infrastructure and configured to run under a specific account also have the Service group added to their access tokens.","pos":[2018,2177]},{"content":"As a result, these processes are assigned this user right when they are started.","pos":[2178,2258]},{"content":"Constant: SeImpersonatePrivilege","pos":[2260,2292]},{"content":"Possible values","pos":[2298,2313]},{"content":"User-defined list of accounts","pos":[2319,2348]},{"content":"Default values","pos":[2353,2367]},{"content":"Not defined","pos":[2372,2383]},{"content":"Best practices","pos":[2389,2403]},{"content":"A user can impersonate an access token if any of the following conditions exist:","pos":[2409,2489]},{"content":"The access token that is being impersonated is for this user.","pos":[2499,2560]},{"content":"The user in this session logged on to the network with explicit credentials to create the access token.","pos":[2569,2672]},{"content":"The requested level is less than Impersonate, such as Anonymous or Identify.","pos":[2681,2757]},{"content":"Because of these factors, users do not usually need to have this user right assigned.","pos":[2763,2848]},{"content":"Location","pos":[2854,2862]},{"content":"Computer Configuration<ph id=\"ph1\">\\\\</ph>Windows Settings<ph id=\"ph2\">\\\\</ph>Security Settings<ph id=\"ph3\">\\\\</ph>Local Policies<ph id=\"ph4\">\\\\</ph>User Rights Assignment","pos":[2864,2963]},{"content":"Default values","pos":[2969,2983]},{"content":"By default, this setting is Administrators, Local Service, Network Service, and Service on domain controllers and stand-alone servers.","pos":[2985,3119]},{"content":"The following table lists the actual and effective default policy values.","pos":[3121,3194]},{"content":"Default values are also listed on the policy’s property page.","pos":[3195,3256]},{"content":"Server type or GPO","pos":[3260,3278]},{"content":"Default value","pos":[3281,3294]},{"content":"Default Domain Policy","pos":[3309,3330]},{"content":"Not defined","pos":[3332,3343]},{"content":"Default Domain Controller Policy","pos":[3348,3380]},{"content":"Administrators","pos":[3382,3396]},{"content":"Local Service","pos":[3401,3414]},{"content":"Network Service","pos":[3419,3434]},{"content":"Service","pos":[3439,3446]},{"content":"Stand-Alone Server Default Settings","pos":[3451,3486]},{"content":"Administrators","pos":[3489,3503]},{"content":"Local Service","pos":[3508,3521]},{"content":"Network Service","pos":[3526,3541]},{"content":"Service","pos":[3546,3553]},{"content":"Domain Controller Effective Default Settings","pos":[3558,3602]},{"content":"Administrators","pos":[3605,3619]},{"content":"Local Service","pos":[3624,3637]},{"content":"Network Service","pos":[3642,3657]},{"content":"Service","pos":[3662,3669]},{"content":"Member Server Effective Default Settings","pos":[3674,3714]},{"content":"Administrators","pos":[3717,3731]},{"content":"Local Service","pos":[3736,3749]},{"content":"Network Service","pos":[3754,3769]},{"content":"Service","pos":[3774,3781]},{"content":"Client Computer Effective Default Settings","pos":[3786,3828]},{"content":"Administrators","pos":[3831,3845]},{"content":"Local Service","pos":[3850,3863]},{"content":"Network Service","pos":[3868,3883]},{"content":"Service","pos":[3888,3895]},{"content":"Policy management","pos":[3903,3920]},{"content":"This section describes features, tools, and guidance to help you manage this policy.","pos":[3922,4006]},{"content":"A restart of the computer is not required for this policy setting to be effective.","pos":[4008,4090]},{"content":"Any change to the user rights assignment for an account becomes effective the next time the owner of the account logs on.","pos":[4092,4213]},{"content":"Group Policy","pos":[4219,4231]},{"content":"Settings are applied in the following order through a Group Policy Object (GPO), which will overwrite settings on the local computer at the next Group Policy update:","pos":[4233,4398]},{"content":"Local policy settings","pos":[4404,4425]},{"content":"Site policy settings","pos":[4430,4450]},{"content":"Domain policy settings","pos":[4455,4477]},{"content":"OU policy settings","pos":[4482,4500]},{"content":"When a local setting is greyed out, it indicates that a GPO currently controls that setting.","pos":[4502,4594]},{"content":"Security considerations","pos":[4599,4622]},{"content":"This section describes how an attacker might exploit a feature or its configuration, how to implement the countermeasure, and the possible negative consequences of countermeasure implementation.","pos":[4624,4818]},{"content":"Vulnerability","pos":[4824,4837]},{"pos":[4839,5089],"content":"An attacker with the <bpt id=\"p1\">**</bpt>Impersonate a client after authentication<ept id=\"p1\">**</ept> user right could create a service, mislead a client into connecting to the service, and then impersonate that computer to elevate the attacker's level of access to that of the device."},{"content":"Countermeasure","pos":[5095,5109]},{"pos":[5111,5314],"content":"On member servers, ensure that only the Administrators and Service groups (Local Service, Network Service, and Service) have the <bpt id=\"p1\">**</bpt>Impersonate a client after authentication<ept id=\"p1\">**</ept> user right assigned to them."},{"content":"Potential impact","pos":[5320,5336]},{"content":"In most cases, this configuration has no impact.","pos":[5338,5386]},{"content":"If you have installed optional components such as ASP.NET or IIS, you may need to assign the <bpt id=\"p1\">**</bpt>Impersonate a client after authentication<ept id=\"p1\">**</ept> user right to additional accounts that are required by those components, such as IUSR<ph id=\"ph1\">\\_</ph><bpt id=\"p2\">*</bpt><ph id=\"ph2\">&amp;lt;</ph>ComputerName<ph id=\"ph3\">&amp;gt;</ph><ept id=\"p2\">*</ept>, IIS<ph id=\"ph4\">\\_</ph>WPG, ASP.NET, or IWAM<ph id=\"ph5\">\\_</ph><bpt id=\"p3\">*</bpt><ph id=\"ph6\">&amp;lt;</ph>ComputerName<ph id=\"ph7\">&amp;gt;</ph><ept id=\"p3\">*</ept>.","pos":[5387,5688]},{"content":"Related topics","pos":[5693,5707]},{"content":"User Rights Assignment","pos":[5712,5734]}],"content":"---\ntitle: Impersonate a client after authentication (Windows 10)\ndescription: Describes the best practices, location, values, policy management, and security considerations for the Impersonate a client after authentication security policy setting.\nms.assetid: 4cd241e2-c680-4b43-8ed0-3b391925cec5\nms.prod: w10\nms.mktglfcycl: deploy\nms.sitesec: library\nms.pagetype: security\nauthor: brianlic-msft\n---\n\n# Impersonate a client after authentication\n\n**Applies to**\n-   Windows 10\n\nDescribes the best practices, location, values, policy management, and security considerations for the **Impersonate a client after authentication** security policy setting.\n\n## Reference\n\nThis policy setting determines which programs are allowed to impersonate a user or another specified account and act on behalf of the user. If this user right is required for this type of impersonation, an unauthorized user cannot cause a client to connect (for example, by remote procedure call (RPC) or named pipes) to a service that they have created to impersonate that client. (Such an action could elevate the unauthorized user's permissions to administrative or system levels.)\n\nImpersonation is the ability of a thread to run in a security context that is different from the context of the process that owns the thread. Impersonation is designed to meet the security requirements of client/server applications. When running in a client's security context, a service \"is\" the client, to some degree. One of the service's threads uses an access token representing the client's credentials to obtain access to the objects to which the client has access.\nThe primary reason for impersonation is to cause access checks to be performed against the client's identity. Using the client's identity for access checks can cause access to be either restricted or expanded, depending on what the client has permission to do.\n\nServices that are started by the Service Control Manager have the built-in Service group added by default to their access tokens. COM servers that are started by the COM infrastructure and configured to run under a specific account also have the Service group added to their access tokens. As a result, these processes are assigned this user right when they are started.\n\nConstant: SeImpersonatePrivilege\n\n### Possible values\n\n-   User-defined list of accounts\n-   Default values\n-   Not defined\n\n### Best practices\n\n-   A user can impersonate an access token if any of the following conditions exist:\n\n    -   The access token that is being impersonated is for this user.\n    -   The user in this session logged on to the network with explicit credentials to create the access token.\n    -   The requested level is less than Impersonate, such as Anonymous or Identify.\n\n    Because of these factors, users do not usually need to have this user right assigned.\n\n### Location\n\nComputer Configuration\\\\Windows Settings\\\\Security Settings\\\\Local Policies\\\\User Rights Assignment\n\n### Default values\n\nBy default, this setting is Administrators, Local Service, Network Service, and Service on domain controllers and stand-alone servers.\n\nThe following table lists the actual and effective default policy values. Default values are also listed on the policy’s property page.\n\n| Server type or GPO | Default value |\n| - | - |\n| Default Domain Policy| Not defined |\n| Default Domain Controller Policy| Administrators<br/>Local Service<br/>Network Service<br/>Service| \n| Stand-Alone Server Default Settings | Administrators<br/>Local Service<br/>Network Service<br/>Service| \n| Domain Controller Effective Default Settings | Administrators<br/>Local Service<br/>Network Service<br/>Service| \n| Member Server Effective Default Settings | Administrators<br/>Local Service<br/>Network Service<br/>Service| \n| Client Computer Effective Default Settings | Administrators<br/>Local Service<br/>Network Service<br/>Service| \n \n## Policy management\n\nThis section describes features, tools, and guidance to help you manage this policy.\n\nA restart of the computer is not required for this policy setting to be effective.\n\nAny change to the user rights assignment for an account becomes effective the next time the owner of the account logs on.\n\n### Group Policy\n\nSettings are applied in the following order through a Group Policy Object (GPO), which will overwrite settings on the local computer at the next Group Policy update:\n\n1.  Local policy settings\n2.  Site policy settings\n3.  Domain policy settings\n4.  OU policy settings\n\nWhen a local setting is greyed out, it indicates that a GPO currently controls that setting.\n\n## Security considerations\n\nThis section describes how an attacker might exploit a feature or its configuration, how to implement the countermeasure, and the possible negative consequences of countermeasure implementation.\n\n### Vulnerability\n\nAn attacker with the **Impersonate a client after authentication** user right could create a service, mislead a client into connecting to the service, and then impersonate that computer to elevate the attacker's level of access to that of the device.\n\n### Countermeasure\n\nOn member servers, ensure that only the Administrators and Service groups (Local Service, Network Service, and Service) have the **Impersonate a client after authentication** user right assigned to them.\n\n### Potential impact\n\nIn most cases, this configuration has no impact. If you have installed optional components such as ASP.NET or IIS, you may need to assign the **Impersonate a client after authentication** user right to additional accounts that are required by those components, such as IUSR\\_*&lt;ComputerName&gt;*, IIS\\_WPG, ASP.NET, or IWAM\\_*&lt;ComputerName&gt;*.\n\n## Related topics\n\n- [User Rights Assignment](user-rights-assignment.md)\n"}