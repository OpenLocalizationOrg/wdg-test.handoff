{"nodes":[{"content":"Verify That Network Traffic Is Authenticated (Windows 10)","pos":[11,68]},{"content":"Verify That Network Traffic Is Authenticated","pos":[82,126]},{"content":"Verify That Network Traffic Is Authenticated","pos":[282,326]},{"content":"Applies to","pos":[330,340]},{"content":"Windows 10","pos":[347,357]},{"content":"Windows Server 2016 Technical Preview","pos":[362,399]},{"content":"After you have configured your domain isolation rule to request, rather than require, authentication, you must confirm that the network traffic sent by the devices on the network is being protected by IPsec authentication as expected.","pos":[401,635]},{"content":"If you switch your rules to require authentication before all of the devices have received and applied the correct GPOs, or if there are any errors in your rules, then communications on the network can fail.","pos":[636,843]},{"content":"By first setting the rules to request authentication, any network connections that fail authentication can continue in clear text while you diagnose and troubleshoot.","pos":[844,1010]},{"content":"In these procedures, you confirm that the rules you deployed are working correctly.","pos":[1012,1095]},{"content":"Your next steps depend on which zone you are working on:","pos":[1096,1152]},{"content":"Main domain isolation zone.","pos":[1160,1187]},{"content":"Before you convert your main domain isolation IPsec rule from request mode to require mode, you must make sure that the network traffic is protected according to your design.","pos":[1190,1364]},{"content":"By configuring your rules to request and not require authentication at the beginning of operations, devices on the network can continue to communicate even when the main mode authentication or quick mode integrity and encryption rules are not working correctly.","pos":[1365,1626]},{"content":"For example, if your encryption zone contains rules that require a certain encryption algorithm, but that algorithm is not included in a security method combination on the clients, then those clients cannot successfully negotiate a quick mode security association, and the server refuses to accept network traffic from the client.","pos":[1627,1957]},{"content":"By first using request mode only, you have the opportunity to deploy your rules and then examine the network traffic to see if they are working as expected without risking a loss of communications.","pos":[1958,2155]},{"content":"Boundary zone.","pos":[2163,2177]},{"content":"Confirming correct operation of IPsec is the last step if you are working on the boundary zone GPO.","pos":[2180,2279]},{"content":"You do not convert the GPO to require mode at any time.","pos":[2280,2335]},{"content":"Encryption zone.","pos":[2343,2359]},{"content":"Similar to the main isolation zone, after you confirm that the network traffic to zone members is properly authenticated and encrypted, you must convert your zone rules from request mode to require mode.","pos":[2362,2565]},{"content":"<bpt id=\"p1\">**</bpt>Note:<ept id=\"p1\">**</ept>  In addition to the steps shown in this procedure, you can also use network traffic capture tools such as Microsoft Network Monitor, which can be downloaded from <bpt id=\"p2\">&lt;</bpt>http://go.microsoft.com/fwlink/?linkid=94770<ept id=\"p2\">&gt;</ept>.","pos":[2568,2787]},{"content":"Network Monitor and similar tools allow you to capture, parse, and display the network packets received by the network adapter on your device.","pos":[2788,2930]},{"content":"Current versions of these tools include full support for IPsec.","pos":[2931,2994]},{"content":"They can identify encrypted network packets, but they cannot decrypt them.","pos":[2995,3069]},{"content":"Administrative credentials","pos":[3076,3102]},{"content":"To complete these procedures, you must be a member of the Domain Administrators group, or otherwise be delegated permissions to modify the GPOs.","pos":[3106,3250]},{"content":"To verify that network connections are authenticated by using the Windows Firewall with Advanced Security console","pos":[3255,3368]},{"content":"Open the Windows Firewall with Advanced Security console.","pos":[3374,3431]},{"pos":[3437,3529],"content":"In the navigation pane, expand <bpt id=\"p1\">**</bpt>Monitoring<ept id=\"p1\">**</ept>, and then click <bpt id=\"p2\">**</bpt>Connection Security Rules<ept id=\"p2\">**</ept>."},{"content":"The details pane displays the rules currently in effect on the device.","pos":[3535,3605]},{"content":"To display the Rule Source column","pos":[3613,3646]},{"pos":[3658,3737],"content":"In the <bpt id=\"p1\">**</bpt>Actions<ept id=\"p1\">**</ept> pane, click <bpt id=\"p2\">**</bpt>View<ept id=\"p2\">**</ept>, and then click <bpt id=\"p3\">**</bpt>Add/Remove Columns<ept id=\"p3\">**</ept>."},{"pos":[3747,3829],"content":"In the <bpt id=\"p1\">**</bpt>Available columns<ept id=\"p1\">**</ept> list, select <bpt id=\"p2\">**</bpt>Rule Source<ept id=\"p2\">**</ept>, and then click <bpt id=\"p3\">**</bpt>Add<ept id=\"p3\">**</ept>."},{"content":"Use the <bpt id=\"p1\">**</bpt>Move up<ept id=\"p1\">**</ept> and <bpt id=\"p2\">**</bpt>Move down<ept id=\"p2\">**</ept> buttons to rearrange the order.","pos":[3839,3908]},{"content":"Click <bpt id=\"p1\">**</bpt>OK<ept id=\"p1\">**</ept> when you are finished.","pos":[3909,3944]},{"content":"It can take a few moments for the list to be refreshed with the newly added column.","pos":[3954,4037]},{"content":"Examine the list for the rules from GPOs that you expect to be applied to this device.","pos":[4043,4129]},{"content":"<bpt id=\"p1\">**</bpt>Note:<ept id=\"p1\">**</ept>  If the rules do not appear in the list, then troubleshoot the GPO security group and the WMI filters that are applied to the GPO.","pos":[4136,4276]},{"content":"Make sure that the local device is a member of the appropriate groups and meets the requirements of the WMI filters.","pos":[4277,4393]},{"pos":[4398,4485],"content":"In the navigation pane, expand <bpt id=\"p1\">**</bpt>Security Associations<ept id=\"p1\">**</ept>, and then click <bpt id=\"p2\">**</bpt>Main Mode<ept id=\"p2\">**</ept>."},{"content":"The current list of main mode associations that have been negotiated with other devices appears in the details column.","pos":[4491,4609]},{"content":"Examine the list of main mode security associations for sessions between the local device and the remote device.","pos":[4615,4727]},{"content":"Make sure that the <bpt id=\"p1\">**</bpt>1st Authentication Method<ept id=\"p1\">**</ept> and <bpt id=\"p2\">**</bpt>2nd Authentication Method<ept id=\"p2\">**</ept> columns contain expected values.","pos":[4728,4843]},{"content":"If your rules specify only a first authentication method, then the <bpt id=\"p1\">**</bpt>2nd Authentication Method<ept id=\"p1\">**</ept> column displays <bpt id=\"p2\">**</bpt>No authentication<ept id=\"p2\">**</ept>.","pos":[4844,4979]},{"content":"If you double-click the row, then the <bpt id=\"p1\">**</bpt>Properties<ept id=\"p1\">**</ept> dialog box appears with additional details about the security association.","pos":[4980,5107]},{"pos":[5113,5158],"content":"In the navigation pane, click <bpt id=\"p1\">**</bpt>Quick mode<ept id=\"p1\">**</ept>."},{"content":"Examine the list of quick mode security associations for sessions between the local device and the remote device.","pos":[5164,5277]},{"content":"Make sure that the <bpt id=\"p1\">**</bpt>AH Integrity<ept id=\"p1\">**</ept>, <bpt id=\"p2\">**</bpt>ESP integrity<ept id=\"p2\">**</ept>, and <bpt id=\"p3\">**</bpt>ESP Confidentiality<ept id=\"p3\">**</ept> columns contain expected values.","pos":[5278,5394]}],"content":"---\ntitle: Verify That Network Traffic Is Authenticated (Windows 10)\ndescription: Verify That Network Traffic Is Authenticated\nms.assetid: cc1fb973-aedf-4074-ad4a-7376b24f03d2\nms.prod: w10\nms.mktglfcycl: deploy\nms.sitesec: library\nms.pagetype: security\nauthor: brianlic-msft\n---\n\n# Verify That Network Traffic Is Authenticated\n\n**Applies to**\n-   Windows 10\n-   Windows Server 2016 Technical Preview\n\nAfter you have configured your domain isolation rule to request, rather than require, authentication, you must confirm that the network traffic sent by the devices on the network is being protected by IPsec authentication as expected. If you switch your rules to require authentication before all of the devices have received and applied the correct GPOs, or if there are any errors in your rules, then communications on the network can fail. By first setting the rules to request authentication, any network connections that fail authentication can continue in clear text while you diagnose and troubleshoot.\n\nIn these procedures, you confirm that the rules you deployed are working correctly. Your next steps depend on which zone you are working on:\n\n-   **Main domain isolation zone.** Before you convert your main domain isolation IPsec rule from request mode to require mode, you must make sure that the network traffic is protected according to your design. By configuring your rules to request and not require authentication at the beginning of operations, devices on the network can continue to communicate even when the main mode authentication or quick mode integrity and encryption rules are not working correctly. For example, if your encryption zone contains rules that require a certain encryption algorithm, but that algorithm is not included in a security method combination on the clients, then those clients cannot successfully negotiate a quick mode security association, and the server refuses to accept network traffic from the client. By first using request mode only, you have the opportunity to deploy your rules and then examine the network traffic to see if they are working as expected without risking a loss of communications.\n\n-   **Boundary zone.** Confirming correct operation of IPsec is the last step if you are working on the boundary zone GPO. You do not convert the GPO to require mode at any time.\n\n-   **Encryption zone.** Similar to the main isolation zone, after you confirm that the network traffic to zone members is properly authenticated and encrypted, you must convert your zone rules from request mode to require mode.\n\n>**Note:**  In addition to the steps shown in this procedure, you can also use network traffic capture tools such as Microsoft Network Monitor, which can be downloaded from <http://go.microsoft.com/fwlink/?linkid=94770>. Network Monitor and similar tools allow you to capture, parse, and display the network packets received by the network adapter on your device. Current versions of these tools include full support for IPsec. They can identify encrypted network packets, but they cannot decrypt them.\n\n \n\n**Administrative credentials**\n\nTo complete these procedures, you must be a member of the Domain Administrators group, or otherwise be delegated permissions to modify the GPOs.\n\n## To verify that network connections are authenticated by using the Windows Firewall with Advanced Security console\n\n1.  Open the Windows Firewall with Advanced Security console.\n\n2.  In the navigation pane, expand **Monitoring**, and then click **Connection Security Rules**.\n\n    The details pane displays the rules currently in effect on the device.\n\n3.  **To display the Rule Source column**\n\n    1.  In the **Actions** pane, click **View**, and then click **Add/Remove Columns**.\n\n    2.  In the **Available columns** list, select **Rule Source**, and then click **Add**.\n\n    3.  Use the **Move up** and **Move down** buttons to rearrange the order. Click **OK** when you are finished.\n\n        It can take a few moments for the list to be refreshed with the newly added column.\n\n4.  Examine the list for the rules from GPOs that you expect to be applied to this device.\n\n    >**Note:**  If the rules do not appear in the list, then troubleshoot the GPO security group and the WMI filters that are applied to the GPO. Make sure that the local device is a member of the appropriate groups and meets the requirements of the WMI filters.\n5.  In the navigation pane, expand **Security Associations**, and then click **Main Mode**.\n\n    The current list of main mode associations that have been negotiated with other devices appears in the details column.\n\n6.  Examine the list of main mode security associations for sessions between the local device and the remote device. Make sure that the **1st Authentication Method** and **2nd Authentication Method** columns contain expected values. If your rules specify only a first authentication method, then the **2nd Authentication Method** column displays **No authentication**. If you double-click the row, then the **Properties** dialog box appears with additional details about the security association.\n\n7.  In the navigation pane, click **Quick mode**.\n\n8.  Examine the list of quick mode security associations for sessions between the local device and the remote device. Make sure that the **AH Integrity**, **ESP integrity**, and **ESP Confidentiality** columns contain expected values.\n"}