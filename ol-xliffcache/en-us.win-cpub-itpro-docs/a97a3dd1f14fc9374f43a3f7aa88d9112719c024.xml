{"nodes":[{"content":"Planning for Server Security","pos":[11,39]},{"content":"Planning for Server Security","pos":[53,81]},{"content":"Planning for Server Security","pos":[255,283]},{"content":"To enhance the security of an environment, you must look at the exposure to any potential threats in the environment.","pos":[286,403]},{"content":"Providing security for an App-V infrastructure requires you to use the specific App-V security features as well as the security practices and features for the underlying infrastructure.","pos":[404,589]},{"content":"Securing the underlying infrastructure for services such as Internet Information Services (IIS), Active Directory Domain Services, and SQL Server will improve the overall security for your App-V system.","pos":[590,792]},{"content":"The default settings for the server installation provide the highest levels of security.","pos":[794,882]},{"content":"However, some of the components rely on underlying infrastructure that is not configured as part of the installation.","pos":[883,1000]},{"content":"Following up with post-installation steps will enhance the security of the App-V infrastructure.","pos":[1001,1097]},{"content":"The content directory contains all of the packages that are to be streamed to clients.","pos":[1099,1185]},{"content":"These resources need to be as secure as possible to eliminate many possible security threats.","pos":[1186,1279]},{"content":"The following list offers some additional guidance:","pos":[1280,1331]},{"content":"UNC-based publishing and/or streaming—The permissions for this item should be the most restrictive in the environment.","pos":[1337,1455]},{"content":"Use NTFS permissions to implement the most restrictive access control lists (ACLs) for the content directory (Users=Read, Administrators=Read and Write).","pos":[1456,1609]},{"content":"IIS used for publishing and/or streaming—Configure IIS to support only Windows Integrated authentication.","pos":[1615,1720]},{"content":"Remove anonymous access to the IIS server, and restrict access to the directory with NTFS permissions.","pos":[1721,1823]},{"content":"RTSP/RTSPS to stream application packages—Configure the App-V Provider Policy to require authentication, enforce access permissions, and enable only required groups to have access to the provider policy.","pos":[1829,2032]},{"content":"Configure applications with the appropriate permissions in the database.","pos":[2033,2105]},{"content":"Keep the number of users with administrative privileges to a minimum to reduce possible threats to the data in the data store and to avoid publishing malicious applications into the infrastructure.","pos":[2107,2304]},{"content":"Application Virtualization Security","pos":[2310,2345]},{"content":"App-V uses several methods of communication between the various components of the infrastructure.","pos":[2348,2445]},{"content":"When you plan your App-V infrastructure, securing the communications between servers can reduce the security risks that might already be present on the existing network.","pos":[2446,2615]},{"content":"Data Store","pos":[2621,2631]},{"content":"The Application Virtualization Management Server and Application Virtualization Management Service communicate with the data store by using an SQL connection over TCP port 1433.","pos":[2633,2810]},{"content":"The Management Server uses the data store to retrieve application and configuration data, and it writes usage information to the database.","pos":[2811,2949]},{"content":"The Management Service communicates with the data store on behalf of an administrator who is configuring the App-V infrastructure.","pos":[2950,3080]},{"content":"Because the data store contains critical information, it is important to minimize threats to this data.","pos":[3081,3184]},{"content":"It is recommended that communications between App-V Management Server, Management Service and the data store be secured with Internet Protocol Security (IPsec).","pos":[3186,3346]},{"content":"Specifically, create policies that secure the communication channel between the data store (SQL) and the Management Server and the data store and the Management Service.","pos":[3347,3516]},{"content":"You can also deploy server and domain isolation with IPsec, ensuring all App-V infrastructure components communicate only with secure channels.","pos":[3517,3660]},{"content":"For information about implementing IPsec, refer to the following documentation:","pos":[3661,3740]},{"pos":[3746,3871],"content":"For Windows Server 2003, see <bpt id=\"p1\">&lt;</bpt>http://go.microsoft.com/fwlink/?LinkId=133226<ept id=\"p1\">&gt;</ept> (http://go.microsoft.com/fwlink/?LinkId=133226)."},{"pos":[3877,4002],"content":"For Windows Server 2008, see <bpt id=\"p1\">&lt;</bpt>http://go.microsoft.com/fwlink/?LinkId=133227<ept id=\"p1\">&gt;</ept> (http://go.microsoft.com/fwlink/?LinkId=133227)."},{"content":"Content Directory","pos":[4008,4025]},{"content":"The App-V Management Server installation configures a location for the content directory.","pos":[4027,4116]},{"content":"This directory is the storage location for virtualized application packages.","pos":[4117,4193]},{"content":"This location can be local to the server, or it can be placed on a remote network share.","pos":[4194,4282]},{"content":"Therefore, implement IPsec to help secure the communication with a remote location for the content directory.","pos":[4283,4392]},{"content":"You can also use a virtual directory on an IIS server to stream packages to the clients.","pos":[4394,4482]},{"content":"If the virtual directory that is created for content is located on a remote source, use IPsec to help secure the communication between the IIS server and the remote storage location.","pos":[4483,4665]},{"content":"The content directory contains all of the packages that are streamed to clients.","pos":[4667,4747]},{"content":"These resources need to be as secure as possible to eliminate many possible security threats.","pos":[4748,4841]},{"content":"Security Protocols","pos":[4847,4865]},{"content":"You can use RTSPS or HTTPS for enhanced secure communications.","pos":[4867,4929]},{"content":"RTSPS is the protocol used by App-V servers, and HTTPS is the protocol used by IIS servers.","pos":[4930,5021]},{"content":"These protocols are used when publishing applications from the server to the Application Virtualization Desktop Client.","pos":[5022,5141]},{"content":"After you determine the desired protocol, add a publishing server that uses that protocol.","pos":[5142,5232]},{"pos":[5295,5330],"content":"Configuring App-V Servers for RTSPS"},{"content":"Installing or configuring an App-V Management Server or Streaming Server to use Enhanced Security (for example, TLS) requires that an X.509 V3 certificate be provisioned to the App-V server.","pos":[5332,5522]},{"content":"When you prepare to install or configure security for a server, you must fulfill some specific requirements.","pos":[5523,5631]},{"content":"Technical requirements for deploying and configuring certificates for a more secure App-V Management Server or Streaming Server include the following:","pos":[5632,5782]},{"content":"Certificate must be valid.","pos":[5788,5814]},{"content":"Otherwise, the client terminates the connection.","pos":[5815,5863]},{"content":"Certificate must contain the correct Enhanced Key Usage (EKU) - Server Authentication (OID 1.3.6.1.5.5.7.3.1).","pos":[5869,5979]},{"content":"Otherwise, the client terminates the connection.","pos":[5980,6028]},{"content":"Certificate fully qualified domain name (FQDN) must match the server on which it is installed.","pos":[6034,6128]},{"content":"For example, if the client is calling <ph id=\"ph1\">`RTSPS://Myserver.mycompany.com/content/MyApp.sft`</ph>, but the certificate <bpt id=\"p1\">**</bpt>Issued To<ept id=\"p1\">**</ept> field contains <ph id=\"ph2\">`Myserver1.mycompany.com`</ph>, the client will not connect to the server and the session is terminated, even if <ph id=\"ph3\">`Myserver.mycompany.com`</ph> and <ph id=\"ph4\">`Myserver1.mycompany.com`</ph> resolve to the same IP address.","pos":[6129,6462]},{"pos":[6468,6831],"content":"**Note**  \nIf you use App-V in a network load balanced cluster, the certificate must be configured with *Subject Alternate Names* (SANs) to support RTSPS. For information about configuring the certification authority (CA) and creating certificates with SANs, see <http://go.microsoft.com/fwlink/?LinkId=133228> (http://go.microsoft.com/fwlink/?LinkId=133228).","leadings":["","    "],"nodes":[{"content":"Note","pos":[2,6]},{"content":"If you use App-V in a network load balanced cluster, the certificate must be configured with *Subject Alternate Names* (SANs) to support RTSPS. For information about configuring the certification authority (CA) and creating certificates with SANs, see <http://go.microsoft.com/fwlink/?LinkId=133228> (http://go.microsoft.com/fwlink/?LinkId=133228).","pos":[11,359],"nodes":[{"content":"If you use App-V in a network load balanced cluster, the certificate must be configured with <bpt id=\"p1\">*</bpt>Subject Alternate Names<ept id=\"p1\">*</ept> (SANs) to support RTSPS.","pos":[0,143]},{"content":"For information about configuring the certification authority (CA) and creating certificates with SANs, see <bpt id=\"p1\">&lt;</bpt>http://go.microsoft.com/fwlink/?LinkId=133228<ept id=\"p1\">&gt;</ept> (http://go.microsoft.com/fwlink/?LinkId=133228).","pos":[144,348]}]}]},{"content":"The CA issuing the certificate to the App-V server must be trusted by the client connecting to the server.","pos":[6844,6950]},{"content":"Otherwise, the client terminates the connection.","pos":[6951,6999]},{"content":"You must change the permissions for the <bpt id=\"p1\">*</bpt>Certificate Private Key<ept id=\"p1\">*</ept> to enable access by the Server App-V Service.","pos":[7005,7116]},{"content":"By default, the App-V Management Server and Streaming Server services run under the Network Service account.","pos":[7117,7225]},{"content":"When a PKCS<ph id=\"ph1\">\\#</ph>10 is generated on the server, a private key is created.","pos":[7226,7295]},{"content":"Only the Local System and Administrators groups have access to this key.","pos":[7296,7368]},{"content":"These default ACLs prevent the App-V server from accepting secure connections.","pos":[7369,7447]},{"pos":[7453,7637],"content":"**Note**  \nFor information about configuring a public key infrastructure (PKI), see <http://go.microsoft.com/fwlink/?LinkId=133229> (http://go.microsoft.com/fwlink/?LinkId=133229).","leadings":["","    "],"nodes":[{"content":"Note","pos":[2,6]},{"content":"For information about configuring a public key infrastructure (PKI), see <bpt id=\"p1\">&lt;</bpt>http://go.microsoft.com/fwlink/?LinkId=133229<ept id=\"p1\">&gt;</ept> (http://go.microsoft.com/fwlink/?LinkId=133229).","pos":[11,180]}]},{"content":"Configuring IIS Servers with HTTPS","pos":[7650,7684]},{"content":"App-V might use IIS servers in certain infrastructure configurations.","pos":[7686,7755]},{"content":"For more information about configuring IIS servers, see <bpt id=\"p1\">&lt;</bpt>http://go.microsoft.com/fwlink/?LinkId=133230<ept id=\"p1\">&gt;</ept> (http://go.microsoft.com/fwlink/?LinkId=133230).","pos":[7756,7908]},{"content":"Note","pos":[7912,7916]},{"content":"If you are using IIS to publish the ICO and OSD files, configure a MIME type for OSD=TXT; otherwise, IIS will refuse to serve the ICO and OSD files to clients.","pos":[7921,8080]},{"content":"Application-Level Security","pos":[8089,8115]},{"content":"You can configure the servers to stream specific applications to a user’s desktop.","pos":[8117,8199]},{"content":"However, access permission actually is granted at the package level, not at the application level.","pos":[8200,8298]},{"content":"Although a specific application might not be published to the user’s desktop, if the user has permission to add applications or is an administrator on the client computer, the user can create and use a shortcut on the client to run all the applications in a package.","pos":[8299,8565]},{"content":"Configuring App-V Administration for a Distributed Environment","pos":[8570,8632]},{"content":"When designing the infrastructure for your specific organization, you can install the App-V Management Web Service on a computer other than the computer where you install the App-V Management Server.","pos":[8635,8834]},{"content":"Common reasons for separating these App-V components include the following:","pos":[8835,8910]},{"content":"Performance","pos":[8916,8927]},{"content":"Reliability","pos":[8933,8944]},{"content":"Availability","pos":[8950,8962]},{"content":"Scalability","pos":[8968,8979]},{"content":"For the infrastructure to operate correctly, separating the App-V Management Console, Management Server and Management Web Service requires additional configuration.","pos":[8981,9146]},{"content":"For detailed information about how to configure the server, see <bpt id=\"p1\">[</bpt>How to Configure the Server to be Trusted for Delegation<ept id=\"p1\">](how-to-configure-the-server-to-be-trusted-for-delegation.md)</ept>.","pos":[9147,9331]},{"content":"Related topics","pos":[9336,9350]},{"content":"Planning for Security and Protection","pos":[9354,9390]}],"content":"---\ntitle: Planning for Server Security\ndescription: Planning for Server Security\nauthor: jamiejdt\nms.assetid: c7cd8227-b359-41e7-a8ae-d0d5718a76a2\nms.pagetype: mdop, appcompat, virtualization\nms.mktglfcycl: deploy\nms.sitesec: library\nms.prod: w8\n---\n\n\n# Planning for Server Security\n\n\nTo enhance the security of an environment, you must look at the exposure to any potential threats in the environment. Providing security for an App-V infrastructure requires you to use the specific App-V security features as well as the security practices and features for the underlying infrastructure. Securing the underlying infrastructure for services such as Internet Information Services (IIS), Active Directory Domain Services, and SQL Server will improve the overall security for your App-V system.\n\nThe default settings for the server installation provide the highest levels of security. However, some of the components rely on underlying infrastructure that is not configured as part of the installation. Following up with post-installation steps will enhance the security of the App-V infrastructure.\n\nThe content directory contains all of the packages that are to be streamed to clients. These resources need to be as secure as possible to eliminate many possible security threats. The following list offers some additional guidance:\n\n-   UNC-based publishing and/or streaming—The permissions for this item should be the most restrictive in the environment. Use NTFS permissions to implement the most restrictive access control lists (ACLs) for the content directory (Users=Read, Administrators=Read and Write).\n\n-   IIS used for publishing and/or streaming—Configure IIS to support only Windows Integrated authentication. Remove anonymous access to the IIS server, and restrict access to the directory with NTFS permissions.\n\n-   RTSP/RTSPS to stream application packages—Configure the App-V Provider Policy to require authentication, enforce access permissions, and enable only required groups to have access to the provider policy. Configure applications with the appropriate permissions in the database.\n\nKeep the number of users with administrative privileges to a minimum to reduce possible threats to the data in the data store and to avoid publishing malicious applications into the infrastructure.\n\n##  Application Virtualization Security\n\n\nApp-V uses several methods of communication between the various components of the infrastructure. When you plan your App-V infrastructure, securing the communications between servers can reduce the security risks that might already be present on the existing network.\n\n### Data Store\n\nThe Application Virtualization Management Server and Application Virtualization Management Service communicate with the data store by using an SQL connection over TCP port 1433. The Management Server uses the data store to retrieve application and configuration data, and it writes usage information to the database. The Management Service communicates with the data store on behalf of an administrator who is configuring the App-V infrastructure. Because the data store contains critical information, it is important to minimize threats to this data.\n\nIt is recommended that communications between App-V Management Server, Management Service and the data store be secured with Internet Protocol Security (IPsec). Specifically, create policies that secure the communication channel between the data store (SQL) and the Management Server and the data store and the Management Service. You can also deploy server and domain isolation with IPsec, ensuring all App-V infrastructure components communicate only with secure channels. For information about implementing IPsec, refer to the following documentation:\n\n-   For Windows Server 2003, see <http://go.microsoft.com/fwlink/?LinkId=133226> (http://go.microsoft.com/fwlink/?LinkId=133226).\n\n-   For Windows Server 2008, see <http://go.microsoft.com/fwlink/?LinkId=133227> (http://go.microsoft.com/fwlink/?LinkId=133227).\n\n### Content Directory\n\nThe App-V Management Server installation configures a location for the content directory. This directory is the storage location for virtualized application packages. This location can be local to the server, or it can be placed on a remote network share. Therefore, implement IPsec to help secure the communication with a remote location for the content directory.\n\nYou can also use a virtual directory on an IIS server to stream packages to the clients. If the virtual directory that is created for content is located on a remote source, use IPsec to help secure the communication between the IIS server and the remote storage location.\n\nThe content directory contains all of the packages that are streamed to clients. These resources need to be as secure as possible to eliminate many possible security threats.\n\n### Security Protocols\n\nYou can use RTSPS or HTTPS for enhanced secure communications. RTSPS is the protocol used by App-V servers, and HTTPS is the protocol used by IIS servers. These protocols are used when publishing applications from the server to the Application Virtualization Desktop Client. After you determine the desired protocol, add a publishing server that uses that protocol.\n\n### <a href=\"\" id=\"configuring-app-v-servers-for-rtsps-\"></a>Configuring App-V Servers for RTSPS\n\nInstalling or configuring an App-V Management Server or Streaming Server to use Enhanced Security (for example, TLS) requires that an X.509 V3 certificate be provisioned to the App-V server. When you prepare to install or configure security for a server, you must fulfill some specific requirements. Technical requirements for deploying and configuring certificates for a more secure App-V Management Server or Streaming Server include the following:\n\n-   Certificate must be valid. Otherwise, the client terminates the connection.\n\n-   Certificate must contain the correct Enhanced Key Usage (EKU) - Server Authentication (OID 1.3.6.1.5.5.7.3.1). Otherwise, the client terminates the connection.\n\n-   Certificate fully qualified domain name (FQDN) must match the server on which it is installed. For example, if the client is calling `RTSPS://Myserver.mycompany.com/content/MyApp.sft`, but the certificate **Issued To** field contains `Myserver1.mycompany.com`, the client will not connect to the server and the session is terminated, even if `Myserver.mycompany.com` and `Myserver1.mycompany.com` resolve to the same IP address.\n\n    **Note**  \n    If you use App-V in a network load balanced cluster, the certificate must be configured with *Subject Alternate Names* (SANs) to support RTSPS. For information about configuring the certification authority (CA) and creating certificates with SANs, see <http://go.microsoft.com/fwlink/?LinkId=133228> (http://go.microsoft.com/fwlink/?LinkId=133228).\n\n     \n\n-   The CA issuing the certificate to the App-V server must be trusted by the client connecting to the server. Otherwise, the client terminates the connection.\n\n-   You must change the permissions for the *Certificate Private Key* to enable access by the Server App-V Service. By default, the App-V Management Server and Streaming Server services run under the Network Service account. When a PKCS\\#10 is generated on the server, a private key is created. Only the Local System and Administrators groups have access to this key. These default ACLs prevent the App-V server from accepting secure connections.\n\n    **Note**  \n    For information about configuring a public key infrastructure (PKI), see <http://go.microsoft.com/fwlink/?LinkId=133229> (http://go.microsoft.com/fwlink/?LinkId=133229).\n\n     \n\n### Configuring IIS Servers with HTTPS\n\nApp-V might use IIS servers in certain infrastructure configurations. For more information about configuring IIS servers, see <http://go.microsoft.com/fwlink/?LinkId=133230> (http://go.microsoft.com/fwlink/?LinkId=133230).\n\n**Note**  \nIf you are using IIS to publish the ICO and OSD files, configure a MIME type for OSD=TXT; otherwise, IIS will refuse to serve the ICO and OSD files to clients.\n\n \n\n### Application-Level Security\n\nYou can configure the servers to stream specific applications to a user’s desktop. However, access permission actually is granted at the package level, not at the application level. Although a specific application might not be published to the user’s desktop, if the user has permission to add applications or is an administrator on the client computer, the user can create and use a shortcut on the client to run all the applications in a package.\n\n## Configuring App-V Administration for a Distributed Environment\n\n\nWhen designing the infrastructure for your specific organization, you can install the App-V Management Web Service on a computer other than the computer where you install the App-V Management Server. Common reasons for separating these App-V components include the following:\n\n-   Performance\n\n-   Reliability\n\n-   Availability\n\n-   Scalability\n\nFor the infrastructure to operate correctly, separating the App-V Management Console, Management Server and Management Web Service requires additional configuration. For detailed information about how to configure the server, see [How to Configure the Server to be Trusted for Delegation](how-to-configure-the-server-to-be-trusted-for-delegation.md).\n\n## Related topics\n\n\n[Planning for Security and Protection](planning-for-security-and-protection.md)\n\n \n\n \n\n\n\n\n\n"}