{"nodes":[{"content":"Planning Server Isolation Zones (Windows 10)","pos":[11,55]},{"content":"Planning Server Isolation Zones","pos":[69,100]},{"content":"Planning Server Isolation Zones","pos":[256,287]},{"content":"Applies to","pos":[291,301]},{"content":"Windows 10","pos":[308,318]},{"content":"Windows Server 2016 Technical Preview","pos":[323,360]},{"content":"Sometimes a server hosts data that is sensitive.","pos":[362,410]},{"content":"If your servers host data that must not be compromised, you have several options to help protect that data.","pos":[411,518]},{"content":"One was already addressed: adding the server to the encryption zone.","pos":[519,587]},{"content":"Membership in that zone prevents the server from being accessed by any devices that are outside the isolated domain, and encrypts all network connections to server.","pos":[588,752]},{"content":"The second option is to additionally restrict access to the server, not just to members of the isolated domain, but to only those users or devices who have business reasons to access the resources on the server.","pos":[754,965]},{"content":"You can specify only approved users, or you can additionally specify that the approved users can only access the server from approved devices.","pos":[966,1108]},{"content":"To grant access, you add the approved user and device accounts to network access groups (NAGs) that are referenced in a firewall rule on this server.","pos":[1110,1259]},{"content":"When the user sends a request to the server, the standard domain isolation rules are invoked.","pos":[1260,1353]},{"content":"This causes IKE to use Kerberos V5 to exchange credentials with the server.","pos":[1354,1429]},{"content":"The additional firewall rule on the server causes Windows to check the provided device and user accounts for group membership in the NAGs.","pos":[1430,1568]},{"content":"If either the user or device is not a member of a required NAG then the network connection is refused.","pos":[1569,1671]},{"content":"Isolated domains and isolated servers","pos":[1676,1713]},{"content":"If you are using an isolated domain, the client devices already have the IPsec rules to enable them to authenticate traffic when the server requires it.","pos":[1715,1867]},{"content":"If you add an isolated server, it must have a GPO applied to its group with the appropriate connection security and firewall rules.","pos":[1868,1999]},{"content":"The rules enforce authentication and restrict access to only connections that are authenticated as coming from an authorized device or user.","pos":[2000,2140]},{"content":"If you are not using an isolated domain, but still want to isolate a server that uses IPsec, you must configure the client devices that you want to access the server to use the appropriate IPsec rules.","pos":[2142,2343]},{"content":"If the client devices are members of an Active Directory domain, you can still use Group Policy to configure the clients.","pos":[2344,2465]},{"content":"Instead of applying the GPO to the whole domain, you apply the GPO to only members of the NAG.","pos":[2466,2560]},{"content":"Creating multiple isolated server zones","pos":[2565,2604]},{"content":"Each set of servers that must be accessed by different sets of users should be set up in its own isolated server zone.","pos":[2606,2724]},{"content":"After one set of GPOs for one isolated server zone has been successfully created and verified, you can copy the GPOs to a new set.","pos":[2725,2855]},{"content":"You must change the GPO names to reflect the new zone, the name and membership of the isolated server zone group to which the GPOs are applied, and the names and membership of the NAG groups that determine which clients can access the servers in the isolated server zone.","pos":[2856,3127]},{"content":"Creating the GPOs","pos":[3132,3149]},{"pos":[3151,3404],"content":"Creation of the groups and how to link them to the GPOs that apply the rules to members of the groups are discussed in the <bpt id=\"p1\">[</bpt>Planning Group Policy Deployment for Your Isolation Zones<ept id=\"p1\">](planning-group-policy-deployment-for-your-isolation-zones.md)</ept> section."},{"content":"An isolated server is often a member of the encryption zone.","pos":[3406,3466]},{"content":"Therefore, copying that GPO set serves as a good starting point.","pos":[3467,3531]},{"content":"You then modify the rules to additionally restrict access to only NAG members.","pos":[3532,3610]},{"content":"GPO settings for isolated servers running at least Windows Server 2008","pos":[3616,3686]},{"content":"GPOs for devices running at least Windows Server 2008 should include the following:","pos":[3688,3771]},{"content":"<bpt id=\"p1\">**</bpt>Note:<ept id=\"p1\">**</ept>  The connection security rules described here are identical to the ones for the encryption zone.","pos":[3774,3880]},{"content":"If you do not want to encrypt access and also restrict access to NAG members, you can use connection security rules identical to the main isolated domain.","pos":[3881,4035]},{"content":"You must still add the firewall rule described at the end of this list to change it into an isolated server zone.","pos":[4036,4149]},{"content":"IPsec default settings that specify the following options:","pos":[4155,4213]},{"content":"Exempt all ICMP traffic from IPsec.","pos":[4223,4258]},{"content":"Key exchange (main mode) security methods and algorithm.","pos":[4268,4324]},{"content":"We recommend that you do not include Diffie-Hellman Group 1, DES, or MD5 in any setting.","pos":[4325,4413]},{"content":"They are included only for compatibility with previous versions of Windows.","pos":[4414,4489]},{"content":"Use the strongest algorithm combinations that are common to all your supported operating systems.","pos":[4490,4587]},{"content":"Data protection (quick mode) algorithm combinations.","pos":[4597,4649]},{"content":"Check <bpt id=\"p1\">**</bpt>Require encryption for all connection security rules that use these settings<ept id=\"p1\">**</ept>, and then specify one or more integrity and encryption combinations.","pos":[4650,4805]},{"content":"We recommend that you do not include DES or MD5 in any setting.","pos":[4806,4869]},{"content":"They are included only for compatibility with previous versions of Windows.","pos":[4870,4945]},{"content":"Use the strongest algorithm combinations that are common to all your supported operating systems.","pos":[4946,5043]},{"content":"If any NAT devices are present on your networks, do not use AH because it cannot traverse NAT devices.","pos":[5053,5155]},{"content":"If isolated servers must communicate with hosts in the encryption zone, include an algorithm that is compatible with the requirements of the encryption zone GPOs.","pos":[5156,5318]},{"content":"Authentication methods.","pos":[5328,5351]},{"content":"Include at least device-based Kerberos V5 authentication for compatibility with the rest of the isolated domain.","pos":[5352,5464]},{"content":"If you want to restrict access to specific user accounts, also include user-based Kerberos V5 authentication as an optional authentication method.","pos":[5465,5611]},{"content":"Do not make the user-based authentication method mandatory, or else devices that cannot use AuthIP instead of IKE, including Windows XP and Windows Server 2003, cannot communicate.","pos":[5612,5792]},{"content":"Likewise, if any of your domain isolation members cannot use Kerberos V5, include certificate-based authentication as an optional authentication method.","pos":[5793,5945]},{"content":"The following connection security and firewall rules:","pos":[5951,6004]},{"content":"A connection security rule that exempts all devices on the exemption list from authentication.","pos":[6014,6108]},{"content":"Be sure to include all your Active Directory domain controllers on this list.","pos":[6109,6186]},{"content":"Enter subnet addresses, if applicable in your environment.","pos":[6187,6245]},{"pos":[6255,6425],"content":"A connection security rule, from <bpt id=\"p1\">**</bpt>Any IP address<ept id=\"p1\">**</ept> to <bpt id=\"p2\">**</bpt>Any IP address<ept id=\"p2\">**</ept>, that requires inbound and requests outbound authentication by using Kerberos V5 authentication."},{"content":"<bpt id=\"p1\">**</bpt>Important:<ept id=\"p1\">**</ept>  Be sure to begin operations by using request in and request out behavior until you are sure that all the devices in your IPsec environment are communicating successfully by using IPsec.","pos":[6436,6637]},{"content":"After confirming that IPsec is operating as expected, you can change the GPO to require in, request out.","pos":[6638,6742]},{"pos":[6752,6947],"content":"A firewall rule that specifies <bpt id=\"p1\">**</bpt>Allow only secure connections<ept id=\"p1\">**</ept>, <bpt id=\"p2\">**</bpt>Require encryption<ept id=\"p2\">**</ept>, and on the <bpt id=\"p3\">**</bpt>Users and Computers<ept id=\"p3\">**</ept> tab includes references to both device and user network access groups."},{"content":"A registry policy that includes the following values:","pos":[6953,7006]},{"content":"Enable PMTU discovery.","pos":[7016,7038]},{"content":"Enabling this setting allows TCP/IP to dynamically determine the largest packet size supported across a connection.","pos":[7039,7154]},{"content":"The value is found at HKLM<ph id=\"ph1\">\\\\</ph>System<ph id=\"ph2\">\\\\</ph>CurrentControlSet<ph id=\"ph3\">\\\\</ph>Services<ph id=\"ph4\">\\\\</ph>TCPIP<ph id=\"ph5\">\\\\</ph>Parameters<ph id=\"ph6\">\\\\</ph>EnablePMTUDiscovery (dword).","pos":[7155,7267]},{"content":"The sample GPO preferences XML file in <bpt id=\"p1\">[</bpt>Appendix A: Sample GPO Template Files for Settings Used in this Guide<ept id=\"p1\">](appendix-a-sample-gpo-template-files-for-settings-used-in-this-guide.md)</ept> sets the value to <bpt id=\"p2\">**</bpt>1<ept id=\"p2\">**</ept>.","pos":[7268,7476]},{"pos":[7483,7694],"content":"<bpt id=\"p1\">**</bpt>Note:<ept id=\"p1\">**</ept>  For a sample template for these registry settings, see <bpt id=\"p2\">[</bpt>Appendix A: Sample GPO Template Files for Settings Used in this Guide<ept id=\"p2\">](appendix-a-sample-gpo-template-files-for-settings-used-in-this-guide.md)</ept>."},{"pos":[7696,7795],"content":"<bpt id=\"p1\">**</bpt>Next: <ept id=\"p1\">**</ept><bpt id=\"p2\">[</bpt>Planning Certificate-based Authentication<ept id=\"p2\">](planning-certificate-based-authentication.md)</ept>"}],"content":"---\ntitle: Planning Server Isolation Zones (Windows 10)\ndescription: Planning Server Isolation Zones\nms.assetid: 5f63c929-589e-4b64-82ea-515d62765b7b\nms.prod: w10\nms.mktglfcycl: deploy\nms.sitesec: library\nms.pagetype: security\nauthor: brianlic-msft\n---\n\n# Planning Server Isolation Zones\n\n**Applies to**\n-   Windows 10\n-   Windows Server 2016 Technical Preview\n\nSometimes a server hosts data that is sensitive. If your servers host data that must not be compromised, you have several options to help protect that data. One was already addressed: adding the server to the encryption zone. Membership in that zone prevents the server from being accessed by any devices that are outside the isolated domain, and encrypts all network connections to server.\n\nThe second option is to additionally restrict access to the server, not just to members of the isolated domain, but to only those users or devices who have business reasons to access the resources on the server. You can specify only approved users, or you can additionally specify that the approved users can only access the server from approved devices.\n\nTo grant access, you add the approved user and device accounts to network access groups (NAGs) that are referenced in a firewall rule on this server. When the user sends a request to the server, the standard domain isolation rules are invoked. This causes IKE to use Kerberos V5 to exchange credentials with the server. The additional firewall rule on the server causes Windows to check the provided device and user accounts for group membership in the NAGs. If either the user or device is not a member of a required NAG then the network connection is refused.\n\n## Isolated domains and isolated servers\n\nIf you are using an isolated domain, the client devices already have the IPsec rules to enable them to authenticate traffic when the server requires it. If you add an isolated server, it must have a GPO applied to its group with the appropriate connection security and firewall rules. The rules enforce authentication and restrict access to only connections that are authenticated as coming from an authorized device or user.\n\nIf you are not using an isolated domain, but still want to isolate a server that uses IPsec, you must configure the client devices that you want to access the server to use the appropriate IPsec rules. If the client devices are members of an Active Directory domain, you can still use Group Policy to configure the clients. Instead of applying the GPO to the whole domain, you apply the GPO to only members of the NAG.\n\n## Creating multiple isolated server zones\n\nEach set of servers that must be accessed by different sets of users should be set up in its own isolated server zone. After one set of GPOs for one isolated server zone has been successfully created and verified, you can copy the GPOs to a new set. You must change the GPO names to reflect the new zone, the name and membership of the isolated server zone group to which the GPOs are applied, and the names and membership of the NAG groups that determine which clients can access the servers in the isolated server zone.\n\n## Creating the GPOs\n\nCreation of the groups and how to link them to the GPOs that apply the rules to members of the groups are discussed in the [Planning Group Policy Deployment for Your Isolation Zones](planning-group-policy-deployment-for-your-isolation-zones.md) section.\n\nAn isolated server is often a member of the encryption zone. Therefore, copying that GPO set serves as a good starting point. You then modify the rules to additionally restrict access to only NAG members.\n\n### GPO settings for isolated servers running at least Windows Server 2008\n\nGPOs for devices running at least Windows Server 2008 should include the following:\n\n>**Note:**  The connection security rules described here are identical to the ones for the encryption zone. If you do not want to encrypt access and also restrict access to NAG members, you can use connection security rules identical to the main isolated domain. You must still add the firewall rule described at the end of this list to change it into an isolated server zone.\n\n-   IPsec default settings that specify the following options:\n\n    1.  Exempt all ICMP traffic from IPsec.\n\n    2.  Key exchange (main mode) security methods and algorithm. We recommend that you do not include Diffie-Hellman Group 1, DES, or MD5 in any setting. They are included only for compatibility with previous versions of Windows. Use the strongest algorithm combinations that are common to all your supported operating systems.\n\n    3.  Data protection (quick mode) algorithm combinations. Check **Require encryption for all connection security rules that use these settings**, and then specify one or more integrity and encryption combinations. We recommend that you do not include DES or MD5 in any setting. They are included only for compatibility with previous versions of Windows. Use the strongest algorithm combinations that are common to all your supported operating systems.\n\n        If any NAT devices are present on your networks, do not use AH because it cannot traverse NAT devices. If isolated servers must communicate with hosts in the encryption zone, include an algorithm that is compatible with the requirements of the encryption zone GPOs.\n\n    4.  Authentication methods. Include at least device-based Kerberos V5 authentication for compatibility with the rest of the isolated domain. If you want to restrict access to specific user accounts, also include user-based Kerberos V5 authentication as an optional authentication method. Do not make the user-based authentication method mandatory, or else devices that cannot use AuthIP instead of IKE, including Windows XP and Windows Server 2003, cannot communicate. Likewise, if any of your domain isolation members cannot use Kerberos V5, include certificate-based authentication as an optional authentication method.\n\n-   The following connection security and firewall rules:\n\n    -   A connection security rule that exempts all devices on the exemption list from authentication. Be sure to include all your Active Directory domain controllers on this list. Enter subnet addresses, if applicable in your environment.\n\n    -   A connection security rule, from **Any IP address** to **Any IP address**, that requires inbound and requests outbound authentication by using Kerberos V5 authentication.\n\n        >**Important:**  Be sure to begin operations by using request in and request out behavior until you are sure that all the devices in your IPsec environment are communicating successfully by using IPsec. After confirming that IPsec is operating as expected, you can change the GPO to require in, request out.\n\n    -   A firewall rule that specifies **Allow only secure connections**, **Require encryption**, and on the **Users and Computers** tab includes references to both device and user network access groups.\n\n-   A registry policy that includes the following values:\n\n    -   Enable PMTU discovery. Enabling this setting allows TCP/IP to dynamically determine the largest packet size supported across a connection. The value is found at HKLM\\\\System\\\\CurrentControlSet\\\\Services\\\\TCPIP\\\\Parameters\\\\EnablePMTUDiscovery (dword). The sample GPO preferences XML file in [Appendix A: Sample GPO Template Files for Settings Used in this Guide](appendix-a-sample-gpo-template-files-for-settings-used-in-this-guide.md) sets the value to **1**.\n\n    >**Note:**  For a sample template for these registry settings, see [Appendix A: Sample GPO Template Files for Settings Used in this Guide](appendix-a-sample-gpo-template-files-for-settings-used-in-this-guide.md).\n\n**Next: **[Planning Certificate-based Authentication](planning-certificate-based-authentication.md)\n"}