{"nodes":[{"content":"Configure a PXE server to load Windows PE (Windows 10)","pos":[11,65]},{"content":"This topic describes how to configure a PXE server to load Windows PE so that it can be used with an image file to install Windows 10 from the network.","pos":[79,230]},{"content":"Configure a PXE server to load Windows PE","pos":[406,447]},{"content":"Applies to","pos":[451,461]},{"content":"Windows 10","pos":[469,479]},{"content":"Summary","pos":[484,491]},{"content":"This walkthrough describes how to configure a PXE server to load Windows PE by booting a client computer from the network.","pos":[493,615]},{"content":"Using the Windows PE tools and a Windows 10 image file, you can install Windows 10 from the network.","pos":[616,716]},{"content":"Prerequisites","pos":[721,734]},{"pos":[738,894],"content":"A deployment computer: A computer with the <bpt id=\"p1\">[</bpt>Windows Assessment and Deployment Kit<ept id=\"p1\">](http://go.microsoft.com/fwlink/p/?LinkId=526803)</ept> (Windows ADK) installed."},{"content":"A DHCP server: A DHCP server or DHCP proxy configured to respond to PXE client requests is required.","pos":[897,997]},{"content":"A PXE server: A server running the TFTP service that can host Windows PE boot files that the client will download.","pos":[1000,1114]},{"content":"A file server: A server hosting a network file share.","pos":[1117,1170]},{"content":"All four of the roles specified above can be hosted on the same computer or each can be on a separate computer.","pos":[1172,1283]},{"content":"Step 1: Copy Windows PE source files","pos":[1288,1324]},{"pos":[1329,1398],"content":"On the deployment computer, click <bpt id=\"p1\">**</bpt>Start<ept id=\"p1\">**</ept>, and type <bpt id=\"p2\">**</bpt>deployment<ept id=\"p2\">**</ept>."},{"content":"Right-click <bpt id=\"p1\">**</bpt>Deployment and Imaging Tools Environment<ept id=\"p1\">**</ept> and then click <bpt id=\"p2\">**</bpt>Run as administrator<ept id=\"p2\">**</ept>.","pos":[1403,1500]},{"content":"The Deployment and Imaging Tools Environment shortcut opens a Command Prompt window and automatically sets environment variables to point to all the necessary tools.","pos":[1501,1666]},{"content":"Run the following command to copy the base Windows PE files into a new folder.","pos":[1671,1749]},{"content":"The script requires two arguments: hardware architecture and destination location.","pos":[1750,1832]},{"content":"The value of <bpt id=\"p1\">**</bpt><ph id=\"ph1\">&amp;lt;</ph>architecture<ph id=\"ph2\">&amp;gt;</ph><ept id=\"p1\">**</ept> can be <bpt id=\"p2\">**</bpt>x86<ept id=\"p2\">**</ept>, <bpt id=\"p3\">**</bpt>amd64<ept id=\"p3\">**</ept>, or <bpt id=\"p4\">**</bpt>arm<ept id=\"p4\">**</ept> and <bpt id=\"p5\">**</bpt><ph id=\"ph3\">&amp;lt;</ph>destination<ph id=\"ph4\">&amp;gt;</ph><ept id=\"p5\">**</ept> is a path to a local directory.","pos":[1833,1968]},{"content":"If the directory does not already exist, it will be created.","pos":[1969,2029]},{"pos":[2096,2203],"content":"For example, the following command copies <bpt id=\"p1\">**</bpt>amd64<ept id=\"p1\">**</ept> architecture files to the <bpt id=\"p2\">**</bpt>C:\\winpe_amd64<ept id=\"p2\">**</ept> directory:"},{"content":"The script creates the destination directory structure and copies all the necessary files for that architecture.","pos":[2262,2374]},{"content":"In the previous example, the following directories are created:","pos":[2375,2438]},{"content":"Mount the base Windows PE image (winpe.wim) to the \\mount directory using the DISM tool.","pos":[2559,2647]},{"content":"Mounting an image file unpacks the file contents into a folder so that you can make changes directly or by using tools such as DISM.","pos":[2648,2780]},{"content":"See the following example.","pos":[2781,2807]},{"content":"Map a network share to the root TFTP directory on the PXE/TFTP server and create a \\Boot folder.","pos":[2939,3035]},{"content":"Consult your TFTP server documentation to determine the root TFTP server directory, then enable sharing for this directory, and verify it can be accessed on the network.","pos":[3036,3205]},{"content":"In the following example, the PXE server name is PXE-1 and the TFTP root directory is shared using a network path of <bpt id=\"p1\">**</bpt><ph id=\"ph1\">\\\\</ph>\\PXE-1\\TFTPRoot<ept id=\"p1\">**</ept>:","pos":[3206,3345]},{"content":"Copy the PXE boot files from the mounted directory to the \\Boot folder.","pos":[3417,3488]},{"content":"For example:","pos":[3489,3501]},{"content":"Copy the boot.sdi file to the PXE/TFTP server.","pos":[3582,3628]},{"content":"Copy the bootable Windows PE image (boot.wim) to the \\Boot folder.","pos":[3702,3768]},{"content":"Step 2: Configure boot settings and copy the BCD file","pos":[3845,3898]},{"content":"Create a BCD store using bcdedit.exe:","pos":[3904,3941]},{"content":"Configure RAMDISK settings:","pos":[3995,4022]},{"content":"Create a new boot application entry for the Windows PE image:","pos":[4290,4351]},{"content":"Configure BOOTMGR settings:","pos":[4835,4862]},{"content":"Copy the BCD file to your TFTP server:","pos":[4994,5032]},{"content":"Your PXE/TFTP server is now configured.","pos":[5089,5128]},{"content":"You can view the BCD settings that have been configured using the command bcdedit /store <ph id=\"ph1\">&amp;lt;</ph>BCD file location<ph id=\"ph2\">&amp;gt;</ph> /enum all.","pos":[5129,5254]},{"content":"See the following example.","pos":[5255,5281]},{"content":"Note: Your GUID will be different than the one shown below.","pos":[5282,5341]},{"content":"PXE boot process summary","pos":[6162,6186]},{"content":"The following summarizes the PXE client boot process.","pos":[6188,6241]},{"content":"A client is directed by DHCP options 066 and 067 to download boot<ph id=\"ph1\">\\\\</ph>wdsnbp.com from the TFTP server.","pos":[6247,6346]},{"content":"Wdsnbp.com validates the DHCP/PXE response packet and then the client downloads boot<ph id=\"ph1\">\\\\</ph>pxeboot.com.","pos":[6351,6449]},{"content":"Pxeboot.com requires the client to press the F12 key to initiate a PXE boot.","pos":[6454,6530]},{"content":"The client downloads boot<ph id=\"ph1\">\\\\</ph>bootmgr.exe and the boot<ph id=\"ph2\">\\\\</ph>BCD file from the TFTP server.","pos":[6535,6618]},{"content":"Note: The BCD store must reside in the <ph id=\"ph1\">\\\\</ph>boot directory on the TFTP server and must be named BCD.","pos":[6619,6716]},{"content":"Bootmgr.exe reads the BCD operating system entries and downloads boot<ph id=\"ph1\">\\\\</ph>boot.sdi and the Windows PE image (boot<ph id=\"ph2\">\\\\</ph>boot.wim).","pos":[6721,6843]},{"content":"Optional files that can also be downloaded include true type fonts (boot<ph id=\"ph1\">\\\\</ph>Fonts<ph id=\"ph2\">\\\\</ph>wgl4<ph id=\"ph3\">\\_</ph>boot.ttf) and the hibernation state file (<ph id=\"ph4\">\\\\</ph>hiberfil.sys) if these files are present.","pos":[6844,7016]},{"content":"Bootmgr.exe starts Windows PE by calling winload.exe within the Windows PE image.","pos":[7021,7102]},{"content":"Windows PE loads, a command prompt opens and wpeinit.exe is run to initialize Windows PE.","pos":[7107,7196]},{"content":"The Windows PE client provides access to tools like imagex, diskpart, and bcdboot using the Windows PE command prompt.","pos":[7201,7319]},{"content":"Using these tools together with a Windows 10 image file, the destination computer can be formatted properly to load a full Windows 10 operating system.","pos":[7320,7471]},{"content":"See Also","pos":[7473,7481]},{"content":"Concepts","pos":[7499,7507]},{"content":"Windows PE Walkthroughs","pos":[7510,7533]}],"content":"---\ntitle: Configure a PXE server to load Windows PE (Windows 10)\ndescription: This topic describes how to configure a PXE server to load Windows PE so that it can be used with an image file to install Windows 10 from the network. \nkeywords: upgrade, update, windows, windows 10, pxe, WinPE, image, wim\nms.prod: w10\nms.mktglfcycl: deploy\nms.sitesec: library\nms.pagetype: deploy\nauthor: greg-lindsay\n---\n\n# Configure a PXE server to load Windows PE\n\n**Applies to**\n\n-   Windows 10\n\n## Summary\n\nThis walkthrough describes how to configure a PXE server to load Windows PE by booting a client computer from the network. Using the Windows PE tools and a Windows 10 image file, you can install Windows 10 from the network.\n\n## Prerequisites\n\n- A deployment computer: A computer with the [Windows Assessment and Deployment Kit](http://go.microsoft.com/fwlink/p/?LinkId=526803) (Windows ADK) installed.\n- A DHCP server: A DHCP server or DHCP proxy configured to respond to PXE client requests is required.\n- A PXE server: A server running the TFTP service that can host Windows PE boot files that the client will download.\n- A file server: A server hosting a network file share.\n\nAll four of the roles specified above can be hosted on the same computer or each can be on a separate computer.\n\n## Step 1: Copy Windows PE source files\n\n1. On the deployment computer, click **Start**, and type **deployment**.\n\n2. Right-click **Deployment and Imaging Tools Environment** and then click **Run as administrator**. The Deployment and Imaging Tools Environment shortcut opens a Command Prompt window and automatically sets environment variables to point to all the necessary tools.\n\n3. Run the following command to copy the base Windows PE files into a new folder. The script requires two arguments: hardware architecture and destination location. The value of **&lt;architecture&gt;** can be **x86**, **amd64**, or **arm** and **&lt;destination&gt;** is a path to a local directory. If the directory does not already exist, it will be created.\n\n    ```\n    copype.cmd <architecture> <destination>\n    ```\n\n    For example, the following command copies **amd64** architecture files to the **C:\\winpe_amd64** directory:\n\n    ```\n    copype.cmd amd64 C:\\winpe_amd64\n    ```\n\n    The script creates the destination directory structure and copies all the necessary files for that architecture. In the previous example, the following directories are created:\n    \n    ```\n    C:\\winpe_amd64\n    C:\\winpe_amd64\\fwfiles\n    C:\\winpe_amd64\\media\n    C:\\winpe_amd64\\mount\n    ```\n4. Mount the base Windows PE image (winpe.wim) to the \\mount directory using the DISM tool. Mounting an image file unpacks the file contents into a folder so that you can make changes directly or by using tools such as DISM. See the following example.\n\n    ```\n    Dism /mount-image /imagefile:c:\\winpe_amd64\\media\\sources\\boot.wim /index:1 /mountdir:C:\\winpe_amd64\\mount\n    ```\n5. Map a network share to the root TFTP directory on the PXE/TFTP server and create a \\Boot folder. Consult your TFTP server documentation to determine the root TFTP server directory, then enable sharing for this directory, and verify it can be accessed on the network. In the following example, the PXE server name is PXE-1 and the TFTP root directory is shared using a network path of **\\\\\\PXE-1\\TFTPRoot**:\n\n    ```\n    net use y: \\\\PXE-1\\TFTPRoot\n    y:\n    md boot\n    ```\n6. Copy the PXE boot files from the mounted directory to the \\Boot folder. For example:\n\n    ```\n    copy c:\\winpe_amd64\\mount\\windows\\boot\\pxe\\*.* y:\\boot\n    ```\n7.  Copy the boot.sdi file to the PXE/TFTP server.\n\n    ```\n    copy C:\\winpe_amd64\\media\\boot\\boot.sdi y:\\boot\n    ```\n8.  Copy the bootable Windows PE image (boot.wim) to the \\Boot folder.\n\n    ```\n    copy C:\\winpe_amd64\\media\\sources\\boot.wim y:\\boot\n    ```\n\n## Step 2: Configure boot settings and copy the BCD file\n\n1.  Create a BCD store using bcdedit.exe:\n\n    ```\n    bcdedit /createstore c:\\BCD\n    ```\n2.  Configure RAMDISK settings:\n\n    ```\n    bcdedit /store c:\\BCD /create {ramdiskoptions} /d \"Ramdisk options\"\n    bcdedit /store c:\\BCD /set {ramdiskoptions} ramdisksdidevice partition=C:\n    bcdedit /store c:\\BCD /set {ramdiskoptions} ramdisksdipath \\winpe_amd64\\media\\boot\\boot.sdi\n    ```\n3.  Create a new boot application entry for the Windows PE image:\n\n    ```\n    bcdedit /store c:\\BCD /set {GUID1} device ramdisk=[c:]\\winpe_amd64\\media\\sources\\boot.wim,{ramdiskoptions} \n    bcdedit /store c:\\BCD /set {GUID1} path \\windows\\system32\\winload.exe \n    bcdedit /store c:\\BCD /set {GUID1} osdevice ramdisk=[c:]\\winpe_amd64\\media\\sources\\boot.wim,{ramdiskoptions} \n    bcdedit /store c:\\BCD /set {GUID1} systemroot \\windows\n    bcdedit /store c:\\BCD /set {GUID1} detecthal Yes\n    bcdedit /store c:\\BCD /set {GUID1} winpe Yes\n    ```\n4.  Configure BOOTMGR settings:\n\n    ```\n    bcdedit /store c:\\BCD /set {bootmgr} timeout 30 \n    bcdedit /store c:\\BCD -displayorder {GUID1} -addlast\n    ```\n5.  Copy the BCD file to your TFTP server:\n\n    ```\n    copy c:\\BCD \\\\PXE-1\\TFTPRoot\\Boot\n    ```\n\nYour PXE/TFTP server is now configured. You can view the BCD settings that have been configured using the command bcdedit /store &lt;BCD file location&gt; /enum all. See the following example. Note: Your GUID will be different than the one shown below.\n\n```\nC:\\>bcdedit /store C:\\BCD /enum all\nWindows Boot Manager\n--------------------\nidentifier              {bootmgr}\ndescription             boot manager\ndisplayorder            {a4f89c62-2142-11e6-80b6-00155da04110}\ntimeout                 30\n\nWindows Boot Loader\n-------------------\nidentifier              {a4f89c62-2142-11e6-80b6-00155da04110}\ndevice                  ramdisk=[boot]\\boot\\boot.wim,{ramdiskoptions}\ndescription             winpe boot image\nosdevice                ramdisk=[boot]\\boot\\boot.wim,{ramdiskoptions}\nsystemroot              \\Windows\ndetecthal               Yes\nwinpe                   Yes\n\nSetup Ramdisk Options\n---------------------\nidentifier              {ramdiskoptions}\ndescription             ramdisk options\nramdisksdidevice        boot\nramdisksdipath          \\boot\\boot.sdi\n```\n\n## PXE boot process summary\n\nThe following summarizes the PXE client boot process.\n\n1.  A client is directed by DHCP options 066 and 067 to download boot\\\\wdsnbp.com from the TFTP server.\n2.  Wdsnbp.com validates the DHCP/PXE response packet and then the client downloads boot\\\\pxeboot.com.\n3.  Pxeboot.com requires the client to press the F12 key to initiate a PXE boot.\n4.  The client downloads boot\\\\bootmgr.exe and the boot\\\\BCD file from the TFTP server. Note: The BCD store must reside in the \\\\boot directory on the TFTP server and must be named BCD.\n5.  Bootmgr.exe reads the BCD operating system entries and downloads boot\\\\boot.sdi and the Windows PE image (boot\\\\boot.wim). Optional files that can also be downloaded include true type fonts (boot\\\\Fonts\\\\wgl4\\_boot.ttf) and the hibernation state file (\\\\hiberfil.sys) if these files are present.\n6.  Bootmgr.exe starts Windows PE by calling winload.exe within the Windows PE image.\n7.  Windows PE loads, a command prompt opens and wpeinit.exe is run to initialize Windows PE.\n8.  The Windows PE client provides access to tools like imagex, diskpart, and bcdboot using the Windows PE command prompt. Using these tools together with a Windows 10 image file, the destination computer can be formatted properly to load a full Windows 10 operating system.\n\nSee Also \n---------\n\n#### Concepts\n\n[Windows PE Walkthroughs](https://technet.microsoft.com/en-us/library/cc748899.aspx)"}