{"nodes":[{"content":"Create an Authentication Request Rule (Windows 10)","pos":[11,61]},{"content":"Create an Authentication Request Rule","pos":[75,112]},{"content":"Create an Authentication Request Rule","pos":[268,305]},{"content":"Applies to","pos":[309,319]},{"content":"Windows 10","pos":[326,336]},{"content":"Windows Server 2016 Technical Preview","pos":[341,378]},{"content":"After you have configured IPsec algorithms and authentication methods, you can create the rule that requires the devices on the network to use those protocols and methods before they can communicate.","pos":[380,579]},{"content":"Administrative credentials","pos":[583,609]},{"content":"To complete this procedure, you must be a member of the Domain Administrators group, or otherwise be delegated permissions to modify the GPOs.","pos":[613,755]},{"content":"To create the authentication request rule","pos":[757,798]},{"pos":[804,978],"content":"<bpt id=\"p1\">[</bpt>Open the Group Policy Management Console to Windows Firewall with Advanced Security<ept id=\"p1\">](open-the-group-policy-management-console-to-windows-firewall-with-advanced-security.md)</ept>."},{"pos":[984,1079],"content":"In the navigation pane, right-click <bpt id=\"p1\">**</bpt>Connection Security Rules<ept id=\"p1\">**</ept>, and then click <bpt id=\"p2\">**</bpt>New Rule<ept id=\"p2\">**</ept>."},{"pos":[1085,1158],"content":"On the <bpt id=\"p1\">**</bpt>Rule Type<ept id=\"p1\">**</ept> page, select <bpt id=\"p2\">**</bpt>Isolation<ept id=\"p2\">**</ept>, and then click <bpt id=\"p3\">**</bpt>Next<ept id=\"p3\">**</ept>."},{"pos":[1164,1265],"content":"On the <bpt id=\"p1\">**</bpt>Requirements<ept id=\"p1\">**</ept> page, select <bpt id=\"p2\">**</bpt>Request authentication for inbound and outbound connections<ept id=\"p2\">**</ept>."},{"content":"<bpt id=\"p1\">**</bpt>Caution:<ept id=\"p1\">**</ept>  Do not configure the rule to require inbound authentication until you have confirmed that all of your devices are receiving the correct GPOs, and are successfully negotiating IPsec and authenticating with each other.","pos":[1272,1502]},{"content":"Allowing the devices to communicate even when authentication fails prevents any errors in the GPOs or their distribution from breaking communications on your network.","pos":[1503,1669]},{"content":"On the <bpt id=\"p1\">**</bpt>Authentication Method<ept id=\"p1\">**</ept> page, select the authentication option you want to use on your network.","pos":[1675,1779]},{"content":"To select multiple methods that are tried in order until one succeeds, click <bpt id=\"p1\">**</bpt>Advanced<ept id=\"p1\">**</ept>, click <bpt id=\"p2\">**</bpt>Customize<ept id=\"p2\">**</ept>, and then click <bpt id=\"p3\">**</bpt>Add<ept id=\"p3\">**</ept> to add methods to the list.","pos":[1780,1942]},{"content":"Second authentication methods require Authenticated IP (AuthIP).","pos":[1943,2007]},{"content":"<bpt id=\"p1\">**</bpt>Default<ept id=\"p1\">**</ept>.","pos":[2017,2029]},{"content":"Selecting this option tells the device to request authentication by using the method currently defined as the default on the device.","pos":[2030,2162]},{"content":"This default might have been configured when the operating system was installed or it might have been configured by Group Policy.","pos":[2163,2292]},{"content":"Selecting this option is appropriate when you have configured system-wide settings by using the <bpt id=\"p1\">[</bpt>Configure Authentication Methods<ept id=\"p1\">](configure-authentication-methods.md)</ept> procedure.","pos":[2293,2471]},{"content":"<bpt id=\"p1\">**</bpt>Computer and User (Kerberos V5)<ept id=\"p1\">**</ept>.","pos":[2481,2517]},{"content":"Selecting this option tells the device to request authentication of both the device and the currently logged-on user by using their domain credentials.","pos":[2518,2669]},{"content":"This authentication method works only with other devices that can use AuthIP.","pos":[2670,2747]},{"content":"User-based authentication using Kerberos V5 is not supported by IKE v1.","pos":[2748,2819]},{"content":"<bpt id=\"p1\">**</bpt>Computer (Kerberos V5)<ept id=\"p1\">**</ept>.","pos":[2829,2856]},{"content":"Selecting this option tells the device to request authentication of the device by using its domain credentials.","pos":[2857,2968]},{"content":"This option works with other devices than can use IKE v1, including earlier versions of Windows.","pos":[2969,3065]},{"content":"<bpt id=\"p1\">**</bpt>Advanced<ept id=\"p1\">**</ept>.","pos":[3075,3088]},{"content":"Click <bpt id=\"p1\">**</bpt>Customize<ept id=\"p1\">**</ept> to specify a custom combination of authentication methods required for your scenario.","pos":[3089,3194]},{"content":"You can specify both a <bpt id=\"p1\">**</bpt>First authentication method<ept id=\"p1\">**</ept> and a <bpt id=\"p2\">**</bpt>Second authentication method<ept id=\"p2\">**</ept>.","pos":[3195,3289]},{"pos":[3299,3363],"content":"The <bpt id=\"p1\">**</bpt>First authentication method<ept id=\"p1\">**</ept> can be one of the following:"},{"content":"<bpt id=\"p1\">**</bpt>Computer (Kerberos V5)<ept id=\"p1\">**</ept>.","pos":[3377,3404]},{"content":"Selecting this option tells the device to request authentication of the device by using its domain credentials.","pos":[3405,3516]},{"content":"This option works with other devices than can use IKE v1, including earlier versions of Windows.","pos":[3517,3613]},{"content":"<bpt id=\"p1\">**</bpt>Computer (NTLMv2)<ept id=\"p1\">**</ept>.","pos":[3627,3649]},{"content":"Selecting this option tells the device to use and require authentication of the device by using its domain credentials.","pos":[3650,3769]},{"content":"This option works only with other devices that can use AuthIP.","pos":[3770,3832]},{"content":"User-based authentication using Kerberos V5 is not supported by IKE v1.","pos":[3833,3904]},{"content":"<bpt id=\"p1\">**</bpt>Computer certificate from this certification authority (CA)<ept id=\"p1\">**</ept>.","pos":[3918,3982]},{"content":"Selecting this option and entering the identification of a CA tells the device to request authentication by using a certificate that is issued by the specified CA.","pos":[3983,4146]},{"content":"If you also select <bpt id=\"p1\">**</bpt>Accept only health certificates<ept id=\"p1\">**</ept>, then only certificates issued by a NAP server can be used for this rule.","pos":[4147,4275]},{"content":"<bpt id=\"p1\">**</bpt>Preshared key (not recommended)<ept id=\"p1\">**</ept>.","pos":[4289,4325]},{"content":"Selecting this method and entering a pre-shared key tells the device to authenticate by exchanging the pre-shared keys.","pos":[4326,4445]},{"content":"If the keys match, then the authentication succeeds.","pos":[4446,4498]},{"content":"This method is not recommended, and is included for backward compatibility and testing purposes only.","pos":[4499,4600]},{"pos":[4610,4760],"content":"If you select <bpt id=\"p1\">**</bpt>First authentication is optional<ept id=\"p1\">**</ept>, then the connection can succeed even if the authentication attempt specified in this column fails."},{"pos":[4770,4835],"content":"The <bpt id=\"p1\">**</bpt>Second authentication method<ept id=\"p1\">**</ept> can be one of the following:"},{"content":"<bpt id=\"p1\">**</bpt>User (Kerberos V5)<ept id=\"p1\">**</ept>.","pos":[4849,4872]},{"content":"Selecting this option tells the device to use and require authentication of the currently logged-on user by using his or her domain credentials.","pos":[4873,5017]},{"content":"This authentication method works only with other devices that can use AuthIP.","pos":[5018,5095]},{"content":"User-based authentication using Kerberos V5 is not supported by IKE v1.","pos":[5096,5167]},{"content":"<bpt id=\"p1\">**</bpt>User (NTLMv2)<ept id=\"p1\">**</ept>.","pos":[5181,5199]},{"content":"Selecting this option tells the device to use and require authentication of the currently logged-on user by using his or her domain credentials, and uses the NTLMv2 protocol instead of Kerberos V5.","pos":[5200,5397]},{"content":"This authentication method works only with other devices that can use AuthIP.","pos":[5398,5475]},{"content":"User-based authentication using NTLMv2 is not supported by IKE v1.","pos":[5476,5542]},{"content":"<bpt id=\"p1\">**</bpt>User health certificate from this certification authority (CA)<ept id=\"p1\">**</ept>.","pos":[5556,5623]},{"content":"Selecting this option and entering the identification of a CA tells the device to request user-based authentication by using a certificate that is issued by the specified CA.","pos":[5624,5798]},{"content":"If you also select <bpt id=\"p1\">**</bpt>Enable certificate to account mapping<ept id=\"p1\">**</ept>, then the certificate can be associated with a user in Active Directory for purposes of granting or denying access to certain users or user groups.","pos":[5799,6007]},{"content":"<bpt id=\"p1\">**</bpt>Computer health certificate from this certification authority (CA)<ept id=\"p1\">**</ept>.","pos":[6021,6092]},{"content":"Selecting this option and entering the identification of a CA tells the device to use and require authentication by using a certificate that is issued by the specified CA.","pos":[6093,6264]},{"content":"If you also select <bpt id=\"p1\">**</bpt>Accept only health certificates<ept id=\"p1\">**</ept>, then only certificates issued by a NAP server can be used for this rule.","pos":[6265,6393]},{"pos":[6403,6548],"content":"If you check <bpt id=\"p1\">**</bpt>Second authentication is optional<ept id=\"p1\">**</ept>, the connection can succeed even if the authentication attempt specified in this column fails."},{"content":"<bpt id=\"p1\">**</bpt>Important:<ept id=\"p1\">**</ept>  Make sure that you do not select the boxes to make both first and second authentication optional.","pos":[6559,6672]},{"content":"Doing so allows plaintext connections whenever authentication fails.","pos":[6673,6741]},{"content":"After you have configured the authentication methods, click <bpt id=\"p1\">**</bpt>OK<ept id=\"p1\">**</ept> on each dialog box to save your changes and close it, until you return to the <bpt id=\"p2\">**</bpt>Authentication Method<ept id=\"p2\">**</ept> page in the wizard.","pos":[6747,6937]},{"content":"Click <bpt id=\"p1\">**</bpt>Next<ept id=\"p1\">**</ept>.","pos":[6938,6953]},{"pos":[6959,7073],"content":"On the <bpt id=\"p1\">**</bpt>Profile<ept id=\"p1\">**</ept> page, select the check boxes for the network location type profiles to which this rule applies."},{"pos":[7083,7258],"content":"On portable devices, consider clearing the <bpt id=\"p1\">**</bpt>Private<ept id=\"p1\">**</ept> and <bpt id=\"p2\">**</bpt>Public<ept id=\"p2\">**</ept> boxes to enable the device to communicate without authentication when it is away from the domain network."},{"content":"On devices that do not move from network to network, consider selecting all of the profiles.","pos":[7268,7360]},{"content":"Doing so prevents an unexpected switch in the network location type from disabling the rule.","pos":[7361,7453]},{"pos":[7459,7474],"content":"Click <bpt id=\"p1\">**</bpt>Next<ept id=\"p1\">**</ept>."},{"pos":[7480,7592],"content":"On the <bpt id=\"p1\">**</bpt>Name<ept id=\"p1\">**</ept> page, type a name for the connection security rule and a description, and then click <bpt id=\"p2\">**</bpt>Finish<ept id=\"p2\">**</ept>."},{"content":"The new rule appears in the list of connection security rules.","pos":[7598,7660]}],"content":"---\ntitle: Create an Authentication Request Rule (Windows 10)\ndescription: Create an Authentication Request Rule\nms.assetid: 1296e048-039f-4d1a-aaf2-8472ad05e359\nms.prod: w10\nms.mktglfcycl: deploy\nms.sitesec: library\nms.pagetype: security\nauthor: brianlic-msft\n---\n\n# Create an Authentication Request Rule\n\n**Applies to**\n-   Windows 10\n-   Windows Server 2016 Technical Preview\n\nAfter you have configured IPsec algorithms and authentication methods, you can create the rule that requires the devices on the network to use those protocols and methods before they can communicate.\n\n**Administrative credentials**\n\nTo complete this procedure, you must be a member of the Domain Administrators group, or otherwise be delegated permissions to modify the GPOs.\n\nTo create the authentication request rule\n\n1.  [Open the Group Policy Management Console to Windows Firewall with Advanced Security](open-the-group-policy-management-console-to-windows-firewall-with-advanced-security.md).\n\n2.  In the navigation pane, right-click **Connection Security Rules**, and then click **New Rule**.\n\n3.  On the **Rule Type** page, select **Isolation**, and then click **Next**.\n\n4.  On the **Requirements** page, select **Request authentication for inbound and outbound connections**.\n\n    >**Caution:**  Do not configure the rule to require inbound authentication until you have confirmed that all of your devices are receiving the correct GPOs, and are successfully negotiating IPsec and authenticating with each other. Allowing the devices to communicate even when authentication fails prevents any errors in the GPOs or their distribution from breaking communications on your network.\n\n5.  On the **Authentication Method** page, select the authentication option you want to use on your network. To select multiple methods that are tried in order until one succeeds, click **Advanced**, click **Customize**, and then click **Add** to add methods to the list. Second authentication methods require Authenticated IP (AuthIP).\n\n    1.  **Default**. Selecting this option tells the device to request authentication by using the method currently defined as the default on the device. This default might have been configured when the operating system was installed or it might have been configured by Group Policy. Selecting this option is appropriate when you have configured system-wide settings by using the [Configure Authentication Methods](configure-authentication-methods.md) procedure.\n\n    2.  **Computer and User (Kerberos V5)**. Selecting this option tells the device to request authentication of both the device and the currently logged-on user by using their domain credentials. This authentication method works only with other devices that can use AuthIP. User-based authentication using Kerberos V5 is not supported by IKE v1.\n\n    3.  **Computer (Kerberos V5)**. Selecting this option tells the device to request authentication of the device by using its domain credentials. This option works with other devices than can use IKE v1, including earlier versions of Windows.\n\n    4.  **Advanced**. Click **Customize** to specify a custom combination of authentication methods required for your scenario. You can specify both a **First authentication method** and a **Second authentication method**.\n\n        The **First authentication method** can be one of the following:\n\n        -   **Computer (Kerberos V5)**. Selecting this option tells the device to request authentication of the device by using its domain credentials. This option works with other devices than can use IKE v1, including earlier versions of Windows.\n\n        -   **Computer (NTLMv2)**. Selecting this option tells the device to use and require authentication of the device by using its domain credentials. This option works only with other devices that can use AuthIP. User-based authentication using Kerberos V5 is not supported by IKE v1.\n\n        -   **Computer certificate from this certification authority (CA)**. Selecting this option and entering the identification of a CA tells the device to request authentication by using a certificate that is issued by the specified CA. If you also select **Accept only health certificates**, then only certificates issued by a NAP server can be used for this rule.\n\n        -   **Preshared key (not recommended)**. Selecting this method and entering a pre-shared key tells the device to authenticate by exchanging the pre-shared keys. If the keys match, then the authentication succeeds. This method is not recommended, and is included for backward compatibility and testing purposes only.\n\n        If you select **First authentication is optional**, then the connection can succeed even if the authentication attempt specified in this column fails.\n\n        The **Second authentication method** can be one of the following:\n\n        -   **User (Kerberos V5)**. Selecting this option tells the device to use and require authentication of the currently logged-on user by using his or her domain credentials. This authentication method works only with other devices that can use AuthIP. User-based authentication using Kerberos V5 is not supported by IKE v1.\n\n        -   **User (NTLMv2)**. Selecting this option tells the device to use and require authentication of the currently logged-on user by using his or her domain credentials, and uses the NTLMv2 protocol instead of Kerberos V5. This authentication method works only with other devices that can use AuthIP. User-based authentication using NTLMv2 is not supported by IKE v1.\n\n        -   **User health certificate from this certification authority (CA)**. Selecting this option and entering the identification of a CA tells the device to request user-based authentication by using a certificate that is issued by the specified CA. If you also select **Enable certificate to account mapping**, then the certificate can be associated with a user in Active Directory for purposes of granting or denying access to certain users or user groups.\n\n        -   **Computer health certificate from this certification authority (CA)**. Selecting this option and entering the identification of a CA tells the device to use and require authentication by using a certificate that is issued by the specified CA. If you also select **Accept only health certificates**, then only certificates issued by a NAP server can be used for this rule.\n\n        If you check **Second authentication is optional**, the connection can succeed even if the authentication attempt specified in this column fails.\n\n        >**Important:**  Make sure that you do not select the boxes to make both first and second authentication optional. Doing so allows plaintext connections whenever authentication fails.\n\n6.  After you have configured the authentication methods, click **OK** on each dialog box to save your changes and close it, until you return to the **Authentication Method** page in the wizard. Click **Next**.\n\n7.  On the **Profile** page, select the check boxes for the network location type profiles to which this rule applies.\n\n    -   On portable devices, consider clearing the **Private** and **Public** boxes to enable the device to communicate without authentication when it is away from the domain network.\n\n    -   On devices that do not move from network to network, consider selecting all of the profiles. Doing so prevents an unexpected switch in the network location type from disabling the rule.\n\n    Click **Next**.\n\n8.  On the **Name** page, type a name for the connection security rule and a description, and then click **Finish**.\n\n    The new rule appears in the list of connection security rules.\n"}