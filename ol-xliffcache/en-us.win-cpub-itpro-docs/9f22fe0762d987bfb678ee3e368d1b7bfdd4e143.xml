{"nodes":[{"content":"Compacting the MED-V Virtual Hard Disk","pos":[11,49]},{"content":"Compacting the MED-V Virtual Hard Disk","pos":[63,101]},{"content":"Compacting the MED-V Virtual Hard Disk","pos":[264,302]},{"content":"Although it is optional, you can compact the virtual hard disk (VHD) to reclaim empty disk space and reduce the size of the VHD before you configure the Windows Virtual PC image.","pos":[305,483]},{"content":"Important","pos":[487,496]},{"content":"Before you proceed, create a backup copy of your Windows XP image.","pos":[501,567]},{"content":"Preparing the Virtual Hard Disk","pos":[574,605]},{"content":"Open your Windows XP image.","pos":[613,640]},{"pos":[646,787],"content":"Click <bpt id=\"p1\">**</bpt>Start<ept id=\"p1\">**</ept>, click <bpt id=\"p2\">**</bpt>All Programs<ept id=\"p2\">**</ept>, click <bpt id=\"p3\">**</bpt>Windows Virtual PC<ept id=\"p3\">**</ept>, click <bpt id=\"p4\">**</bpt>Windows Virtual PC<ept id=\"p4\">**</ept>, then double-click your Windows XP image."},{"content":"Clear the DLL cache.","pos":[793,813]},{"pos":[823,893],"content":"At a command prompt in the virtual machine, type <bpt id=\"p1\">**</bpt>sfc /cachesize=1<ept id=\"p1\">**</ept>."},{"content":"Restart the virtual machine.","pos":[903,931]},{"pos":[941,1010],"content":"At a command prompt in the virtual machine, type <bpt id=\"p1\">**</bpt>sfc /purgecache<ept id=\"p1\">**</ept>."},{"content":"Delete unnecessary files, such as uninstallers, temp files, log files, page files, shared folders, and so on.","pos":[1016,1125]},{"content":"Turn off System Restore.","pos":[1131,1155]},{"content":"You can also specify this step in your Sysprep.inf file.","pos":[1156,1212]},{"pos":[1222,1312],"content":"In <bpt id=\"p1\">**</bpt>Control Panel<ept id=\"p1\">**</ept>, double-click <bpt id=\"p2\">**</bpt>System<ept id=\"p2\">**</ept>, and then select the <bpt id=\"p3\">**</bpt>System Restore<ept id=\"p3\">**</ept> tab."},{"pos":[1322,1380],"content":"Select <bpt id=\"p1\">**</bpt>Turn off System Restore<ept id=\"p1\">**</ept>, and then click <bpt id=\"p2\">**</bpt>OK<ept id=\"p2\">**</ept>."},{"content":"Set maximum event log sizes and clear all events.","pos":[1386,1435]},{"content":"Open the event viewer.","pos":[1445,1467]},{"pos":[1477,1593],"content":"Click <bpt id=\"p1\">**</bpt>Start<ept id=\"p1\">**</ept>, click <bpt id=\"p2\">**</bpt>Control Panel<ept id=\"p2\">**</ept>, double-click <bpt id=\"p3\">**</bpt>Administrative Tools<ept id=\"p3\">**</ept>, then double-click <bpt id=\"p4\">**</bpt>Event Viewer<ept id=\"p4\">**</ept>."},{"pos":[1603,1657],"content":"Right-click <bpt id=\"p1\">**</bpt>Application<ept id=\"p1\">**</ept>, and click <bpt id=\"p2\">**</bpt>Properties<ept id=\"p2\">**</ept>."},{"pos":[1667,1774],"content":"In the <bpt id=\"p1\">**</bpt>Log Size<ept id=\"p1\">**</ept> area, set <bpt id=\"p2\">**</bpt>Maximum Log Size<ept id=\"p2\">**</ept> to 512KB and then select <bpt id=\"p3\">**</bpt>Overwrite events as needed<ept id=\"p3\">**</ept>."},{"content":"Click <bpt id=\"p1\">**</bpt>Clear Log<ept id=\"p1\">**</ept>.","pos":[1784,1804]},{"content":"In the <bpt id=\"p1\">**</bpt>Event Viewer<ept id=\"p1\">**</ept> dialog box that appears, click <bpt id=\"p2\">**</bpt>No<ept id=\"p2\">**</ept>.","pos":[1805,1867]},{"pos":[1877,1920],"content":"In the <bpt id=\"p1\">**</bpt>Properties<ept id=\"p1\">**</ept> window, click <bpt id=\"p2\">**</bpt>OK<ept id=\"p2\">**</ept>."},{"pos":[1930,1996],"content":"Repeat steps a through e for the <bpt id=\"p1\">**</bpt>Security<ept id=\"p1\">**</ept> and <bpt id=\"p2\">**</bpt>System<ept id=\"p2\">**</ept> logs."},{"content":"Run the Disk Cleanup Tool.","pos":[2002,2028]},{"pos":[2034,2154],"content":"Click <bpt id=\"p1\">**</bpt>Start<ept id=\"p1\">**</ept>, click <bpt id=\"p2\">**</bpt>All Programs<ept id=\"p2\">**</ept>, click <bpt id=\"p3\">**</bpt>Accessories<ept id=\"p3\">**</ept>, click <bpt id=\"p4\">**</bpt>System Tools<ept id=\"p4\">**</ept>, and then click <bpt id=\"p5\">**</bpt>Disk Cleanup<ept id=\"p5\">**</ept>."},{"content":"Configure your page file as needed for your applications.","pos":[2160,2217]},{"pos":[2227,2311],"content":"In <bpt id=\"p1\">**</bpt>Control Panel<ept id=\"p1\">**</ept>, double-click <bpt id=\"p2\">**</bpt>System<ept id=\"p2\">**</ept>, and then select the <bpt id=\"p3\">**</bpt>Advanced<ept id=\"p3\">**</ept> tab."},{"pos":[2321,2369],"content":"In the <bpt id=\"p1\">**</bpt>Performance<ept id=\"p1\">**</ept> area, click <bpt id=\"p2\">**</bpt>Settings<ept id=\"p2\">**</ept>."},{"pos":[2379,2428],"content":"In the <bpt id=\"p1\">**</bpt>Virtual Memory<ept id=\"p1\">**</ept> area, click <bpt id=\"p2\">**</bpt>Change<ept id=\"p2\">**</ept>."},{"content":"Configure your page file settings.","pos":[2438,2472]},{"content":"Shut down the Windows XP image.","pos":[2478,2509]},{"content":"Defragmenting and Pre-compacting the Virtual Hard Disk","pos":[2513,2567]},{"pos":[2575,2745],"content":"In <bpt id=\"p1\">**</bpt>Control Panel<ept id=\"p1\">**</ept> on the host computer that is running Windows 7, click <bpt id=\"p2\">**</bpt>Administrative Tools<ept id=\"p2\">**</ept>, double-click <bpt id=\"p3\">**</bpt>Computer Management<ept id=\"p3\">**</ept>, then click <bpt id=\"p4\">**</bpt>Disk Management<ept id=\"p4\">**</ept>."},{"content":"By using the Disk Management Console, attach (mount) the virtual hard disk and then defragment the disk.","pos":[2751,2855]},{"content":"By using an ISO extraction tool, extract the precompact.iso located in the <ph id=\"ph1\">\\\\</ph>Program Files<ph id=\"ph2\">\\\\</ph>Windows Virtual PC<ph id=\"ph3\">\\\\</ph>Integration Components folder.","pos":[2861,3003]},{"content":"Use the precompact.exe program to compress the Windows XP virtual hard disk.","pos":[3009,3085]},{"content":"By using the Disk Management Console, detach the virtual hard disk.","pos":[3091,3158]},{"content":"Compacting the Virtual Hard Disk","pos":[3162,3194]},{"content":"Open Windows Virtual PC.","pos":[3202,3226]},{"pos":[3232,3337],"content":"Click <bpt id=\"p1\">**</bpt>Start<ept id=\"p1\">**</ept>, click <bpt id=\"p2\">**</bpt>All Programs<ept id=\"p2\">**</ept>, click <bpt id=\"p3\">**</bpt>Windows Virtual PC<ept id=\"p3\">**</ept>, then click <bpt id=\"p4\">**</bpt>Windows Virtual PC<ept id=\"p4\">**</ept>."},{"pos":[3343,3401],"content":"Right-click your Windows XP image and select <bpt id=\"p1\">**</bpt>Settings<ept id=\"p1\">**</ept>."},{"pos":[3407,3508],"content":"Click <bpt id=\"p1\">**</bpt>Hard Disk<ept id=\"p1\">**</ept> for the one that corresponds to your Windows XP image, and then click <bpt id=\"p2\">**</bpt>Modify<ept id=\"p2\">**</ept>."},{"pos":[3514,3550],"content":"Click <bpt id=\"p1\">**</bpt>Compact virtual hard disk<ept id=\"p1\">**</ept>."},{"pos":[3556,3596],"content":"Click <bpt id=\"p1\">**</bpt>Compact<ept id=\"p1\">**</ept> and then click <bpt id=\"p2\">**</bpt>OK<ept id=\"p2\">**</ept>."},{"content":"Create a backup copy of your compacted virtual hard disk.","pos":[3598,3655]},{"content":"Related topics","pos":[3660,3674]},{"content":"Configuring a Windows Virtual PC Image for MED-V","pos":[3678,3726]},{"content":"Technical Reference for MED-V","pos":[3783,3812]}],"content":"---\ntitle: Compacting the MED-V Virtual Hard Disk\ndescription: Compacting the MED-V Virtual Hard Disk\nauthor: jamiejdt\nms.assetid: 5e6122d1-9847-4b33-adab-594919eec3c5\nms.pagetype: mdop, virtualization\nms.mktglfcycl: deploy\nms.sitesec: library\nms.prod: w7\n---\n\n\n# Compacting the MED-V Virtual Hard Disk\n\n\nAlthough it is optional, you can compact the virtual hard disk (VHD) to reclaim empty disk space and reduce the size of the VHD before you configure the Windows Virtual PC image.\n\n**Important**  \nBefore you proceed, create a backup copy of your Windows XP image.\n\n \n\n**Preparing the Virtual Hard Disk**\n\n1.  Open your Windows XP image.\n\n    Click **Start**, click **All Programs**, click **Windows Virtual PC**, click **Windows Virtual PC**, then double-click your Windows XP image.\n\n2.  Clear the DLL cache.\n\n    1.  At a command prompt in the virtual machine, type **sfc /cachesize=1**.\n\n    2.  Restart the virtual machine.\n\n    3.  At a command prompt in the virtual machine, type **sfc /purgecache**.\n\n3.  Delete unnecessary files, such as uninstallers, temp files, log files, page files, shared folders, and so on.\n\n4.  Turn off System Restore. You can also specify this step in your Sysprep.inf file.\n\n    1.  In **Control Panel**, double-click **System**, and then select the **System Restore** tab.\n\n    2.  Select **Turn off System Restore**, and then click **OK**.\n\n5.  Set maximum event log sizes and clear all events.\n\n    1.  Open the event viewer.\n\n        Click **Start**, click **Control Panel**, double-click **Administrative Tools**, then double-click **Event Viewer**.\n\n    2.  Right-click **Application**, and click **Properties**.\n\n    3.  In the **Log Size** area, set **Maximum Log Size** to 512KB and then select **Overwrite events as needed**.\n\n    4.  Click **Clear Log**. In the **Event Viewer** dialog box that appears, click **No**.\n\n    5.  In the **Properties** window, click **OK**.\n\n    6.  Repeat steps a through e for the **Security** and **System** logs.\n\n6.  Run the Disk Cleanup Tool.\n\n    Click **Start**, click **All Programs**, click **Accessories**, click **System Tools**, and then click **Disk Cleanup**.\n\n7.  Configure your page file as needed for your applications.\n\n    1.  In **Control Panel**, double-click **System**, and then select the **Advanced** tab.\n\n    2.  In the **Performance** area, click **Settings**.\n\n    3.  In the **Virtual Memory** area, click **Change**.\n\n    4.  Configure your page file settings.\n\n8.  Shut down the Windows XP image.\n\n**Defragmenting and Pre-compacting the Virtual Hard Disk**\n\n1.  In **Control Panel** on the host computer that is running Windows 7, click **Administrative Tools**, double-click **Computer Management**, then click **Disk Management**.\n\n2.  By using the Disk Management Console, attach (mount) the virtual hard disk and then defragment the disk.\n\n3.  By using an ISO extraction tool, extract the precompact.iso located in the \\\\Program Files\\\\Windows Virtual PC\\\\Integration Components folder.\n\n4.  Use the precompact.exe program to compress the Windows XP virtual hard disk.\n\n5.  By using the Disk Management Console, detach the virtual hard disk.\n\n**Compacting the Virtual Hard Disk**\n\n1.  Open Windows Virtual PC.\n\n    Click **Start**, click **All Programs**, click **Windows Virtual PC**, then click **Windows Virtual PC**.\n\n2.  Right-click your Windows XP image and select **Settings**.\n\n3.  Click **Hard Disk** for the one that corresponds to your Windows XP image, and then click **Modify**.\n\n4.  Click **Compact virtual hard disk**.\n\n5.  Click **Compact** and then click **OK**.\n\nCreate a backup copy of your compacted virtual hard disk.\n\n## Related topics\n\n\n[Configuring a Windows Virtual PC Image for MED-V](configuring-a-windows-virtual-pc-image-for-med-v.md)\n\n[Technical Reference for MED-V](technical-reference-for-med-v.md)\n\n \n\n \n\n\n\n\n\n"}