{"nodes":[{"content":"How to Configure the Server to be Trusted for Delegation","pos":[11,67]},{"content":"How to Configure the Server to be Trusted for Delegation","pos":[81,137]},{"content":"How to Configure the Server to be Trusted for Delegation","pos":[311,367]},{"content":"When you install the Microsoft Application Virtualization (App-V) Management Server software, you can choose to install it by using a distributed system architecture.","pos":[370,536]},{"content":"If you install the console, the Management Web Service, and the database on different computers, you must configure the Internet Information Services (IIS) server to be trusted for delegation.","pos":[537,729]},{"content":"This is necessary because the Management Web Service will attempt to connect to the App-V data store by using the credentials of the App-V administrator who is using the console.","pos":[730,908]},{"content":"The database server on which the data store is installed will not accept the administrator’s credentials from the IIS server unless the IIS server is configured to be trusted for delegation, and so the Management Web Service will not be able to connect to the App-V data store.","pos":[909,1186]},{"content":"Note","pos":[1190,1194]},{"content":"If you install the App-V Management Server software on a single server and place the data store on a separate server, there is one situation in which you must still configure the server to be trusted for delegation even though the Management Web Service and Management Console are on the same server.","pos":[1199,1499]},{"content":"This situation occurs if you need to connect to the Management Web Service in the console by using the <bpt id=\"p1\">**</bpt>Use Alternate Credentials<ept id=\"p1\">**</ept> option.","pos":[1500,1640]},{"content":"The type of delegation that you can use depends on the Domain Functional Level that you have configured in your Active Directory Domain Services (AD DS) infrastructure.","pos":[1645,1813]},{"content":"The following table lists the types of delegation that can be configured for each Domain Functional Level for App-V.","pos":[1814,1930]},{"content":"Detailed instructions follow the table.","pos":[1931,1970]},{"content":"Domain Functional Level","pos":[2088,2111]},{"content":"Delegation Levels Available","pos":[2134,2161]},{"content":"Windows 2000 native","pos":[2227,2246]},{"content":"No delegation (default)","pos":[2285,2308]},{"content":"Unconstrained delegation","pos":[2325,2349]},{"content":"Windows Server 2003, Windows Server 2008, or Windows Server 2008 R2","pos":[2414,2481]},{"content":"No delegation (default)","pos":[2520,2543]},{"content":"Unconstrained delegation¹","pos":[2560,2585]},{"content":"Constrained delegation (Use Kerberos Only Protocols)","pos":[2602,2654]},{"content":"Constrained delegation (Use any authentication protocol) ¹","pos":[2671,2729]},{"content":"¹ Not recommended.","pos":[2778,2796]},{"content":"To configure unconstrained delegation when the Domain Functional Level is Windows 2000 native","pos":[2801,2894]},{"content":"On the domain controller for your Web server’s domain, complete the following steps.","pos":[2897,2981]},{"pos":[2993,3092],"content":"Click <bpt id=\"p1\">**</bpt>Start<ept id=\"p1\">**</ept>, <bpt id=\"p2\">**</bpt>Administrative Tools<ept id=\"p2\">**</ept>, and then click <bpt id=\"p3\">**</bpt>Active Directory Users and Computers<ept id=\"p3\">**</ept>."},{"content":"Expand domain, and then expand the Computers folder.","pos":[3098,3150]},{"pos":[3156,3255],"content":"In the right pane, right-click the computer name for the Web server, and then click <bpt id=\"p1\">**</bpt>Properties<ept id=\"p1\">**</ept>."},{"pos":[3261,3357],"content":"On the <bpt id=\"p1\">**</bpt>General<ept id=\"p1\">**</ept> tab, ensure that the <bpt id=\"p2\">**</bpt>Trust computer for delegation<ept id=\"p2\">**</ept> check box is selected."},{"pos":[3363,3376],"content":"Click <bpt id=\"p1\">**</bpt>OK<ept id=\"p1\">**</ept>."},{"content":"To configure unconstrained delegation when the Domain Functional Level is Windows Server 2003, Windows Server 2008, or Windows Server 2008 R2","pos":[3381,3522]},{"content":"On the domain controller for your Web server’s domain, complete the following steps.","pos":[3525,3609]},{"pos":[3621,3726],"content":"Click <bpt id=\"p1\">**</bpt>Start<ept id=\"p1\">**</ept>, click <bpt id=\"p2\">**</bpt>Administrative Tools<ept id=\"p2\">**</ept>, and then click <bpt id=\"p3\">**</bpt>Active Directory Users and Computers<ept id=\"p3\">**</ept>."},{"content":"Expand domain, and expand the Computers folder.","pos":[3732,3779]},{"pos":[3785,3915],"content":"In the right pane, right-click the computer name for the Web server, select <bpt id=\"p1\">**</bpt>Properties<ept id=\"p1\">**</ept>, and then click the <bpt id=\"p2\">**</bpt>Delegation<ept id=\"p2\">**</ept> tab."},{"pos":[3921,4007],"content":"Click to select <bpt id=\"p1\">**</bpt>Trust this computer for delegation to any service (Kerberos only)<ept id=\"p1\">**</ept>."},{"pos":[4013,4026],"content":"Click <bpt id=\"p1\">**</bpt>OK<ept id=\"p1\">**</ept>."},{"content":"To configure constrained delegation when the Domain Functional Level is Windows Server 2003, Windows Server 2008, or Windows Server 2008 R2","pos":[4031,4170]},{"content":"On the domain controller for your Web server’s domain, complete the following steps.","pos":[4173,4257]},{"pos":[4269,4374],"content":"Click <bpt id=\"p1\">**</bpt>Start<ept id=\"p1\">**</ept>, click <bpt id=\"p2\">**</bpt>Administrative Tools<ept id=\"p2\">**</ept>, and then click <bpt id=\"p3\">**</bpt>Active Directory Users and Computers<ept id=\"p3\">**</ept>."},{"content":"Expand domain, and then expand the Computers folder.","pos":[4380,4432]},{"pos":[4438,4568],"content":"In the right pane, right-click the computer name for the Web server, select <bpt id=\"p1\">**</bpt>Properties<ept id=\"p1\">**</ept>, and then click the <bpt id=\"p2\">**</bpt>Delegation<ept id=\"p2\">**</ept> tab."},{"pos":[4574,4656],"content":"Click to select <bpt id=\"p1\">**</bpt>Trust this computer for delegation to specified services only<ept id=\"p1\">**</ept>."},{"pos":[4662,4731],"content":"Ensure that <bpt id=\"p1\">**</bpt>Use Kerberos only<ept id=\"p1\">**</ept> is selected, and then click <bpt id=\"p2\">**</bpt>OK<ept id=\"p2\">**</ept>."},{"content":"Click the <bpt id=\"p1\">**</bpt>Add<ept id=\"p1\">**</ept> button.","pos":[4737,4762]},{"content":"In the <bpt id=\"p1\">**</bpt>Add Services<ept id=\"p1\">**</ept> dialog box, click <bpt id=\"p2\">**</bpt>Users or Computers<ept id=\"p2\">**</ept>, and then browse to or type the name of the Microsoft SQL server that has the App-V data store and is to receive the users credentials from IIS.","pos":[4763,4972]},{"content":"Click <bpt id=\"p1\">**</bpt>OK<ept id=\"p1\">**</ept>.","pos":[4973,4986]},{"content":"In the <bpt id=\"p1\">**</bpt>Available Services<ept id=\"p1\">**</ept> list, select the MSSQLSvc service that lists port number on which the Microsoft SQL Server is accepting connections for the App-V database (the default port is 1433).","pos":[4992,5188]},{"content":"Click <bpt id=\"p1\">**</bpt>OK<ept id=\"p1\">**</ept>.","pos":[5189,5202]},{"content":"Additional steps to configure IIS 7 for constrained delegation","pos":[5208,5270]},{"pos":[5272,5434],"content":"If you are running the Management Web Service on an IIS 7 server, you must complete the following steps to set the IIS 7 <bpt id=\"p1\">*</bpt>useAppPoolCredentials<ept id=\"p1\">*</ept> variable to True."},{"content":"Open an elevated Command Prompt window.","pos":[5440,5479]},{"content":"To open an elevated Command Prompt window, click <bpt id=\"p1\">**</bpt>Start<ept id=\"p1\">**</ept>, click <bpt id=\"p2\">**</bpt>All Programs<ept id=\"p2\">**</ept>, click <bpt id=\"p3\">**</bpt>Accessories<ept id=\"p3\">**</ept>, right-click <bpt id=\"p4\">**</bpt>Command Prompt<ept id=\"p4\">**</ept>, and then click <bpt id=\"p5\">**</bpt>Run as administrator<ept id=\"p5\">**</ept>.","pos":[5480,5659]},{"content":"Navigate to %windir%<ph id=\"ph1\">\\\\</ph>system32<ph id=\"ph2\">\\\\</ph>inetsrv.","pos":[5665,5705]},{"pos":[5711,5864],"content":"Type <bpt id=\"p1\">**</bpt>appcmd.exe set config -section:system.webServer/security/authentication/windowsAuthentication -useAppPoolCredentials:true<ept id=\"p1\">**</ept>, and then press ENTER."}],"content":"---\ntitle: How to Configure the Server to be Trusted for Delegation\ndescription: How to Configure the Server to be Trusted for Delegation\nauthor: jamiejdt\nms.assetid: d8d11588-17c0-4bcb-a7e6-86b5e4ba7e1c\nms.pagetype: mdop, appcompat, virtualization\nms.mktglfcycl: deploy\nms.sitesec: library\nms.prod: w8\n---\n\n\n# How to Configure the Server to be Trusted for Delegation\n\n\nWhen you install the Microsoft Application Virtualization (App-V) Management Server software, you can choose to install it by using a distributed system architecture. If you install the console, the Management Web Service, and the database on different computers, you must configure the Internet Information Services (IIS) server to be trusted for delegation. This is necessary because the Management Web Service will attempt to connect to the App-V data store by using the credentials of the App-V administrator who is using the console. The database server on which the data store is installed will not accept the administrator’s credentials from the IIS server unless the IIS server is configured to be trusted for delegation, and so the Management Web Service will not be able to connect to the App-V data store.\n\n**Note**  \nIf you install the App-V Management Server software on a single server and place the data store on a separate server, there is one situation in which you must still configure the server to be trusted for delegation even though the Management Web Service and Management Console are on the same server. This situation occurs if you need to connect to the Management Web Service in the console by using the **Use Alternate Credentials** option.\n\n \n\nThe type of delegation that you can use depends on the Domain Functional Level that you have configured in your Active Directory Domain Services (AD DS) infrastructure. The following table lists the types of delegation that can be configured for each Domain Functional Level for App-V. Detailed instructions follow the table.\n\n<table>\n<colgroup>\n<col width=\"50%\" />\n<col width=\"50%\" />\n</colgroup>\n<thead>\n<tr class=\"header\">\n<th align=\"left\">Domain Functional Level</th>\n<th align=\"left\">Delegation Levels Available</th>\n</tr>\n</thead>\n<tbody>\n<tr class=\"odd\">\n<td align=\"left\"><p>Windows 2000 native</p></td>\n<td align=\"left\"><ul>\n<li><p>No delegation (default)</p></li>\n<li><p>Unconstrained delegation</p></li>\n</ul></td>\n</tr>\n<tr class=\"even\">\n<td align=\"left\"><p>Windows Server 2003, Windows Server 2008, or Windows Server 2008 R2</p></td>\n<td align=\"left\"><ul>\n<li><p>No delegation (default)</p></li>\n<li><p>Unconstrained delegation¹</p></li>\n<li><p>Constrained delegation (Use Kerberos Only Protocols)</p></li>\n<li><p>Constrained delegation (Use any authentication protocol) ¹</p></li>\n</ul></td>\n</tr>\n</tbody>\n</table>\n\n \n\n¹ Not recommended.\n\n## To configure unconstrained delegation when the Domain Functional Level is Windows 2000 native\n\n\nOn the domain controller for your Web server’s domain, complete the following steps.\n\n****\n\n1.  Click **Start**, **Administrative Tools**, and then click **Active Directory Users and Computers**.\n\n2.  Expand domain, and then expand the Computers folder.\n\n3.  In the right pane, right-click the computer name for the Web server, and then click **Properties**.\n\n4.  On the **General** tab, ensure that the **Trust computer for delegation** check box is selected.\n\n5.  Click **OK**.\n\n## To configure unconstrained delegation when the Domain Functional Level is Windows Server 2003, Windows Server 2008, or Windows Server 2008 R2\n\n\nOn the domain controller for your Web server’s domain, complete the following steps.\n\n****\n\n1.  Click **Start**, click **Administrative Tools**, and then click **Active Directory Users and Computers**.\n\n2.  Expand domain, and expand the Computers folder.\n\n3.  In the right pane, right-click the computer name for the Web server, select **Properties**, and then click the **Delegation** tab.\n\n4.  Click to select **Trust this computer for delegation to any service (Kerberos only)**.\n\n5.  Click **OK**.\n\n## To configure constrained delegation when the Domain Functional Level is Windows Server 2003, Windows Server 2008, or Windows Server 2008 R2\n\n\nOn the domain controller for your Web server’s domain, complete the following steps.\n\n****\n\n1.  Click **Start**, click **Administrative Tools**, and then click **Active Directory Users and Computers**.\n\n2.  Expand domain, and then expand the Computers folder.\n\n3.  In the right pane, right-click the computer name for the Web server, select **Properties**, and then click the **Delegation** tab.\n\n4.  Click to select **Trust this computer for delegation to specified services only**.\n\n5.  Ensure that **Use Kerberos only** is selected, and then click **OK**.\n\n6.  Click the **Add** button. In the **Add Services** dialog box, click **Users or Computers**, and then browse to or type the name of the Microsoft SQL server that has the App-V data store and is to receive the users credentials from IIS. Click **OK**.\n\n7.  In the **Available Services** list, select the MSSQLSvc service that lists port number on which the Microsoft SQL Server is accepting connections for the App-V database (the default port is 1433). Click **OK**.\n\n### Additional steps to configure IIS 7 for constrained delegation\n\nIf you are running the Management Web Service on an IIS 7 server, you must complete the following steps to set the IIS 7 *useAppPoolCredentials* variable to True.\n\n1.  Open an elevated Command Prompt window. To open an elevated Command Prompt window, click **Start**, click **All Programs**, click **Accessories**, right-click **Command Prompt**, and then click **Run as administrator**.\n\n2.  Navigate to %windir%\\\\system32\\\\inetsrv.\n\n3.  Type **appcmd.exe set config -section:system.webServer/security/authentication/windowsAuthentication -useAppPoolCredentials:true**, and then press ENTER.\n\n \n\n \n\n\n\n\n\n"}