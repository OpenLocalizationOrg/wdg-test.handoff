{"nodes":[{"content":"How to Move the MBAM 2.5 Databases","pos":[11,45]},{"content":"How to Move the MBAM 2.5 Databases","pos":[59,93]},{"content":"How to Move the MBAM 2.5 Databases","pos":[251,285]},{"content":"Use these procedures to move the following databases from one computer to another, that is, to move the databases from Server A to Server B:","pos":[288,428]},{"content":"Compliance and Audit Database","pos":[434,463]},{"content":"Recovery Database","pos":[469,486]},{"content":"If you are moving multiple features, move them in the following order:","pos":[488,558]},{"content":"Recovery Database","pos":[564,581]},{"content":"Compliance and Audit Database","pos":[587,616]},{"content":"Reports","pos":[622,629]},{"content":"Administration and Monitoring Website","pos":[635,672]},{"content":"Self-Service Portal","pos":[678,697]},{"content":"Note","pos":[701,705]},{"content":"To run the example Windows PowerShell scripts provided in this topic, you must update the Windows PowerShell execution policy to enable scripts to be run.","pos":[710,864]},{"content":"See <bpt id=\"p1\">[</bpt>Running Windows PowerShell Scripts<ept id=\"p1\">](http://technet.microsoft.com/library/ee176949.aspx)</ept> for instructions.","pos":[865,975]},{"content":"Moving the Recovery Database","pos":[983,1011]},{"content":"The high-level steps for moving the Recovery Database are:","pos":[1014,1072]},{"content":"Stop all instances of the MBAM Administration and Monitoring Website","pos":[1078,1146]},{"content":"Back up the Recovery Database on Server A","pos":[1152,1193]},{"content":"Install MBAM Server software and run the MBAM Server Configuration wizard on Server B","pos":[1199,1284]},{"content":"Move the Recovery Database from Server A to Server B","pos":[1290,1342]},{"content":"Restore the Recovery Database on Server B","pos":[1348,1389]},{"content":"Configure access to the Database on Server B and update connection data","pos":[1395,1466]},{"content":"Resume the instance of the Administration and Monitoring Website","pos":[1472,1536]},{"content":"How to move the Recovery Database","pos":[1540,1573]},{"content":"Stop all instances of the MBAM Administration and Monitoring Website","pos":[1583,1651]},{"content":"On each server that is running the MBAM Administration and Monitoring Server Website, use the Internet Information Services (IIS) Manager console to stop the Administration and Monitoring Website.","pos":[1663,1859]},{"content":"To automate this procedure, you can use Windows PowerShell to enter a command that is similar to the following:","pos":[1869,1980]},{"pos":[2103,2272],"content":"**Note**  \nTo run this command, you must add the Internet Information Services (IIS) module for Windows PowerShell to the current instance of Windows PowerShell.","leadings":["","        "],"nodes":[{"content":"Note","pos":[2,6]},{"content":"To run this command, you must add the Internet Information Services (IIS) module for Windows PowerShell to the current instance of Windows PowerShell.","pos":[11,161]}]},{"content":"Install MBAM Server software and run the MBAM Server Configuration wizard on Server B","pos":[2291,2376]},{"pos":[2388,2545],"content":"Install the MBAM 2.5 Server software on Server B. For instructions, see <bpt id=\"p1\">[</bpt>Installing the MBAM 2.5 Server Software<ept id=\"p1\">](installing-the-mbam-25-server-software.md)</ept>."},{"pos":[2555,2695],"content":"On Server B, start the MBAM Server Configuration wizard, click <bpt id=\"p1\">**</bpt>Add New Features<ept id=\"p1\">**</ept>, and then select only the <bpt id=\"p2\">**</bpt>Recovery Database<ept id=\"p2\">**</ept> feature."},{"pos":[2705,2821],"content":"Alternatively, you can use the <bpt id=\"p1\">**</bpt>Enable-MbamDatabase<ept id=\"p1\">**</ept> Windows PowerShell cmdlet to configure the Recovery Database."},{"pos":[2831,2972],"content":"For instructions on how to configure the databases, see <bpt id=\"p1\">[</bpt>How to Configure the MBAM 2.5 Databases<ept id=\"p1\">](how-to-configure-the-mbam-25-databases.md)</ept>."},{"content":"Back up the Recovery Database on Server A","pos":[2980,3021]},{"pos":[3033,3196],"content":"Use the <bpt id=\"p1\">**</bpt>Back Up<ept id=\"p1\">**</ept> task in SQL Server Management Studio to back up the Recovery Database on Server A. By default, the database name is <bpt id=\"p2\">**</bpt>MBAM Recovery Database<ept id=\"p2\">**</ept>."},{"content":"To automate this procedure, create a SQL file (.sql) that contains the following SQL script, and change the MBAM Recovery Database to use the full recovery mode:","pos":[3206,3367]},{"content":"Use the following value to replace the values in the code example with values that match your environment.","pos":[4272,4378]},{"pos":[4388,4464],"content":"<bpt id=\"p1\">**</bpt>$PASSWORD$<ept id=\"p1\">**</ept> - password that you will use to encrypt the Private Key file."},{"content":"Run the script that is stored in the .sql file by using a Windows PowerShell command that is similar to the following:","pos":[4474,4592]},{"content":"Use the following value to replace the values in the code example with values that match your environment:","pos":[4774,4880]},{"pos":[4890,5004],"content":"<bpt id=\"p1\">**</bpt>$SERVERNAME$<ph id=\"ph1\">\\\\</ph>$SQLINSTANCENAME$<ept id=\"p1\">**</ept> - server name and instance from which the Recovery Database will be backed up."},{"content":"Move the Recovery Database from Server A to Server B","pos":[5012,5064]},{"pos":[5076,5185],"content":"Use Windows Explorer to move the <bpt id=\"p1\">**</bpt>MBAM Compliance Status Database Data.bak<ept id=\"p1\">**</ept> file from Server A to Server B."},{"content":"To automate this procedure, you can use Windows PowerShell to run a command that is similar to the following:","pos":[5195,5304]},{"content":"Use the information in the following table to replace the values in the code example with values that match your environment.","pos":[5651,5776]},{"pos":[5786,6470],"content":"<table>\n<colgroup>\n<col width=\"50%\" />\n<col width=\"50%\" />\n</colgroup>\n<thead>\n<tr class=\"header\">\n<th align=\"left\">Parameter</th>\n<th align=\"left\">Description</th>\n</tr>\n</thead>\n<tbody>\n<tr class=\"odd\">\n<td align=\"left\"><p>$SERVERNAME$</p></td>\n<td align=\"left\"><p>Name of the server to which the files will be copied.</p></td>\n</tr>\n<tr class=\"even\">\n<td align=\"left\"><p>$DESTINATIONSHARE$</p></td>\n<td align=\"left\"><p>Name of the share and path to which the files will be copied.</p></td>\n</tr>\n</tbody>\n</table>","leadings":["","        ","        ","        ","        ","        ","        ","        ","        ","        ","        ","        ","        ","        ","        ","        ","        ","        ","        ","        ","        ","        "],"nodes":[{"content":"Parameter","pos":[116,125]},{"content":"Description","pos":[148,159]},{"content":"$SERVERNAME$","pos":[225,237]},{"content":"Name of the server to which the files will be copied.","pos":[267,320]},{"content":"$DESTINATIONSHARE$","pos":[374,392]},{"content":"Name of the share and path to which the files will be copied.","pos":[422,483]}]},{"content":"Restore the Recovery Database on Server B","pos":[6489,6530]},{"pos":[6542,6655],"content":"Restore the Recovery Database on Server B by using the <bpt id=\"p1\">**</bpt>Restore Database<ept id=\"p1\">**</ept> task in SQL Server Management Studio."},{"pos":[6665,6763],"content":"When the previous task finishes, select <bpt id=\"p1\">**</bpt>From Device<ept id=\"p1\">**</ept>, and then select the database backup file."},{"pos":[6773,6906],"content":"Use the <bpt id=\"p1\">**</bpt>Add<ept id=\"p1\">**</ept> command to select the <bpt id=\"p2\">**</bpt>MBAM Recovery Database Data.bak<ept id=\"p2\">**</ept> file, and click <bpt id=\"p3\">**</bpt>OK<ept id=\"p3\">**</ept> to complete the restoration process."},{"content":"To automate this procedure, create a SQL file (.sql) that contains the following SQL script:","pos":[6916,7008]},{"content":"Use the following value to replace the values in the code example with values that match your environment.","pos":[7783,7889]},{"pos":[7899,7971],"content":"<bpt id=\"p1\">**</bpt>$PASSWORD$<ept id=\"p1\">**</ept> - password that you used to encrypt the Private Key file."},{"content":"Run the script that is stored in the .sql file by using a Windows PowerShell command that is similar to the following:","pos":[7981,8099]},{"content":"Use the following value to replace the values in the code example with values that match your environment.","pos":[8282,8388]},{"pos":[8398,8509],"content":"<bpt id=\"p1\">**</bpt>$SERVERNAME$<ph id=\"ph1\">\\\\</ph>$SQLINSTANCENAME$<ept id=\"p1\">**</ept> - Server name and instance to which the Recovery Database will be restored."},{"content":"Configure access to the Database on Server B and update connection data","pos":[8517,8588]},{"content":"Verify that the Microsoft SQL Server user login that enables Recovery Database access on the restored database is mapped to the access account that you provided during the configuration process.","pos":[8600,8794]},{"content":"If the login is not the same, create a login by using SQL Server Management Studio, and map it to the existing database user.","pos":[8804,8929]},{"content":"On the server that is running the Administration and Monitoring Website, use the Internet Information Services (IIS) Manager console to update the connection string information for the MBAM websites.","pos":[8939,9138]},{"pos":[9148,9256],"content":"Edit the following registry key: <bpt id=\"p1\">**</bpt>HKLM<ph id=\"ph1\">\\\\</ph>Software<ph id=\"ph2\">\\\\</ph>Microsoft<ph id=\"ph3\">\\\\</ph>MBAM Server<ph id=\"ph4\">\\\\</ph>Web<ph id=\"ph5\">\\\\</ph>RecoveryDBConnectionString<ept id=\"p1\">**</ept>"},{"pos":[9266,9427],"content":"Update the <bpt id=\"p1\">**</bpt>Data Source<ept id=\"p1\">**</ept> value with the name of the server and instance (for example, $SERVERNAME$<ph id=\"ph1\">\\\\</ph>$SQLINSTANCENAME) to which the Recovery Database was moved."},{"pos":[9437,9507],"content":"Update the <bpt id=\"p1\">**</bpt>Initial Catalog<ept id=\"p1\">**</ept> value with the recovered database name."},{"content":"To automate this process, you can use the Windows PowerShell command prompt to enter a command line on the Administration and Monitoring Server that is similar to the following:","pos":[9517,9694]},{"pos":[10698,10841],"content":"**Note**  \nThis connection string is shared by all local MBAM web applications. Therefore, it needs to be updated only once per server.","leadings":["","        "],"nodes":[{"content":"Note","pos":[2,6]},{"content":"This connection string is shared by all local MBAM web applications. Therefore, it needs to be updated only once per server.","pos":[11,135],"nodes":[{"content":"This connection string is shared by all local MBAM web applications.","pos":[0,68]},{"content":"Therefore, it needs to be updated only once per server.","pos":[69,124]}]}]},{"content":"Use the following table to replace the values in the code example with values that match your environment.","pos":[10862,10968]},{"pos":[10978,11666],"content":"<table>\n<colgroup>\n<col width=\"50%\" />\n<col width=\"50%\" />\n</colgroup>\n<thead>\n<tr class=\"header\">\n<th align=\"left\">Parameter</th>\n<th align=\"left\">Description</th>\n</tr>\n</thead>\n<tbody>\n<tr class=\"odd\">\n<td align=\"left\"><p>$SERVERNAME$\\$SQLINSTANCENAME$</p></td>\n<td align=\"left\"><p>Server name and instance of SQL Server where the Recovery Database is located.</p></td>\n</tr>\n<tr class=\"even\">\n<td align=\"left\"><p>$DATABASE$</p></td>\n<td align=\"left\"><p>Name of the Recovery database.</p></td>\n</tr>\n</tbody>\n</table>","leadings":["","        ","        ","        ","        ","        ","        ","        ","        ","        ","        ","        ","        ","        ","        ","        ","        ","        ","        ","        ","        ","        "],"nodes":[{"content":"Parameter","pos":[116,125]},{"content":"Description","pos":[148,159]},{"content":"$SERVERNAME$<ph id=\"ph1\">\\$</ph>SQLINSTANCENAME$","pos":[225,255]},{"content":"Server name and instance of SQL Server where the Recovery Database is located.","pos":[285,363]},{"content":"$DATABASE$","pos":[417,427]},{"content":"Name of the Recovery database.","pos":[457,487]}]},{"content":"Resume the instance of the Administration and Monitoring Website","pos":[11685,11749]},{"content":"On the server that is running the Administration and Monitoring Website, use the Internet Information Services (IIS) Manager console to start the Administration and Monitoring Website.","pos":[11761,11945]},{"content":"To automate this procedure, you can use Windows PowerShell to run a command that is similar to the following:","pos":[11955,12064]},{"pos":[12188,12325],"content":"**Note**  \nTo run this command, you must add the IIS module for Windows PowerShell to the current instance of Windows PowerShell.","leadings":["","        "],"nodes":[{"content":"Note","pos":[2,6]},{"content":"To run this command, you must add the IIS module for Windows PowerShell to the current instance of Windows PowerShell.","pos":[11,129]}]},{"content":"Moving the Compliance and Audit Database","pos":[12341,12381]},{"content":"The high-level steps for moving the Compliance and Audit Database are:","pos":[12384,12454]},{"content":"Stop all instances of the MBAM Administration and Monitoring Website","pos":[12460,12528]},{"content":"Install MBAM Server software and run the MBAM Server Configuration wizard on Server B","pos":[12534,12619]},{"content":"Back up the Compliance and Audit Database on Server A","pos":[12625,12678]},{"content":"Move the Compliance and Audit Database from Server A to Server B","pos":[12684,12748]},{"content":"Restore the Compliance and Audit Database on Server B","pos":[12754,12807]},{"content":"Configure access to the Database on Server B and update connection data","pos":[12813,12884]},{"content":"Resume the instance of the Administration and Monitoring Website","pos":[12890,12954]},{"content":"How to move the Compliance and Audit Database","pos":[12958,13003]},{"content":"Stop all instances of the MBAM Administration and Monitoring Website","pos":[13013,13081]},{"content":"On each server that is running the MBAM Administration and Monitoring Server Website, use the Internet Information Services (IIS) Manager console to stop the Administration and Monitoring Website.","pos":[13093,13289]},{"content":"To automate this procedure, you can use Windows PowerShell to enter a command that is similar to the following:","pos":[13299,13410]},{"pos":[13533,13702],"content":"**Note**  \nTo run this command, you must add the Internet Information Services (IIS) module for Windows PowerShell to the current instance of Windows PowerShell.","leadings":["","        "],"nodes":[{"content":"Note","pos":[2,6]},{"content":"To run this command, you must add the Internet Information Services (IIS) module for Windows PowerShell to the current instance of Windows PowerShell.","pos":[11,161]}]},{"content":"Install MBAM Server software and run the MBAM Server Configuration wizard on Server B","pos":[13721,13806]},{"pos":[13818,13975],"content":"Install the MBAM 2.5 Server software on Server B. For instructions, see <bpt id=\"p1\">[</bpt>Installing the MBAM 2.5 Server Software<ept id=\"p1\">](installing-the-mbam-25-server-software.md)</ept>."},{"pos":[13985,14137],"content":"On Server B, start the MBAM Server Configuration wizard, click <bpt id=\"p1\">**</bpt>Add New Features<ept id=\"p1\">**</ept>, and then select only the <bpt id=\"p2\">**</bpt>Compliance and Audit Database<ept id=\"p2\">**</ept> feature."},{"pos":[14147,14275],"content":"Alternatively, you can use the <bpt id=\"p1\">**</bpt>Enable-MbamDatabase<ept id=\"p1\">**</ept> Windows PowerShell cmdlet to configure the Compliance and Audit Database."},{"pos":[14285,14426],"content":"For instructions on how to configure the databases, see <bpt id=\"p1\">[</bpt>How to Configure the MBAM 2.5 Databases<ept id=\"p1\">](how-to-configure-the-mbam-25-databases.md)</ept>."},{"content":"Back up the Compliance and Audit Database on Server A","pos":[14434,14487]},{"pos":[14499,14683],"content":"Use the <bpt id=\"p1\">**</bpt>Back Up<ept id=\"p1\">**</ept> task in SQL Server Management Studio to back up the Compliance and Audit Database on Server A. By default, the database name is <bpt id=\"p2\">**</bpt>MBAM Compliance Status Database<ept id=\"p2\">**</ept>."},{"content":"To automate this procedure, create a SQL file (.sql) that contains the following SQL script:","pos":[14693,14785]},{"content":"Run the script that is stored in the .sql file by using a Windows PowerShell command that is similar to the following:","pos":[15380,15498]},{"content":"Using the following value, replace the values in the code example with values that match your environment:","pos":[15678,15784]},{"pos":[15794,15920],"content":"<bpt id=\"p1\">**</bpt>$SERVERNAME$<ph id=\"ph1\">\\\\</ph>$SQLINSTANCENAME$<ept id=\"p1\">**</ept> - server name and instance from which the Compliance and Audit Database will be backed up."},{"content":"Move the Compliance and Audit Database from Server A to Server B","pos":[15928,15992]},{"pos":[16004,16113],"content":"Use Windows Explorer to move the <bpt id=\"p1\">**</bpt>MBAM Compliance Status Database Data.bak<ept id=\"p1\">**</ept> file from Server A to Server B."},{"content":"To automate this procedure, you can use Windows PowerShell to run a command that is similar to the following:","pos":[16123,16232]},{"content":"Using the following table, replace the values in the code example with values that match your environment.","pos":[16380,16486]},{"pos":[16496,17180],"content":"<table>\n<colgroup>\n<col width=\"50%\" />\n<col width=\"50%\" />\n</colgroup>\n<thead>\n<tr class=\"header\">\n<th align=\"left\">Parameter</th>\n<th align=\"left\">Description</th>\n</tr>\n</thead>\n<tbody>\n<tr class=\"odd\">\n<td align=\"left\"><p>$SERVERNAME$</p></td>\n<td align=\"left\"><p>Name of the server to which the files will be copied.</p></td>\n</tr>\n<tr class=\"even\">\n<td align=\"left\"><p>$DESTINATIONSHARE$</p></td>\n<td align=\"left\"><p>Name of the share and path to which the files will be copied.</p></td>\n</tr>\n</tbody>\n</table>","leadings":["","        ","        ","        ","        ","        ","        ","        ","        ","        ","        ","        ","        ","        ","        ","        ","        ","        ","        ","        ","        ","        "],"nodes":[{"content":"Parameter","pos":[116,125]},{"content":"Description","pos":[148,159]},{"content":"$SERVERNAME$","pos":[225,237]},{"content":"Name of the server to which the files will be copied.","pos":[267,320]},{"content":"$DESTINATIONSHARE$","pos":[374,392]},{"content":"Name of the share and path to which the files will be copied.","pos":[422,483]}]},{"content":"Restore the Compliance and Audit Database on Server B","pos":[17199,17252]},{"pos":[17264,17389],"content":"Restore the Compliance and Audit Database on Server B by using the <bpt id=\"p1\">**</bpt>Restore Database<ept id=\"p1\">**</ept> task in SQL Server Management Studio."},{"pos":[17399,17497],"content":"When the previous task finishes, select <bpt id=\"p1\">**</bpt>From Device<ept id=\"p1\">**</ept>, and then select the database backup file."},{"pos":[17507,17649],"content":"Use the <bpt id=\"p1\">**</bpt>Add<ept id=\"p1\">**</ept> command to select the <bpt id=\"p2\">**</bpt>MBAM Compliance Status Database Data.bak<ept id=\"p2\">**</ept> file, and click <bpt id=\"p3\">**</bpt>OK<ept id=\"p3\">**</ept> to complete the restoration process."},{"content":"To automate this procedure, create a SQL file (.sql) that contains the following SQL script:","pos":[17659,17751]},{"content":"Run the script that is stored in the .sql file by using a Windows PowerShell command that is similar to the following:","pos":[18117,18235]},{"content":"Using the following value, replace the values in the code example with values that match your environment.","pos":[18416,18522]},{"pos":[18532,18655],"content":"<bpt id=\"p1\">**</bpt>$SERVERNAME$<ph id=\"ph1\">\\\\</ph>$SQLINSTANCENAME$<ept id=\"p1\">**</ept> - Server name and instance to which the Compliance and Audit Database will be restored."},{"content":"Configure access to the Database on Server B and update connection data","pos":[18663,18734]},{"content":"Verify that the Microsoft SQL Server user login that enables Compliance and Audit Database access on the restored database is mapped to the access account that you provided during the configuration process.","pos":[18746,18952]},{"content":"If the login is not the same, create a login by using SQL Server Management Studio, and map it to the existing database user.","pos":[18962,19087]},{"content":"On the server that is running the Administration and Monitoring Website, use the Internet Information Services (IIS) Manager console to update the connection string information for the Website.","pos":[19097,19290]},{"pos":[19300,19410],"content":"Edit the following registry key: <bpt id=\"p1\">**</bpt>HKLM<ph id=\"ph1\">\\\\</ph>Software<ph id=\"ph2\">\\\\</ph>Microsoft<ph id=\"ph3\">\\\\</ph>MBAM Server<ph id=\"ph4\">\\\\</ph>Web<ph id=\"ph5\">\\\\</ph>ComplianceDBConnectionString<ept id=\"p1\">**</ept>"},{"pos":[19420,19581],"content":"Update the <bpt id=\"p1\">**</bpt>Data Source<ept id=\"p1\">**</ept> value with the name of the server and instance (for example, $SERVERNAME$<ph id=\"ph1\">\\\\</ph>$SQLINSTANCENAME) to which the Recovery Database was moved."},{"pos":[19591,19661],"content":"Update the <bpt id=\"p1\">**</bpt>Initial Catalog<ept id=\"p1\">**</ept> value with the recovered database name."},{"content":"To automate this process, you can use the Windows PowerShell command prompt to enter a command line on the Administration and Monitoring Server that is similar to the following:","pos":[19671,19848]},{"pos":[20115,20258],"content":"**Note**  \nThis connection string is shared by all local MBAM web applications. Therefore, it needs to be updated only once per server.","leadings":["","        "],"nodes":[{"content":"Note","pos":[2,6]},{"content":"This connection string is shared by all local MBAM web applications. Therefore, it needs to be updated only once per server.","pos":[11,135],"nodes":[{"content":"This connection string is shared by all local MBAM web applications.","pos":[0,68]},{"content":"Therefore, it needs to be updated only once per server.","pos":[69,124]}]}]},{"content":"Using the following table, replace the values in the code example with values that match your environment.","pos":[20279,20385]},{"pos":[20395,21084],"content":"<table>\n<colgroup>\n<col width=\"50%\" />\n<col width=\"50%\" />\n</colgroup>\n<thead>\n<tr class=\"header\">\n<th align=\"left\">Parameter</th>\n<th align=\"left\">Description</th>\n</tr>\n</thead>\n<tbody>\n<tr class=\"odd\">\n<td align=\"left\"><p>$SERVERNAME$\\$SQLINSTANCENAME$</p></td>\n<td align=\"left\"><p>Server name and instance of SQL Server where the Recovery Database is located.</p></td>\n</tr>\n<tr class=\"even\">\n<td align=\"left\"><p>$DATABASE$</p></td>\n<td align=\"left\"><p>Name of the recovered database.</p></td>\n</tr>\n</tbody>\n</table>","leadings":["","        ","        ","        ","        ","        ","        ","        ","        ","        ","        ","        ","        ","        ","        ","        ","        ","        ","        ","        ","        ","        "],"nodes":[{"content":"Parameter","pos":[116,125]},{"content":"Description","pos":[148,159]},{"content":"$SERVERNAME$<ph id=\"ph1\">\\$</ph>SQLINSTANCENAME$","pos":[225,255]},{"content":"Server name and instance of SQL Server where the Recovery Database is located.","pos":[285,363]},{"content":"$DATABASE$","pos":[417,427]},{"content":"Name of the recovered database.","pos":[457,488]}]},{"content":"Resume the instance of the Administration and Monitoring Website","pos":[21103,21167]},{"content":"On the server that is running the Administration and Monitoring Website, use the Internet Information Services (IIS) Manager console to start the Administration and Monitoring Website.","pos":[21179,21363]},{"content":"To automate this procedure, you can use Windows PowerShell to run a command that is similar to the following:","pos":[21373,21482]},{"pos":[21606,21743],"content":"**Note**  \nTo run this command, you must add the IIS module for Windows PowerShell to the current instance of Windows PowerShell.","leadings":["","        "],"nodes":[{"content":"Note","pos":[2,6]},{"content":"To run this command, you must add the IIS module for Windows PowerShell to the current instance of Windows PowerShell.","pos":[11,129]}]},{"content":"<bpt id=\"p1\">**</bpt>Got a suggestion for MBAM<ept id=\"p1\">**</ept>?","pos":[21756,21786]},{"content":"Add or vote on suggestions <bpt id=\"p1\">[</bpt>here<ept id=\"p1\">](http://mbam.uservoice.com/forums/268571-microsoft-bitlocker-administration-and-monitoring)</ept>.","pos":[21787,21912]},{"content":"<bpt id=\"p1\">**</bpt>Got a MBAM issue<ept id=\"p1\">**</ept>?","pos":[21913,21934]},{"content":"Use the <bpt id=\"p1\">[</bpt>MBAM TechNet Forum<ept id=\"p1\">](https://social.technet.microsoft.com/Forums/home?forum=mdopmbam)</ept>.","pos":[21935,22029]},{"content":"Related topics","pos":[22034,22048]},{"content":"How to Configure the MBAM 2.5 Databases","pos":[22052,22091]},{"content":"Configuring MBAM 2.5 Server Features by Using Windows PowerShell","pos":[22138,22202]},{"content":"Moving MBAM 2.5 Features to Another Server","pos":[22274,22316]}],"content":"---\ntitle: How to Move the MBAM 2.5 Databases\ndescription: How to Move the MBAM 2.5 Databases\nauthor: jamiejdt\nms.assetid: 34b46f2d-0add-4377-8e4e-04b628fdfcf1\nms.pagetype: mdop, security\nms.mktglfcycl: manage\nms.sitesec: library\nms.prod: w10\n---\n\n\n# How to Move the MBAM 2.5 Databases\n\n\nUse these procedures to move the following databases from one computer to another, that is, to move the databases from Server A to Server B:\n\n-   Compliance and Audit Database\n\n-   Recovery Database\n\nIf you are moving multiple features, move them in the following order:\n\n1.  Recovery Database\n\n2.  Compliance and Audit Database\n\n3.  Reports\n\n4.  Administration and Monitoring Website\n\n5.  Self-Service Portal\n\n**Note**  \nTo run the example Windows PowerShell scripts provided in this topic, you must update the Windows PowerShell execution policy to enable scripts to be run. See [Running Windows PowerShell Scripts](http://technet.microsoft.com/library/ee176949.aspx) for instructions.\n\n \n\n## Moving the Recovery Database\n\n\nThe high-level steps for moving the Recovery Database are:\n\n1.  Stop all instances of the MBAM Administration and Monitoring Website\n\n2.  Back up the Recovery Database on Server A\n\n3.  Install MBAM Server software and run the MBAM Server Configuration wizard on Server B\n\n4.  Move the Recovery Database from Server A to Server B\n\n5.  Restore the Recovery Database on Server B\n\n6.  Configure access to the Database on Server B and update connection data\n\n7.  Resume the instance of the Administration and Monitoring Website\n\n**How to move the Recovery Database**\n\n1.  **Stop all instances of the MBAM Administration and Monitoring Website**\n\n    -   On each server that is running the MBAM Administration and Monitoring Server Website, use the Internet Information Services (IIS) Manager console to stop the Administration and Monitoring Website.\n\n        To automate this procedure, you can use Windows PowerShell to enter a command that is similar to the following:\n\n        ``` syntax\n        PS C:\\> Stop-Website \"Microsoft BitLocker Administration and Monitoring\"\n        ```\n\n        **Note**  \n        To run this command, you must add the Internet Information Services (IIS) module for Windows PowerShell to the current instance of Windows PowerShell.\n\n         \n\n2.  **Install MBAM Server software and run the MBAM Server Configuration wizard on Server B**\n\n    1.  Install the MBAM 2.5 Server software on Server B. For instructions, see [Installing the MBAM 2.5 Server Software](installing-the-mbam-25-server-software.md).\n\n    2.  On Server B, start the MBAM Server Configuration wizard, click **Add New Features**, and then select only the **Recovery Database** feature.\n\n        Alternatively, you can use the **Enable-MbamDatabase** Windows PowerShell cmdlet to configure the Recovery Database.\n\n        For instructions on how to configure the databases, see [How to Configure the MBAM 2.5 Databases](how-to-configure-the-mbam-25-databases.md).\n\n3.  **Back up the Recovery Database on Server A**\n\n    1.  Use the **Back Up** task in SQL Server Management Studio to back up the Recovery Database on Server A. By default, the database name is **MBAM Recovery Database**.\n\n        To automate this procedure, create a SQL file (.sql) that contains the following SQL script, and change the MBAM Recovery Database to use the full recovery mode:\n\n        ``` syntax\n        USE master; \n        GO \n        ALTER DATABASE \"MBAM Recovery and Hardware\" \n        SET RECOVERY FULL; \n        GO \n        -- Create MBAM Recovery Database Data and MBAM Recovery logical backup devices.\n        USE master \n        GO \n        EXEC sp_addumpdevice 'disk', 'MBAM Recovery and Hardware Database Data Device', \n        'Z:\\MBAM Recovery Database Data.bak'; \n        GO \n        -- Back up the full MBAM Recovery Database.\n        BACKUP DATABASE [MBAM Recovery and Hardware] TO [MBAM Recovery and Hardware Database Data Device]; \n        GO \n        BACKUP CERTIFICATE [MBAM Recovery Encryption Certificate] \n        TO FILE = 'Z:\\SQLServerInstanceCertificateFile' \n        WITH PRIVATE KEY \n        ( \n        FILE = ' Z:\\SQLServerInstanceCertificateFilePrivateKey', \n        ENCRYPTION BY PASSWORD = '$PASSWORD$' \n        ); \n        GO\n        ```\n\n        Use the following value to replace the values in the code example with values that match your environment.\n\n        **$PASSWORD$** - password that you will use to encrypt the Private Key file.\n\n    2.  Run the script that is stored in the .sql file by using a Windows PowerShell command that is similar to the following:\n\n        ``` syntax\n        PS C:\\> Invoke-Sqlcmd -InputFile 'Z:\\BackupMBAMRecoveryandHardwarDatabaseScript.sql' -ServerInstance $SERVERNAME$\\$SQLINSTANCENAME$\n        ```\n\n        Use the following value to replace the values in the code example with values that match your environment:\n\n        **$SERVERNAME$\\\\$SQLINSTANCENAME$** - server name and instance from which the Recovery Database will be backed up.\n\n4.  **Move the Recovery Database from Server A to Server B**\n\n    -   Use Windows Explorer to move the **MBAM Compliance Status Database Data.bak** file from Server A to Server B.\n\n        To automate this procedure, you can use Windows PowerShell to run a command that is similar to the following:\n\n        ``` syntax\n        PS C:\\> Copy-Item “Z:\\MBAM Recovery Database Data.bak” \\\\$SERVERNAME$\\$DESTINATIONSHARE$ \n        PS C:\\> Copy-Item “Z:\\SQLServerInstanceCertificateFile” \\\\$SERVERNAME$\\$DESTINATIONSHARE$ \n        PS C:\\> Copy-Item “Z:\\SQLServerInstanceCertificateFilePrivateKey” \\\\$SERVERNAME$\\$DESTINATIONSHARE$\n        ```\n\n        Use the information in the following table to replace the values in the code example with values that match your environment.\n\n        <table>\n        <colgroup>\n        <col width=\"50%\" />\n        <col width=\"50%\" />\n        </colgroup>\n        <thead>\n        <tr class=\"header\">\n        <th align=\"left\">Parameter</th>\n        <th align=\"left\">Description</th>\n        </tr>\n        </thead>\n        <tbody>\n        <tr class=\"odd\">\n        <td align=\"left\"><p>$SERVERNAME$</p></td>\n        <td align=\"left\"><p>Name of the server to which the files will be copied.</p></td>\n        </tr>\n        <tr class=\"even\">\n        <td align=\"left\"><p>$DESTINATIONSHARE$</p></td>\n        <td align=\"left\"><p>Name of the share and path to which the files will be copied.</p></td>\n        </tr>\n        </tbody>\n        </table>\n\n         \n\n5.  **Restore the Recovery Database on Server B**\n\n    1.  Restore the Recovery Database on Server B by using the **Restore Database** task in SQL Server Management Studio.\n\n    2.  When the previous task finishes, select **From Device**, and then select the database backup file.\n\n    3.  Use the **Add** command to select the **MBAM Recovery Database Data.bak** file, and click **OK** to complete the restoration process.\n\n        To automate this procedure, create a SQL file (.sql) that contains the following SQL script:\n\n        ``` syntax\n        -- Restore MBAM Recovery Database. \n        USE master \n        GO \n        -- Drop certificate created by MBAM Setup. \n        DROP CERTIFICATE [MBAM Recovery Encryption Certificate] \n        GO \n        --Add certificate\n        CREATE CERTIFICATE [MBAM Recovery Encryption Certificate] \n        FROM FILE = 'Z: \\SQLServerInstanceCertificateFile' \n        WITH PRIVATE KEY \n        ( \n        FILE = ' Z:\\SQLServerInstanceCertificateFilePrivateKey', \n        DECRYPTION BY PASSWORD = '$PASSWORD$' \n        ); \n        GO \n        -- Restore the MBAM Recovery Database data and log files. \n        RESTORE DATABASE [MBAM Recovery and Hardware] \n        FROM DISK = 'Z:\\MBAM Recovery Database Data.bak' \n        WITH REPLACE\n        ```\n\n        Use the following value to replace the values in the code example with values that match your environment.\n\n        **$PASSWORD$** - password that you used to encrypt the Private Key file.\n\n    4.  Run the script that is stored in the .sql file by using a Windows PowerShell command that is similar to the following:\n\n        ``` syntax\n        PS C:\\> Invoke-Sqlcmd -InputFile 'Z:\\RestoreMBAMRecoveryandHardwarDatabaseScript.sql' -ServerInstance $SERVERNAME$\\$SQLINSTANCENAME$\n        ```\n\n        Use the following value to replace the values in the code example with values that match your environment.\n\n        **$SERVERNAME$\\\\$SQLINSTANCENAME$** - Server name and instance to which the Recovery Database will be restored.\n\n6.  **Configure access to the Database on Server B and update connection data**\n\n    1.  Verify that the Microsoft SQL Server user login that enables Recovery Database access on the restored database is mapped to the access account that you provided during the configuration process.\n\n        If the login is not the same, create a login by using SQL Server Management Studio, and map it to the existing database user.\n\n    2.  On the server that is running the Administration and Monitoring Website, use the Internet Information Services (IIS) Manager console to update the connection string information for the MBAM websites.\n\n    3.  Edit the following registry key: **HKLM\\\\Software\\\\Microsoft\\\\MBAM Server\\\\Web\\\\RecoveryDBConnectionString**\n\n    4.  Update the **Data Source** value with the name of the server and instance (for example, $SERVERNAME$\\\\$SQLINSTANCENAME) to which the Recovery Database was moved.\n\n    5.  Update the **Initial Catalog** value with the recovered database name.\n\n        To automate this process, you can use the Windows PowerShell command prompt to enter a command line on the Administration and Monitoring Server that is similar to the following:\n\n        ``` syntax\n        PS C:\\> reg add \"HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\MBAM Server\\Web\" /v RecoveryDBConnectionString /t REG_SZ /d \"Integrated Security=SSPI;Initial Catalog=$DATABASE$;Data Source=$SERVERNAME$\\$SQLINSTANCENAME$\" /f\n        PS C:\\> Set-WebConfigurationProperty '/connectionStrings/add[@name=\"KeyRecoveryConnectionString\"]' -PSPath \"IIS:\\sites\\Microsoft Bitlocker Administration and Monitoring\\MBAMAdministrationService\" -Name \"connectionString\" -Value “Data Source=$SERVERNAME$\\$SQLINSTANCENAME$;Initial Catalog=MBAM Recovery and Hardware;Integrated Security=SSPI;” \n        PS C:\\> Set-WebConfigurationProperty '/connectionStrings/add[@name=\"Microsoft.Mbam.RecoveryAndHardwareDataStore.ConnectionString\"]' -PSPath \"IIS:\\sites\\Microsoft Bitlocker Administration and Monitoring\\MBAMRecoveryAndHardwareService\" -Name \"connectionString\" -Value \"Data Source=$SERVERNAME$\\$SQLINSTANCENAME$;Initial Catalog=MBAM Recovery and Hardware;Integrated Security=SSPI;”\n        ```\n\n        **Note**  \n        This connection string is shared by all local MBAM web applications. Therefore, it needs to be updated only once per server.\n\n         \n\n        Use the following table to replace the values in the code example with values that match your environment.\n\n        <table>\n        <colgroup>\n        <col width=\"50%\" />\n        <col width=\"50%\" />\n        </colgroup>\n        <thead>\n        <tr class=\"header\">\n        <th align=\"left\">Parameter</th>\n        <th align=\"left\">Description</th>\n        </tr>\n        </thead>\n        <tbody>\n        <tr class=\"odd\">\n        <td align=\"left\"><p>$SERVERNAME$\\$SQLINSTANCENAME$</p></td>\n        <td align=\"left\"><p>Server name and instance of SQL Server where the Recovery Database is located.</p></td>\n        </tr>\n        <tr class=\"even\">\n        <td align=\"left\"><p>$DATABASE$</p></td>\n        <td align=\"left\"><p>Name of the Recovery database.</p></td>\n        </tr>\n        </tbody>\n        </table>\n\n         \n\n7.  **Resume the instance of the Administration and Monitoring Website**\n\n    1.  On the server that is running the Administration and Monitoring Website, use the Internet Information Services (IIS) Manager console to start the Administration and Monitoring Website.\n\n    2.  To automate this procedure, you can use Windows PowerShell to run a command that is similar to the following:\n\n        ``` syntax\n        PS C:\\> Start-Website \"Microsoft BitLocker Administration and Monitoring\"\n        ```\n\n        **Note**  \n        To run this command, you must add the IIS module for Windows PowerShell to the current instance of Windows PowerShell.\n\n         \n\n## Moving the Compliance and Audit Database\n\n\nThe high-level steps for moving the Compliance and Audit Database are:\n\n1.  Stop all instances of the MBAM Administration and Monitoring Website\n\n2.  Install MBAM Server software and run the MBAM Server Configuration wizard on Server B\n\n3.  Back up the Compliance and Audit Database on Server A\n\n4.  Move the Compliance and Audit Database from Server A to Server B\n\n5.  Restore the Compliance and Audit Database on Server B\n\n6.  Configure access to the Database on Server B and update connection data\n\n7.  Resume the instance of the Administration and Monitoring Website\n\n**How to move the Compliance and Audit Database**\n\n1.  **Stop all instances of the MBAM Administration and Monitoring Website**\n\n    -   On each server that is running the MBAM Administration and Monitoring Server Website, use the Internet Information Services (IIS) Manager console to stop the Administration and Monitoring Website.\n\n        To automate this procedure, you can use Windows PowerShell to enter a command that is similar to the following:\n\n        ``` syntax\n        PS C:\\> Stop-Website \"Microsoft BitLocker Administration and Monitoring\"\n        ```\n\n        **Note**  \n        To run this command, you must add the Internet Information Services (IIS) module for Windows PowerShell to the current instance of Windows PowerShell.\n\n         \n\n2.  **Install MBAM Server software and run the MBAM Server Configuration wizard on Server B**\n\n    1.  Install the MBAM 2.5 Server software on Server B. For instructions, see [Installing the MBAM 2.5 Server Software](installing-the-mbam-25-server-software.md).\n\n    2.  On Server B, start the MBAM Server Configuration wizard, click **Add New Features**, and then select only the **Compliance and Audit Database** feature.\n\n        Alternatively, you can use the **Enable-MbamDatabase** Windows PowerShell cmdlet to configure the Compliance and Audit Database.\n\n        For instructions on how to configure the databases, see [How to Configure the MBAM 2.5 Databases](how-to-configure-the-mbam-25-databases.md).\n\n3.  **Back up the Compliance and Audit Database on Server A**\n\n    1.  Use the **Back Up** task in SQL Server Management Studio to back up the Compliance and Audit Database on Server A. By default, the database name is **MBAM Compliance Status Database**.\n\n        To automate this procedure, create a SQL file (.sql) that contains the following SQL script:\n\n        ``` syntax\n        USE master; \n        GO \n        ALTER DATABASE \"MBAM Compliance Status\" \n        SET RECOVERY FULL; \n        GO \n        -- Create MBAM Compliance Status Data logical backup devices. \n        USE master \n        GO \n        EXEC sp_addumpdevice 'disk', 'MBAM Compliance Status Database Data Device', \n        'Z: \\MBAM Compliance Status Database Data.bak'; \n        GO\n        -- Back up the full MBAM Compliance Recovery database. \n        BACKUP DATABASE [MBAM Compliance Status] TO [MBAM Compliance Status Database Data Device]; \n        GO\n        ```\n\n    2.  Run the script that is stored in the .sql file by using a Windows PowerShell command that is similar to the following:\n\n        ``` syntax\n        PS C:\\> Invoke-Sqlcmd -InputFile \"Z:\\BackupMBAMComplianceStatusDatabaseScript.sql\" –ServerInstance $SERVERNAME$\\$SQLINSTANCENAME$\n        ```\n\n        Using the following value, replace the values in the code example with values that match your environment:\n\n        **$SERVERNAME$\\\\$SQLINSTANCENAME$** - server name and instance from which the Compliance and Audit Database will be backed up.\n\n4.  **Move the Compliance and Audit Database from Server A to Server B**\n\n    -   Use Windows Explorer to move the **MBAM Compliance Status Database Data.bak** file from Server A to Server B.\n\n        To automate this procedure, you can use Windows PowerShell to run a command that is similar to the following:\n\n        ``` syntax\n        PS C:\\> Copy-Item \"Z:\\MBAM Compliance Status Database Data.bak\" \\\\$SERVERNAME$\\$DESTINATIONSHARE$\n        ```\n\n        Using the following table, replace the values in the code example with values that match your environment.\n\n        <table>\n        <colgroup>\n        <col width=\"50%\" />\n        <col width=\"50%\" />\n        </colgroup>\n        <thead>\n        <tr class=\"header\">\n        <th align=\"left\">Parameter</th>\n        <th align=\"left\">Description</th>\n        </tr>\n        </thead>\n        <tbody>\n        <tr class=\"odd\">\n        <td align=\"left\"><p>$SERVERNAME$</p></td>\n        <td align=\"left\"><p>Name of the server to which the files will be copied.</p></td>\n        </tr>\n        <tr class=\"even\">\n        <td align=\"left\"><p>$DESTINATIONSHARE$</p></td>\n        <td align=\"left\"><p>Name of the share and path to which the files will be copied.</p></td>\n        </tr>\n        </tbody>\n        </table>\n\n         \n\n5.  **Restore the Compliance and Audit Database on Server B**\n\n    1.  Restore the Compliance and Audit Database on Server B by using the **Restore Database** task in SQL Server Management Studio.\n\n    2.  When the previous task finishes, select **From Device**, and then select the database backup file.\n\n    3.  Use the **Add** command to select the **MBAM Compliance Status Database Data.bak** file, and click **OK** to complete the restoration process.\n\n        To automate this procedure, create a SQL file (.sql) that contains the following SQL script:\n\n        ``` syntax\n        -- Create MBAM Compliance Status Database Data logical backup devices. \n        Use master \n        GO \n        -- Restore the MBAM Compliance Status database data files. \n        RESTORE DATABASE [MBAM Compliance Status] \n        FROM DISK = 'C:\\test\\MBAM Compliance Status Database Data.bak' \n        WITH REPLACE\n        ```\n\n    4.  Run the script that is stored in the .sql file by using a Windows PowerShell command that is similar to the following:\n\n        ``` syntax\n        PS C:\\> Invoke-Sqlcmd -InputFile \"Z:\\RestoreMBAMComplianceStatusDatabaseScript.sql\" -ServerInstance $SERVERNAME$\\$SQLINSTANCENAME$\n        ```\n\n        Using the following value, replace the values in the code example with values that match your environment.\n\n        **$SERVERNAME$\\\\$SQLINSTANCENAME$** - Server name and instance to which the Compliance and Audit Database will be restored.\n\n6.  **Configure access to the Database on Server B and update connection data**\n\n    1.  Verify that the Microsoft SQL Server user login that enables Compliance and Audit Database access on the restored database is mapped to the access account that you provided during the configuration process.\n\n        If the login is not the same, create a login by using SQL Server Management Studio, and map it to the existing database user.\n\n    2.  On the server that is running the Administration and Monitoring Website, use the Internet Information Services (IIS) Manager console to update the connection string information for the Website.\n\n    3.  Edit the following registry key: **HKLM\\\\Software\\\\Microsoft\\\\MBAM Server\\\\Web\\\\ComplianceDBConnectionString**\n\n    4.  Update the **Data Source** value with the name of the server and instance (for example, $SERVERNAME$\\\\$SQLINSTANCENAME) to which the Recovery Database was moved.\n\n    5.  Update the **Initial Catalog** value with the recovered database name.\n\n        To automate this process, you can use the Windows PowerShell command prompt to enter a command line on the Administration and Monitoring Server that is similar to the following:\n\n        ``` syntax\n        PS C:\\> reg add \"HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\MBAM Server\\Web\" /v ComplianceDBConnectionString /t REG_SZ /d \"Integrated Security=SSPI;Initial Catalog=$DATABASE$;Data Source=$SERVERNAME$\\$SQLINSTANCENAME$\" /f\n        ```\n\n        **Note**  \n        This connection string is shared by all local MBAM web applications. Therefore, it needs to be updated only once per server.\n\n         \n\n        Using the following table, replace the values in the code example with values that match your environment.\n\n        <table>\n        <colgroup>\n        <col width=\"50%\" />\n        <col width=\"50%\" />\n        </colgroup>\n        <thead>\n        <tr class=\"header\">\n        <th align=\"left\">Parameter</th>\n        <th align=\"left\">Description</th>\n        </tr>\n        </thead>\n        <tbody>\n        <tr class=\"odd\">\n        <td align=\"left\"><p>$SERVERNAME$\\$SQLINSTANCENAME$</p></td>\n        <td align=\"left\"><p>Server name and instance of SQL Server where the Recovery Database is located.</p></td>\n        </tr>\n        <tr class=\"even\">\n        <td align=\"left\"><p>$DATABASE$</p></td>\n        <td align=\"left\"><p>Name of the recovered database.</p></td>\n        </tr>\n        </tbody>\n        </table>\n\n         \n\n7.  **Resume the instance of the Administration and Monitoring Website**\n\n    1.  On the server that is running the Administration and Monitoring Website, use the Internet Information Services (IIS) Manager console to start the Administration and Monitoring Website.\n\n    2.  To automate this procedure, you can use Windows PowerShell to run a command that is similar to the following:\n\n        ``` syntax\n        PS C:\\> Start-Website \"Microsoft BitLocker Administration and Monitoring\"\n        ```\n\n        **Note**  \n        To run this command, you must add the IIS module for Windows PowerShell to the current instance of Windows PowerShell.\n\n         \n\n**Got a suggestion for MBAM**? Add or vote on suggestions [here](http://mbam.uservoice.com/forums/268571-microsoft-bitlocker-administration-and-monitoring). **Got a MBAM issue**? Use the [MBAM TechNet Forum](https://social.technet.microsoft.com/Forums/home?forum=mdopmbam).\n\n## Related topics\n\n\n[How to Configure the MBAM 2.5 Databases](how-to-configure-the-mbam-25-databases.md)\n\n[Configuring MBAM 2.5 Server Features by Using Windows PowerShell](configuring-mbam-25-server-features-by-using-windows-powershell.md)\n\n[Moving MBAM 2.5 Features to Another Server](moving-mbam-25-features-to-another-server.md)\n\n \n\n \n\n\n\n\n\n"}