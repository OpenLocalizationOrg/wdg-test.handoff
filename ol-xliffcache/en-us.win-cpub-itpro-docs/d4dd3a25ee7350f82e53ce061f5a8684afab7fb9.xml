{"nodes":[{"content":"Common Issues (Windows 10)","pos":[11,37]},{"content":"Common Issues","pos":[51,64]},{"content":"Common Issues","pos":[197,210]},{"content":"The following sections discuss common issues that you might see when you run the User State Migration Tool (USMT) 10.0 tools.","pos":[213,338]},{"content":"USMT produces log files that describe in further detail any errors that occurred during the migration process.","pos":[339,449]},{"content":"These logs can be used to troubleshoot migration failures.","pos":[450,508]},{"content":"In This Topic","pos":[513,526]},{"content":"User Account Problems","pos":[530,551]},{"content":"Command-line Problems","pos":[562,583]},{"content":"XML File Problems","pos":[597,614]},{"content":"Migration Problems","pos":[624,642]},{"content":"Offline Migration Problems","pos":[658,684]},{"content":"Hard Link Migration Problems","pos":[703,731]},{"content":"General Guidelines for Identifying Migration Problems","pos":[753,806]},{"content":"When you encounter a problem or error message during migration, you can use the following general guidelines to help determine the source of the problem:","pos":[809,962]},{"content":"Examine the ScanState, LoadState, and UsmtUtils logs to obtain the exact USMT error messages and Windows® application programming interface (API) error messages.","pos":[968,1129]},{"content":"For more information about USMT return codes and error messages, see <bpt id=\"p1\">[</bpt>Return Codes<ept id=\"p1\">](usmt-return-codes.md)</ept>.","pos":[1130,1236]},{"content":"For more information about Windows API error messages, type <bpt id=\"p1\">**</bpt>nethelpmsg<ept id=\"p1\">**</ept> on the command line.","pos":[1237,1332]},{"content":"In most cases, the ScanState and LoadState logs indicate why a USMT migration is failing.","pos":[1338,1427]},{"content":"We recommend that you use the <bpt id=\"p1\">**</bpt>/v<ept id=\"p1\">**</ept><bpt id=\"p2\">*</bpt>:5<ept id=\"p2\">*</ept> option when testing your migration.","pos":[1428,1504]},{"content":"This verbosity level can be adjusted in a production migration; however, reducing the verbosity level might make it more difficult to diagnose failures that are encountered during production migrations.","pos":[1505,1707]},{"content":"You can use a verbosity level higher than 5 if you want the log files output to go to a debugger.","pos":[1708,1805]},{"pos":[1811,2043],"content":"**Note**  \nRunning the ScanState and LoadState tools with the **/v***:5* option creates a detailed log file. Although this option makes the log file large, the extra detail can help you determine where migration errors occurred.","leadings":["","    "],"nodes":[{"content":"Note","pos":[2,6]},{"content":"Running the ScanState and LoadState tools with the **/v***:5* option creates a detailed log file. Although this option makes the log file large, the extra detail can help you determine where migration errors occurred.","pos":[11,228],"nodes":[{"content":"Running the ScanState and LoadState tools with the <bpt id=\"p1\">**</bpt>/v<ept id=\"p1\">**</ept><bpt id=\"p2\">*</bpt>:5<ept id=\"p2\">*</ept> option creates a detailed log file.","pos":[0,97]},{"content":"Although this option makes the log file large, the extra detail can help you determine where migration errors occurred.","pos":[98,217]}]}]},{"content":"Use the <bpt id=\"p1\">**</bpt>/Verify<ept id=\"p1\">**</ept> option in the UsmtUtils tool to determine whether any files in a compressed migration store are corrupted.","pos":[2056,2182]},{"content":"For more information, see <bpt id=\"p1\">[</bpt>Verify the Condition of a Compressed Migration Store<ept id=\"p1\">](verify-the-condition-of-a-compressed-migration-store.md)</ept>.","pos":[2183,2321]},{"content":"Use the <bpt id=\"p1\">**</bpt>/Extract<ept id=\"p1\">**</ept> option in the UsmtUtils tool to extract files from a compressed migration store.","pos":[2327,2428]},{"content":"For more information, see <bpt id=\"p1\">[</bpt>Extract Files from a Compressed USMT Migration Store<ept id=\"p1\">](usmt-extract-files-from-a-compressed-migration-store.md)</ept>.","pos":[2429,2567]},{"pos":[2573,2652],"content":"Create a progress log using the <bpt id=\"p1\">**</bpt>/Progress<ept id=\"p1\">**</ept> option to monitor your migration."},{"content":"For the source and destination computers, obtain operating system information, and versions of applications such as Internet Explorer and any other relevant programs.","pos":[2658,2824]},{"content":"Then verify the exact steps that are needed to reproduce the problem.","pos":[2825,2894]},{"content":"This information might help you to understand what is wrong and to reproduce the issue in your testing environment.","pos":[2895,3010]},{"content":"Log off after you run the LoadState tool.","pos":[3016,3057]},{"content":"Some settings—for example, fonts, desktop backgrounds, and screen-saver settings—will not take effect until the next time the end user logs on.","pos":[3058,3201]},{"content":"Close all applications before running ScanState or LoadState tools.","pos":[3207,3274]},{"content":"If some applications are running during the ScanState or LoadState process, USMT might not migrate some data.","pos":[3275,3384]},{"content":"For example, if Microsoft Outlook® is open, USMT might not migrate PST files.","pos":[3385,3462]},{"pos":[3468,3720],"content":"**Note**  \nUSMT will fail if it cannot migrate a file or setting unless you specify the **/c** option. When you specify the **/c** option, USMT ignores errors. However, it logs an error when it encounters a file that is in use that did not migrate.","leadings":["","    "],"nodes":[{"content":"Note","pos":[2,6]},{"content":"USMT will fail if it cannot migrate a file or setting unless you specify the **/c** option. When you specify the **/c** option, USMT ignores errors. However, it logs an error when it encounters a file that is in use that did not migrate.","pos":[11,248],"nodes":[{"content":"USMT will fail if it cannot migrate a file or setting unless you specify the <bpt id=\"p1\">**</bpt>/c<ept id=\"p1\">**</ept> option.","pos":[0,91]},{"content":"When you specify the <bpt id=\"p1\">**</bpt>/c<ept id=\"p1\">**</ept> option, USMT ignores errors.","pos":[92,148]},{"content":"However, it logs an error when it encounters a file that is in use that did not migrate.","pos":[149,237]}]}]},{"pos":[3757,3778],"content":"User Account Problems"},{"content":"The following sections describe common user account problems.","pos":[3781,3842]},{"content":"Expand the section to see recommended solutions.","pos":[3843,3891]},{"content":"I'm having problems creating local accounts on the destination computer.","pos":[3897,3969]},{"pos":[3971,4121],"content":"<bpt id=\"p1\">**</bpt>Resolution:<ept id=\"p1\">**</ept> For more information about creating accounts and migrating local accounts, see <bpt id=\"p2\">[</bpt>Migrate User Accounts<ept id=\"p2\">](usmt-migrate-user-accounts.md)</ept>."},{"content":"Not all of the user accounts were migrated to the destination computer.","pos":[4127,4198]},{"pos":[4200,4270],"content":"<bpt id=\"p1\">**</bpt>Causes/Resolutions<ept id=\"p1\">**</ept> There are two possible causes for this problem:"},{"content":"When running the ScanState tool on Windows Vista, or the ScanState and LoadState tools on Windows 7, Windows 8, or Windows 10, you must run them in Administrator mode from an account with administrative credentials to ensure that all specified users are migrated.","pos":[4272,4535]},{"content":"To run in Administrator mode:","pos":[4536,4565]},{"pos":[4571,4587],"content":"Click <bpt id=\"p1\">**</bpt>Start<ept id=\"p1\">**</ept>."},{"pos":[4593,4616],"content":"Click <bpt id=\"p1\">**</bpt>All Programs<ept id=\"p1\">**</ept>."},{"pos":[4622,4644],"content":"Click <bpt id=\"p1\">**</bpt>Accessories<ept id=\"p1\">**</ept>."},{"pos":[4650,4681],"content":"Right-click <bpt id=\"p1\">**</bpt>Command Prompt<ept id=\"p1\">**</ept>."},{"pos":[4687,4718],"content":"Click <bpt id=\"p1\">**</bpt>Run as administrator<ept id=\"p1\">**</ept>."},{"content":"Then specify your LoadState or ScanState command.","pos":[4720,4769]},{"content":"If you do not run USMT in Administrator mode, only the user profile that is logged on will be included in the migration.","pos":[4770,4890]},{"content":"Any user accounts on the computer that have not been used will not be migrated.","pos":[4892,4971]},{"content":"For example, if you add User1 to the computer, but User1 never logs on, then USMT will not migrate the User1 account.","pos":[4972,5089]},{"content":"User accounts that I excluded were migrated to the destination computer.","pos":[5095,5167]},{"content":"<bpt id=\"p1\">**</bpt>Cause:<ept id=\"p1\">**</ept> The command that you specified might have had conflicting <bpt id=\"p2\">**</bpt>/ui<ept id=\"p2\">**</ept> and <bpt id=\"p3\">**</bpt>/ue<ept id=\"p3\">**</ept> options.","pos":[5169,5266]},{"content":"If a user is specified with the <bpt id=\"p1\">**</bpt>/ui<ept id=\"p1\">**</ept> option and is also specified to be excluded with either the <bpt id=\"p2\">**</bpt>/ue<ept id=\"p2\">**</ept> or <bpt id=\"p3\">**</bpt>/uel<ept id=\"p3\">**</ept> options, the user will be included in the migration.","pos":[5267,5439]},{"content":"For example, if you specify <ph id=\"ph1\">`/ui:domain1\\* /ue:domain1\\user1`</ph>, then User1 will be migrated because the <bpt id=\"p1\">**</bpt>/ui<ept id=\"p1\">**</ept> option takes precedence.","pos":[5440,5575]},{"pos":[5577,5748],"content":"<bpt id=\"p1\">**</bpt>Resolution:<ept id=\"p1\">**</ept> For more information about how to use the <bpt id=\"p2\">**</bpt>/ui<ept id=\"p2\">**</ept> and <bpt id=\"p3\">**</bpt>/ue<ept id=\"p3\">**</ept> options together, see the examples in the <bpt id=\"p4\">[</bpt>ScanState Syntax<ept id=\"p4\">](usmt-scanstate-syntax.md)</ept> topic."},{"content":"I am using the /uel option, but many accounts are still being included in the migration.","pos":[5754,5842]},{"content":"<bpt id=\"p1\">**</bpt>Cause<ept id=\"p1\">**</ept> The <bpt id=\"p2\">**</bpt>/uel<ept id=\"p2\">**</ept> option depends on the last modified date of the users' NTUser.dat file.","pos":[5844,5938]},{"content":"There are scenarios in which this last modified date might not match the users' last logon date.","pos":[5939,6035]},{"content":"<bpt id=\"p1\">**</bpt>Resolution<ept id=\"p1\">**</ept> This is a limitation of the <bpt id=\"p2\">**</bpt>/uel<ept id=\"p2\">**</ept> option.","pos":[6037,6096]},{"content":"You might need to exclude these users manually with the <bpt id=\"p1\">**</bpt>/ue<ept id=\"p1\">**</ept> option.","pos":[6097,6168]},{"content":"The LoadState tool reports an error as return code 71 and fails to restore a user profile during a migration test.","pos":[6174,6288]},{"content":"<bpt id=\"p1\">**</bpt>Cause:<ept id=\"p1\">**</ept> During a migration test, if you run the ScanState tool on your test computer and then delete user profiles in order to test the LoadState tool on the same computer, you may have a conflicting key present in the registry.","pos":[6290,6521]},{"content":"Using the <bpt id=\"p1\">**</bpt>net use<ept id=\"p1\">**</ept> command to remove a user profile will delete folders and files associated with that profile, but will not remove the registry key.","pos":[6522,6674]},{"content":"<bpt id=\"p1\">**</bpt>Resolution:<ept id=\"p1\">**</ept> To delete a user profile, use the <bpt id=\"p2\">**</bpt>User Accounts<ept id=\"p2\">**</ept> item in Control Panel.","pos":[6676,6766]},{"content":"To correct an incomplete deletion of a user profile:","pos":[6767,6819]},{"pos":[6825,6900],"content":"Open the registry editor by typing <ph id=\"ph1\">`regedit`</ph> at an elevated command prompt."},{"pos":[6906,6996],"content":"Navigate to <ph id=\"ph1\">`HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\ProfileList`</ph>."},{"pos":[7002,7077],"content":"Each user profile is stored in a System Identifier key under <ph id=\"ph1\">`ProfileList`</ph>."},{"content":"Delete the key for the user profile you are trying to remove.","pos":[7083,7144]},{"content":"Files that were not encrypted before the migration are now encrypted with the account used to run the LoadState tool.","pos":[7150,7267]},{"content":"<bpt id=\"p1\">**</bpt>Cause:<ept id=\"p1\">**</ept> The ScanState tool was run using the <bpt id=\"p2\">**</bpt>/EFS: copyraw<ept id=\"p2\">**</ept> option to migrate encrypted files and Encrypting File System (EFS) certificates.","pos":[7269,7415]},{"content":"The encryption attribute was set on a folder that was migrated, but the attribute was removed from file contents of that folder prior to migration.","pos":[7416,7563]},{"content":"<bpt id=\"p1\">**</bpt>Resolution:<ept id=\"p1\">**</ept> Before using the ScanState tool for a migration that includes encrypted files and EFS certificates, you can run the Cipher tool at the command prompt to review and change encryption settings on files and folders.","pos":[7565,7793]},{"content":"You must remove the encryption attribute from folders that contain unencrypted files or encrypt the contents of all files within an encrypted folder.","pos":[7794,7943]},{"content":"To remove encryption from files that have already been migrated incorrectly, you must log on to the computer with the account that you used to run the LoadState tool and then remove the encryption from the affected files.","pos":[7945,8166]},{"content":"The LoadState tool reports an error as return code 71 and a Windows Error 2202 in the log file.","pos":[8172,8267]},{"pos":[8269,8362],"content":"<bpt id=\"p1\">**</bpt>Cause:<ept id=\"p1\">**</ept> The computer name was changed during an offline migration of a local user profile."},{"content":"<bpt id=\"p1\">**</bpt>Resolution:<ept id=\"p1\">**</ept> You can use the <bpt id=\"p2\">**</bpt>/mu<ept id=\"p2\">**</ept> option when you run the LoadState tool to specify a new name for the user.","pos":[8364,8478]},{"content":"For example,","pos":[8479,8491]},{"pos":[8676,8697],"content":"Command-line Problems"},{"content":"The following sections describe common command-line problems.","pos":[8700,8761]},{"content":"Expand the section to see recommended solutions.","pos":[8762,8810]},{"content":"I received the following error message: \"Usage Error: You cannot specify a file path with any of the command-line options that exceeds 256 characters.\"","pos":[8816,8967]},{"content":"<bpt id=\"p1\">**</bpt>Cause:<ept id=\"p1\">**</ept> You might receive this error message in some cases even if you do not specify a long store or file path, because the path length is calculated based on the absolute path.","pos":[8969,9150]},{"content":"For example, if you run the <bpt id=\"p1\">**</bpt>scanstate.exe /o store<ept id=\"p1\">**</ept> command from C:<ph id=\"ph1\">\\\\</ph>Program Files<ph id=\"ph2\">\\\\</ph>USMT40, then each character in \"<ph id=\"ph3\">`C:\\Program Files\\USMT40`</ph>\" will be added to the length of \"store\" to get the length of the path.","pos":[9151,9366]},{"pos":[9368,9491],"content":"<bpt id=\"p1\">**</bpt>Resolution:<ept id=\"p1\">**</ept> Ensure that the total path length—the store path plus the current directory—does not exceed 256 characters."},{"content":"I received the following error message: \"USMT was unable to create the log file(s).","pos":[9497,9580]},{"content":"Ensure that you have write access to the log directory.\"","pos":[9581,9637]},{"pos":[9639,9799],"content":"<bpt id=\"p1\">**</bpt>Cause:<ept id=\"p1\">**</ept> If you are running the ScanState or LoadState tools from a shared network resource, you will receive this error message if you do not specify <bpt id=\"p2\">**</bpt>/l<ept id=\"p2\">**</ept>."},{"pos":[9801,9907],"content":"<bpt id=\"p1\">**</bpt>Resolution:<ept id=\"p1\">**</ept> To fix this issue in this scenario, specify the <bpt id=\"p2\">**</bpt>/l:scan.log<ept id=\"p2\">**</ept> or <bpt id=\"p3\">**</bpt>/l:load.log<ept id=\"p3\">**</ept> option."},{"pos":[9936,9953],"content":"XML File Problems"},{"content":"The following sections describe common XML file problems.","pos":[9956,10013]},{"content":"Expand the section to see recommended solutions.","pos":[10014,10062]},{"content":"I used the /genconfig option to create a Config.xml file, but I see only a few applications and components that are in MigApp.xml.","pos":[10068,10198]},{"content":"Why does Config.xml not contain all of the same applications?","pos":[10199,10260]},{"content":"<bpt id=\"p1\">**</bpt>Cause:<ept id=\"p1\">**</ept> Config.xml will contain only operating system components, applications, and the user document sections that are in both of the .xml files and are installed on the computer when you run the <bpt id=\"p2\">**</bpt>/genconfig<ept id=\"p2\">**</ept> option.","pos":[10262,10484]},{"content":"Otherwise, these applications and components will not appear in the Config.xml file.","pos":[10485,10569]},{"content":"<bpt id=\"p1\">**</bpt>Resolution:<ept id=\"p1\">**</ept> Install all of the desired applications on the computer before running the <bpt id=\"p2\">**</bpt>/genconfig<ept id=\"p2\">**</ept> option.","pos":[10571,10684]},{"content":"Then run ScanState with all of the .xml files.","pos":[10685,10731]},{"content":"For example, run the following:","pos":[10732,10763]},{"content":"I am having problems with a custom .xml file that I authored, and I cannot verify that the syntax is correct.","pos":[10855,10964]},{"content":"<bpt id=\"p1\">**</bpt>Resolution:<ept id=\"p1\">**</ept> You can load the XML schema (MigXML.xsd), included with USMT, into your XML authoring tool.","pos":[10966,11073]},{"content":"For examples, see the <bpt id=\"p1\">[</bpt>Visual Studio Development Center<ept id=\"p1\">](http://go.microsoft.com/fwlink/p/?LinkId=74513)</ept>.","pos":[11074,11179]},{"content":"Then, load your .xml file in the authoring tool to see if there is a syntax error.","pos":[11180,11262]},{"content":"In addition, see <bpt id=\"p1\">[</bpt>USMT XML Reference<ept id=\"p1\">](usmt-xml-reference.md)</ept> for more information about using the XML elements.","pos":[11263,11374]},{"content":"I am using a MigXML helper function, but the migration isn’t working the way I expected it to.","pos":[11530,11624]},{"content":"How do I troubleshoot this issue?","pos":[11626,11659]},{"content":"<bpt id=\"p1\">**</bpt>Cause:<ept id=\"p1\">**</ept> Typically, this issue is caused by incorrect syntax used in a helper function.","pos":[11661,11750]},{"content":"You receive a Success return code, but the files you wanted to migrate did not get collected or applied, or weren’t collected or applied in the way you expected.","pos":[11751,11912]},{"pos":[11914,12148],"content":"<bpt id=\"p1\">**</bpt>Resolution:<ept id=\"p1\">**</ept> You should search the ScanState or LoadState log for either the component name which contains the MigXML helper function, or the MigXML helper function title, so that you can locate the related warning in the log file."},{"pos":[12183,12201],"content":"Migration Problems"},{"content":"The following sections describe common migration problems.","pos":[12204,12262]},{"content":"Expand the section to see recommended solutions.","pos":[12263,12311]},{"content":"Files that I specified to exclude are still being migrated.","pos":[12317,12376]},{"content":"<bpt id=\"p1\">**</bpt>Cause:<ept id=\"p1\">**</ept> There might be another rule that is including the files.","pos":[12378,12445]},{"content":"If there is a more specific rule or a conflicting rule, the files will be included in the migration.","pos":[12446,12546]},{"pos":[12548,12716],"content":"<bpt id=\"p1\">**</bpt>Resolution:<ept id=\"p1\">**</ept> For more information, see <bpt id=\"p2\">[</bpt>Conflicts and Precedence<ept id=\"p2\">](usmt-conflicts-and-precedence.md)</ept> and the Diagnostic Log section in <bpt id=\"p3\">[</bpt>Log Files<ept id=\"p3\">](usmt-log-files.md)</ept>."},{"content":"I specified rules to move a folder to a specific location on the destination computer, but it has not migrated correctly.","pos":[12722,12843]},{"pos":[12845,12898],"content":"<bpt id=\"p1\">**</bpt>Cause:<ept id=\"p1\">**</ept> There might be an error in the XML syntax."},{"content":"<bpt id=\"p1\">**</bpt>Resolution:<ept id=\"p1\">**</ept> You can use the USMT XML schema (MigXML.xsd) to write and validate migration .xml files.","pos":[12900,13004]},{"content":"Also see the XML examples in the following topics:","pos":[13005,13055]},{"content":"Conflicts and Precedence","pos":[13058,13082]},{"content":"Exclude Files and Settings","pos":[13120,13146]},{"content":"Reroute Files and Settings","pos":[13186,13212]},{"content":"Include Files and Settings","pos":[13252,13278]},{"content":"Custom XML Examples","pos":[13318,13337]},{"content":"After LoadState completes, the new desktop background does not appear on the destination computer.","pos":[13373,13471]},{"content":"There are three typical causes for this issue.","pos":[13473,13519]},{"pos":[13521,13698],"content":"<bpt id=\"p1\">**</bpt>Cause <ph id=\"ph1\">\\#</ph>1:<ept id=\"p1\">**</ept>: Some settings such as fonts, desktop backgrounds, and screen-saver settings are not applied by LoadState until after the destination computer has been restarted."},{"pos":[13700,13804],"content":"<bpt id=\"p1\">**</bpt>Resolution:<ept id=\"p1\">**</ept> To fix this issue, log off, and then log back on to see the migrated desktop background."},{"content":"<bpt id=\"p1\">**</bpt>Cause <ph id=\"ph1\">\\#</ph>2:<ept id=\"p1\">**</ept> If the source computer was running Windows® XP and the desktop background was stored in the <bpt id=\"p2\">*</bpt>Drive<ept id=\"p2\">*</ept>:<ph id=\"ph2\">\\\\</ph>WINDOWS<ph id=\"ph3\">\\\\</ph>Web<ph id=\"ph4\">\\\\</ph>Wallpaper folder—the default folder where desktop backgrounds are stored in Windows XP—the desktop background will not be migrated.","pos":[13806,14068]},{"content":"Instead, the destination computer will have the default Windows® desktop background.","pos":[14069,14153]},{"content":"This will occur even if the desktop background was a custom picture that was added to the <ph id=\"ph1\">\\\\</ph>WINDOWS<ph id=\"ph2\">\\\\</ph>Web<ph id=\"ph3\">\\\\</ph>Wallpaper folder.","pos":[14154,14277]},{"content":"However, if the end user sets a picture as the desktop background that was saved in another location, for example, My Pictures, then the desktop background will migrate.","pos":[14278,14447]},{"pos":[14449,14603],"content":"<bpt id=\"p1\">**</bpt>Resolution:<ept id=\"p1\">**</ept> Ensure that the desktop background images that you want to migrate are not in the <ph id=\"ph1\">\\\\</ph>WINDOWS<ph id=\"ph2\">\\\\</ph>Web<ph id=\"ph3\">\\\\</ph>Wallpaper folder on the source computer."},{"content":"<bpt id=\"p1\">**</bpt>Cause <ph id=\"ph1\">\\#</ph>3:<ept id=\"p1\">**</ept> If ScanState was not run on Windows XP from an account with administrative credentials, some operating system settings will not migrate.","pos":[14605,14756]},{"content":"For example, desktop background settings, screen-saver selections, modem options, media-player settings, and Remote Access Service (RAS) connection phone book (.pbk) files and settings will not migrate.","pos":[14757,14959]},{"pos":[14961,15070],"content":"<bpt id=\"p1\">**</bpt>Resolution:<ept id=\"p1\">**</ept> Run the ScanState and LoadState tools from within an account with administrative credentials."},{"pos":[15173,15249],"content":"I included MigApp.xml in the migration, but some PST files aren’t migrating."},{"pos":[15251,15346],"content":"<bpt id=\"p1\">**</bpt>Cause:<ept id=\"p1\">**</ept> The MigApp.xml file migrates only the PST files that are linked to Outlook profiles."},{"pos":[15348,15491],"content":"<bpt id=\"p1\">**</bpt>Resolution:<ept id=\"p1\">**</ept> To migrate PST files that are not linked to Outlook profiles, you must create a separate migration rule to capture these files."},{"pos":[15529,15555],"content":"Offline Migration Problems"},{"content":"The following sections describe common offline migration problems.","pos":[15558,15624]},{"content":"Expand the section to see recommended solutions.","pos":[15625,15673]},{"content":"Some of my system settings do not migrate in an offline migration.","pos":[15679,15745]},{"content":"<bpt id=\"p1\">**</bpt>Cause:<ept id=\"p1\">**</ept> Some system settings, such as desktop backgrounds and network printers, are not supported in an offline migration.","pos":[15747,15872]},{"content":"For more information, see <bpt id=\"p1\">[</bpt>What Does USMT Migrate?<ept id=\"p1\">](usmt-what-does-usmt-migrate.md)</ept>","pos":[15873,15956]},{"pos":[15958,16047],"content":"<bpt id=\"p1\">**</bpt>Resolution:<ept id=\"p1\">**</ept> In an offline migration, these system settings must be restored manually."},{"content":"The ScanState tool fails with return code 26.","pos":[16053,16098]},{"content":"<bpt id=\"p1\">**</bpt>Cause:<ept id=\"p1\">**</ept> A common cause of return code 26 is that a temp profile is active on the source computer.","pos":[16100,16200]},{"content":"This profile maps to c:<ph id=\"ph1\">\\\\</ph>users<ph id=\"ph2\">\\\\</ph>temp.","pos":[16201,16238]},{"content":"The ScanState log shows a MigStartupOfflineCaught exception that includes the message \"User profile duplicate SID error\".","pos":[16239,16360]},{"pos":[16362,16531],"content":"<bpt id=\"p1\">**</bpt>Resolution:<ept id=\"p1\">**</ept> You can reboot the computer to get rid of the temp profile or you can set MIG<ph id=\"ph1\">\\_</ph>FAIL<ph id=\"ph2\">\\_</ph>ON<ph id=\"ph3\">\\_</ph>PROFILE<ph id=\"ph4\">\\_</ph>ERROR=0 to skip the error and exclude the temp profile."},{"content":"Include and Exclude rules for migrating user profiles do not work the same offline as they do online.","pos":[16537,16638]},{"pos":[16640,16739],"content":"<bpt id=\"p1\">**</bpt>Cause:<ept id=\"p1\">**</ept> When offline, the DNS server cannot be queried to resolve the user name and SID mapping."},{"content":"<bpt id=\"p1\">**</bpt>Resolution:<ept id=\"p1\">**</ept> Use a Security Identifier (SID) to include a user when running the ScanState tool.","pos":[16741,16839]},{"content":"For example:","pos":[16840,16852]},{"pos":[16924,17009],"content":"The wild card (<ph id=\"ph1\">\\*</ph>) at the end of the SID will migrate the <bpt id=\"p1\">*</bpt>SID<ept id=\"p1\">*</ept><ph id=\"ph2\">\\_</ph>Classes key as well."},{"content":"You can also use patterns for SIDs that identify generic users or groups.","pos":[17011,17084]},{"content":"For example, you can use the <bpt id=\"p1\">*</bpt>/ue:<ph id=\"ph1\">\\*</ph>-500<ept id=\"p1\">*</ept> option to exclude the local administrator accounts.","pos":[17085,17178]},{"content":"For more information about Windows SIDs, see <bpt id=\"p1\">[</bpt>this Microsoft Web site<ept id=\"p1\">](http://go.microsoft.com/fwlink/p/?LinkId=190277)</ept>.","pos":[17179,17299]},{"content":"My script to wipe the disk fails after running the ScanState tool on a 64-bit system.","pos":[17305,17390]},{"pos":[17392,17488],"content":"<bpt id=\"p1\">**</bpt>Cause:<ept id=\"p1\">**</ept> The HKLM registry hive is not unloaded after the ScanState tool has finished running."},{"content":"<bpt id=\"p1\">**</bpt>Resolution:<ept id=\"p1\">**</ept> Reboot the computer or unload the registry hive at the command prompt after the ScanState tool has finished running.","pos":[17490,17622]},{"content":"For example, at a command prompt, type:","pos":[17623,17662]},{"pos":[17752,17780],"content":"Hard-Link Migration Problems"},{"content":"The following sections describe common hard-link migration problems.","pos":[17783,17851]},{"content":"Expand the section to see recommended solutions.","pos":[17852,17900]},{"content":"EFS files are not restored to the new partition.","pos":[17906,17954]},{"content":"<bpt id=\"p1\">**</bpt>Cause:<ept id=\"p1\">**</ept> EFS files cannot be moved to a new partition with a hard link.","pos":[17956,18029]},{"content":"The <bpt id=\"p1\">**</bpt>/efs:hardlink<ept id=\"p1\">**</ept> command-line option is only applicable to files migrated on the same partition.","pos":[18030,18131]},{"pos":[18133,18321],"content":"<bpt id=\"p1\">**</bpt>Resolution:<ept id=\"p1\">**</ept> Use the <bpt id=\"p2\">**</bpt>/efs:copyraw<ept id=\"p2\">**</ept> command-line option to copy EFS files during the migration instead of creating hard links, or manually copy the EFS files from the hard-link store."},{"content":"The ScanState tool cannot delete a previous hard-link migration store.","pos":[18327,18397]},{"pos":[18399,18466],"content":"<bpt id=\"p1\">**</bpt>Cause:<ept id=\"p1\">**</ept> The migration store contains hard links to locked files."},{"content":"<bpt id=\"p1\">**</bpt>Resolution:<ept id=\"p1\">**</ept> Use the UsmtUtils tool to delete the store or change the store name.","pos":[18468,18552]},{"content":"For example, at a command prompt, type:","pos":[18553,18592]},{"content":"You should also reboot the machine.","pos":[18635,18670]},{"content":"Related topics","pos":[18675,18689]},{"content":"User State Migration Tool (USMT) Troubleshooting","pos":[18693,18741]},{"content":"Frequently Asked Questions","pos":[18770,18796]},{"content":"Return Codes","pos":[18813,18825]},{"content":"UsmtUtils Syntax","pos":[18851,18867]}],"content":"---\ntitle: Common Issues (Windows 10)\ndescription: Common Issues\nms.assetid: 5a37e390-8617-4768-9eee-50397fbbb2e1\nms.prod: w10\nms.mktglfcycl: deploy\nms.sitesec: library\nauthor: greg-lindsay\n---\n\n# Common Issues\n\n\nThe following sections discuss common issues that you might see when you run the User State Migration Tool (USMT) 10.0 tools. USMT produces log files that describe in further detail any errors that occurred during the migration process. These logs can be used to troubleshoot migration failures.\n\n## In This Topic\n\n\n[User Account Problems](#user)\n\n[Command-line Problems](#command)\n\n[XML File Problems](#xml)\n\n[Migration Problems](#migration)\n\n[Offline Migration Problems](#bkmk-offline)\n\n[Hard Link Migration Problems](#bkmk-hardlink)\n\n## General Guidelines for Identifying Migration Problems\n\n\nWhen you encounter a problem or error message during migration, you can use the following general guidelines to help determine the source of the problem:\n\n-   Examine the ScanState, LoadState, and UsmtUtils logs to obtain the exact USMT error messages and Windows® application programming interface (API) error messages. For more information about USMT return codes and error messages, see [Return Codes](usmt-return-codes.md). For more information about Windows API error messages, type **nethelpmsg** on the command line.\n\n    In most cases, the ScanState and LoadState logs indicate why a USMT migration is failing. We recommend that you use the **/v***:5* option when testing your migration. This verbosity level can be adjusted in a production migration; however, reducing the verbosity level might make it more difficult to diagnose failures that are encountered during production migrations. You can use a verbosity level higher than 5 if you want the log files output to go to a debugger.\n\n    **Note**  \n    Running the ScanState and LoadState tools with the **/v***:5* option creates a detailed log file. Although this option makes the log file large, the extra detail can help you determine where migration errors occurred.\n\n     \n\n-   Use the **/Verify** option in the UsmtUtils tool to determine whether any files in a compressed migration store are corrupted. For more information, see [Verify the Condition of a Compressed Migration Store](verify-the-condition-of-a-compressed-migration-store.md).\n\n-   Use the **/Extract** option in the UsmtUtils tool to extract files from a compressed migration store. For more information, see [Extract Files from a Compressed USMT Migration Store](usmt-extract-files-from-a-compressed-migration-store.md).\n\n-   Create a progress log using the **/Progress** option to monitor your migration.\n\n-   For the source and destination computers, obtain operating system information, and versions of applications such as Internet Explorer and any other relevant programs. Then verify the exact steps that are needed to reproduce the problem. This information might help you to understand what is wrong and to reproduce the issue in your testing environment.\n\n-   Log off after you run the LoadState tool. Some settings—for example, fonts, desktop backgrounds, and screen-saver settings—will not take effect until the next time the end user logs on.\n\n-   Close all applications before running ScanState or LoadState tools. If some applications are running during the ScanState or LoadState process, USMT might not migrate some data. For example, if Microsoft Outlook® is open, USMT might not migrate PST files.\n\n    **Note**  \n    USMT will fail if it cannot migrate a file or setting unless you specify the **/c** option. When you specify the **/c** option, USMT ignores errors. However, it logs an error when it encounters a file that is in use that did not migrate.\n\n     \n\n## <a href=\"\" id=\"user\"></a>User Account Problems\n\n\nThe following sections describe common user account problems. Expand the section to see recommended solutions.\n\n### I'm having problems creating local accounts on the destination computer.\n\n**Resolution:** For more information about creating accounts and migrating local accounts, see [Migrate User Accounts](usmt-migrate-user-accounts.md).\n\n### Not all of the user accounts were migrated to the destination computer.\n\n**Causes/Resolutions** There are two possible causes for this problem:\n\nWhen running the ScanState tool on Windows Vista, or the ScanState and LoadState tools on Windows 7, Windows 8, or Windows 10, you must run them in Administrator mode from an account with administrative credentials to ensure that all specified users are migrated. To run in Administrator mode:\n\n1.  Click **Start**.\n\n2.  Click **All Programs**.\n\n3.  Click **Accessories**.\n\n4.  Right-click **Command Prompt**.\n\n5.  Click **Run as administrator**.\n\nThen specify your LoadState or ScanState command. If you do not run USMT in Administrator mode, only the user profile that is logged on will be included in the migration.\n\nAny user accounts on the computer that have not been used will not be migrated. For example, if you add User1 to the computer, but User1 never logs on, then USMT will not migrate the User1 account.\n\n### User accounts that I excluded were migrated to the destination computer.\n\n**Cause:** The command that you specified might have had conflicting **/ui** and **/ue** options. If a user is specified with the **/ui** option and is also specified to be excluded with either the **/ue** or **/uel** options, the user will be included in the migration. For example, if you specify `/ui:domain1\\* /ue:domain1\\user1`, then User1 will be migrated because the **/ui** option takes precedence.\n\n**Resolution:** For more information about how to use the **/ui** and **/ue** options together, see the examples in the [ScanState Syntax](usmt-scanstate-syntax.md) topic.\n\n### I am using the /uel option, but many accounts are still being included in the migration.\n\n**Cause** The **/uel** option depends on the last modified date of the users' NTUser.dat file. There are scenarios in which this last modified date might not match the users' last logon date.\n\n**Resolution** This is a limitation of the **/uel** option. You might need to exclude these users manually with the **/ue** option.\n\n### The LoadState tool reports an error as return code 71 and fails to restore a user profile during a migration test.\n\n**Cause:** During a migration test, if you run the ScanState tool on your test computer and then delete user profiles in order to test the LoadState tool on the same computer, you may have a conflicting key present in the registry. Using the **net use** command to remove a user profile will delete folders and files associated with that profile, but will not remove the registry key.\n\n**Resolution:** To delete a user profile, use the **User Accounts** item in Control Panel. To correct an incomplete deletion of a user profile:\n\n1.  Open the registry editor by typing `regedit` at an elevated command prompt.\n\n2.  Navigate to `HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\ProfileList`.\n\n    Each user profile is stored in a System Identifier key under `ProfileList`.\n\n3.  Delete the key for the user profile you are trying to remove.\n\n### Files that were not encrypted before the migration are now encrypted with the account used to run the LoadState tool.\n\n**Cause:** The ScanState tool was run using the **/EFS: copyraw** option to migrate encrypted files and Encrypting File System (EFS) certificates. The encryption attribute was set on a folder that was migrated, but the attribute was removed from file contents of that folder prior to migration.\n\n**Resolution:** Before using the ScanState tool for a migration that includes encrypted files and EFS certificates, you can run the Cipher tool at the command prompt to review and change encryption settings on files and folders. You must remove the encryption attribute from folders that contain unencrypted files or encrypt the contents of all files within an encrypted folder.\n\nTo remove encryption from files that have already been migrated incorrectly, you must log on to the computer with the account that you used to run the LoadState tool and then remove the encryption from the affected files.\n\n### The LoadState tool reports an error as return code 71 and a Windows Error 2202 in the log file.\n\n**Cause:** The computer name was changed during an offline migration of a local user profile.\n\n**Resolution:** You can use the **/mu** option when you run the LoadState tool to specify a new name for the user. For example,\n\n``` syntax\nloadstate /i:migapp.xml /i:migdocs.xml \\\\server\\share\\migration\\mystore \n/progress:prog.log /l:load.log /mu:fareast\\user1:farwest\\user1\n```\n\n## <a href=\"\" id=\"command\"></a>Command-line Problems\n\n\nThe following sections describe common command-line problems. Expand the section to see recommended solutions.\n\n### I received the following error message: \"Usage Error: You cannot specify a file path with any of the command-line options that exceeds 256 characters.\"\n\n**Cause:** You might receive this error message in some cases even if you do not specify a long store or file path, because the path length is calculated based on the absolute path. For example, if you run the **scanstate.exe /o store** command from C:\\\\Program Files\\\\USMT40, then each character in \"`C:\\Program Files\\USMT40`\" will be added to the length of \"store\" to get the length of the path.\n\n**Resolution:** Ensure that the total path length—the store path plus the current directory—does not exceed 256 characters.\n\n### I received the following error message: \"USMT was unable to create the log file(s). Ensure that you have write access to the log directory.\"\n\n**Cause:** If you are running the ScanState or LoadState tools from a shared network resource, you will receive this error message if you do not specify **/l**.\n\n**Resolution:** To fix this issue in this scenario, specify the **/l:scan.log** or **/l:load.log** option.\n\n## <a href=\"\" id=\"xml\"></a>XML File Problems\n\n\nThe following sections describe common XML file problems. Expand the section to see recommended solutions.\n\n### I used the /genconfig option to create a Config.xml file, but I see only a few applications and components that are in MigApp.xml. Why does Config.xml not contain all of the same applications?\n\n**Cause:** Config.xml will contain only operating system components, applications, and the user document sections that are in both of the .xml files and are installed on the computer when you run the **/genconfig** option. Otherwise, these applications and components will not appear in the Config.xml file.\n\n**Resolution:** Install all of the desired applications on the computer before running the **/genconfig** option. Then run ScanState with all of the .xml files. For example, run the following:\n\n`scanstate /genconfig:config.xml /i:migdocs.xml /i:migapp.xml /v:5 /l:scanstate.log`\n\n### I am having problems with a custom .xml file that I authored, and I cannot verify that the syntax is correct.\n\n**Resolution:** You can load the XML schema (MigXML.xsd), included with USMT, into your XML authoring tool. For examples, see the [Visual Studio Development Center](http://go.microsoft.com/fwlink/p/?LinkId=74513). Then, load your .xml file in the authoring tool to see if there is a syntax error. In addition, see [USMT XML Reference](usmt-xml-reference.md) for more information about using the XML elements.\n\n### <a href=\"\" id=\"i-am-using-a-migxml-helper-function--but-the-migration-isn-t-working-the-way-i-expected-it-to---how-do-i-troubleshoot-this-issue-\"></a>I am using a MigXML helper function, but the migration isn’t working the way I expected it to.  How do I troubleshoot this issue?\n\n**Cause:** Typically, this issue is caused by incorrect syntax used in a helper function. You receive a Success return code, but the files you wanted to migrate did not get collected or applied, or weren’t collected or applied in the way you expected.\n\n**Resolution:** You should search the ScanState or LoadState log for either the component name which contains the MigXML helper function, or the MigXML helper function title, so that you can locate the related warning in the log file.\n\n## <a href=\"\" id=\"migration\"></a>Migration Problems\n\n\nThe following sections describe common migration problems. Expand the section to see recommended solutions.\n\n### Files that I specified to exclude are still being migrated.\n\n**Cause:** There might be another rule that is including the files. If there is a more specific rule or a conflicting rule, the files will be included in the migration.\n\n**Resolution:** For more information, see [Conflicts and Precedence](usmt-conflicts-and-precedence.md) and the Diagnostic Log section in [Log Files](usmt-log-files.md).\n\n### I specified rules to move a folder to a specific location on the destination computer, but it has not migrated correctly.\n\n**Cause:** There might be an error in the XML syntax.\n\n**Resolution:** You can use the USMT XML schema (MigXML.xsd) to write and validate migration .xml files. Also see the XML examples in the following topics:\n\n[Conflicts and Precedence](usmt-conflicts-and-precedence.md)\n\n[Exclude Files and Settings](usmt-exclude-files-and-settings.md)\n\n[Reroute Files and Settings](usmt-reroute-files-and-settings.md)\n\n[Include Files and Settings](usmt-include-files-and-settings.md)\n\n[Custom XML Examples](usmt-custom-xml-examples.md)\n\n### After LoadState completes, the new desktop background does not appear on the destination computer.\n\nThere are three typical causes for this issue.\n\n**Cause \\#1:**: Some settings such as fonts, desktop backgrounds, and screen-saver settings are not applied by LoadState until after the destination computer has been restarted.\n\n**Resolution:** To fix this issue, log off, and then log back on to see the migrated desktop background.\n\n**Cause \\#2:** If the source computer was running Windows® XP and the desktop background was stored in the *Drive*:\\\\WINDOWS\\\\Web\\\\Wallpaper folder—the default folder where desktop backgrounds are stored in Windows XP—the desktop background will not be migrated. Instead, the destination computer will have the default Windows® desktop background. This will occur even if the desktop background was a custom picture that was added to the \\\\WINDOWS\\\\Web\\\\Wallpaper folder. However, if the end user sets a picture as the desktop background that was saved in another location, for example, My Pictures, then the desktop background will migrate.\n\n**Resolution:** Ensure that the desktop background images that you want to migrate are not in the \\\\WINDOWS\\\\Web\\\\Wallpaper folder on the source computer.\n\n**Cause \\#3:** If ScanState was not run on Windows XP from an account with administrative credentials, some operating system settings will not migrate. For example, desktop background settings, screen-saver selections, modem options, media-player settings, and Remote Access Service (RAS) connection phone book (.pbk) files and settings will not migrate.\n\n**Resolution:** Run the ScanState and LoadState tools from within an account with administrative credentials.\n\n### <a href=\"\" id=\"i-included-migapp-xml-in-the-migration--but-some-pst-files-aren-t-migrating-\"></a>I included MigApp.xml in the migration, but some PST files aren’t migrating.\n\n**Cause:** The MigApp.xml file migrates only the PST files that are linked to Outlook profiles.\n\n**Resolution:** To migrate PST files that are not linked to Outlook profiles, you must create a separate migration rule to capture these files.\n\n## <a href=\"\" id=\"bkmk-offline\"></a>Offline Migration Problems\n\n\nThe following sections describe common offline migration problems. Expand the section to see recommended solutions.\n\n### Some of my system settings do not migrate in an offline migration.\n\n**Cause:** Some system settings, such as desktop backgrounds and network printers, are not supported in an offline migration. For more information, see [What Does USMT Migrate?](usmt-what-does-usmt-migrate.md)\n\n**Resolution:** In an offline migration, these system settings must be restored manually.\n\n### The ScanState tool fails with return code 26.\n\n**Cause:** A common cause of return code 26 is that a temp profile is active on the source computer. This profile maps to c:\\\\users\\\\temp. The ScanState log shows a MigStartupOfflineCaught exception that includes the message \"User profile duplicate SID error\".\n\n**Resolution:** You can reboot the computer to get rid of the temp profile or you can set MIG\\_FAIL\\_ON\\_PROFILE\\_ERROR=0 to skip the error and exclude the temp profile.\n\n### Include and Exclude rules for migrating user profiles do not work the same offline as they do online.\n\n**Cause:** When offline, the DNS server cannot be queried to resolve the user name and SID mapping.\n\n**Resolution:** Use a Security Identifier (SID) to include a user when running the ScanState tool. For example:\n\n``` syntax\nScanstate /ui:S1-5-21-124525095-708259637-1543119021*\n```\n\nThe wild card (\\*) at the end of the SID will migrate the *SID*\\_Classes key as well.\n\nYou can also use patterns for SIDs that identify generic users or groups. For example, you can use the */ue:\\*-500* option to exclude the local administrator accounts. For more information about Windows SIDs, see [this Microsoft Web site](http://go.microsoft.com/fwlink/p/?LinkId=190277).\n\n### My script to wipe the disk fails after running the ScanState tool on a 64-bit system.\n\n**Cause:** The HKLM registry hive is not unloaded after the ScanState tool has finished running.\n\n**Resolution:** Reboot the computer or unload the registry hive at the command prompt after the ScanState tool has finished running. For example, at a command prompt, type:\n\n``` syntax\nreg.exe unload hklm\\$dest$software\n```\n\n## <a href=\"\" id=\"bkmk-hardlink\"></a>Hard-Link Migration Problems\n\n\nThe following sections describe common hard-link migration problems. Expand the section to see recommended solutions.\n\n### EFS files are not restored to the new partition.\n\n**Cause:** EFS files cannot be moved to a new partition with a hard link. The **/efs:hardlink** command-line option is only applicable to files migrated on the same partition.\n\n**Resolution:** Use the **/efs:copyraw** command-line option to copy EFS files during the migration instead of creating hard links, or manually copy the EFS files from the hard-link store.\n\n### The ScanState tool cannot delete a previous hard-link migration store.\n\n**Cause:** The migration store contains hard links to locked files.\n\n**Resolution:** Use the UsmtUtils tool to delete the store or change the store name. For example, at a command prompt, type:\n\n``` syntax\nUSMTutils /rd <storedir>\n```\n\nYou should also reboot the machine.\n\n## Related topics\n\n\n[User State Migration Tool (USMT) Troubleshooting](usmt-troubleshooting.md)\n\n[Frequently Asked Questions](usmt-faq.md)\n\n[Return Codes](usmt-return-codes.md)\n\n[UsmtUtils Syntax](usmt-utilities.md)\n\n \n\n \n\n\n\n\n\n"}