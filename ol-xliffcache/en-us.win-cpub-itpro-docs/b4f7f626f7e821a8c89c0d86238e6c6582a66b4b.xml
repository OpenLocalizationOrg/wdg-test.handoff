{"nodes":[{"content":"Server Isolation Policy Design Example (Windows 10)","pos":[11,62]},{"content":"Server Isolation Policy Design Example","pos":[76,114]},{"content":"Server Isolation Policy Design Example","pos":[270,308]},{"content":"Applies to","pos":[312,322]},{"content":"Windows 10","pos":[329,339]},{"content":"Windows Server 2016 Technical Preview","pos":[344,381]},{"pos":[383,655],"content":"This design example continues to use the fictitious company Woodgrove Bank, as described in the <bpt id=\"p1\">[</bpt>Firewall Policy Design Example<ept id=\"p1\">](firewall-policy-design-example.md)</ept> section and the <bpt id=\"p2\">[</bpt>Domain Isolation Policy Design Example<ept id=\"p2\">](domain-isolation-policy-design-example.md)</ept> section."},{"content":"In addition to the protections provided by the firewall and domain isolation, Woodgrove Bank wants to provide additional protection to the devices that are running Microsoft SQL Server for the WGBank program.","pos":[657,865]},{"content":"They contain personal data, including each customer's financial history.","pos":[866,938]},{"content":"Government and industry rules and regulations specify that access to this information must be restricted to only those users who have a legitimate business need.","pos":[939,1100]},{"content":"This includes a requirement to prevent interception of and access to the information when it is in transit over the network.","pos":[1101,1225]},{"content":"The information presented by the WGBank front-end servers to the client devices, and the information presented by the WGPartner servers to the remote partner devices, are not considered sensitive for the purposes of the government regulations, because they are processed to remove sensitive elements before transmitting the data to the client devices.","pos":[1227,1578]},{"content":"In this guide, the examples show server isolation layered on top of a domain isolation design.","pos":[1580,1674]},{"content":"If you have an isolated domain, the client devices are already equipped with GPOs that require authentication.","pos":[1675,1785]},{"content":"You only have to add settings to the isolated server(s) to require authentication on inbound connections, and to check for membership in the NAG.","pos":[1786,1931]},{"content":"The connection attempt succeeds only if NAG membership is confirmed.","pos":[1932,2000]},{"content":"Server isolation without domain isolation","pos":[2005,2046]},{"content":"Server isolation can also be deployed by itself, to only the devices that must participate.","pos":[2048,2139]},{"content":"The GPO on the server is no different from the one discussed in the previous paragraph for a server in an existing isolated domain.","pos":[2140,2271]},{"content":"The difference is that you must also deploy a GPO with supporting connection security rules to the clients that must be able to communicate with the isolated server.","pos":[2272,2437]},{"content":"Because those devices must be members of the NAG, that group can also be used in a security group filter on the client GPO.","pos":[2438,2561]},{"content":"That GPO must contain rules that support the authentication requirements of the isolated server.","pos":[2562,2658]},{"content":"In short, instead of applying the client GPO to all clients in the domain, you apply the GPO to only the members of the NAG.","pos":[2660,2784]},{"content":"If you do not have an Active Directory domain, you can manually apply the connection security rules, use a netsh command-line script, or use a Windows PowerShell script to help automate the configuration of the rules on larger numbers of devices.","pos":[2786,3032]},{"content":"If you do not have an Active Directory domain, you cannot use the Kerberos V5 protocol, but instead must provide the clients and the isolated servers with certificates that are referenced in the connection security rules.","pos":[3033,3254]},{"content":"Design requirements","pos":[3259,3278]},{"content":"In addition to the protection provided by the firewall rules and domain isolation described in the previous design examples, the network administrators want to implement server isolation to help protect the sensitive data stored on the devices that run SQL Server.","pos":[3280,3544]},{"content":"The following illustration shows the traffic protection needs for this design example.","pos":[3546,3632]},{"content":"isolated server example","pos":[3636,3659]},{"content":"Access to the SQL Server devices must be restricted to only those computer or user accounts that have a business requirement to access the data.","pos":[3699,3843]},{"content":"This includes the service accounts that are used by the WGBank front-end servers, and administrators of the SQL Server devices.","pos":[3844,3971]},{"content":"In addition, access is only granted when it is sent from an authorized computer.","pos":[3972,4052]},{"content":"Authorization is determined by membership in a network access group (NAG).","pos":[4053,4127]},{"content":"All network traffic to and from the SQL Server devices must be encrypted.","pos":[4133,4206]},{"content":"Client devices or users whose accounts are not members of the NAG cannot access the isolated servers.","pos":[4212,4313]},{"content":"Other traffic notes:","pos":[4317,4337]},{"pos":[4345,4484],"content":"All of the design requirements shown in the <bpt id=\"p1\">[</bpt>Firewall Policy Design Example<ept id=\"p1\">](firewall-policy-design-example.md)</ept> section are still enforced."},{"pos":[4490,4645],"content":"All of the design requirements shown in the <bpt id=\"p1\">[</bpt>Domain Isolation Policy Design Example<ept id=\"p1\">](domain-isolation-policy-design-example.md)</ept> section are still enforced."},{"content":"Design details","pos":[4650,4664]},{"content":"Woodgrove Bank uses Active Directory groups and GPOs to deploy the server isolation settings and rules to the devices on its network.","pos":[4666,4799]},{"content":"As in the previously described policy design examples, GPOs to implement the domain isolation environment are linked to the domain container in Active Directory, and then WMI filters and security group filters are attached to GPOs to ensure that the correct GPO is applied to each computer.","pos":[4801,5091]},{"content":"The following groups were created by using the Active Directory Users and Computers snap-in, and all devices that run Windows were added to the correct groups.","pos":[5092,5251]},{"content":"<bpt id=\"p1\">**</bpt>CG<ph id=\"ph1\">\\_</ph>SRVISO<ph id=\"ph2\">\\_</ph>WGBANK<ph id=\"ph3\">\\_</ph>SQL<ept id=\"p1\">**</ept>.","pos":[5257,5285]},{"content":"This group contains the computer accounts for the devices that run SQL Server.","pos":[5286,5364]},{"content":"Members of this group receive a GPO with firewall and connections security rules that require that only users who are members of the group CG<ph id=\"ph1\">\\_</ph>NAG<ph id=\"ph2\">\\_</ph>SQL<ph id=\"ph3\">\\_</ph>USERS can access the server, and only when they are using a computer that is a member of the group CG<ph id=\"ph4\">\\_</ph>NAG<ph id=\"ph5\">\\_</ph>SQL<ph id=\"ph6\">\\_</ph>COMPUTERS.","pos":[5365,5641]},{"content":"<bpt id=\"p1\">**</bpt>Note:<ept id=\"p1\">**</ept>  You can design your GPOs in nested groups.","pos":[5644,5697]},{"content":"For example, you can make the boundary group a member of the isolated domain group, so that it receives the firewall and basic isolated domain settings through that nested membership, with only the changes supplied by the boundary zone GPO.","pos":[5698,5938]},{"content":"However, devices that are running older versions of Windows can only support a single IPsec policy being active at a time.","pos":[5939,6061]},{"content":"The policies for each GPO must be complete (and to a great extent redundant with each other), because you cannot layer them as you can in the newer versions of Windows.","pos":[6062,6230]},{"content":"For simplicity, this guide describes the techniques used to create the independent, non-layered policies.","pos":[6231,6336]},{"content":"We recommend that you create and periodically run a script that compares the memberships of the groups that must be mutually exclusive and reports any devices that are incorrectly assigned to more than one group.","pos":[6337,6549]},{"content":"Network access groups (NAGs) are not used to determine which GPOs are applied to a computer.","pos":[6553,6645]},{"content":"Instead, these groups determine which users and devices can access the services on the isolated server.","pos":[6646,6749]},{"content":"<bpt id=\"p1\">**</bpt>CG<ph id=\"ph1\">\\_</ph>NAG<ph id=\"ph2\">\\_</ph>SQL<ph id=\"ph3\">\\_</ph>COMPUTERS<ept id=\"p1\">**</ept>.","pos":[6755,6783]},{"content":"This network access group contains the computer accounts that are able to access the devices running SQL Server hosting the WGBank data.","pos":[6784,6920]},{"content":"Members of this group include the WGBank front-end servers, and some client devices from which SQL Server administrators are permitted to work on the servers.","pos":[6921,7079]},{"content":"<bpt id=\"p1\">**</bpt>CG<ph id=\"ph1\">\\_</ph>NAG<ph id=\"ph2\">\\_</ph>SQL<ph id=\"ph3\">\\_</ph>USERS<ept id=\"p1\">**</ept>.","pos":[7085,7109]},{"content":"This network access group contains the user accounts of users who are permitted to access the SQL Server devices that host the WGBank data.","pos":[7110,7249]},{"content":"Members of this group include the service account that the WGBank front-end program uses to run on its devices, and the user accounts for the SQL Server administration team members.","pos":[7250,7431]},{"content":"<bpt id=\"p1\">**</bpt>Note:<ept id=\"p1\">**</ept>  You can use a single group for both user and computer accounts.","pos":[7434,7508]},{"content":"Woodgrove Bank chose to keep them separate for clarity.","pos":[7509,7564]},{"content":"If Woodgrove Bank wants to implement server isolation without domain isolation, the CG<ph id=\"ph1\">\\_</ph>NAG<ph id=\"ph2\">\\_</ph>SQL<ph id=\"ph3\">\\_</ph>COMPUTERS group can also be attached as a security group filter on the GPOs that apply connection security rules to the client devices.","pos":[7566,7799]},{"content":"By doing this, all the devices that are authorized to access the isolated server also have the required connection security rules.","pos":[7800,7930]},{"content":"You do not have to include the encryption-capable rules on all devices.","pos":[7932,8003]},{"content":"Instead, you can create GPOs that are applied only to members of the NAG, in addition to the standard domain isolation GPO, that contain connection security rules to support encryption.","pos":[8004,8189]},{"pos":[8191,8306],"content":"<bpt id=\"p1\">**</bpt>Next: <ept id=\"p1\">**</ept><bpt id=\"p2\">[</bpt>Certificate-based Isolation Policy Design Example<ept id=\"p2\">](certificate-based-isolation-policy-design-example.md)</ept>"}],"content":"---\ntitle: Server Isolation Policy Design Example (Windows 10)\ndescription: Server Isolation Policy Design Example\nms.assetid: 337e5f6b-1ec5-4b83-bee5-d0aea1fa5fc6\nms.prod: w10\nms.mktglfcycl: deploy\nms.sitesec: library\nms.pagetype: security\nauthor: brianlic-msft\n---\n\n# Server Isolation Policy Design Example\n\n**Applies to**\n-   Windows 10\n-   Windows Server 2016 Technical Preview\n\nThis design example continues to use the fictitious company Woodgrove Bank, as described in the [Firewall Policy Design Example](firewall-policy-design-example.md) section and the [Domain Isolation Policy Design Example](domain-isolation-policy-design-example.md) section.\n\nIn addition to the protections provided by the firewall and domain isolation, Woodgrove Bank wants to provide additional protection to the devices that are running Microsoft SQL Server for the WGBank program. They contain personal data, including each customer's financial history. Government and industry rules and regulations specify that access to this information must be restricted to only those users who have a legitimate business need. This includes a requirement to prevent interception of and access to the information when it is in transit over the network.\n\nThe information presented by the WGBank front-end servers to the client devices, and the information presented by the WGPartner servers to the remote partner devices, are not considered sensitive for the purposes of the government regulations, because they are processed to remove sensitive elements before transmitting the data to the client devices.\n\nIn this guide, the examples show server isolation layered on top of a domain isolation design. If you have an isolated domain, the client devices are already equipped with GPOs that require authentication. You only have to add settings to the isolated server(s) to require authentication on inbound connections, and to check for membership in the NAG. The connection attempt succeeds only if NAG membership is confirmed.\n\n## Server isolation without domain isolation\n\nServer isolation can also be deployed by itself, to only the devices that must participate. The GPO on the server is no different from the one discussed in the previous paragraph for a server in an existing isolated domain. The difference is that you must also deploy a GPO with supporting connection security rules to the clients that must be able to communicate with the isolated server. Because those devices must be members of the NAG, that group can also be used in a security group filter on the client GPO. That GPO must contain rules that support the authentication requirements of the isolated server.\n\nIn short, instead of applying the client GPO to all clients in the domain, you apply the GPO to only the members of the NAG.\n\nIf you do not have an Active Directory domain, you can manually apply the connection security rules, use a netsh command-line script, or use a Windows PowerShell script to help automate the configuration of the rules on larger numbers of devices. If you do not have an Active Directory domain, you cannot use the Kerberos V5 protocol, but instead must provide the clients and the isolated servers with certificates that are referenced in the connection security rules.\n\n## Design requirements\n\nIn addition to the protection provided by the firewall rules and domain isolation described in the previous design examples, the network administrators want to implement server isolation to help protect the sensitive data stored on the devices that run SQL Server.\n\nThe following illustration shows the traffic protection needs for this design example.\n\n![isolated server example](images/wfas-design3example1.gif)\n\n1.  Access to the SQL Server devices must be restricted to only those computer or user accounts that have a business requirement to access the data. This includes the service accounts that are used by the WGBank front-end servers, and administrators of the SQL Server devices. In addition, access is only granted when it is sent from an authorized computer. Authorization is determined by membership in a network access group (NAG).\n\n2.  All network traffic to and from the SQL Server devices must be encrypted.\n\n3.  Client devices or users whose accounts are not members of the NAG cannot access the isolated servers.\n\n**Other traffic notes:**\n\n-   All of the design requirements shown in the [Firewall Policy Design Example](firewall-policy-design-example.md) section are still enforced.\n\n-   All of the design requirements shown in the [Domain Isolation Policy Design Example](domain-isolation-policy-design-example.md) section are still enforced.\n\n## Design details\n\nWoodgrove Bank uses Active Directory groups and GPOs to deploy the server isolation settings and rules to the devices on its network.\n\nAs in the previously described policy design examples, GPOs to implement the domain isolation environment are linked to the domain container in Active Directory, and then WMI filters and security group filters are attached to GPOs to ensure that the correct GPO is applied to each computer. The following groups were created by using the Active Directory Users and Computers snap-in, and all devices that run Windows were added to the correct groups.\n\n-   **CG\\_SRVISO\\_WGBANK\\_SQL**. This group contains the computer accounts for the devices that run SQL Server. Members of this group receive a GPO with firewall and connections security rules that require that only users who are members of the group CG\\_NAG\\_SQL\\_USERS can access the server, and only when they are using a computer that is a member of the group CG\\_NAG\\_SQL\\_COMPUTERS.\n\n>**Note:**  You can design your GPOs in nested groups. For example, you can make the boundary group a member of the isolated domain group, so that it receives the firewall and basic isolated domain settings through that nested membership, with only the changes supplied by the boundary zone GPO. However, devices that are running older versions of Windows can only support a single IPsec policy being active at a time. The policies for each GPO must be complete (and to a great extent redundant with each other), because you cannot layer them as you can in the newer versions of Windows. For simplicity, this guide describes the techniques used to create the independent, non-layered policies. We recommend that you create and periodically run a script that compares the memberships of the groups that must be mutually exclusive and reports any devices that are incorrectly assigned to more than one group.\n\n \nNetwork access groups (NAGs) are not used to determine which GPOs are applied to a computer. Instead, these groups determine which users and devices can access the services on the isolated server.\n\n-   **CG\\_NAG\\_SQL\\_COMPUTERS**. This network access group contains the computer accounts that are able to access the devices running SQL Server hosting the WGBank data. Members of this group include the WGBank front-end servers, and some client devices from which SQL Server administrators are permitted to work on the servers.\n\n-   **CG\\_NAG\\_SQL\\_USERS**. This network access group contains the user accounts of users who are permitted to access the SQL Server devices that host the WGBank data. Members of this group include the service account that the WGBank front-end program uses to run on its devices, and the user accounts for the SQL Server administration team members.\n\n>**Note:**  You can use a single group for both user and computer accounts. Woodgrove Bank chose to keep them separate for clarity.\n\nIf Woodgrove Bank wants to implement server isolation without domain isolation, the CG\\_NAG\\_SQL\\_COMPUTERS group can also be attached as a security group filter on the GPOs that apply connection security rules to the client devices. By doing this, all the devices that are authorized to access the isolated server also have the required connection security rules.\n\nYou do not have to include the encryption-capable rules on all devices. Instead, you can create GPOs that are applied only to members of the NAG, in addition to the standard domain isolation GPO, that contain connection security rules to support encryption.\n\n**Next: **[Certificate-based Isolation Policy Design Example](certificate-based-isolation-policy-design-example.md)\n"}