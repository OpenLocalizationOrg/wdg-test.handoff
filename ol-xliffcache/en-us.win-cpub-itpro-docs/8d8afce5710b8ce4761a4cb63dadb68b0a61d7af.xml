{"nodes":[{"content":"Switch PCR banks on TPM 2.0 devices (Windows 10)","pos":[11,59]},{"content":"A Platform Configuration Register (PCR) is a memory location in the TPM that has some unique properties.","pos":[73,177]},{"content":"Switch PCR banks on TPM 2.0 devices","pos":[333,368]},{"content":"Applies to","pos":[372,382]},{"content":"Windows 10","pos":[389,399]},{"content":"A Platform Configuration Register (PCR) is a memory location in the TPM that has some unique properties.","pos":[401,505]},{"content":"The size of the value that can be stored in a PCR is determined by the size of a digest generated by an associated hashing algorithm.","pos":[506,639]},{"content":"A SHA-1 PCR can store 20 bytes – the size of a SHA-1 digest.","pos":[640,700]},{"content":"Multiple PCRs associated with the same hashing algorithm are referred to as a PCR bank.","pos":[701,788]},{"pos":[790,931],"content":"To store a new value in a PCR, the existing value is extended with a new value as follows: PCR<ph id=\"ph1\">\\[</ph>N<ph id=\"ph2\">\\]</ph> = HASHalg( PCR<ph id=\"ph3\">\\[</ph>N<ph id=\"ph4\">\\]</ph> || ArgumentOfExtend )"},{"content":"The existing value is concatenated with the argument of the TPM Extend operation.","pos":[933,1014]},{"content":"The resulting concatenation is then used as input to the associated hashing algorithm, which computes a digest of the input.","pos":[1015,1139]},{"content":"This computed digest becomes the new value of the PCR.","pos":[1140,1194]},{"content":"The <bpt id=\"p1\">[</bpt>TCG PC Client Specific Platform TPM Profile for TPM 2.0<ept id=\"p1\">](http://go.microsoft.com/fwlink/p/?LinkId=746577)</ept> defines the inclusion of at least one PCR bank with 24 registers.","pos":[1196,1372]},{"content":"The only way to reset the first 16 PCRs is to reset the TPM itself.","pos":[1373,1440]},{"content":"This restriction helps ensure that the value of those PCRs can only be modified via the TPM Extend operation.","pos":[1441,1550]},{"content":"Some TPM PCRs are used as checksums of log events.","pos":[1552,1602]},{"content":"The log events are extended in the TPM as the events occur.","pos":[1603,1662]},{"content":"Later, an auditor can validate the logs by computing the expected PCR values from the log and comparing them to the PCR values of the TPM.","pos":[1663,1801]},{"content":"Since the first 16 TPM PCRs cannot be modified arbitrarily, a match between an expected PCR value in that range and the actual TPM PCR value provides assurance of an unmodified log.","pos":[1802,1983]},{"content":"How does Windows 10 use PCRs?","pos":[1988,2017]},{"content":"To bind the use of a TPM based key to a certain state of the PC, the key can be sealed to an expected set of PCR values.","pos":[2019,2139]},{"content":"For instance, PCRs 0 through 7 have a well-defined value after the boot process – when the OS is loaded.","pos":[2140,2244]},{"content":"When the hardware, firmware, or boot loader of the machine changes, the change can be detected in the PCR values.","pos":[2245,2358]},{"content":"Windows 10 uses this capability to make certain cryptographic keys only available at certain times during the boot process.","pos":[2359,2482]},{"content":"For instance, the BitLocker key can be used at a certain point in the boot, but not before or after.","pos":[2483,2583]},{"content":"It is important to note that this binding to PCR values also includes the hashing algorithm used for the PCR.","pos":[2585,2694]},{"content":"For instance, a key can be bound to a specific value of the SHA-1 PCR<ph id=\"ph1\">\\[</ph>12<ph id=\"ph2\">\\]</ph>, if using SHA-256 PCR banks, even with the same system configuration otherwise, the PCR values will not match.","pos":[2695,2882]},{"content":"What happens when PCR banks are switched?","pos":[2887,2928]},{"content":"When the PCR banks are switched, the algorithm used to compute the hashed values stored in the PCRs during extend operations is changed.","pos":[2930,3066]},{"content":"For the same input, each hash algorithm will return a different cryptographic signature for the same inputs.","pos":[3067,3175]},{"content":"As a result, if the currently used PCR bank is switched all keys that have been bound to the previous PCR values will no longer work.","pos":[3177,3310]},{"content":"For example, if you had a key bound to the SHA-1 value of PCR<ph id=\"ph1\">\\[</ph>12<ph id=\"ph2\">\\]</ph> and subsequently changed the PCR banks to SHA-256, the banks wouldn’t match, and you would be unable to use that key.","pos":[3311,3496]},{"content":"The BitLocker key is secured using the PCR banks and Windows 10 will not be able to unseal it if the PCR banks are switched while BitLocker is enabled.","pos":[3497,3648]},{"content":"What can I do to switch PCRs when BitLocker is already active?","pos":[3653,3715]},{"content":"Before switching PCR banks you should suspend or disable BitLocker – or have your recovery key ready.","pos":[3717,3818]},{"content":"For steps on how to switch PCR banks on your PC, you should contact your OEM or UEFI vendor.","pos":[3819,3911]}],"content":"---\ntitle: Switch PCR banks on TPM 2.0 devices (Windows 10)\ndescription: A Platform Configuration Register (PCR) is a memory location in the TPM that has some unique properties.\nms.assetid: 743FCCCB-99A9-4636-8F48-9ECB3A3D10DE\nms.prod: w10\nms.mktglfcycl: deploy\nms.sitesec: library\nms.pagetype: security\nauthor: brianlic-msft\n---\n\n# Switch PCR banks on TPM 2.0 devices\n\n**Applies to**\n-   Windows 10\n\nA Platform Configuration Register (PCR) is a memory location in the TPM that has some unique properties. The size of the value that can be stored in a PCR is determined by the size of a digest generated by an associated hashing algorithm. A SHA-1 PCR can store 20 bytes – the size of a SHA-1 digest. Multiple PCRs associated with the same hashing algorithm are referred to as a PCR bank.\n\nTo store a new value in a PCR, the existing value is extended with a new value as follows:\nPCR\\[N\\] = HASHalg( PCR\\[N\\] || ArgumentOfExtend )\n\nThe existing value is concatenated with the argument of the TPM Extend operation. The resulting concatenation is then used as input to the associated hashing algorithm, which computes a digest of the input. This computed digest becomes the new value of the PCR.\n\nThe [TCG PC Client Specific Platform TPM Profile for TPM 2.0](http://go.microsoft.com/fwlink/p/?LinkId=746577) defines the inclusion of at least one PCR bank with 24 registers. The only way to reset the first 16 PCRs is to reset the TPM itself. This restriction helps ensure that the value of those PCRs can only be modified via the TPM Extend operation.\n\nSome TPM PCRs are used as checksums of log events. The log events are extended in the TPM as the events occur. Later, an auditor can validate the logs by computing the expected PCR values from the log and comparing them to the PCR values of the TPM. Since the first 16 TPM PCRs cannot be modified arbitrarily, a match between an expected PCR value in that range and the actual TPM PCR value provides assurance of an unmodified log.\n\n## How does Windows 10 use PCRs?\n\nTo bind the use of a TPM based key to a certain state of the PC, the key can be sealed to an expected set of PCR values. For instance, PCRs 0 through 7 have a well-defined value after the boot process – when the OS is loaded. When the hardware, firmware, or boot loader of the machine changes, the change can be detected in the PCR values. Windows 10 uses this capability to make certain cryptographic keys only available at certain times during the boot process. For instance, the BitLocker key can be used at a certain point in the boot, but not before or after.\n\nIt is important to note that this binding to PCR values also includes the hashing algorithm used for the PCR. For instance, a key can be bound to a specific value of the SHA-1 PCR\\[12\\], if using SHA-256 PCR banks, even with the \nsame system configuration otherwise, the PCR values will not match.\n\n## What happens when PCR banks are switched?\n\nWhen the PCR banks are switched, the algorithm used to compute the hashed values stored in the PCRs during extend operations is changed. For the same input, each hash algorithm will return a different cryptographic signature for the same inputs.\n\nAs a result, if the currently used PCR bank is switched all keys that have been bound to the previous PCR values will no longer work. For example, if you had a key bound to the SHA-1 value of PCR\\[12\\] and subsequently changed the PCR banks to SHA-256, the banks wouldn’t match, and you would be unable to use that key. The BitLocker key is secured using the PCR banks and Windows 10 will not be able to unseal it if the PCR banks are switched while BitLocker is enabled.\n\n## What can I do to switch PCRs when BitLocker is already active?\n\nBefore switching PCR banks you should suspend or disable BitLocker – or have your recovery key ready. For steps on how to switch PCR banks on your PC, you should contact your OEM or UEFI vendor.\n"}