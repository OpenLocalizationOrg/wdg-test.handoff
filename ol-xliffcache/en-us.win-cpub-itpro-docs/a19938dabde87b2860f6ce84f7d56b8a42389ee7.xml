{"nodes":[{"content":"How to Enable BitLocker by Using MBAM as Part of a Windows Deployment","pos":[11,80]},{"content":"How to Enable BitLocker by Using MBAM as Part of a Windows Deployment","pos":[94,163]},{"content":"How to Enable BitLocker by Using MBAM as Part of a Windows Deployment","pos":[321,390]},{"content":"This topic explains how to enable BitLocker on an end user's computer by using MBAM as part of your Windows imaging and deployment process.","pos":[393,532]},{"content":"Prerequisites:","pos":[536,550]},{"content":"An existing Windows image deployment process – Microsoft Deployment Toolkit (MDT), Microsoft System Center Configuration Manager, or some other imaging tool or process – must be in place","pos":[558,744]},{"content":"TPM must be enabled in the BIOS and visible to the OS","pos":[750,803]},{"content":"MBAM server infrastructure must be in place and accessible","pos":[809,867]},{"content":"The system partition required by BitLocker must be created","pos":[873,931]},{"content":"The machine must be domain joined during imaging before MBAM fully enables BitLocker","pos":[937,1021]},{"content":"To enable BitLocker using MBAM 2.5 SP1 as part of a Windows deployment","pos":[1025,1095]},{"pos":[1103,1261],"content":"In MBAM 2.5 SP1, the recommended approach to enable BitLocker during a Windows Deployment is by using the <ph id=\"ph1\">`Invoke-MbamClientDeployment.ps1`</ph> PowerShell script."},{"content":"The <ph id=\"ph1\">`Invoke-MbamClientDeployment.ps1`</ph> script enacts BitLocker during the imaging process.","pos":[1271,1360]},{"content":"When required by BitLocker policy, the MBAM agent immediately prompts the domain user to create a PIN or password when the domain user first logs on after imaging.","pos":[1361,1524]},{"content":"Easy to use with MDT, System Center Configuration Manager, or standalone imaging processes","pos":[1534,1624]},{"content":"Compatible with PowerShell 2.0 or higher","pos":[1634,1674]},{"content":"Encrypt OS volume with TPM key protector","pos":[1684,1724]},{"content":"Fully support BitLocker pre-provisioning","pos":[1734,1774]},{"content":"Optionally encrypt FDDs","pos":[1784,1807]},{"content":"Escrow TPM OwnerAuth, even on Windows 8 or higher (MBAM still must own the TPM on Windows 7 for escrow to occur)","pos":[1817,1929]},{"content":"Escrow recovery keys and recovery key packages","pos":[1939,1985]},{"content":"Report encryption status immediately","pos":[1995,2031]},{"content":"New WMI providers","pos":[2041,2058]},{"content":"Detailed logging","pos":[2068,2084]},{"content":"Robust error handling","pos":[2094,2115]},{"content":"You can download the <ph id=\"ph1\">`Invoke-MbamClientDeployment.ps1`</ph> script from <bpt id=\"p1\">[</bpt>Microsoft.com Download Center<ept id=\"p1\">](https://www.microsoft.com/download/details.aspx?id=48698)</ept>.","pos":[2120,2277]},{"content":"This is the main script that your deployment system will call to configure BitLocker drive encryption and record recovery keys with the MBAM Server.","pos":[2278,2426]},{"pos":[2431,2621],"content":"<bpt id=\"p1\">**</bpt>WMI deployment methods for MBAM:<ept id=\"p1\">**</ept> The following WMI methods have been added in MBAM 2.5 SP1 to support enabling BitLocker by using the <ph id=\"ph1\">`Invoke-MbamClientDeployment.ps1`</ph> PowerShell script."},{"pos":[2626,3005],"content":"<a href=\"\" id=\"mbam-machine-wmi-class\"></a>**MBAM\\_Machine WMI Class**  \n**PrepareTpmAndEscrowOwnerAuth:** Reads the TPM OwnerAuth and sends it to the MBAM recovery database by using the MBAM recovery service. If the TPM is not owned and auto-provisioning is not on, it generates a TPM OwnerAuth and takes ownership. If it fails, an error code is returned for troubleshooting.","leadings":["","   "],"nodes":[{"content":"MBAM<ph id=\"ph1\">\\_</ph>Machine WMI Class","pos":[45,68]},{"content":"**PrepareTpmAndEscrowOwnerAuth:** Reads the TPM OwnerAuth and sends it to the MBAM recovery database by using the MBAM recovery service. If the TPM is not owned and auto-provisioning is not on, it generates a TPM OwnerAuth and takes ownership. If it fails, an error code is returned for troubleshooting.","pos":[73,376],"nodes":[{"content":"<bpt id=\"p1\">**</bpt>PrepareTpmAndEscrowOwnerAuth:<ept id=\"p1\">**</ept> Reads the TPM OwnerAuth and sends it to the MBAM recovery database by using the MBAM recovery service.","pos":[0,136]},{"content":"If the TPM is not owned and auto-provisioning is not on, it generates a TPM OwnerAuth and takes ownership.","pos":[137,243]},{"content":"If it fails, an error code is returned for troubleshooting.","pos":[244,303]}]}]},{"content":"Parameter","pos":[3009,3018]},{"content":"Description","pos":[3021,3032]},{"content":"RecoveryServiceEndPoint","pos":[3064,3087]},{"content":"A string specifying the MBAM recovery service endpoint.","pos":[3090,3145]},{"content":"Here are a list of common error messages:","pos":[3149,3190]},{"content":"Common return values","pos":[3194,3214]},{"content":"Error message","pos":[3217,3230]},{"content":"S_OK","pos":[3279,3283]},{"content":"0 (0x0)","pos":[3291,3298]},{"content":"The method was successful.","pos":[3301,3327]},{"content":"MBAM_E_TPM_NOT_PRESENT","pos":[3334,3356]},{"content":"2147746304 (0x80040200)","pos":[3364,3387]},{"content":"TPM is not present in the computer or is disabled in the BIOS configuration.","pos":[3390,3466]},{"content":"MBAM_E_TPM_INCORRECT_STATE","pos":[3473,3499]},{"content":"2147746305 (0x80040201)","pos":[3507,3530]},{"content":"TPM is not in the correct state (enabled, activated and owner installation allowed).","pos":[3533,3617]},{"content":"MBAM_E_TPM_AUTO_PROVISIONING_PENDING","pos":[3624,3660]},{"content":"2147746306 (0x80040202)","pos":[3668,3691]},{"content":"MBAM cannot take ownership of TPM because auto-provisioning is pending.","pos":[3694,3765]},{"content":"Try again after auto-provisioning is completed.","pos":[3766,3813]},{"content":"MBAM_E_TPM_OWNERAUTH_READFAIL","pos":[3820,3849]},{"content":"2147746307 (0x80040203)","pos":[3857,3880]},{"content":"MBAM cannot read the TPM owner authorization value.","pos":[3883,3934]},{"content":"The value might have been removed after a successful escrow.","pos":[3935,3995]},{"content":"On Windows 7, MBAM cannot read the value if the TPM is owned by others.","pos":[3996,4067]},{"content":"MBAM_E_REBOOT_REQUIRED","pos":[4074,4096]},{"content":"2147746308 (0x80040204)","pos":[4104,4127]},{"content":"The computer must be restarted to set TPM to the correct state.","pos":[4130,4193]},{"content":"You might need to manually reboot the computer.","pos":[4194,4241]},{"content":"MBAM_E_SHUTDOWN_REQUIRED","pos":[4248,4272]},{"content":"2147746309 (0x80040205)","pos":[4280,4303]},{"content":"The computer must be shut down and turned back on to set TPM to the correct state.","pos":[4306,4388]},{"content":"You might need to manually reboot the computer.","pos":[4389,4436]},{"content":"WS_E_ENDPOINT_ACCESS_DENIED","pos":[4443,4470]},{"content":"2151481349 (0x803D0005)","pos":[4478,4501]},{"content":"Access was denied by the remote endpoint.","pos":[4504,4545]},{"content":"WS_E_ENDPOINT_NOT_FOUND","pos":[4552,4575]},{"content":"2151481357 (0x803D000D)","pos":[4583,4606]},{"content":"The remote endpoint does not exist or could not be located.","pos":[4609,4668]},{"content":"**WS_E_ENDPOINT_FAILURE","pos":[4673,4696]},{"content":"2151481357 (0x803D000F)","pos":[4702,4725]},{"content":"The remote endpoint could not process the request.","pos":[4728,4778]},{"content":"WS_E_ENDPOINT_UNREACHABLE","pos":[4785,4810]},{"content":"2151481360 (0x803D0010)","pos":[4818,4841]},{"content":"The remote endpoint was not reachable.","pos":[4844,4882]},{"content":"WS_E_ENDPOINT_FAULT_RECEIVED","pos":[4889,4917]},{"content":"2151481363 (0x803D0013)","pos":[4925,4948]},{"content":"A message containing a fault was received from the remote endpoint.","pos":[4951,5018]},{"content":"Make sure you are connecting to the correct service endpoint.","pos":[5019,5080]},{"pos":[5085,5138],"content":"<bpt id=\"p1\">**</bpt>WS_E_INVALID_ENDPOINT_URL<ept id=\"p1\">**</ept> 2151481376 (0x803D0020)"},{"content":"The endpoint address URL is not valid.","pos":[5141,5179]},{"content":"The URL must start with “http” or “https”.","pos":[5180,5222]},{"content":"<bpt id=\"p1\">**</bpt>ReportStatus:<ept id=\"p1\">**</ept> Reads the compliance status of the volume and sends it to the MBAM compliance status database by using the MBAM status reporting service.","pos":[5229,5384]},{"content":"The status includes cipher strength, protector type, protector state and encryption state.","pos":[5385,5475]},{"content":"If it fails, an error code is returned for troubleshooting.","pos":[5476,5535]},{"content":"Parameter","pos":[5545,5554]},{"content":"Description","pos":[5557,5568]},{"content":"ReportingServiceEndPoint","pos":[5607,5631]},{"content":"A string specifying the MBAM status reporting service endpoint.","pos":[5634,5697]},{"content":"Here are a list of common error messages:","pos":[5707,5748]},{"content":"Common return values","pos":[5758,5778]},{"content":"Error message","pos":[5781,5794]},{"content":"S_OK","pos":[5848,5852]},{"content":"0 (0x0)","pos":[5861,5868]},{"content":"The method was successful","pos":[5871,5896]},{"content":"WS_E_ENDPOINT_ACCESS_DENIED","pos":[5906,5933]},{"content":"2151481349 (0x803D0005)","pos":[5941,5964]},{"content":"Access was denied by the remote endpoint.","pos":[5967,6008]},{"content":"WS_E_ENDPOINT_NOT_FOUND","pos":[6017,6040]},{"content":"2151481357 (0x803D000D)","pos":[6048,6071]},{"content":"The remote endpoint does not exist or could not be located.","pos":[6074,6133]},{"content":"WS_E_ENDPOINT_FAILURE","pos":[6143,6164]},{"content":"2151481357 (0x803D000F)","pos":[6173,6196]},{"content":"The remote endpoint could not process the request.","pos":[6199,6249]},{"content":"WS_E_ENDPOINT_UNREACHABLE","pos":[6259,6284]},{"content":"2151481360 (0x803D0010)","pos":[6292,6315]},{"content":"The remote endpoint was not reachable.","pos":[6318,6356]},{"content":"WS_E_ENDPOINT_FAULT_RECEIVED","pos":[6366,6394]},{"content":"2151481363 (0x803D0013)","pos":[6402,6425]},{"content":"A message containing a fault was received from the remote endpoint.","pos":[6428,6495]},{"content":"Make sure you are connecting to the correct service endpoint.","pos":[6496,6557]},{"content":"WS_E_INVALID_ENDPOINT_URL","pos":[6567,6592]},{"content":"2151481376 (0x803D0020)","pos":[6600,6623]},{"content":"The endpoint address URL is not valid.","pos":[6626,6664]},{"content":"The URL must start with “http” or “https”.","pos":[6665,6707]},{"content":"MBAM<ph id=\"ph1\">\\_</ph>Volume WMI Class","pos":[6758,6780]},{"content":"<bpt id=\"p1\">   **</bpt>EscrowRecoveryKey:<ept id=\"p1\">**</ept> Reads the recovery numerical password and key package of the volume and sends them to the MBAM recovery database by using the MBAM recovery service.","pos":[6785,6959]},{"content":"If it fails, an error code is returned for troubleshooting.","pos":[6960,7019]},{"content":"Parameter","pos":[7029,7038]},{"content":"Description","pos":[7041,7052]},{"content":"RecoveryServiceEndPoint","pos":[7091,7114]},{"content":"A string specifying the MBAM recovery service endpoint.","pos":[7117,7172]},{"content":"Here are a list of common error messages:","pos":[7182,7223]},{"content":"Common return values","pos":[7233,7253]},{"content":"Error message","pos":[7256,7269]},{"content":"S_OK","pos":[7323,7327]},{"content":"0 (0x0)","pos":[7335,7342]},{"content":"The method was successful","pos":[7345,7370]},{"content":"FVE_E_LOCKED_VOLUME","pos":[7380,7399]},{"content":"2150694912 (0x80310000)","pos":[7407,7430]},{"content":"The volume is locked.","pos":[7433,7454]},{"content":"FVE_E_PROTECTOR_NOT_FOUND","pos":[7464,7489]},{"content":"2150694963 (0x80310033)","pos":[7497,7520]},{"content":"A Numerical Password protector was not found for the volume.","pos":[7523,7583]},{"content":"WS_E_ENDPOINT_ACCESS_DENIED","pos":[7594,7621]},{"content":"2151481349 (0x803D0005)","pos":[7629,7652]},{"content":"Access was denied by the remote endpoint.","pos":[7655,7696]},{"content":"WS_E_ENDPOINT_NOT_FOUND","pos":[7706,7729]},{"content":"2151481357 (0x803D000D)","pos":[7737,7760]},{"content":"The remote endpoint does not exist or could not be located.","pos":[7763,7822]},{"content":"WS_E_ENDPOINT_FAILURE","pos":[7832,7853]},{"content":"2151481357 (0x803D000F)","pos":[7861,7884]},{"content":"The remote endpoint could not process the request.","pos":[7887,7937]},{"content":"WS_E_ENDPOINT_UNREACHABLE","pos":[7947,7972]},{"content":"2151481360 (0x803D0010)","pos":[7980,8003]},{"content":"The remote endpoint was not reachable.","pos":[8006,8044]},{"content":"WS_E_ENDPOINT_FAULT_RECEIVED","pos":[8054,8082]},{"content":"2151481363 (0x803D0013)","pos":[8090,8113]},{"content":"A message containing a fault was received from the remote endpoint.","pos":[8116,8183]},{"content":"Make sure you are connecting to the correct service endpoint.","pos":[8184,8245]},{"content":"WS_E_INVALID_ENDPOINT_URL","pos":[8255,8280]},{"content":"2151481376 (0x803D0020)","pos":[8288,8311]},{"content":"The endpoint address URL is not valid.","pos":[8314,8352]},{"content":"The URL must start with “http” or “https”.","pos":[8353,8395]},{"content":"Deploy MBAM by using Microsoft Deployment Toolkit (MDT) and PowerShell","pos":[8411,8481]},{"content":"In MDT, create a new deployment share or open an existing deployment share.","pos":[8493,8568]},{"pos":[8578,8827],"content":"**Note**  \nThe `Invoke-MbamClientDeployment.ps1` PowerShell script can be used with any imaging process or tool. This section shows how to integrate it by using MDT, but the steps are similar to integrating it with any other process or tool.","leadings":["","        "],"nodes":[{"content":"Note","pos":[2,6]},{"content":"The `Invoke-MbamClientDeployment.ps1` PowerShell script can be used with any imaging process or tool. This section shows how to integrate it by using MDT, but the steps are similar to integrating it with any other process or tool.","pos":[11,241],"nodes":[{"content":"The <ph id=\"ph1\">`Invoke-MbamClientDeployment.ps1`</ph> PowerShell script can be used with any imaging process or tool.","pos":[0,101]},{"content":"This section shows how to integrate it by using MDT, but the steps are similar to integrating it with any other process or tool.","pos":[102,230]}]}]},{"pos":[8837,9197],"content":"**Caution**  \nIf you are using BitLocker pre-provisioning (WinPE) and want to maintain the TPM owner authorization value, you must add the `SaveWinPETpmOwnerAuth.wsf` script in WinPE immediately before the installation reboots into the full operating system. **If you do not use this script, you will lose the TPM owner authorization value on reboot.**","leadings":["","        "],"nodes":[{"content":"Caution","pos":[2,9]},{"content":"If you are using BitLocker pre-provisioning (WinPE) and want to maintain the TPM owner authorization value, you must add the `SaveWinPETpmOwnerAuth.wsf` script in WinPE immediately before the installation reboots into the full operating system. **If you do not use this script, you will lose the TPM owner authorization value on reboot.**","pos":[14,352],"nodes":[{"content":"If you are using BitLocker pre-provisioning (WinPE) and want to maintain the TPM owner authorization value, you must add the <ph id=\"ph1\">`SaveWinPETpmOwnerAuth.wsf`</ph> script in WinPE immediately before the installation reboots into the full operating system.","pos":[0,244]},{"content":"If you do not use this script, you will lose the TPM owner authorization value on reboot.","pos":[247,336]}]}]},{"content":"Copy <ph id=\"ph1\">`Invoke-MbamClientDeployment.ps1`</ph> to <bpt id=\"p1\">**</bpt><ph id=\"ph2\">&amp;lt;</ph>DeploymentShare<ph id=\"ph3\">&amp;gt;\\\\</ph>Scripts<ept id=\"p1\">**</ept>.","pos":[9215,9294]},{"content":"If you are using pre-provisioning, copy the <ph id=\"ph1\">`SaveWinPETpmOwnerAuth.wsf`</ph> file into <bpt id=\"p1\">**</bpt><ph id=\"ph2\">&amp;lt;</ph>DeploymentShare<ph id=\"ph3\">&amp;gt;\\\\</ph>Scripts<ept id=\"p1\">**</ept>.","pos":[9295,9414]},{"content":"Add the MBAM 2.5 SP1 client application to the Applications node in the deployment share.","pos":[9424,9513]},{"pos":[9527,9586],"content":"Under the <bpt id=\"p1\">**</bpt>Applications<ept id=\"p1\">**</ept> node, click <bpt id=\"p2\">**</bpt>New Application<ept id=\"p2\">**</ept>."},{"content":"Select <bpt id=\"p1\">**</bpt>Application with Source Files<ept id=\"p1\">**</ept>.","pos":[9600,9641]},{"content":"Click <bpt id=\"p1\">**</bpt>Next<ept id=\"p1\">**</ept>.","pos":[9642,9657]},{"content":"In <bpt id=\"p1\">**</bpt>Application Name<ept id=\"p1\">**</ept>, type “MBAM 2.5 SP1 Client”.","pos":[9671,9723]},{"content":"Click <bpt id=\"p1\">**</bpt>Next<ept id=\"p1\">**</ept>.","pos":[9724,9739]},{"content":"Browse to the directory containing <ph id=\"ph1\">`MBAMClientSetup-&lt;Version&gt;.msi`</ph>.","pos":[9753,9820]},{"content":"Click <bpt id=\"p1\">**</bpt>Next<ept id=\"p1\">**</ept>.","pos":[9821,9836]},{"content":"Type “MBAM 2.5 SP1 Client” as the directory to create.","pos":[9850,9904]},{"content":"Click <bpt id=\"p1\">**</bpt>Next<ept id=\"p1\">**</ept>.","pos":[9905,9920]},{"content":"Enter <ph id=\"ph1\">`msiexec /i MBAMClientSetup-&lt;Version&gt;.msi /quiet`</ph> at the command line.","pos":[9934,10010]},{"content":"Click <bpt id=\"p1\">**</bpt>Next<ept id=\"p1\">**</ept>.","pos":[10011,10026]},{"content":"Accept the remaining defaults to complete the New Application wizard.","pos":[10040,10109]},{"content":"In MDT, right-click the name of the deployment share and click <bpt id=\"p1\">**</bpt>Properties<ept id=\"p1\">**</ept>.","pos":[10119,10197]},{"content":"Click the <bpt id=\"p1\">**</bpt>Rules<ept id=\"p1\">**</ept> tab.","pos":[10198,10222]},{"content":"Add the following lines:","pos":[10223,10247]},{"content":"Click OK to close the window.","pos":[10351,10380]},{"content":"Under the Task Sequences node, edit an existing task sequence used for Windows Deployment.","pos":[10390,10480]},{"content":"If you want, you can create a new task sequence by right-clicking the <bpt id=\"p1\">**</bpt>Task Sequences<ept id=\"p1\">**</ept> node, selecting <bpt id=\"p2\">**</bpt>New Task Sequence<ept id=\"p2\">**</ept>, and completing the wizard.","pos":[10481,10635]},{"pos":[10645,10725],"content":"On the <bpt id=\"p1\">**</bpt>Task Sequence<ept id=\"p1\">**</ept> tab of the selected task sequence, perform these steps:"},{"pos":[10739,10899],"content":"Under the <bpt id=\"p1\">**</bpt>Preinstall<ept id=\"p1\">**</ept> folder, enable the optional task <bpt id=\"p2\">**</bpt>Enable BitLocker (Offline)<ept id=\"p2\">**</ept> if you want BitLocker enabled in WinPE, which encrypts used space only."},{"content":"To persist TPM OwnerAuth when using pre-provisioning, allowing MBAM to escrow it later, do the following:","pos":[10913,11018]},{"pos":[11036,11078],"content":"Find the <bpt id=\"p1\">**</bpt>Install Operating System<ept id=\"p1\">**</ept> step"},{"pos":[11096,11140],"content":"Add a new <bpt id=\"p1\">**</bpt>Run Command Line<ept id=\"p1\">**</ept> step after it"},{"pos":[11158,11197],"content":"Name the step <bpt id=\"p1\">**</bpt>Persist TPM OwnerAuth<ept id=\"p1\">**</ept>"},{"pos":[11215,11238],"content":"Set the command line to"},{"pos":[11307,11377],"content":"In the <bpt id=\"p1\">**</bpt>State Restore<ept id=\"p1\">**</ept> folder, delete the <bpt id=\"p2\">**</bpt>Enable BitLocker<ept id=\"p2\">**</ept> task."},{"content":"In the <bpt id=\"p1\">**</bpt>State Restore<ept id=\"p1\">**</ept> folder under <bpt id=\"p2\">**</bpt>Custom Tasks<ept id=\"p2\">**</ept>, create a new <bpt id=\"p3\">**</bpt>Install Application<ept id=\"p3\">**</ept> task and name it <bpt id=\"p4\">**</bpt>Install MBAM Agent<ept id=\"p4\">**</ept>.","pos":[11391,11524]},{"content":"Click the <bpt id=\"p1\">**</bpt>Install Single Application<ept id=\"p1\">**</ept> radio button and browse to the MBAM 2.5 SP1 client application created earlier.","pos":[11525,11645]},{"pos":[11659,11896],"content":"In the <bpt id=\"p1\">**</bpt>State Restore<ept id=\"p1\">**</ept> folder under <bpt id=\"p2\">**</bpt>Custom Tasks<ept id=\"p2\">**</ept>, create a new <bpt id=\"p3\">**</bpt>Run PowerShell Script<ept id=\"p3\">**</ept> task (after the MBAM 2.5 SP1 Client application step) with the following settings (update the parameters as appropriate for your environment):"},{"content":"Name: Configure BitLocker for MBAM","pos":[11914,11948]},{"pos":[11966,11984],"content":"PowerShell script:"},{"content":"Parameters:","pos":[12036,12047]},{"pos":[12065,14916],"content":"<table>\n<colgroup>\n<col width=\"33%\" />\n<col width=\"33%\" />\n<col width=\"33%\" />\n</colgroup>\n<tbody>\n<tr class=\"odd\">\n<td align=\"left\"><p>-RecoveryServiceEndpoint</p></td>\n<td align=\"left\"><p>Required</p></td>\n<td align=\"left\"><p>MBAM recovery service endpoint</p></td>\n</tr>\n<tr class=\"even\">\n<td align=\"left\"><p>-StatusReportingServiceEndpoint</p></td>\n<td align=\"left\"><p>Optional</p></td>\n<td align=\"left\"><p>MBAM status reporting service endpoint</p></td>\n</tr>\n<tr class=\"odd\">\n<td align=\"left\"><p>-EncryptionMethod</p></td>\n<td align=\"left\"><p>Optional</p></td>\n<td align=\"left\"><p>Encryption method (default: AES 128)</p></td>\n</tr>\n<tr class=\"even\">\n<td align=\"left\"><p>-EncryptAndEscrowDataVolume</p></td>\n<td align=\"left\"><p>Switch</p></td>\n<td align=\"left\"><p>Specify to encrypt data volume(s) and escrow data volume recovery key(s)</p></td>\n</tr>\n<tr class=\"odd\">\n<td align=\"left\"><p>-WaitForEncryptionToComplete</p></td>\n<td align=\"left\"><p>Switch</p></td>\n<td align=\"left\"><p>Specify to wait for the encryption to complete</p></td>\n</tr>\n<tr class=\"even\">\n<td align=\"left\"><p>-DoNotResumeSuspendedEncryption</p></td>\n<td align=\"left\"><p>Switch</p></td>\n<td align=\"left\"><p>Specify that the deployment script will not resume suspended encryption</p></td>\n</tr>\n<tr class=\"odd\">\n<td align=\"left\"><p>-IgnoreEscrowOwnerAuthFailure</p></td>\n<td align=\"left\"><p>Switch</p></td>\n<td align=\"left\"><p>Specify to ignore TPM owner-auth escrow failure. It should be used in the scenarios where MBAM is not able to read the TPM owner-auth, e.g. if TPM auto provisioning is enabled</p></td>\n</tr>\n<tr class=\"even\">\n<td align=\"left\"><p>-IgnoreEscrowRecoveryKeyFailure</p></td>\n<td align=\"left\"><p>Switch</p></td>\n<td align=\"left\"><p>Specify to ignore volume recovery key escrow failure</p></td>\n</tr>\n<tr class=\"odd\">\n<td align=\"left\"><p>-IgnoreReportStatusFailure</p></td>\n<td align=\"left\"><p>Switch</p></td>\n<td align=\"left\"><p>Specify to ignore status reporting failure</p></td>\n</tr>\n</tbody>\n</table>","leadings":["","                ","                ","                ","                ","                ","                ","                ","                ","                ","                ","                ","                ","                ","                ","                ","                ","                ","                ","                ","                ","                ","                ","                ","                ","                ","                ","                ","                ","                ","                ","                ","                ","                ","                ","                ","                ","                ","                ","                ","                ","                ","                ","                ","                ","                ","                ","                ","                ","                ","                ","                ","                ","                "],"nodes":[{"content":"-RecoveryServiceEndpoint","pos":[136,160]},{"content":"Required","pos":[190,198]},{"content":"MBAM recovery service endpoint","pos":[228,258]},{"content":"-StatusReportingServiceEndpoint","pos":[312,343]},{"content":"Optional","pos":[373,381]},{"content":"MBAM status reporting service endpoint","pos":[411,449]},{"content":"-EncryptionMethod","pos":[502,519]},{"content":"Optional","pos":[549,557]},{"content":"Encryption method (default: AES 128)","pos":[587,623]},{"content":"-EncryptAndEscrowDataVolume","pos":[677,704]},{"content":"Switch","pos":[734,740]},{"content":"Specify to encrypt data volume(s) and escrow data volume recovery key(s)","pos":[770,842]},{"content":"-WaitForEncryptionToComplete","pos":[895,923]},{"content":"Switch","pos":[953,959]},{"content":"Specify to wait for the encryption to complete","pos":[989,1035]},{"content":"-DoNotResumeSuspendedEncryption","pos":[1089,1120]},{"content":"Switch","pos":[1150,1156]},{"content":"Specify that the deployment script will not resume suspended encryption","pos":[1186,1257]},{"content":"-IgnoreEscrowOwnerAuthFailure","pos":[1310,1339]},{"content":"Switch","pos":[1369,1375]},{"content":"Specify to ignore TPM owner-auth escrow failure. It should be used in the scenarios where MBAM is not able to read the TPM owner-auth, e.g. if TPM auto provisioning is enabled","pos":[1405,1580],"nodes":[{"content":"Specify to ignore TPM owner-auth escrow failure.","pos":[0,48]},{"content":"It should be used in the scenarios where MBAM is not able to read the TPM owner-auth, e.g. if TPM auto provisioning is enabled","pos":[49,175]}]},{"content":"-IgnoreEscrowRecoveryKeyFailure","pos":[1634,1665]},{"content":"Switch","pos":[1695,1701]},{"content":"Specify to ignore volume recovery key escrow failure","pos":[1731,1783]},{"content":"-IgnoreReportStatusFailure","pos":[1836,1862]},{"content":"Switch","pos":[1892,1898]},{"content":"Specify to ignore status reporting failure","pos":[1928,1970]}]},{"content":"To enable BitLocker using MBAM 2.5 or earlier as part of a Windows deployment","pos":[14939,15016]},{"content":"Install the MBAM Client.","pos":[15024,15048]},{"content":"For instructions, see <bpt id=\"p1\">[</bpt>How to Deploy the MBAM Client by Using a Command Line<ept id=\"p1\">](how-to-deploy-the-mbam-client-by-using-a-command-line.md)</ept>.","pos":[15049,15185]},{"content":"Join the computer to a domain (recommended).","pos":[15191,15235]},{"content":"If the computer is not joined to a domain, the recovery password is not stored in the MBAM Key Recovery service.","pos":[15245,15357]},{"content":"By default, MBAM does not allow encryption to occur unless the recovery key can be stored.","pos":[15358,15448]},{"content":"If a computer starts in recovery mode before the recovery key is stored on the MBAM Server, no recovery method is available, and the computer has to be reimaged.","pos":[15458,15619]},{"content":"Open a command prompt as an administrator, and stop the MBAM service.","pos":[15625,15694]},{"pos":[15700,15780],"content":"Set the service to <bpt id=\"p1\">**</bpt>Manual<ept id=\"p1\">**</ept> or <bpt id=\"p2\">**</bpt>On demand<ept id=\"p2\">**</ept> by typing the following commands:"},{"content":"net stop mbamagent","pos":[15788,15806]},{"content":"sc config mbamagent start= demand","pos":[15816,15849]},{"content":"Set the registry values so that the MBAM Client ignores the Group Policy settings and instead sets encryption to start the time Windows is deployed to that client computer.","pos":[15857,16029]},{"pos":[16035,16349],"content":"**Caution**  \nThis step describes how to modify the Windows registry. Using Registry Editor incorrectly can cause serious issues that can require you to reinstall Windows. We cannot guarantee that issues resulting from the incorrect use of Registry Editor can be resolved. Use Registry Editor at your own risk.","leadings":["","    "],"nodes":[{"content":"Caution","pos":[2,9]},{"content":"This step describes how to modify the Windows registry. Using Registry Editor incorrectly can cause serious issues that can require you to reinstall Windows. We cannot guarantee that issues resulting from the incorrect use of Registry Editor can be resolved. Use Registry Editor at your own risk.","pos":[14,310],"nodes":[{"content":"This step describes how to modify the Windows registry.","pos":[0,55]},{"content":"Using Registry Editor incorrectly can cause serious issues that can require you to reinstall Windows.","pos":[56,157]},{"content":"We cannot guarantee that issues resulting from the incorrect use of Registry Editor can be resolved.","pos":[158,258]},{"content":"Use Registry Editor at your own risk.","pos":[259,296]}]}]},{"pos":[16359,16548],"content":"Set the TPM for <bpt id=\"p1\">**</bpt>Operating system only encryption<ept id=\"p1\">**</ept>, run Regedit.exe, and then import the registry key template from C:<ph id=\"ph1\">\\\\</ph>Program Files<ph id=\"ph2\">\\\\</ph>Microsoft<ph id=\"ph3\">\\\\</ph>MDOP MBAM<ph id=\"ph4\">\\\\</ph>MBAMDeploymentKeyTemplate.reg."},{"content":"In Regedit.exe, go to HKLM<ph id=\"ph1\">\\\\</ph>SOFTWARE<ph id=\"ph2\">\\\\</ph>Microsoft<ph id=\"ph3\">\\\\</ph>MBAM, and configure the settings that are listed in the following table.","pos":[16558,16679]},{"pos":[16689,16834],"content":"**Note**  \nYou can set Group Policy settings or registry values related to MBAM here. These settings will override previously set values.","leadings":["","        "],"nodes":[{"content":"Note","pos":[2,6]},{"content":"You can set Group Policy settings or registry values related to MBAM here. These settings will override previously set values.","pos":[11,137],"nodes":[{"content":"You can set Group Policy settings or registry values related to MBAM here.","pos":[0,74]},{"content":"These settings will override previously set values.","pos":[75,126]}]}]},{"pos":[16852,16897],"content":"Registry entry Configuration settings","leadings":["","        "]},{"content":"DeploymentTime","pos":[16907,16921]},{"content":"0 = Off","pos":[16931,16938]},{"content":"1 = Use deployment time policy settings (default) – use this setting to enable encryption at the time Windows is deployed to the client computer.","pos":[16948,17093]},{"content":"UseKeyRecoveryService","pos":[17103,17124]},{"content":"0 = Do not use key escrow (the next two registry entries are not required in this case)","pos":[17134,17221]},{"content":"1 = Use key escrow in Key Recovery system (default)","pos":[17231,17282]},{"content":"This is the recommended setting, which enables MBAM to store the recovery keys.","pos":[17292,17371]},{"content":"The computer must be able to communicate with the MBAM Key Recovery service.","pos":[17372,17448]},{"content":"Verify that the computer can communicate with the service before you proceed.","pos":[17449,17526]},{"content":"KeyRecoveryOptions","pos":[17536,17554]},{"content":"0 = Uploads Recovery Key only","pos":[17564,17593]},{"content":"1 = Uploads Recovery Key and Key Recovery Package (default)","pos":[17603,17662]},{"content":"KeyRecoveryServiceEndPoint","pos":[17672,17698]},{"content":"Set this value to the URL for the server running the Key Recovery service, for example, http://<ph id=\"ph1\">&amp;lt;</ph>computer name<ph id=\"ph2\">&amp;gt;</ph>/MBAMRecoveryAndHardwareService/CoreService.svc.","pos":[17708,17872]},{"content":"The MBAM Client will restart the system during the MBAM Client deployment.","pos":[17879,17953]},{"content":"When you are ready for this restart, run the following command at a command prompt as an administrator:","pos":[17954,18057]},{"content":"net start mbamagent","pos":[18065,18084]},{"content":"When the computers restarts, and the BIOS prompts you, accept the TPM change.","pos":[18092,18169]},{"pos":[18175,18421],"content":"During the Windows client operating system imaging process, when you are ready to start encryption, open a command prompt as an administrator, and type the following commands to set the start to <bpt id=\"p1\">**</bpt>Automatic<ept id=\"p1\">**</ept> and to restart the MBAM Client agent:"},{"content":"sc config mbamagent start= auto","pos":[18429,18460]},{"content":"net start mbamagent","pos":[18470,18489]},{"content":"To delete the bypass registry values, run Regedit.exe, and go to the HKLM<ph id=\"ph1\">\\\\</ph>SOFTWARE<ph id=\"ph2\">\\\\</ph>Microsoft registry entry.","pos":[18497,18607]},{"content":"Right-click the <bpt id=\"p1\">**</bpt>MBAM<ept id=\"p1\">**</ept> node, and then click <bpt id=\"p2\">**</bpt>Delete<ept id=\"p2\">**</ept>.","pos":[18608,18665]},{"content":"Related topics","pos":[18670,18684]},{"content":"Deploying the MBAM 2.5 Client","pos":[18687,18716]},{"content":"Planning for MBAM 2.5 Client Deployment","pos":[18753,18792]}],"content":"---\ntitle: How to Enable BitLocker by Using MBAM as Part of a Windows Deployment\ndescription: How to Enable BitLocker by Using MBAM as Part of a Windows Deployment\nauthor: jamiejdt\nms.assetid: 7609ad7a-bb06-47be-b186-0a2db787c8a5\nms.pagetype: mdop, security\nms.mktglfcycl: manage\nms.sitesec: library\nms.prod: w10\n---\n\n\n# How to Enable BitLocker by Using MBAM as Part of a Windows Deployment\n\n\nThis topic explains how to enable BitLocker on an end user's computer by using MBAM as part of your Windows imaging and deployment process.\n\n**Prerequisites:**\n\n-   An existing Windows image deployment process – Microsoft Deployment Toolkit (MDT), Microsoft System Center Configuration Manager, or some other imaging tool or process – must be in place\n\n-   TPM must be enabled in the BIOS and visible to the OS\n\n-   MBAM server infrastructure must be in place and accessible\n\n-   The system partition required by BitLocker must be created\n\n-   The machine must be domain joined during imaging before MBAM fully enables BitLocker\n\n**To enable BitLocker using MBAM 2.5 SP1 as part of a Windows deployment**\n\n1.  In MBAM 2.5 SP1, the recommended approach to enable BitLocker during a Windows Deployment is by using the `Invoke-MbamClientDeployment.ps1` PowerShell script.\n\n    -   The `Invoke-MbamClientDeployment.ps1` script enacts BitLocker during the imaging process. When required by BitLocker policy, the MBAM agent immediately prompts the domain user to create a PIN or password when the domain user first logs on after imaging.\n\n    -   Easy to use with MDT, System Center Configuration Manager, or standalone imaging processes\n\n    -   Compatible with PowerShell 2.0 or higher\n\n    -   Encrypt OS volume with TPM key protector\n\n    -   Fully support BitLocker pre-provisioning\n\n    -   Optionally encrypt FDDs\n\n    -   Escrow TPM OwnerAuth, even on Windows 8 or higher (MBAM still must own the TPM on Windows 7 for escrow to occur)\n\n    -   Escrow recovery keys and recovery key packages\n\n    -   Report encryption status immediately\n\n    -   New WMI providers\n\n    -   Detailed logging\n\n    -   Robust error handling\n\n   You can download the `Invoke-MbamClientDeployment.ps1` script from [Microsoft.com Download Center](https://www.microsoft.com/download/details.aspx?id=48698). This is the main script that your deployment system will call to configure BitLocker drive encryption and record recovery keys with the MBAM Server.\n\n   **WMI deployment methods for MBAM:** The following WMI methods have been added in MBAM 2.5 SP1 to support enabling BitLocker by using the `Invoke-MbamClientDeployment.ps1` PowerShell script.\n\n   <a href=\"\" id=\"mbam-machine-wmi-class\"></a>**MBAM\\_Machine WMI Class**  \n   **PrepareTpmAndEscrowOwnerAuth:** Reads the TPM OwnerAuth and sends it to the MBAM recovery database by using the MBAM recovery service. If the TPM is not owned and auto-provisioning is not on, it generates a TPM OwnerAuth and takes ownership. If it fails, an error code is returned for troubleshooting.\n\n| Parameter | Description |\n| -------- | ----------- |\n| RecoveryServiceEndPoint | A string specifying the MBAM recovery service endpoint. |\n\nHere are a list of common error messages:\n\n| Common return values | Error message |\n| -------------------- | ------------- |\n|  **S_OK**<br />0 (0x0) | The method was successful. |\n| **MBAM_E_TPM_NOT_PRESENT**<br />2147746304 (0x80040200) | TPM is not present in the computer or is disabled in the BIOS configuration. |\n| **MBAM_E_TPM_INCORRECT_STATE**<br />2147746305 (0x80040201) | TPM is not in the correct state (enabled, activated and owner installation allowed). |\n| **MBAM_E_TPM_AUTO_PROVISIONING_PENDING**<br />2147746306 (0x80040202) | MBAM cannot take ownership of TPM because auto-provisioning is pending. Try again after auto-provisioning is completed. |\n| **MBAM_E_TPM_OWNERAUTH_READFAIL**<br />2147746307 (0x80040203) | MBAM cannot read the TPM owner authorization value. The value might have been removed after a successful escrow. On Windows 7, MBAM cannot read the value if the TPM is owned by others. |\n| **MBAM_E_REBOOT_REQUIRED**<br />2147746308 (0x80040204) | The computer must be restarted to set TPM to the correct state. You might need to manually reboot the computer. |\n| **MBAM_E_SHUTDOWN_REQUIRED**<br />2147746309 (0x80040205) | The computer must be shut down and turned back on to set TPM to the correct state. You might need to manually reboot the computer. |\n| **WS_E_ENDPOINT_ACCESS_DENIED**<br />2151481349 (0x803D0005) | Access was denied by the remote endpoint. |\n| **WS_E_ENDPOINT_NOT_FOUND**<br />2151481357 (0x803D000D) | The remote endpoint does not exist or could not be located. |\n| **WS_E_ENDPOINT_FAILURE<br />2151481357 (0x803D000F) | The remote endpoint could not process the request. |\n| **WS_E_ENDPOINT_UNREACHABLE**<br />2151481360 (0x803D0010) | The remote endpoint was not reachable. |\n| **WS_E_ENDPOINT_FAULT_RECEIVED**<br />2151481363 (0x803D0013) | A message containing a fault was received from the remote endpoint. Make sure you are connecting to the correct service endpoint. |\n| **WS_E_INVALID_ENDPOINT_URL** 2151481376 (0x803D0020) | The endpoint address URL is not valid. The URL must start with “http” or “https”. |\n\n   **ReportStatus:** Reads the compliance status of the volume and sends it to the MBAM compliance status database by using the MBAM status reporting service. The status includes cipher strength, protector type, protector state and encryption state. If it fails, an error code is returned for troubleshooting.\n   \n   | Parameter | Description |\n   | --------- | ----------- |\n   | ReportingServiceEndPoint | A string specifying the MBAM status reporting service endpoint. |\n   \n   Here are a list of common error messages:\n   \n   | Common return values | Error message |\n   | -------------------- | ------------- |\n   | **S_OK**<br /> 0 (0x0) | The method was successful |\n   | **WS_E_ENDPOINT_ACCESS_DENIED**<br />2151481349 (0x803D0005) | Access was denied by the remote endpoint.|\n   | **WS_E_ENDPOINT_NOT_FOUND**<br />2151481357 (0x803D000D) | The remote endpoint does not exist or could not be located. |\n   | **WS_E_ENDPOINT_FAILURE**<br /> 2151481357 (0x803D000F) | The remote endpoint could not process the request. |\n   | **WS_E_ENDPOINT_UNREACHABLE**<br />2151481360 (0x803D0010) | The remote endpoint was not reachable. |\n   | **WS_E_ENDPOINT_FAULT_RECEIVED**<br />2151481363 (0x803D0013) | A message containing a fault was received from the remote endpoint. Make sure you are connecting to the correct service endpoint. |\n   | **WS_E_INVALID_ENDPOINT_URL**<br />2151481376 (0x803D0020) | The endpoint address URL is not valid. The URL must start with “http” or “https”. |\n\n   <a href=\"\" id=\"mbam-volume-wmi-class\"></a>**MBAM\\_Volume WMI Class**  \n   **EscrowRecoveryKey:** Reads the recovery numerical password and key package of the volume and sends them to the MBAM recovery database by using the MBAM recovery service. If it fails, an error code is returned for troubleshooting.\n   \n   | Parameter | Description |\n   | --------- | ----------- |\n   | RecoveryServiceEndPoint | A string specifying the MBAM recovery service endpoint. |\n   \n   Here are a list of common error messages:\n   \n   | Common return values | Error message |\n   | -------------------- | ------------- |\n   | **S_OK**<br />0 (0x0) | The method was successful |\n   | **FVE_E_LOCKED_VOLUME**<br />2150694912 (0x80310000) | The volume is locked. |\n   | **FVE_E_PROTECTOR_NOT_FOUND**<br />2150694963 (0x80310033) | A Numerical Password protector was not found for the volume. | \n   | **WS_E_ENDPOINT_ACCESS_DENIED**<br />2151481349 (0x803D0005) | Access was denied by the remote endpoint. |\n   | **WS_E_ENDPOINT_NOT_FOUND**<br />2151481357 (0x803D000D) | The remote endpoint does not exist or could not be located. |\n   | **WS_E_ENDPOINT_FAILURE**<br />2151481357 (0x803D000F) | The remote endpoint could not process the request. |\n   | **WS_E_ENDPOINT_UNREACHABLE**<br />2151481360 (0x803D0010) | The remote endpoint was not reachable. |\n   | **WS_E_ENDPOINT_FAULT_RECEIVED**<br />2151481363 (0x803D0013) | A message containing a fault was received from the remote endpoint. Make sure you are connecting to the correct service endpoint. |\n   | **WS_E_INVALID_ENDPOINT_URL**<br />2151481376 (0x803D0020) | The endpoint address URL is not valid. The URL must start with “http” or “https”. |\n     \n\n2.  **Deploy MBAM by using Microsoft Deployment Toolkit (MDT) and PowerShell**\n\n    1.  In MDT, create a new deployment share or open an existing deployment share.\n\n        **Note**  \n        The `Invoke-MbamClientDeployment.ps1` PowerShell script can be used with any imaging process or tool. This section shows how to integrate it by using MDT, but the steps are similar to integrating it with any other process or tool.\n\n        **Caution**  \n        If you are using BitLocker pre-provisioning (WinPE) and want to maintain the TPM owner authorization value, you must add the `SaveWinPETpmOwnerAuth.wsf` script in WinPE immediately before the installation reboots into the full operating system. **If you do not use this script, you will lose the TPM owner authorization value on reboot.**\n        \n    2.  Copy `Invoke-MbamClientDeployment.ps1` to **&lt;DeploymentShare&gt;\\\\Scripts**. If you are using pre-provisioning, copy the `SaveWinPETpmOwnerAuth.wsf` file into **&lt;DeploymentShare&gt;\\\\Scripts**.\n\n    3.  Add the MBAM 2.5 SP1 client application to the Applications node in the deployment share.\n\n        1.  Under the **Applications** node, click **New Application**.\n\n        2.  Select **Application with Source Files**. Click **Next**.\n\n        3.  In **Application Name**, type “MBAM 2.5 SP1 Client”. Click **Next**.\n\n        4.  Browse to the directory containing `MBAMClientSetup-<Version>.msi`. Click **Next**.\n\n        5.  Type “MBAM 2.5 SP1 Client” as the directory to create. Click **Next**.\n\n        6.  Enter `msiexec /i MBAMClientSetup-<Version>.msi /quiet` at the command line. Click **Next**.\n\n        7.  Accept the remaining defaults to complete the New Application wizard.\n\n    4.  In MDT, right-click the name of the deployment share and click **Properties**. Click the **Rules** tab. Add the following lines:\n\n        `SkipBitLocker=YES``BDEInstall=TPM``BDEInstallSuppress=NO``BDEWaitForEncryption=YES`\n\n        Click OK to close the window.\n\n    5.  Under the Task Sequences node, edit an existing task sequence used for Windows Deployment. If you want, you can create a new task sequence by right-clicking the **Task Sequences** node, selecting **New Task Sequence**, and completing the wizard.\n\n        On the **Task Sequence** tab of the selected task sequence, perform these steps:\n\n        1.  Under the **Preinstall** folder, enable the optional task **Enable BitLocker (Offline)** if you want BitLocker enabled in WinPE, which encrypts used space only.\n\n        2.  To persist TPM OwnerAuth when using pre-provisioning, allowing MBAM to escrow it later, do the following:\n\n            1.  Find the **Install Operating System** step\n\n            2.  Add a new **Run Command Line** step after it\n\n            3.  Name the step **Persist TPM OwnerAuth**\n\n            4.  Set the command line to `cscript.exe \"%SCRIPTROOT%/SaveWinPETpmOwnerAuth.wsf\"`\n\n        3.  In the **State Restore** folder, delete the **Enable BitLocker** task.\n\n        4.  In the **State Restore** folder under **Custom Tasks**, create a new **Install Application** task and name it **Install MBAM Agent**. Click the **Install Single Application** radio button and browse to the MBAM 2.5 SP1 client application created earlier.\n\n        5.  In the **State Restore** folder under **Custom Tasks**, create a new **Run PowerShell Script** task (after the MBAM 2.5 SP1 Client application step) with the following settings (update the parameters as appropriate for your environment):\n\n            -   Name: Configure BitLocker for MBAM\n\n            -   PowerShell script: `Invoke-MbamClientDeployment.ps1`\n\n            -   Parameters:\n\n                <table>\n                <colgroup>\n                <col width=\"33%\" />\n                <col width=\"33%\" />\n                <col width=\"33%\" />\n                </colgroup>\n                <tbody>\n                <tr class=\"odd\">\n                <td align=\"left\"><p>-RecoveryServiceEndpoint</p></td>\n                <td align=\"left\"><p>Required</p></td>\n                <td align=\"left\"><p>MBAM recovery service endpoint</p></td>\n                </tr>\n                <tr class=\"even\">\n                <td align=\"left\"><p>-StatusReportingServiceEndpoint</p></td>\n                <td align=\"left\"><p>Optional</p></td>\n                <td align=\"left\"><p>MBAM status reporting service endpoint</p></td>\n                </tr>\n                <tr class=\"odd\">\n                <td align=\"left\"><p>-EncryptionMethod</p></td>\n                <td align=\"left\"><p>Optional</p></td>\n                <td align=\"left\"><p>Encryption method (default: AES 128)</p></td>\n                </tr>\n                <tr class=\"even\">\n                <td align=\"left\"><p>-EncryptAndEscrowDataVolume</p></td>\n                <td align=\"left\"><p>Switch</p></td>\n                <td align=\"left\"><p>Specify to encrypt data volume(s) and escrow data volume recovery key(s)</p></td>\n                </tr>\n                <tr class=\"odd\">\n                <td align=\"left\"><p>-WaitForEncryptionToComplete</p></td>\n                <td align=\"left\"><p>Switch</p></td>\n                <td align=\"left\"><p>Specify to wait for the encryption to complete</p></td>\n                </tr>\n                <tr class=\"even\">\n                <td align=\"left\"><p>-DoNotResumeSuspendedEncryption</p></td>\n                <td align=\"left\"><p>Switch</p></td>\n                <td align=\"left\"><p>Specify that the deployment script will not resume suspended encryption</p></td>\n                </tr>\n                <tr class=\"odd\">\n                <td align=\"left\"><p>-IgnoreEscrowOwnerAuthFailure</p></td>\n                <td align=\"left\"><p>Switch</p></td>\n                <td align=\"left\"><p>Specify to ignore TPM owner-auth escrow failure. It should be used in the scenarios where MBAM is not able to read the TPM owner-auth, e.g. if TPM auto provisioning is enabled</p></td>\n                </tr>\n                <tr class=\"even\">\n                <td align=\"left\"><p>-IgnoreEscrowRecoveryKeyFailure</p></td>\n                <td align=\"left\"><p>Switch</p></td>\n                <td align=\"left\"><p>Specify to ignore volume recovery key escrow failure</p></td>\n                </tr>\n                <tr class=\"odd\">\n                <td align=\"left\"><p>-IgnoreReportStatusFailure</p></td>\n                <td align=\"left\"><p>Switch</p></td>\n                <td align=\"left\"><p>Specify to ignore status reporting failure</p></td>\n                </tr>\n                </tbody>\n                </table>\n\n                 \n\n**To enable BitLocker using MBAM 2.5 or earlier as part of a Windows deployment**\n\n1.  Install the MBAM Client. For instructions, see [How to Deploy the MBAM Client by Using a Command Line](how-to-deploy-the-mbam-client-by-using-a-command-line.md).\n\n2.  Join the computer to a domain (recommended).\n\n    -   If the computer is not joined to a domain, the recovery password is not stored in the MBAM Key Recovery service. By default, MBAM does not allow encryption to occur unless the recovery key can be stored.\n\n    -   If a computer starts in recovery mode before the recovery key is stored on the MBAM Server, no recovery method is available, and the computer has to be reimaged.\n\n3.  Open a command prompt as an administrator, and stop the MBAM service.\n\n4.  Set the service to **Manual** or **On demand** by typing the following commands:\n\n    **net stop mbamagent**\n\n    **sc config mbamagent start= demand**\n\n5.  Set the registry values so that the MBAM Client ignores the Group Policy settings and instead sets encryption to start the time Windows is deployed to that client computer.\n\n    **Caution**  \n    This step describes how to modify the Windows registry. Using Registry Editor incorrectly can cause serious issues that can require you to reinstall Windows. We cannot guarantee that issues resulting from the incorrect use of Registry Editor can be resolved. Use Registry Editor at your own risk.\n\n    1.  Set the TPM for **Operating system only encryption**, run Regedit.exe, and then import the registry key template from C:\\\\Program Files\\\\Microsoft\\\\MDOP MBAM\\\\MBAMDeploymentKeyTemplate.reg.\n\n    2.  In Regedit.exe, go to HKLM\\\\SOFTWARE\\\\Microsoft\\\\MBAM, and configure the settings that are listed in the following table.\n\n        **Note**  \n        You can set Group Policy settings or registry values related to MBAM here. These settings will override previously set values.\n        \n        Registry entry\n        Configuration settings\n\n        DeploymentTime\n\n        0 = Off\n\n        1 = Use deployment time policy settings (default) – use this setting to enable encryption at the time Windows is deployed to the client computer.\n\n        UseKeyRecoveryService\n\n        0 = Do not use key escrow (the next two registry entries are not required in this case)\n\n        1 = Use key escrow in Key Recovery system (default)\n\n        This is the recommended setting, which enables MBAM to store the recovery keys. The computer must be able to communicate with the MBAM Key Recovery service. Verify that the computer can communicate with the service before you proceed.\n\n        KeyRecoveryOptions\n\n        0 = Uploads Recovery Key only\n\n        1 = Uploads Recovery Key and Key Recovery Package (default)\n\n        KeyRecoveryServiceEndPoint\n\n        Set this value to the URL for the server running the Key Recovery service, for example, http://&lt;computer name&gt;/MBAMRecoveryAndHardwareService/CoreService.svc.\n\n\n6.  The MBAM Client will restart the system during the MBAM Client deployment. When you are ready for this restart, run the following command at a command prompt as an administrator:\n\n    **net start mbamagent**\n\n7.  When the computers restarts, and the BIOS prompts you, accept the TPM change.\n\n8.  During the Windows client operating system imaging process, when you are ready to start encryption, open a command prompt as an administrator, and type the following commands to set the start to **Automatic** and to restart the MBAM Client agent:\n\n    **sc config mbamagent start= auto**\n\n    **net start mbamagent**\n\n9.  To delete the bypass registry values, run Regedit.exe, and go to the HKLM\\\\SOFTWARE\\\\Microsoft registry entry. Right-click the **MBAM** node, and then click **Delete**.\n\n## Related topics\n\n[Deploying the MBAM 2.5 Client](deploying-the-mbam-25-client.md)\n\n[Planning for MBAM 2.5 Client Deployment](planning-for-mbam-25-client-deployment.md)\n\n"}