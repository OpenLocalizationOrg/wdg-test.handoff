{"nodes":[{"content":"Appendix PowerShell (Surface Hub)","pos":[11,44]},{"content":"PowerShell scripts to help set up and manage your Microsoft Surface Hub .","pos":[58,131]},{"content":"Appendix: PowerShell (Surface Hub)","pos":[344,378]},{"content":"PowerShell scripts to help set up and manage your Microsoft Surface Hub .","pos":[381,454]},{"content":"PowerShell scripts for Surface Hub admins","pos":[461,502]},{"content":"Create an on-premise account","pos":[534,562]},{"content":"Create a device account using Office 365","pos":[604,644]},{"content":"Account verification script","pos":[681,708]},{"content":"Enable Skype for Business (EnableSfb.ps1)","pos":[750,791]},{"content":"Useful cmdlets","pos":[822,836]},{"content":"Creating a Surface Hub-compatible Exchange ActiveSync policy","pos":[864,924]},{"content":"Allowing device IDs for ActiveSync","pos":[965,999]},{"content":"Auto-accepting and declining meeting requests","pos":[1043,1088]},{"content":"Accepting external meeting requests","pos":[1129,1164]},{"pos":[1196,1311],"content":"You can check online for updated versions at <bpt id=\"p1\">[</bpt>Surface Hub device account scripts<ept id=\"p1\">](http://aka.ms/surfacehubscripts)</ept>."},{"pos":[1355,1404],"content":"PowerShell scripts for Surface Hub administrators"},{"content":"What do the scripts do?","pos":[1407,1430]},{"content":"Create device accounts for setups using pure single-forest on-premises (Microsoft Exchange and Skype 2013 and later only) or online (Microsoft Office 365), that are configured correctly for your Surface Hub.","pos":[1436,1643]},{"content":"Validate existing device accounts for any setup (on-premises, online, or hybrid using Exchange or Lync 2010 or later) to make sure they're compatible with Surface Hub.","pos":[1648,1815]},{"content":"Provide a base template for anyone wanting to create their own device account creation or validation scripts.","pos":[1820,1929]},{"content":"What do you need in order to run the scripts?","pos":[1931,1976]},{"content":"Remote PowerShell access to your organization's domain or tenant, Exchange servers, and Skype for Business servers.","pos":[1982,2097]},{"content":"Admin credentials for your organization's domain or tenant, Exchange servers, and Skype for Business servers.","pos":[2102,2211]},{"content":"<bpt id=\"p1\">**</bpt>Note<ept id=\"p1\">**</ept>  Whether you’re creating a new account or modifying an already-existing account, the validation script will verify that your device account is configured correctly.","pos":[2214,2387]},{"content":"You should always run the validation script before adding a device account to Surface Hub.","pos":[2388,2478]},{"content":"Running the scripts","pos":[2486,2505]},{"content":"The account creation scripts will:","pos":[2508,2542]},{"content":"Ask for administrator credentials","pos":[2548,2581]},{"content":"Create device accounts in your domain/tenant","pos":[2586,2630]},{"content":"Create or assign a Surface Hub-compatible ActiveSync policy to the device account(s)","pos":[2635,2719]},{"content":"Set various attributes for the created account(s) in Exchange and Skype for Business.","pos":[2724,2809]},{"content":"Assign licenses and permissions to the created account(s)","pos":[2814,2871]},{"content":"These are the attributes that are set by the scripts:","pos":[2873,2926]},{"content":"Cmdlet","pos":[3064,3070]},{"content":"Attribute","pos":[3093,3102]},{"content":"Value","pos":[3125,3130]},{"content":"Set-Mailbox","pos":[3196,3207]},{"content":"RoomMailboxPassword","pos":[3237,3256]},{"content":"User-provided","pos":[3286,3299]},{"content":"EnableRoomMailboxAccount","pos":[3383,3407]},{"content":"True","pos":[3437,3441]},{"content":"Type","pos":[3524,3528]},{"content":"Room","pos":[3558,3562]},{"content":"Set-CalendarProcessing","pos":[3616,3638]},{"content":"AutomateProcessing","pos":[3668,3686]},{"content":"AutoAccept","pos":[3716,3726]},{"content":"RemovePrivateProperty","pos":[3809,3830]},{"content":"False","pos":[3860,3865]},{"content":"DeleteSubject","pos":[3949,3962]},{"content":"False","pos":[3992,3997]},{"content":"DeleteComments","pos":[4080,4094]},{"content":"False","pos":[4124,4129]},{"content":"AddOrganizerToSubject","pos":[4213,4234]},{"content":"False","pos":[4264,4269]},{"content":"AddAdditionalResponse","pos":[4352,4373]},{"content":"True","pos":[4403,4407]},{"content":"AdditionalResponse","pos":[4491,4509]},{"content":"This is a Surface Hub room!","pos":[4545,4572]},{"content":"New-MobileDeviceMailboxPolicy","pos":[4631,4660]},{"content":"PasswordEnabled","pos":[4690,4705]},{"content":"False","pos":[4735,4740]},{"content":"AllowNonProvisionableDevices","pos":[4824,4852]},{"content":"True","pos":[4882,4886]},{"content":"Enable-CSMeetingRoom","pos":[4939,4959]},{"content":"RegistrarPool","pos":[4989,5002]},{"content":"User-provided","pos":[5032,5045]},{"content":"SipAddress","pos":[5129,5139]},{"content":"Set to the User Principal Name (UPN) of the device account","pos":[5169,5227]},{"content":"Set-MsolUserLicense (O365 only)","pos":[5280,5311]},{"content":"AddLicenses","pos":[5341,5352]},{"content":"User-provided","pos":[5382,5395]},{"content":"Set-MsolUser (O365 only)","pos":[5449,5473]},{"content":"PasswordNeverExpires","pos":[5503,5523]},{"content":"True","pos":[5553,5557]},{"content":"Set-AdUser (On-prem only)","pos":[5610,5635]},{"content":"Enabled","pos":[5665,5672]},{"content":"True","pos":[5702,5706]},{"content":"Set-AdUser (On-prem only)","pos":[5760,5785]},{"content":"PasswordNeverExpires","pos":[5815,5835]},{"content":"True","pos":[5865,5869]},{"content":"Account creation scripts","pos":[5910,5934]},{"content":"These scripts will create a device account for you.","pos":[5937,5988]},{"content":"You can use the <bpt id=\"p1\">[</bpt>Account verification script<ept id=\"p1\">](#acct-verification-ps-scripts)</ept> to make sure they ran correctly.","pos":[5989,6098]},{"content":"The account creation scripts cannot modify an already existing account, but can be used to help you understand which cmdlets need to be run to configure the existing account correctly.","pos":[6100,6284]},{"pos":[6339,6367],"content":"Create an on-premise account"},{"pos":[6369,6484],"content":"Creates an account as described in <bpt id=\"p1\">[</bpt>On-premises deployment<ept id=\"p1\">](on-premises-deployment-surface-hub-device-accounts.md)</ept>."},{"pos":[18125,18165],"content":"Create a device account using Office 365"},{"pos":[18167,18289],"content":"Creates an account as described in <bpt id=\"p1\">[</bpt>Create a device account using Office 365<ept id=\"p1\">](create-a-device-account-using-office-365.md)</ept>"},{"pos":[32138,32165],"content":"Account verification script"},{"content":"This script will validate the previously-created device account on a Surface Hub, no matter which method was used to create it.","pos":[32168,32295]},{"content":"This script is basically pass/fail.","pos":[32296,32331]},{"content":"If one of the test errors out, it will show a detailed error message, but if all tests pass, the end result will be a summary report.","pos":[32332,32465]},{"content":"For example, you might see:","pos":[32466,32493]},{"content":"Details of specific settings will not be shown.","pos":[32561,32608]},{"pos":[48683,48708],"content":"Enable Skype for Business"},{"content":"This script will enable Skype for Business on a device account.","pos":[48711,48774]},{"content":"Use it only if Skype for Business wasn't previously enabled during account creation.","pos":[48775,48859]},{"content":"Useful cmdlets","pos":[53045,53059]},{"pos":[53114,53165],"content":"Creating a Surface Hub-compatible ActiveSync policy"},{"content":"For Surface Hub to use Exchange services, a device account configured with a compatible ActiveSync policy must be provisioned on the device.","pos":[53167,53307]},{"content":"This policy has the following requirements:","pos":[53308,53351]},{"pos":[53390,53550],"content":"In the following cmdlets, <ph id=\"ph1\">`$strPolicy`</ph> is the name of the ActiveSync policy, and <ph id=\"ph2\">`$strRoomUpn`</ph> is the UPN of the device account you want to apply the policy to."},{"content":"Note that in order to run the cmdlets, you need to set up a remote PowerShell session and:","pos":[53552,53642]},{"content":"Your admin account must be remote-PowerShell-enabled.","pos":[53648,53701]},{"content":"This allows the admin to use the PowerShell cmdlets that are needed by the script.","pos":[53702,53784]},{"content":"(This permission can be set using set-user <ph id=\"ph1\">`$admin -RemotePowerShellEnabled $true`</ph>)","pos":[53785,53868]},{"content":"Your admin account must have the \"Reset Password\" role if you plan to run the creation scripts.","pos":[53873,53968]},{"content":"This allows the admin to change the password of the account, which is needed for the script.","pos":[53969,54061]},{"content":"The Reset Password Role can be enabled using the Exchange Admin Center.","pos":[54062,54133]},{"content":"Create the policy.","pos":[54135,54153]},{"content":"To apply the policy, the mailbox cannot be a room type, so it has to be converted into a user first.","pos":[54331,54431]},{"content":"Now the device account just needs to be converted back into a room type.","pos":[54610,54682]},{"pos":[54824,54858],"content":"Allowing device IDs for ActiveSync"},{"pos":[54860,54921],"content":"To allow an account <ph id=\"ph1\">`$strRoomUpn`</ph>, run the following command:"},{"content":"To find a device's ID, run:","pos":[55014,55041]},{"pos":[55104,55231],"content":"This retrieves device information for every device that the account has been provisioned on, Including the <ph id=\"ph1\">`DeviceId`</ph> property."},{"pos":[55285,55330],"content":"Auto-accepting and declining meeting requests"},{"content":"For a device account to automatically accept or decline meeting requests based on its availability, the <bpt id=\"p1\">**</bpt>AutomateProcessing<ept id=\"p1\">**</ept> attribute must be set to <bpt id=\"p2\">**</bpt>AutoAccept<ept id=\"p2\">**</ept>.","pos":[55332,55499]},{"content":"This is recommended as to prevent overlapping meetings.","pos":[55500,55555]},{"pos":[55694,55729],"content":"Accepting external meeting requests"},{"content":"For a device account to accept external meeting requests (a meeting request from an account not in the same tenant/domain), the device account must be set to allow processing of external meeting requests.","pos":[55731,55935]},{"content":"Once set, the device account will automatically accept or decline meeting requests from external accounts as well as local accounts.","pos":[55936,56068]},{"pos":[56071,56189],"content":"<bpt id=\"p1\">**</bpt>Note<ept id=\"p1\">**</ept>  If the <bpt id=\"p2\">**</bpt>AutomateProcessing<ept id=\"p2\">**</ept> attribute is not set to <bpt id=\"p3\">**</bpt>AutoAccept<ept id=\"p3\">**</ept>, then setting this will have no effect."}],"content":"---\ntitle: Appendix PowerShell (Surface Hub)\ndescription: PowerShell scripts to help set up and manage your Microsoft Surface Hub .\nms.assetid: 3EF48F63-8E4C-4D74-ACD5-461F1C653784\nkeywords: PowerShell, set up Surface Hub, manage Surface Hub\nms.prod: w10\nms.mktglfcycl: manage\nms.sitesec: library\nms.pagetype: surfacehub\nauthor: TrudyHa\n---\n\n# Appendix: PowerShell (Surface Hub)\n\n\nPowerShell scripts to help set up and manage your Microsoft Surface Hub .\n\n-   [PowerShell scripts for Surface Hub admins](#scripts-for-admins)\n    -   [Create an on-premise account](#create-on-premise-ps-scripts)\n    -   [Create a device account using Office 365](#create-os356-ps-scripts)\n    -   [Account verification script](#acct-verification-ps-scripts)\n    -   [Enable Skype for Business (EnableSfb.ps1)](#enable-sfb-ps-scripts)\n-   [Useful cmdlets](#useful-cmdlets)\n    -   [Creating a Surface Hub-compatible Exchange ActiveSync policy](#create-compatible-as-policy)\n    -   [Allowing device IDs for ActiveSync](#whitelisting-device-ids-cmdlet)\n    -   [Auto-accepting and declining meeting requests](#auto-accept-meetings-cmdlet)\n    -   [Accepting external meeting requests](#accept-ext-meetings-cmdlet)\n\nYou can check online for updated versions at [Surface Hub device account scripts](http://aka.ms/surfacehubscripts).\n\n## <a href=\"\" id=\"scripts-for-admins\"></a>PowerShell scripts for Surface Hub administrators\n\n\nWhat do the scripts do?\n\n-   Create device accounts for setups using pure single-forest on-premises (Microsoft Exchange and Skype 2013 and later only) or online (Microsoft Office 365), that are configured correctly for your Surface Hub.\n-   Validate existing device accounts for any setup (on-premises, online, or hybrid using Exchange or Lync 2010 or later) to make sure they're compatible with Surface Hub.\n-   Provide a base template for anyone wanting to create their own device account creation or validation scripts.\n\nWhat do you need in order to run the scripts?\n\n-   Remote PowerShell access to your organization's domain or tenant, Exchange servers, and Skype for Business servers.\n-   Admin credentials for your organization's domain or tenant, Exchange servers, and Skype for Business servers.\n\n>**Note**  Whether you’re creating a new account or modifying an already-existing account, the validation script will verify that your device account is configured correctly. You should always run the validation script before adding a device account to Surface Hub.\n\n \n\n## Running the scripts\n\n\nThe account creation scripts will:\n\n-   Ask for administrator credentials\n-   Create device accounts in your domain/tenant\n-   Create or assign a Surface Hub-compatible ActiveSync policy to the device account(s)\n-   Set various attributes for the created account(s) in Exchange and Skype for Business.\n-   Assign licenses and permissions to the created account(s)\n\nThese are the attributes that are set by the scripts:\n\n<table>\n<colgroup>\n<col width=\"33%\" />\n<col width=\"33%\" />\n<col width=\"33%\" />\n</colgroup>\n<thead>\n<tr class=\"header\">\n<th align=\"left\">Cmdlet</th>\n<th align=\"left\">Attribute</th>\n<th align=\"left\">Value</th>\n</tr>\n</thead>\n<tbody>\n<tr class=\"odd\">\n<td align=\"left\"><p>Set-Mailbox</p></td>\n<td align=\"left\"><p>RoomMailboxPassword</p></td>\n<td align=\"left\"><p>User-provided</p></td>\n</tr>\n<tr class=\"even\">\n<td align=\"left\"><p></p></td>\n<td align=\"left\"><p>EnableRoomMailboxAccount</p></td>\n<td align=\"left\"><p>True</p></td>\n</tr>\n<tr class=\"odd\">\n<td align=\"left\"><p></p></td>\n<td align=\"left\"><p>Type</p></td>\n<td align=\"left\"><p>Room</p></td>\n</tr>\n<tr class=\"even\">\n<td align=\"left\"><p>Set-CalendarProcessing</p></td>\n<td align=\"left\"><p>AutomateProcessing</p></td>\n<td align=\"left\"><p>AutoAccept</p></td>\n</tr>\n<tr class=\"odd\">\n<td align=\"left\"><p></p></td>\n<td align=\"left\"><p>RemovePrivateProperty</p></td>\n<td align=\"left\"><p>False</p></td>\n</tr>\n<tr class=\"even\">\n<td align=\"left\"><p></p></td>\n<td align=\"left\"><p>DeleteSubject</p></td>\n<td align=\"left\"><p>False</p></td>\n</tr>\n<tr class=\"odd\">\n<td align=\"left\"><p></p></td>\n<td align=\"left\"><p>DeleteComments</p></td>\n<td align=\"left\"><p>False</p></td>\n</tr>\n<tr class=\"even\">\n<td align=\"left\"><p></p></td>\n<td align=\"left\"><p>AddOrganizerToSubject</p></td>\n<td align=\"left\"><p>False</p></td>\n</tr>\n<tr class=\"odd\">\n<td align=\"left\"><p></p></td>\n<td align=\"left\"><p>AddAdditionalResponse</p></td>\n<td align=\"left\"><p>True</p></td>\n</tr>\n<tr class=\"even\">\n<td align=\"left\"><p></p></td>\n<td align=\"left\"><p>AdditionalResponse</p></td>\n<td align=\"left\"><p>&quot;This is a Surface Hub room!&quot;</p></td>\n</tr>\n<tr class=\"odd\">\n<td align=\"left\"><p>New-MobileDeviceMailboxPolicy</p></td>\n<td align=\"left\"><p>PasswordEnabled</p></td>\n<td align=\"left\"><p>False</p></td>\n</tr>\n<tr class=\"even\">\n<td align=\"left\"><p></p></td>\n<td align=\"left\"><p>AllowNonProvisionableDevices</p></td>\n<td align=\"left\"><p>True</p></td>\n</tr>\n<tr class=\"odd\">\n<td align=\"left\"><p>Enable-CSMeetingRoom</p></td>\n<td align=\"left\"><p>RegistrarPool</p></td>\n<td align=\"left\"><p>User-provided</p></td>\n</tr>\n<tr class=\"even\">\n<td align=\"left\"><p></p></td>\n<td align=\"left\"><p>SipAddress</p></td>\n<td align=\"left\"><p>Set to the User Principal Name (UPN) of the device account</p></td>\n</tr>\n<tr class=\"odd\">\n<td align=\"left\"><p>Set-MsolUserLicense (O365 only)</p></td>\n<td align=\"left\"><p>AddLicenses</p></td>\n<td align=\"left\"><p>User-provided</p></td>\n</tr>\n<tr class=\"even\">\n<td align=\"left\"><p>Set-MsolUser (O365 only)</p></td>\n<td align=\"left\"><p>PasswordNeverExpires</p></td>\n<td align=\"left\"><p>True</p></td>\n</tr>\n<tr class=\"odd\">\n<td align=\"left\"><p>Set-AdUser (On-prem only)</p></td>\n<td align=\"left\"><p>Enabled</p></td>\n<td align=\"left\"><p>True</p></td>\n</tr>\n<tr class=\"even\">\n<td align=\"left\"><p>Set-AdUser (On-prem only)</p></td>\n<td align=\"left\"><p>PasswordNeverExpires</p></td>\n<td align=\"left\"><p>True</p></td>\n</tr>\n</tbody>\n</table>\n\n \n\n## Account creation scripts\n\n\nThese scripts will create a device account for you. You can use the [Account verification script](#acct-verification-ps-scripts) to make sure they ran correctly.\n\nThe account creation scripts cannot modify an already existing account, but can be used to help you understand which cmdlets need to be run to configure the existing account correctly.\n\n### <a href=\"\" id=\"create-on-premise-ps-scripts\"></a>Create an on-premise account\n\nCreates an account as described in [On-premises deployment](on-premises-deployment-surface-hub-device-accounts.md).\n\n```PowerShell\n# SHAccountCreateOnPrem.ps1\n\n$Error.Clear()\n$ErrorActionPreference = \"Stop\"\n$status = @{}\n\n# Cleans up set state such as remote powershell sessions\nfunction Cleanup()\n{\n    if ($sessExchange)\n    {\n        Remove-PSSession $sessExchange\n    }\n    if ($sessCS)\n    {\n        Remove-PSSession $sessCS\n    }\n}\n\nfunction PrintError($strMsg)\n{\n    Write-Host $strMsg -foregroundcolor Red\n}\n\nfunction PrintSuccess($strMsg)\n{\n    Write-Host $strMsg -foregroundcolor Green\n}\n\nfunction PrintAction($strMsg)\n{\n    Write-Host $strMsg -ForegroundColor Cyan\n}\n\n\n# Cleans up and prints an error message\nfunction CleanupAndFail($strMsg)\n{\n    if ($strMsg)\n    {\n        PrintError($strMsg);\n    }\n    Cleanup\n    exit 1\n}\n\n# Exits if there is an error set and prints the given message\nfunction ExitIfError($strMsg)\n{\n    if ($Error)\n    {\n        CleanupAndFail($strMsg);\n    }\n}\n\n## Collect account data ##\n$credNewAccount = (Get-Credential -Message \"Enter the desired UPN and password for this new account\")\n$strUpn = $credNewAccount.UserName\n$strDisplayName = Read-Host \"Please enter the display name you would like to use for $strUpn\"\nif (!$credNewAccount -Or [System.String]::IsNullOrEmpty($strDisplayName) -Or [System.String]::IsNullOrEmpty($credNewAccount.UserName) -Or $credNewAccount.Password.Length -le 0)\n{\n    CleanupAndFail \"Please enter all of the requested data to continue.\"\n    exit 1\n}\n\n\n## Sign in to remote powershell for exchange and lync online ##\n\n$credExchange = $null\n$credExchange=Get-Credential -Message \"Enter credentials of an Exchange user with mailbox creation rights\"\nif (!$credExchange)\n{\n    CleanupAndFail(\"Valid credentials are required to create and prepare the account.\");\n}\n$strExchangeServer = Read-Host \"Please enter the FQDN of your exchange server (e.g. exch.contoso.com)\"\n\n# Lync info\n$credLync = Get-Credential -Message \"Enter credentials of a Skype for Business admin (or cancel if they are the same as Exchange)\"\nif (!$credLync)\n{\n    $credLync = $credExchange\n}\n$strLyncFQDN = Read-Host \"Please enter the FQDN of your Lync server (e.g. lync.contoso.com) or enter to use [$strExchangeServer]\"\nif ([System.String]::IsNullOrEmpty($strLyncFQDN))\n{\n    $strLyncFQDN = $strExchangeServer\n}\n\n\nPrintAction \"Connecting to remote sessions. This can occasionally take a while - please do not enter input...\"\ntry \n{\n    $sessExchange = New-PSSession -ConfigurationName microsoft.exchange -Credential $credExchange -AllowRedirection -Authentication Kerberos -ConnectionUri \"http://$strExchangeServer/powershell\" -WarningAction SilentlyContinue\n}\ncatch\n{\n    CleanupAndFail(\"Failed to connect to exchange. Please check your credentials and try again. If this continues to fail, you may not have permission for remote powershell - if not, please perform the setup manually. Error message: $_\")\n}\nPrintSuccess \"Connected to Remote Exchange Shell\"\n\ntry\n{\n    $sessLync = New-PSSession -Credential $credLync -ConnectionURI \"https://$strLyncFQDN/OcsPowershell\" -AllowRedirection -WarningAction SilentlyContinue\n}\ncatch\n{\n    CleanupAndFail(\"Failed to connect to Lync. Please check your credentials and try again. Error message: $_\")\n}\nPrintSuccess \"Connected to Lync Server Remote PowerShell\"\n\n\nImport-PSSession $sessExchange -AllowClobber -WarningAction SilentlyContinue\nImport-PSSession $sessLync -AllowClobber -WarningAction SilentlyContinue\n\n# In case there was any uncaught errors\nExitIfError(\"Remote connections failed. Please check your credentials and try again.\")\n\n\n\n## Create the Exchange mailbox ##\n# Note: These exchange commandlets do not always throw their errors as exceptions \n\n# Because Get-Mailbox will throw an error if the mailbox is not found\n$Error.Clear()\nPrintAction \"Creating a new account...\"\ntry\n{\n    $mailbox = $null\n    $mailbox = (New-Mailbox -UserPrincipalName $credNewAccount.UserName -Alias $credNewAccount.UserName.substring(0,$credNewAccount.UserName.indexOf('@')) -room -Name $strDisplayName -RoomMailboxPassword $credNewAccount.Password -EnableRoomMailboxAccount $true)\n} catch { }\nExitIfError \"Failed to create a new mailbox on exchange.\";\n$status[\"Mailbox Setup\"] = \"Successfully created a mailbox for the new account\"\n\n\n$strEmail = $mailbox.WindowsEmailAddress\nPrintSuccess \"The following mailbox has been created for this room: $strEmail\"\n\n\n## Create or retrieve a policy that will be applied to surface hub devices ##\n# The policy disables requiring a device password so that the SurfaceHub does not need to be lockable to use Active Sync\n$strPolicy = Read-Host 'Please enter the name for a new Surface Hub ActiveSync policy that will be created and applied to this account.\nWe will configure that policy to be compatible with Surface Hub devices.\nIf this script has been used before, please enter the name of the existing policy.'\n\n$easpolicy = $null\ntry {\n    $easpolicy = Get-MobileDeviceMailboxPolicy $strPolicy\n}\ncatch {} \n\nif ($easpolicy)\n{\n    if (!$easpolicy.PasswordEnabled -and ($easpolicy.AllowNonProvisionableDevices -eq $null -or $easpolicy.AllowNonProvisionableDevices ))\n    {\n        PrintSuccess \"An existing policy has been found and will be applied to this account.\"\n    }\n    else\n    {\n        PrintError \"The policy you provided is incompatible with the surface hub.\"\n        $easpolicy = $null\n        $status[\"Device Password Policy\"] = \"Failed to apply the EAS policy to the account because the policy was invalid.\"\n    }\n}\nelse\n{\n    $Error.Clear()\n    PrintAction \"Creating policy...\"\n    $easpolicy = New-MobileDeviceMailboxPolicy -Name $strPolicy -PasswordEnabled $false -AllowNonProvisionableDevices $true\n    if ($easpolicy)\n    {\n        PrintSuccess \"A new device policy has been created; you can use this same policy for all future Surface Hub device accounts.\" \n    }\n    else\n    {\n        PrintError \"Could not create $strPolicy\"\n    }\n}\n\nif ($easpolicy)\n{\n    # Convert mailbox to user type so we can apply the policy (necessary)\n    # Sometimes it takes a while for this change to take affect so we have some nasty retry loops\n    $Error.Clear();\n    try\n    {\n        Set-Mailbox $credNewAccount.UserName -Type Regular\n    } catch {}\n    if ($Error)\n    {\n        $Error.Clear()\n        $status[\"Device Password Policy\"] = \"Failed to apply the EAS policy to the account.\"\n    }\n    else\n    {\n        # Loop until resource type goes away, up to 5 times\n        for ($i = 0; $i -lt 5 -And (Get-Mailbox $credNewAccount.UserName).ResourceType; $i++)\n        {\n            Start-Sleep -s 5\n        }\n        # If the mailbox is still a Room we cannot apply the policy\n        if (!((Get-Mailbox $credNewAccount.UserName).ResourceType))\n        {\n            $Error.Clear()\n            # Set policy for account \n            Set-CASMailbox $credNewAccount.UserName -ActiveSyncMailboxPolicy $strPolicy\n            if (!$Error)\n            {\n                $status[\"ActiveSync Policy\"] = \"Successfully applied $strPolicy to the account\"\n            }\n            else\n            {\n                $status[\"ActiveSync Policy\"] = \"Failed to apply the EAS policy to the account.\"\n            }\n            $Error.Clear()\n        \n            # Convert back to room mailbox\n            Set-Mailbox $credNewAccount.UserName -Type Room \n            # Loop until resource type goes back to room\n            for ($i = 0; ($i -lt 5) -And ((Get-Mailbox $credNewAccount.UserName).ResourceType -ne \"Room\"); $i++)\n            {\n                Start-Sleep -s 5\n            }\n            if ((Get-Mailbox $credNewAccount.UserName).ResourceType -ne \"Room\")\n            {\n                # A failure to convert the mailbox back to a room is unfortunate but means the mailbox is unusable. \n                $status[\"Mailbox Setup\"] = \"A mailbox was created but we could not set it to a room resource type.\"\n            }\n            else\n            {\n                try \n                {\n                    Set-Mailbox $credNewAccount.UserName -RoomMailboxPassword $credNewAccount.Password -EnableRoomMailboxAccount $true\n                } catch { }\n                if ($Error)\n                {\n                    $status[\"Mailbox Setup\"] = \"A room mailbox was created but we could not set its password.\"\n                }\n                $Error.Clear()\n            }\n        \n        }\n    }\n}\nPrintSuccess \"Account creation completed.\"\n\nPrintAction \"Setting calendar processing rules...\"\n\n$Error.Clear();\n## Prepare the calendar for automatic meeting responses ##\ntry {\n    Set-CalendarProcessing -Identity $credNewAccount.UserName -AutomateProcessing AutoAccept\n} catch { }\nif ($Error)\n{\n    $status[\"Calendar Acceptance\"] = \"Failed to configure the account to automatically accept/decline meeting requests\"\n}\nelse\n{\n    $status[\"Calendar Acceptance\"] = \"Successfully configured the account to automatically accept/decline meeting requests\"\n}\n\n\n$Error.Clear()\ntry {\n    Set-CalendarProcessing -Identity $credNewAccount.UserName -RemovePrivateProperty $false -AddOrganizerToSubject $false -AddAdditionalResponse $true -DeleteSubject $false -DeleteComments $false -AdditionalResponse \"This is a Surface Hub room!\"\n} catch { }\nif ($Error)\n{\n    $status[\"Calendar Response Configuration\"] = \"Failed to configure the account's response properties\"\n}\nelse\n{\n    $status[\"Calendar Response Configuration\"] = \"Successfully configured the account's response properties\"\n}\n\n$Error.Clear()\n## Configure the Account to not expire ##\nPrintAction \"Configuring password not to expire...\"\nStart-Sleep -s 20\ntry \n{\n    Set-AdUser $mailbox.Alias -PasswordNeverExpires $true -Enabled $true\n}\ncatch\n{\n    \n}\n\nif ($Error)\n{\n    $status[\"Password Expiration Policy\"] = \"Failed to set the password to never expire\"\n}\nelse\n{\n    $status[\"Password Expiration Policy\"] = \"Successfully set the password to never expire\"\n}\n\nPrintSuccess \"Completed Exchange configuration\"\n\n## Setup Skype for Business. This is somewhat optional and if it fails we SfbEnable can be used later ##\nPrintAction \"Configuring account for Skype for Business.\"\n\n# Getting registrar pool\n$strRegPool = $strLyncFQDN\n$Error.Clear()\n$strRegPoolEntry = Read-Host \"Enter a Skype for Business Registrar Pool, or leave blank to use [$strRegPool]\"\nif (![System.String]::IsNullOrEmpty($strRegPoolEntry))\n{\n    $strRegPool = $strRegPoolEntry\n}\n\n# Try to SfB-enable the account. Note that it may not work right away as the account needs to propogate to active directory\nPrintAction \"Enabling Skype for Business...\"\nStart-Sleep -s 10\n$Error.Clear()\ntry {\n    Enable-CsMeetingRoom -Identity $credNewAccount.UserName -RegistrarPool $strRegPool -SipAddressType EmailAddress\n}\ncatch { } \n\nif ($Error)\n{\n    $status[\"Skype for Business Account Setup\"] = \"Failed to setup the Skype for Business meeting room - you can run EnableSfb.ps1 to try again.\"\n    $Error.Clear();\n}\nelse\n{\n    $status[\"Skype for Business Account Setup\"] = \"Successfully enabled account as a Skype for Business meeting room\"\n}\n\nWrite-Host\n\n## Cleanup and print results ##\nCleanup\n$strDisplay = $mailbox.DisplayName\n$strUsr = $credNewAccount.UserName\nPrintAction \"Summary for creation of $strUsr ($strDisplay)\"\nif ($status.Count -gt 0)\n{\n    ForEach($k in $status.Keys) \n    {\n        $v = $status[$k]\n        $color = \"yellow\"\n        if ($v[0] -eq \"S\") { $color = \"green\" }\n        elseif ($v[0] -eq \"F\") \n        {\n            $color = \"red\" \n            $v += \" Go to http://aka.ms/shubtshoot\"\n        }\n\n        Write-Host -NoNewline $k -ForegroundColor $color\n        Write-Host -NoNewline \": \"\n        Write-Host $v\n    }\n}\nelse\n{\n    PrintError \"The account could not be created\"\n}\n```\n\n### <a href=\"\" id=\"create-os356-ps-scripts\"></a>Create a device account using Office 365\n\nCreates an account as described in [Create a device account using Office 365](create-a-device-account-using-office-365.md)\n\n```PowerShell\n# SHAccountCreateO365.ps1\n\n$Error.Clear()\n$ErrorActionPreference = \"Stop\"\n$status = @{}\n\n# Cleans up set state such as remote powershell sessions\nfunction Cleanup()\n{\n    if ($sessExchange)\n    {\n        Remove-PSSession $sessExchange\n    }\n    if ($sessCS)\n    {\n        Remove-PSSession $sessCS\n    }\n}\n\nfunction PrintError($strMsg)\n{\n    Write-Host $strMsg -foregroundcolor Red\n}\n\nfunction PrintSuccess($strMsg)\n{\n    Write-Host $strMsg -foregroundcolor Green\n}\n\nfunction PrintAction($strMsg)\n{\n    Write-Host $strMsg -ForegroundColor Cyan\n}\n\n\n# Cleans up and prints an error message\nfunction CleanupAndFail($strMsg)\n{\n    if ($strMsg)\n    {\n        PrintError($strMsg);\n    }\n    Cleanup\n    exit 1\n}\n\n# Exits if there is an error set and prints the given message\nfunction ExitIfError($strMsg)\n{\n    if ($Error)\n    {\n        CleanupAndFail($strMsg);\n    }\n}\n\n\n## Check dependencies ##\ntry {\n    Import-Module LyncOnlineConnector\n    Import-Module MSOnline\n} \ncatch\n{\n    PrintError \"Some dependencies are missing\"\n    PrintError \"Please install the Windows PowerShell Module for Lync Online. For more information go to http://www.microsoft.com/download/details.aspx?id=39366\" \n    PrintError \"Please install the Azure Active Directory module for PowerShell from http://go.microsoft.com/fwlink/p/?linkid=236297\"\n    CleanupAndFail\n}\n\n\n\n## Collect account data ##\n$credNewAccount = (Get-Credential -Message \"Enter the desired UPN and password for this new account\")\n$strUpn = $credNewAccount.UserName\n$strDisplayName = Read-Host \"Please enter the display name you would like to use for $strUpn\"\nif (!$credNewAccount -Or [System.String]::IsNullOrEmpty($strDisplayName) -Or [System.String]::IsNullOrEmpty($credNewAccount.UserName) -Or $credNewAccount.Password.Length -le 0)\n{\n    CleanupAndFail \"Please enter all of the requested data to continue.\"\n    exit 1\n}\n\n\n## Sign in to remote powershell for exchange and lync online ##\n$credAdmin = $null\n$credAdmin=Get-Credential -Message \"Enter credentials of an Exchange and Skype for Business admin\"\nif (!$credadmin)\n{\n    CleanupAndFail \"Valid admin credentials are required to create and prepare the account.\" \n}\nPrintAction \"Connecting to remote sessions. This can occasionally take a while - please do not enter input...\"\ntry \n{\n    $sessExchange = New-PSSession -ConfigurationName microsoft.exchange -Credential $credAdmin -AllowRedirection -Authentication basic -ConnectionUri \"https://outlook.office365.com/powershell-liveid/\" -WarningAction SilentlyContinue\n}\ncatch\n{\n    CleanupAndFail \"Failed to connect to exchange. Please check your credentials and try again. Error message: $_\"\n}\n\ntry\n{\n    $sessCS = New-CsOnlineSession -Credential $credAdmin\n}\ncatch\n{\n    CleanupAndFail \"Failed to connect to Skype for Business Online Datacenter. Please check your credentials and try again. Error message: $_\"\n}\n\ntry\n{\n    Connect-MsolService -Credential $credAdmin \n}\ncatch\n{\n    CleanupAndFail \"Failed to connect to Azure Active Directory. Please check your credentials and try again. Error message: $_\"\n}\n\nImport-PSSession $sessExchange -AllowClobber -WarningAction SilentlyContinue\nImport-PSSession $sessCS -AllowClobber -WarningAction SilentlyContinue\n \n# In case there was any uncaught errors\nExitIfError \"Remote connection failed. Please check your credentials and try again.\"\n\n\n\n## Create the Exchange mailbox ##\n# Note: These exchange commandlets do not always throw their errors as exceptions \n\n# Because Get-Mailbox will throw an error if the mailbox is not found\n$Error.Clear()\nPrintAction \"Creating a new account...\"\ntry\n{\n    $mailbox = $null\n    $mailbox = (New-Mailbox -MicrosoftOnlineServicesID $credNewAccount.UserName -room -Name $strDisplayName -RoomMailboxPassword $credNewAccount.Password -EnableRoomMailboxAccount $true)\n} catch { }\nExitIfError \"Failed to create a new mailbox on exchange.\";\n$status[\"Mailbox Setup\"] = \"Successfully created a mailbox for the new account\"\n\n\n$strEmail = $mailbox.WindowsEmailAddress\nPrintSuccess \"The following mailbox has been created for this room: $strEmail\"\n\n\n## Create or retrieve a policy that will be applied to surface hub devices ##\n# The policy disables requiring a device password so that the SurfaceHub does not need to be lockable to use Active Sync\n$strPolicy = Read-Host 'Please enter the name for a new Surface Hub ActiveSync policy that will be created and applied to this account.\nWe will configure that policy to be compatible with Surface Hub devices.\nIf this script has been used before, please enter the name of the existing policy.'\n\n$easpolicy = $null\ntry {\n    $easpolicy = Get-MobileDeviceMailboxPolicy $strPolicy\n}\ncatch {} \n\nif ($easpolicy)\n{\n    if (!$easpolicy.PasswordEnabled -and ($easpolicy.AllowNonProvisionableDevices -eq $null -or $easpolicy.AllowNonProvisionableDevices ))\n    {\n        PrintSuccess \"An existing policy has been found and will be applied to this account.\"\n    }\n    else\n    {\n        PrintError \"The policy you provided is incompatible with the surface hub.\"\n        $easpolicy = $null\n        $status[\"ActiveSync Policy\"] = \"Failed to apply the EAS policy to the account because the policy was invalid.\"\n    }\n}\nelse\n{\n    $Error.Clear()\n    PrintAction \"Creating policy...\"\n    $easpolicy = New-MobileDeviceMailboxPolicy -Name $strPolicy -PasswordEnabled $false -AllowNonProvisionableDevices $true\n    if ($easpolicy)\n    {\n        PrintSuccess \"A new device policy has been created; you can use this same policy for all future Surface Hub device accounts.\" \n    }\n    else\n    {\n        PrintError \"Could not create $strPolicy\"\n    }\n}\n\nif ($easpolicy)\n{\n    # Convert mailbox to user type so we can apply the policy (necessary)\n    # Sometimes it takes a while for this change to take affect so we have some nasty retry loops\n    $Error.Clear();\n    try\n    {\n        Set-Mailbox $credNewAccount.UserName -Type Regular\n    } catch {}\n    if ($Error)\n    {\n        $Error.Clear()\n        $status[\"Device Password Policy\"] = \"Failed to apply the EAS policy to the account.\"\n        PrintError \"Failed to convert to regular account\"\n    }\n    else\n    {\n        # Loop until resource type goes away, up to 5 times\n        for ($i = 0; $i -lt 5 -And (Get-Mailbox $credNewAccount.UserName).ResourceType; $i++)\n        {\n            Start-Sleep -s 5\n        }\n        # If the mailbox is still a Room we cannot apply the policy\n        if (!((Get-Mailbox $credNewAccount.UserName).ResourceType))\n        {\n            $Error.Clear()\n            # Set policy for account \n            Set-CASMailbox $credNewAccount.UserName -ActiveSyncMailboxPolicy $strPolicy\n            if (!$Error)\n            {\n                $status[\"Device Password Policy\"] = \"Successfully applied $strPolicy to the account\"\n            }\n            else\n            {\n                $status[\"Device Password Policy\"] = \"Failed to apply the EAS policy to the account.\"\n                PrintError \"Failed to apply policy\"\n            }\n            $Error.Clear()\n        \n            # Convert back to room mailbox\n            Set-Mailbox $credNewAccount.UserName -Type Room \n            # Loop until resource type goes back to room\n            for ($i = 0; ($i -lt 5) -And ((Get-Mailbox $credNewAccount.UserName).ResourceType -ne \"Room\"); $i++)\n            {\n                Start-Sleep -s 5\n            }\n            if ((Get-Mailbox $credNewAccount.UserName).ResourceType -ne \"Room\")\n            {\n                # A failure to convert the mailbox back to a room is unfortunate but means the mailbox is unusable. \n                $status[\"Mailbox Setup\"] = \"A mailbox was created but we could not set it to a room resource type.\"\n            }\n            else\n            {\n                Set-Mailbox $credNewAccount.UserName -RoomMailboxPassword $credNewAccount.Password -EnableRoomMailboxAccount $true\n                if ($Error)\n                {\n                    $status[\"Mailbox Setup\"] = \"A room mailbox was created but we could not set its password.\"\n                }\n                $Error.Clear()\n            }\n        \n        }\n    }\n}\nelse\n{\n    $status[\"Device Password Policy\"] = \"Failed to apply the EAS policy to the account.\"\n    PrintError \"Failed to obtain policy\"\n}\nPrintSuccess \"Account creation completed.\"\n\nPrintAction \"Setting calendar processing rules...\"\n\n$Error.Clear();\n## Prepare the calendar for automatic meeting responses ##\ntry {\n    Set-CalendarProcessing -Identity $credNewAccount.UserName -AutomateProcessing AutoAccept\n} catch { }\nif ($Error)\n{\n    $status[\"Calendar Acceptance\"] = \"Failed to configure the account to automatically accept/decline meeting requests\"\n}\nelse\n{\n    $status[\"Calendar Acceptance\"] = \"Successfully configured the account to automatically accept/decline meeting requests\"\n}\n\n\n$Error.Clear()\ntry {\n    Set-CalendarProcessing -Identity $credNewAccount.UserName -RemovePrivateProperty $false -AddOrganizerToSubject $false -AddAdditionalResponse $true -DeleteSubject $false -DeleteComments $false -AdditionalResponse \"This is a Surface Hub room!\"\n} catch { }\nif ($Error)\n{\n    $status[\"Calendar Response Configuration\"] = \"Failed to configure the account's response properties\"\n}\nelse\n{\n    $status[\"Calendar Response Configuration\"] = \"Successfully configured the account's response properties\"\n}\n\n$Error.Clear()\n## Configure the Account to not expire ##\nPrintAction \"Configuring password not to expire...\"\ntry \n{\n    Set-MsolUser -UserPrincipalName $credNewAccount.UserName -PasswordNeverExpires $true\n}\ncatch\n{\n    \n}\n\nif ($Error)\n{\n    $status[\"Password Expiration Policy\"] = \"Failed to set the password to never expire\"\n}\nelse\n{\n    $status[\"Password Expiration Policy\"] = \"Successfully set the password to never expire\"\n}\n\nPrintSuccess \"Completed Exchange configuration\"\n\n## Setup Skype for Business. This is somewhat optional and if it fails we SfbEnable can be used later ##\nPrintAction \"Configuring account for Skype for Business.\"\n\n# Getting registrar pool\n$strRegPool = $null\ntry {\n    $strRegPool = (Get-CsTenant).TenantPoolExtension\n}\ncatch {}\n$Error.Clear()\nif (![System.String]::IsNullOrEmpty($strRegPool))\n{\n    $strRegPool = $strRegPool.Substring($strRegPool[0].IndexOf(':') + 1)\n}\n<#\n$strRegPoolEntry = Read-Host \"Enter a Skype for Business Registrar Pool, or leave blank to use [$strRegPool]\"\nif (![System.String]::IsNullOrEmpty($strRegPoolEntry))\n{\n    $strRegPool = $strRegPoolEntry\n}\n#>\n\n# Try to SfB-enable the account. Note that it may not work right away as the account needs to propogate to active directory\nPrintAction \"Enabling Skype for Business on $strRegPool\"\nStart-Sleep -s 10\n$Error.Clear()\ntry {\n    Enable-CsMeetingRoom -Identity $credNewAccount.UserName -RegistrarPool $strRegPool -SipAddressType EmailAddress\n}\ncatch { } \n\nif ($Error)\n{\n    $status[\"Skype for Business Account Setup\"] = \"Failed to setup the Skype for Business meeting room - you can run EnableSfb.ps1 to try again.\"\n    $Error.Clear();\n}\nelse\n{\n    $status[\"Skype for Business Account Setup\"] = \"Successfully enabled account as a Skype for Business meeting room\"\n}\n\n## Now we need to assign a Skype for Business license to the account ##\n# Assign a license to thes\n$countryCode = (Get-CsTenant).CountryAbbreviation\n$loc = Read-Host \"Please enter the usage location for this device account (where the account is being used). This is a 2-character code that is used to assign licenses (e.g. $countryCode)\"\ntry {\n    $Error.Clear()\n    Set-MsolUser -UserPrincipalName $credNewAccount.UserName -UsageLocation $loc\n}\ncatch{}\nif ($Error)\n{\n    $status[\"Office 365 License\"] = \"Failed to assign an Office 365 license to the account\"\n    $Error.Clear()\n}\nelse\n{\n    PrintAction \"We found the following licenses available for your tenant:\"\n    $skus = (Get-MsolAccountSku | Where-Object { !$_.AccountSkuID.Contains(\"INTUNE\"); })\n    $i = 1\n    $skus | % {\n     Write-Host -NoNewline $i\n     Write-Host -NoNewLine \": AccountSKUID: \"\n     Write-Host -NoNewLine $_.AccountSkuid\n     Write-Host -NoNewLine \" Active Units: \"\n     Write-Host -NoNewLine $_.ActiveUnits\n     Write-Host -NoNewLine \" Consumed Units: \"\n     Write-Host $_.ConsumedUnits\n     $i++\n    }\n    $iLicenseIndex = 0;\n    do\n    {\n        $iLicenseIndex = Read-Host 'Choose the number for the SKU you want to pick'\n    } while ($iLicenseIndex -lt 1 -or $iLicenseIndex -gt $skus.Length)\n    $strLicenses = $skus[$iLicenseIndex - 1].AccountSkuId\n\n    if (![System.String]::IsNullOrEmpty($strLicenses))\n    {\n        try \n        {\n            $Error.Clear()\n            Set-MsolUserLicense -UserPrincipalName $credNewAccount.UserName -AddLicenses $strLicenses\n        }\n        catch\n        {\n       \n        }\n        if ($Error)\n        {\n            $Error.Clear()\n            $status[\"Office 365 License\"] = \"Failed to add a license to the account. Make sure you have remaining licenses.\"\n        }\n        else\n        {\n            $status[\"Office 365 License\"] = \"Successfully added license to the account\"\n        }\n    }\n    else\n    {\n        $status[\"Office 365 License\"] = \"You opted not to install a license on this account\"\n    }\n}\n\n\nWrite-Host \n\n## Cleanup and print results ##\nCleanup\n$strDisplay = $mailbox.DisplayName\n$strUsr = $credNewAccount.UserName\nPrintAction \"Summary for creation of $strUsr ($strDisplay)\"\nif ($status.Count -gt 0)\n{\n    ForEach($k in $status.Keys) \n    {\n        $v = $status[$k]\n        $color = \"yellow\"\n        if ($v[0] -eq \"S\") { $color = \"green\" }\n        elseif ($v[0] -eq \"F\") \n        {\n            $color = \"red\" \n            $v += \" Go to http://aka.ms/shubtshoot for help\"\n        }\n\n        Write-Host -NoNewline $k -ForegroundColor $color\n        Write-Host -NoNewline \": \"\n        Write-Host $v\n    }\n}\nelse\n{\n    PrintError \"The account could not be created\"\n}\n```\n\n## <a href=\"\" id=\"acct-verification-ps-scripts\"></a>Account verification script\n\n\nThis script will validate the previously-created device account on a Surface Hub, no matter which method was used to create it. This script is basically pass/fail. If one of the test errors out, it will show a detailed error message, but if all tests pass, the end result will be a summary report. For example, you might see:\n\n``` syntax\n15 tests executed\n0 failures\n2 warnings\n15 passed\n```\n\nDetails of specific settings will not be shown.\n\n```PowerShell\n# SHAccountValidate.ps1\n\n$Error.Clear()\n$ErrorActionPreference = \"Stop\"\n\n\n# Cleans up set state such as remote powershell sessions\nfunction Cleanup()\n{\n    if ($sessEx)\n    {\n        Remove-PSSession $sessEx\n    }\n    if ($sessSfb)\n    {\n        Remove-PSSession $sessSfb\n    }\n}\n\nfunction PrintError($strMsg)\n{\n    Write-Host $strMsg -foregroundcolor \"red\"\n}\n\nfunction PrintSuccess($strMsg)\n{\n    Write-Host $strMsg -foregroundcolor \"green\"\n}\n\nfunction PrintAction($strMsg)\n{\n    Write-Host $strMsg -ForegroundColor Cyan\n}\n\n\n# Cleans up and prints an error message\nfunction CleanupAndFail($strMsg)\n{\n    if ($strMsg)\n    {\n        PrintError($strMsg);\n    }\n    Cleanup\n    exit 1\n}\n\n# Exits if there is an error set and prints the given message\nfunction ExitIfError($strMsg)\n{\n    if ($Error)\n    {\n        CleanupAndFail($strMsg);\n    }\n}\n\n$strUpn = Read-Host \"What is the email address of the account you wish to validate?\"\nif (!$strUpn.Contains('@'))\n{\n    CleanupAndFail \"$strUpn is not a valid email address\"\n}\n$strExServer = Read-Host \"What is your exchange server? (leave blank for online tenants)\"\nif ($strExServer.Equals(\"\"))\n{\n    $fExIsOnline = $true\n}\nelse\n{\n    $fExIsOnline = $false\n}\n$credEx = Get-Credential -Message \"Please provide exchange user credentials\"\n\n$strRegistrarPool = Read-Host (\"What is the Skype for Business registrar pool for $strUpn\" + \"? (leave blank for online tenants)\")\n$fSfbIsOnline = $strRegistrarPool.Equals(\"\")\n\n$fHasOnPrem = $true\nif ($fSfbIsOnline -and $fExIsOnline)\n{\n    do\n    {\n        $strHasOnPrem = (Read-Host \"Do you have an on-premises Active Directory (Y/N) (No if your domain services are hosted entirely online)\").ToUpper()\n    } while ($strHasOnPrem -ne \"Y\" -and $strHasOnPrem -ne \"N\")\n    $fHasOnPrem = $strHasOnPrem.Equals(\"Y\")\n}\n\n$fHasOnline = $false\nif ($fSfbIsOnline -or $fExIsOnline)\n{\n    $fHasOnline = $true\n}\n\nif ($fSfbIsOnline)\n{\n    try {\n        Import-Module LyncOnlineConnector\n    }\n    catch \n    {\n        CleanupAndFail \"To verify Skype for Business in online tenants you need the Lync Online Connector module from http://www.microsoft.com/download/details.aspx?id=39366\"\n    }\n}\nelse\n{\n    $credSfb = (Get-Credential -Message \"Please enter Skype for Business admin credentials\")\n}\n\nif ($fHasOnline)\n{\n    $credSfb = $credEx\n    try {\n        Import-Module MSOnline\n    }\n    catch \n    {\n        CleanupAndFail \"To verify accounts in online tenants you need the Azure Active Directory module for PowerShell from http://go.microsoft.com/fwlink/p/?linkid=236297\"\n    }\n}\n\nPrintAction \"Connecting to Exchange Powershell Session...\"\n[System.Management.Automation.Runspaces.AuthenticationMechanism] $authType = [System.Management.Automation.Runspaces.AuthenticationMechanism]::Kerberos\nif ($fExIsOnline)\n{\n    $authType = [System.Management.Automation.Runspaces.AuthenticationMechanism]::Basic\n}\ntry \n{\n    $sessEx = $null\n    if ($fExIsOnline)\n    {\n        $sessEx = New-PSSession -ConfigurationName microsoft.exchange -Credential $credEx -AllowRedirection -Authentication $authType -ConnectionUri \"https://outlook.office365.com/powershell-liveid/\" -WarningAction SilentlyContinue\n    }\n    else\n    {\n        $sessEx = New-PSSession -ConfigurationName microsoft.exchange -Credential $credEx -AllowRedirection -Authentication $authType -ConnectionUri https://$strExServer/powershell -WarningAction SilentlyContinue\n    }\n} \ncatch\n{\n}\n\nif (!$sessEx) \n{\n    CleanupAndFail \"Connecting to Exchange Powershell failed, please validate your server is accessible and credentials are correct\"\n}\n\nPrintSuccess \"Connected to Exchange Powershell Session\"\n\nPrintAction \"Connecting to Skype for Business Powershell Session...\"\n\nif ($fSfbIsOnline)\n{\n    $sessSfb = New-CsOnlineSession -Credential $credSfb\n}\nelse\n{\n    $sessSfb = New-PSSession -Credential $credSfb -ConnectionURI \"https://$strRegistrarPool/OcsPowershell\" -AllowRedirection -WarningAction SilentlyContinue\n}\n\nif (!$sessSfb)\n{\n    CleanupAndFail \"Connecting to Skype for Business Powershell failed, please validate your server is accessible and credentials are correct\"\n}\n\nPrintSuccess \"Connected to Skype for Business Powershell\"\n\nif ($fHasOnline)\n{\n    $credMsol = $null\n    if ($fExIsOnline)\n    {\n        $credMsol = $credEx\n    }\n    elseif ($fSfbIsOnline)\n    {\n        $credMsol = $credSfb\n    }\n    else\n    {\n        CleanupAndFail \"Internal error - could not determine MS Online credentials\"\n    }\n    try \n    {\n        PrintAction \"Connecting to Azure Active Directory Services...\"\n        Connect-MsolService -Credential $credMsol\n        PrintSuccess \"Connected to Azure Active Directory Services\"\n    } \n    catch\n    {\n        # This really shouldn't happen unless there is a network error\n        CleanupAndFail \"Failed to connect to MSOnline\"\n    }\n}\n\n\nPrintAction \"Importing remote sessions into the local session...\"\ntry\n{\n    $importEx = Import-PSSession $sessEx -AllowClobber -WarningAction SilentlyContinue -DisableNameChecking \n    $importSfb = Import-PSSession $sessSfb -AllowClobber -WarningAction SilentlyContinue -DisableNameChecking \n}\ncatch \n{\n}\nif (!$importEx -or !$importSfb)\n{\n    CleanupAndFail \"Import failed\"   \n}\nPrintSuccess \"Import successful\"\n\n\n$mailbox = $null\ntry \n{\n    $mailbox = Get-Mailbox -Identity $strUpn\n} \ncatch\n{   \n}\n\nif (!$mailbox)\n{\n    CleanupAndFail \"Account exists check failed. Unable to find the mailbox for $strUpn - please make sure the Exchange account exists on $strExServer\"\n}\n\n$exchange = $null\nif (!$fExIsOnline)\n{\n    $exchange = Get-ExchangeServer\n    if (!$exchange -or !$exchange.IsE14OrLater)\n    {\n        CleanupAndFail \"A compatible exchange server version was not found. Please use at least exchange 2010.\"\n    }\n}\n\n\n$strAlias = $mailbox.Alias\n$strDisplayName = $mailbox.DisplayName\n\n$strLinkedAccount = $strLinkedDomain = $strLinkedUser = $strLinkedServer = $null\n$credLinkedDomain = $Null\nif (!$fExIsOnline -and ![System.String]::IsNullOrEmpty($mailbox.LinkedMasterAccount) -and !$mailbox.LinkedMasterAccount.EndsWith(\"\\SELF\"))\n{\n    $strLinkedAccount = $mailbox.LinkedMasterAccount\n    $strLinkedDomain = $strLinkedAccount.substring(0,$strLinkedAccount.IndexOf('\\'))\n    $strLinkedUser = $strLinkedAccount.substring($strLinkedAccount.IndexOf('\\') + 1)\n    $strLinkedServer = Read-Host \"What is the domain controller for the $strLinkedDomain\"\n    $credLinkedDomain = (Get-Credential -Message \"Please provide credentials for $strLinkedDomain\")\n}\n\n\n\n\n\n\n\nWrite-Host\nWrite-Host\nWrite-Host\nPrintAction \"Performing verification checks on $strDisplayName...\"\n$Global:iTotalFailures = 0\n$global:iTotalWarnings = 0\n$Global:iTotalPasses = 0\n\nfunction Validate()\n{\n    Param(\n        [string]$Test,\n        [bool]  $Condition,\n        [string]$FailureMsg,\n        [switch]$WarningOnly\n    )\n\n    Write-Host -NoNewline -ForegroundColor White $Test.PadRight(100,'.')\n    if ($Condition)\n    {\n        Write-Host -ForegroundColor Green \"Passed\"\n        $global:iTotalPasses++\n    }\n    else\n    {\n        if ($WarningOnly)\n        {\n            Write-Host -ForegroundColor Yellow (\"Warning: \"+$FailureMsg)\n            $global:iTotalWarnings++\n        }\n        else\n        {\n            Write-Host -ForegroundColor Red (\"Failed: \"+$FailureMsg)\n            $global:iTotalFailures++\n        }\n    }\n}\n\n## Exchange ##\n\nValidate -WarningOnly -Test \"The mailbox $strUpn is enabled as a room account\" -Condition ($mailbox.RoomMailboxAccountEnabled -eq $True) -FailureMsg \"RoomMailboxEnabled - without a device account, the Surface Hub will not be able to use various key features.\"\n$calendarProcessing = Get-CalendarProcessing -Identity $strUpn -WarningAction SilentlyContinue -ErrorAction SilentlyContinue\nValidate -Test \"The mailbox $strUpn is configured to accept meeting requests\" -Condition ($calendarProcessing -ne $null -and $calendarProcessing.AutomateProcessing -eq 'AutoAccept') -FailureMsg \"AutomateProcessing - the Surface Hub will not be able to send mail or sync its calendar.\"\nValidate -WarningOnly -Test \"The mailbox $strUpn will not delete meeting comments\" -Condition ($calendarProcessing -ne $null -and !$calendarProcessing.DeleteComments) -FailureMsg \"DeleteComments - the Surface Hub may be missing some meeting information on the welcome screen and Skype.\"\nValidate -WarningOnly -Test \"The mailbox $strUpn keeps private meetings private\" -Condition ($calendarProcessing -ne $null -and !$calendarProcessing.RemovePrivateProperty) -FailureMsg \"RemovePrivateProperty - the Surface Hub will make show private meetings.\"\nValidate -Test \"The mailbox $strUpn keeps meeting subjects\" -Condition ($calendarProcessing -ne $null -and !$calendarProcessing.DeleteSubject) -FailureMsg \"DeleteSubject - the Surface Hub will not keep meeting subject information.\"\nValidate -WarningOnly -Test \"The mailbox $strUpn does not prepend meeting organizers to subjects\" -Condition ($calendarProcessing -ne $null -and !$calendarProcessing.AddOrganizerToSubject) -FailureMsg \"AddOrganizerToSubject - the Surface Hub will not display meeting subjects as intended.\"\n\nif ($fExIsOnline)\n{\n    #No online specifics\n}\nelse\n{\n    #No onprem specifics\n}\n\n#ActiveSync\n$casMailbox = Get-Casmailbox $strUpn -WarningAction SilentlyContinue -ErrorAction SilentlyContinue\nValidate -Test \"The mailbox $strUpn has a mailbox policy\" -Condition ($casMailbox -ne $null) -FailureMsg \"PasswordEnabled - unable to find policy - the Surface Hub will not be able to send mail or sync its calendar.\"\nif ($casMailbox)\n{\n    $policy = $null\n    if ($fExIsOnline -or $exchange.IsE15OrLater)\n    {\n        $strPolicy = $casMailbox.ActiveSyncMailboxPolicy\n        $policy = Get-MobileDeviceMailboxPolicy -Identity $strPolicy -WarningAction SilentlyContinue -ErrorAction SilentlyContinue\n        Validate -Test \"The policy $strPolicy does not require a device password\" -Condition ($policy.PasswordEnabled -ne $True) -FailureMsg \"PasswordEnabled - policy requires a device password - the Surface Hub will not be able to send mail or sync its calendar.\"\n    }\n    else\n    {\n        $strPolicy = $casMailbox.ActiveSyncMailboxPolicy\n        $policy = Get-ActiveSyncMailboxPolicy -Identity $strPolicy -WarningAction SilentlyContinue -ErrorAction SilentlyContinue\n        Validate -Test \"The policy $strPolicy does not require a device password\" -Condition ($policy.PasswordEnabled -ne $True) -FailureMsg \"PasswordEnabled - policy requires a device password - the Surface Hub will not be able to send mail or sync its calendar.\"\n    }\n    \n    if ($policy -ne $null)\n    {\n        Validate -Test \"The policy $strPolicy allows non-provisionable devices\" -Condition ($policy.AllowNonProvisionableDevices -eq $null -or $policy.AllowNonProvisionableDevices -eq $true) -FailureMsg \"AllowNonProvisionableDevices - policy will not allow the SurfaceHub to sync\"\n    }\n    \n}\n\n\n# Check the default access level\n$orgSettings = Get-ActiveSyncOrganizationSettings\n$strDefaultAccessLevel = $orgSettings.DefaultAccessLevel\nValidate -Test \"ActiveSync devices are allowed\" -Condition ($strDefaultAccessLevel -eq 'Allow') -FailureMsg \"DeviceType Windows Mail is accessible - devices are not allowed by default - the surface hub will not be able to send mail or sync its calendar.\"\n\n# Check if there exists a device access rule that bans the device type Windows Mail\n$blockingRules = Get-ActiveSyncDeviceAccessRule | where {($_.AccessLevel -eq 'Block' -or $_.AccessLevel -eq 'Quarantine') -and $_.Characteristic -eq 'DeviceType'-and $_.QueryString -eq 'WindowsMail'}\nValidate -Test \"Windows mail devices are not blocked or quarantined\" -Condition ($blockingRules -eq $null -or $blockingRules.Length -eq 0) -FailureMsg \"DeviceType Windows Mail is accessible - devices are blocked or quaratined - the surface hub will not be able to send mail or sync its calendar.\"\n\n## End Exchange ##\n\n\n\n## SfB ##\n$strLyncIdentity = $null\nif ($fSfbIsOnline)\n{\n    $strLyncIdentity = $strUpn\n}\nelse\n{\n    $strLyncIdentity = $strAlias\n}\n\n$lyncAccount = $null\ntry {\n    $lyncAccount = Get-CsMeetingRoom -Identity $strLyncIdentity -WarningAction SilentlyContinue -ErrorAction SilentlyContinue\n} catch {\n    try {\n        $lyncAccount = Get-CsUser -Identity $strLyncIdentity -WarningAction SilentlyContinue -ErrorAction SilentlyContinue\n    } catch { }\n}\nValidate -Test \"There is a Lync or Skype for Business account for $strLyncIdentity\" -Condition ($lyncAccount -ne $null -and $lyncAccount.Enabled) -FailureMsg \"SfB Enabled - there is no Skype for Business account - meetings will not support Skype for Business\"\nif ($lyncAccount)\n{\n    Validate -Test \"The meeting room has a SIP address\" -Condition (![System.String]::IsNullOrEmpty($lyncAccount.SipAddress)) -FailureMsg \"SfB Enabled - there is no SIP Address - the device account cannot be used to sign into Skype for Business.\"\n}\n## End SFB ##\n\n\nif ($fHasOnline)\n{\n    #License validation and password expiry\n    $accountOnline = Get-MsolUser -UserPrincipalName $strUpn -WarningAction SilentlyContinue -ErrorAction SilentlyContinue\n    Validate -Test \"There is an online user account for $strUpn\" -Condition ($accountOnline -ne $null) -FailureMsg \"Could not find a Microsoft Online account for this user even though some services are online\"\n    if ($accountOnline)\n    {\n        Validate -Test \"The password for $strUpn will not expire\" -Condition ($accountOnline.PasswordNeverExpires -eq $True) -FailureMsg \"PasswordNeverExpires - the admin will need to update the device account's password on the Surface Hub when it expires.\"\n        if ($fIsSfbOnline -and !$fIsExOnline)\n        {\n            $strLicenseFailureMsg = \"Has O365 license - The devices will not be able to use Skype for Business services.\"\n        }\n        elseif ($fIsExOnline -and !$fIsSfbOnline)\n        {\n            $strLicenseFailureMsg = \"Has O365 license - The devices will not be able to use Exchange Online services.\"\n        }\n        else\n        {\n            $strLicenseFailureMsg = \"Has O365 license - The devices will not be able to use Skype for Business or Exchange Online services.\"\n        }\n        Validate -Test \"$strUpn is licensed\" -Condition ($accountOnline.IsLicensed -eq $True) -FailureMsg $strLicenseFailureMsg\n\n        Validate -Test \"$strUpn is allowed to sign in\" -Condition ($accountOnline.BlockCredential -ne $True) -FailureMsg \"BlockCredential - This user is not allowed to sign in.\"\n    }\n}\n\n#If there is an on-prem component, we can get the authorative AD user from mailbox \nif ($fHasOnPrem)\n{\n    $accountOnPrem = $null\n    if ($strLinkedAccount)\n    {\n        $accountOnPrem = Get-AdUser $strLinkedUser -server $strLinkedServer -credential $credLinkedDomain -properties PasswordNeverExpires -WarningAction SilentlyContinue -ErrorAction SilentlyContinue\n    }\n    else\n    {\n        #AD User enabled validation\n        $accountOnPrem = Get-AdUser $strAlias -properties PasswordNeverExpires -WarningAction SilentlyContinue -ErrorAction SilentlyContinue\n    }\n    $strOnPremUpn = $accountOnPrem.UserPrincipalName\n    Validate -Test \"There is a user account for $strOnPremUpn\" -Condition ($accountOnprem -ne $null) -FailureMsg \"Could not find an Active Directory account for this user\"\n    if ($accountOnPrem)\n    {\n        Validate -WarningOnly -Test \"The password for $strOnPremUpn will not expire\" -Condition ($accountOnprem.PasswordNeverExpires -eq $True) -FailureMsg \"PasswordNeverExpires - the admin will need to update the device account's password on the Surface Hub when it expires.\"\n        Validate -Test \"$strOnPremUpn is enabled\" -Condition $accountOnPrem.Enabled -FailureMsg \"AccountEnabled - this device account will not sign in\"\n    }\n}\n\n\n$global:iTotalTests = ($global:iTotalFailures + $global:iTotalPasses + $global:iTotalWarnings)\n\nWrite-Host -NoNewline $global:iTotalTests \"tests executed: \"\nWrite-Host -NoNewline -ForegroundColor Red $Global:iTotalFailures \"failures \"\nWrite-Host -NoNewline -ForegroundColor Yellow $Global:iTotalWarnings \"warnings \"\nWrite-Host -ForegroundColor Green $Global:iTotalPasses \"passes \"\n\nCleanup\n```\n\n## <a href=\"\" id=\"enable-sfb-ps-scripts\"></a>Enable Skype for Business\n\n\nThis script will enable Skype for Business on a device account. Use it only if Skype for Business wasn't previously enabled during account creation.\n\n```PowerShell\n## This script performs only the Enable for Skype for Business step on an account. It should only be run if this step failed in SHAccountCreate and the other steps have been completed ##\n# EnableSfb.ps1\n\n$Error.Clear()\n$ErrorActionPreference = \"Stop\"\n\n# Cleans up set state such as remote powershell sessions\nfunction Cleanup()\n{\n    if ($sessCS)\n    {\n        Remove-PSSession $sessCS\n    }\n}\n\nfunction PrintError($strMsg)\n{\n    Write-Host $strMsg -foregroundcolor \"red\"\n}\n\nfunction PrintSuccess($strMsg)\n{\n    Write-Host $strMsg -foregroundcolor \"green\"\n}\n\n# Cleans up and prints an error message\nfunction CleanupAndFail($strMsg)\n{\n    if ($strMsg)\n    {\n        PrintError($strMsg);\n    }\n    Cleanup\n    exit 1\n}\n\n# Exits if there is an error set and prints the given message\nfunction ExitIfError($strMsg)\n{\n    if ($Error)\n    {\n        CleanupAndFail($strMsg);\n    }\n}\n\n## Check dependencies ##\n\n$input = Read-Host \"Is the account you wish to enable part of an online environment (enter O) or on-premises environment (enter P)\"\nif ($input -eq \"P\")\n{\n    $online = $false\n}\nelseif ($input -eq \"O\")\n{\n    $online = $true\n}\nelse\n{\n    CleanupAndFail \"Invalid selection\"\n}\nif ($online)\n{\n    try {\n        Import-Module LyncOnlineConnector\n    } \n    catch\n    {\n        PrintError \"Some dependencies are missing\"\n        PrintError \"Please install the Windows PowerShell Module for Lync Online. For more information go to http://www.microsoft.com/download/details.aspx?id=39366\" \n        PrintError \"Please install the Azure Active Directory module for PowerShell from http://go.microsoft.com/fwlink/p/?linkid=236297\"\n        CleanupAndFail\n    }\n}\nelse \n{\n    $strRegPool = Read-Host \"Enter the FQDN of your Skype for Business Registrar Pool\"\n}\n\n\n## Collect account data ##\nWrite-Host \"-----------  Enter info for the account to enable  -----------.\" -foregroundcolor \"magenta\"\n$strRoomUri=Read-Host 'Please enter the UPN of the account you are enabling (e.g. confroom@surfacehub.microsoft.com)'\n\nif ([System.String]::IsNullOrEmpty($strRoomUri))\n{\n    CleanupAndFail \"Please enter all of the requested data to continue.\"\n    exit 1\n}\nWrite-Host \"--------------------------------------------------------------.\" -foregroundcolor \"magenta\"\n\n\n\n## Sign in to remote powershell for exchange and lync online ##\nWrite-Host \"`n------------------  Establishing connection  -----------------.\" -foregroundcolor \"magenta\"\n$credAdmin=Get-Credential -Message \"Enter credentials of a Skype for Business admin\"\nif (!$credadmin)\n{\n    CleanupAndFail(\"Valid admin credentials are required to create and prepare the account.\");\n}\nWrite-Host \"Connecting to remote sessions. This can occasionally take a while - please do not enter input...\"\n\ntry\n{\n    if ($online)\n    {\n        $sessCS = New-CsOnlineSession -Credential $credAdmin\n    }\n    else\n    {\n        $sessCS = New-PSSession -Credential $credAdmin -ConnectionURI \"https://$strRegPool/OcsPowershell\" -AllowRedirection -WarningAction SilentlyContinue\n    }\n}\ncatch\n{\n    CleanupAndFail(\"Failed to connect to Skype for Business server. Please check your credentials and try again. Error message: $_\")\n}\n\nImport-PSSession $sessCS -AllowClobber\n\n# In case there was any uncaught errors\nExitIfError(\"Remote connection failed. Please check your credentials and try again.\")\nWrite-Host \"--------------------------------------------------------------.\" -foregroundcolor \"magenta\"\n\n# Getting registrar pool\nif ($online)\n{\n    try {\n        $strRegPool = $null;\n        $strRegPool = (Get-CsTenant).TenantPoolExtension\n    } catch {}\n    if ($Error)\n    {\n        $Error.Clear();\n        $strRegPool = \"\";\n        Write-Host \"We failed to lookup your Skype for Business Registrar Pool, but you can still enter it manually\"\n    }\n    else\n    {\n        $strRegPool = $strRegPool[0].Substring($strRegPool[0].IndexOf(':') + 1)\n    }\n}\n\n\n$Error.Clear()\ntry {\n    Enable-CsMeetingRoom -Identity $strRoomUri -RegistrarPool $strRegPool -SipAddressType EmailAddress\n}\ncatch {}\n\nExitIfError(\"Failed to setup Skype for Business meeting room\")\n\nPrintSuccess \"Successfully enabled $strRoomUri as a Skype for Business meeting room\"\n\nCleanup\n```\n\n## Useful cmdlets\n\n\n### <a href=\"\" id=\"create-compatible-as-policy\"></a>Creating a Surface Hub-compatible ActiveSync policy\n\nFor Surface Hub to use Exchange services, a device account configured with a compatible ActiveSync policy must be provisioned on the device. This policy has the following requirements:\n\n``` syntax\nPasswordEnabled == 0\n```\n\nIn the following cmdlets, `$strPolicy` is the name of the ActiveSync policy, and `$strRoomUpn` is the UPN of the device account you want to apply the policy to.\n\nNote that in order to run the cmdlets, you need to set up a remote PowerShell session and:\n\n-   Your admin account must be remote-PowerShell-enabled. This allows the admin to use the PowerShell cmdlets that are needed by the script. (This permission can be set using set-user `$admin -RemotePowerShellEnabled $true`)\n-   Your admin account must have the \"Reset Password\" role if you plan to run the creation scripts. This allows the admin to change the password of the account, which is needed for the script. The Reset Password Role can be enabled using the Exchange Admin Center.\n\nCreate the policy.\n\n```PowerShell\n# Create new policy with PasswordEnabled == false\nNew-MobileDeviceMailboxPolicy -Name $strPolicy -PasswordEnabled $false –AllowNonProvisionableDevices $true\n```\n\nTo apply the policy, the mailbox cannot be a room type, so it has to be converted into a user first.\n\n```PowerShell\n# Convert user to regular type\nSet-Mailbox $strRoomUpn -Type Regular\n# Set policy for account \nSet-CASMailbox $strRoomUpn -ActiveSyncMailboxPolicy $strPolicy\n```\n\nNow the device account just needs to be converted back into a room type.\n\n```PowerShell\n# Convert back to room mailbox\nSet-Mailbox $strRoomUpn -Type Room\n```\n\n### <a href=\"\" id=\"whitelisting-device-ids-cmdlet\"></a>Allowing device IDs for ActiveSync\n\nTo allow an account `$strRoomUpn`, run the following command:\n\n```PowerShell\nSet-CASMailbox –Identity $strRoomUpn –ActiveSyncAllowedDeviceIDs “<ID>”\n```\n\nTo find a device's ID, run:\n\n```PowerShell\nGet-ActiveSyncDevice -Mailbox $strRoomUpn\n```\n\nThis retrieves device information for every device that the account has been provisioned on, Including the `DeviceId` property.\n\n### <a href=\"\" id=\"auto-accept-meetings-cmdlet\"></a>Auto-accepting and declining meeting requests\n\nFor a device account to automatically accept or decline meeting requests based on its availability, the **AutomateProcessing** attribute must be set to **AutoAccept**. This is recommended as to prevent overlapping meetings.\n\n```PowerShell\nSet-CalendarProcessing $ strRoomUpn -AutomateProcessing AutoAccept\n```\n\n### <a href=\"\" id=\"accept-ext-meetings-cmdlet\"></a>Accepting external meeting requests\n\nFor a device account to accept external meeting requests (a meeting request from an account not in the same tenant/domain), the device account must be set to allow processing of external meeting requests. Once set, the device account will automatically accept or decline meeting requests from external accounts as well as local accounts.\n\n>**Note**  If the **AutomateProcessing** attribute is not set to **AutoAccept**, then setting this will have no effect.\n\n \n\n```PowerShell\nSet-CalendarProcessing $strRoomUpn -ProcessExternalMeetingMessages $true\n```\n\n \n\n \n\n\n\n\n\n"}