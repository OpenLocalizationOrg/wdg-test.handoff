{"nodes":[{"content":"Set up and turn on Enterprise Mode logging and data collection in your organization.","pos":[17,101]},{"content":"Set up Enterprise Mode logging and data collection (Internet Explorer 11 for IT Pros)","pos":[256,341]},{"content":"Set up Enterprise Mode logging and data collection","pos":[349,399]},{"content":"Applies to:","pos":[403,414]},{"content":"Windows 10","pos":[422,432]},{"content":"Windows 8.1","pos":[437,448]},{"content":"Windows 7","pos":[453,462]},{"content":"Windows Server 2012 R2","pos":[467,489]},{"content":"Windows Server 2008 R2 with Service Pack 1 (SP1)","pos":[494,542]},{"content":"Using Group Policy, you can turn on Enterprise Mode for Internet Explorer and then you can turn on local user control using the <bpt id=\"p1\">**</bpt>Let users turn on and use Enterprise Mode from the Tools menu<ept id=\"p1\">**</ept> setting, located in the <ph id=\"ph1\">`Administrative Templates\\Windows Components\\Internet Explorer`</ph> category path.","pos":[544,840]},{"content":"After you turn this setting on, your users can turn on Enterprise Mode locally, from the IE <bpt id=\"p1\">**</bpt>Tools<ept id=\"p1\">**</ept> menu.","pos":[841,948]},{"content":"enterprise mode option on the tools menu","pos":[952,992]},{"content":"The <bpt id=\"p1\">**</bpt>Let users turn on and use Enterprise Mode from the Tools menu<ept id=\"p1\">**</ept> setting also lets you decide where to send the user reports (as a URL).","pos":[1025,1166]},{"content":"We recommend creating a custom HTTP port 81 to let your incoming user information go to a dedicated site.","pos":[1167,1272]},{"content":"A dedicated site is important so you can quickly pick out the Enterprise Mode traffic from your other website traffic.","pos":[1273,1391]},{"content":"group policy to turn on enterprise mode","pos":[1395,1434]},{"content":"Getting these reports lets you find out about sites that aren’t working right, so you can add them to your Enterprise Mode site list, without having to locate them all yourself.","pos":[1469,1646]},{"content":"For more information about creating and using a site list, see the <bpt id=\"p1\">[</bpt>Add multiple sites to the Enterprise Mode site list using a file and the Enterprise Mode Site List Manager (schema v.2)<ept id=\"p1\">](add-multiple-sites-to-enterprise-mode-site-list-using-the-version-2-schema-and-enterprise-mode-tool.md)</ept> or the <bpt id=\"p2\">[</bpt>Add multiple sites to the Enterprise Mode site list using a file and the Enterprise Mode Site List Manager (schema v.1)<ept id=\"p2\">](add-multiple-sites-to-enterprise-mode-site-list-using-the-version-1-schema-and-enterprise-mode-tool.md)</ept> topic, based on your operating system.","pos":[1647,2211]},{"content":"Using ASP to collect your data","pos":[2216,2246]},{"content":"When you turn logging on, you need a valid URL that points to a server that can be listened to for updates to a user’s registry key.","pos":[2247,2379]},{"content":"This means you need to set up an endpoint server for the incoming POST messages, which are sent every time the user turns Enterprise Mode on or off from the <bpt id=\"p1\">**</bpt>Tools<ept id=\"p1\">**</ept> menu.","pos":[2380,2552]},{"pos":[2579,2607],"content":"To set up an endpoint server"},{"content":"Configure an IIS server to work with your Enterprise Mode data collection process.","pos":[2615,2697]},{"content":"If you’re unsure how to set up IIS, see the <bpt id=\"p1\">[</bpt>IIS installation webpage<ept id=\"p1\">](http://go.microsoft.com/fwlink/p/?LinkId=507609)</ept>.","pos":[2698,2818]},{"content":"Open Internet Information Services (IIS) and turn on the ASP components from the <bpt id=\"p1\">**</bpt>Add Roles and Features Wizard<ept id=\"p1\">**</ept>, <bpt id=\"p2\">**</bpt>Server Roles<ept id=\"p2\">**</ept> page.","pos":[2824,2962]},{"content":"This lets you create an ASP form that accepts the incoming POST messages.","pos":[2966,3039]},{"pos":[3045,3257],"content":"Open the Internet Information Services (IIS) Manager, click <bpt id=\"p1\">**</bpt>Bindings<ept id=\"p1\">**</ept>, highlight <bpt id=\"p2\">**</bpt>Port 81<ept id=\"p2\">**</ept>, click <bpt id=\"p3\">**</bpt>Edit<ept id=\"p3\">**</ept>, and then change the website information to point to Port 81 so it matches your custom-created port."},{"content":"IIS Manager, editing website bindings","pos":[3265,3302]},{"pos":[3342,3468],"content":"Open the <bpt id=\"p1\">**</bpt>Logging<ept id=\"p1\">**</ept> feature, pick <bpt id=\"p2\">**</bpt>W3C<ept id=\"p2\">**</ept> for the format, and click <bpt id=\"p3\">**</bpt>Select Fields<ept id=\"p3\">**</ept> to open the <bpt id=\"p4\">**</bpt>W3C Logging Fields<ept id=\"p4\">**</ept> box."},{"content":"IIS Manager, setting logging options","pos":[3476,3512]},{"content":"Change the WC3 logging fields to include only the <bpt id=\"p1\">**</bpt>Date<ept id=\"p1\">**</ept>, <bpt id=\"p2\">**</bpt>Client IP<ept id=\"p2\">**</ept>, <bpt id=\"p3\">**</bpt>User Name<ept id=\"p3\">**</ept>, and <bpt id=\"p4\">**</bpt>URI Query<ept id=\"p4\">**</ept> standard fields, and then click <bpt id=\"p5\">**</bpt>OK<ept id=\"p5\">**</ept>.","pos":[3547,3694]},{"content":"Using only these fields keeps the log file simple, giving you the date, client IP address, and the website URI information for any site changed by your users.","pos":[3698,3856]},{"content":"Apply these changes to your default website and close the IIS Manager.","pos":[3862,3932]},{"content":"Put your EmIE.asp file into the root of the web server, using this command:","pos":[3938,4013]},{"content":"This code logs your POST fields to your IIS log file, where you can review all of the collected data.","pos":[4171,4272]},{"content":"IIS log file information","pos":[4279,4303]},{"content":"This is what your log files will look like after you set everything up and at least one of your users has turned on Enterprise Mode locally from the <bpt id=\"p1\">**</bpt>Tools<ept id=\"p1\">**</ept> menu.","pos":[4304,4468]},{"content":"You can see the URL of the problematic website and client IP address of the user that turned on Enterprise Mode.","pos":[4469,4581]},{"content":"Enterprise Mode log file","pos":[4585,4609]},{"content":"Using the GitHub sample to collect your data","pos":[4644,4688]},{"content":"Microsoft has created the <bpt id=\"p1\">[</bpt>EMIE-Data-Collection_Sample<ept id=\"p1\">](http://go.microsoft.com/fwlink/p/?LinkId=507401)</ept> that shows how to collect your Enterprise Mode reports.","pos":[4689,4849]},{"content":"This sample only shows how to collect data, it doesn’t show how to aggregate the data into your Enterprise Mode site list.","pos":[4850,4972]},{"content":"This sample starts with you turning on Enterprise Mode and logging (either through Group Policy, or by manually setting the EnterpriseMode registry key) so that your users can use Enterprise Mode locally.","pos":[4976,5180]},{"content":"For the steps to do this, go to <bpt id=\"p1\">[</bpt>Turn on local control and logging for Enterprise Mode<ept id=\"p1\">](turn-on-local-control-and-logging-for-enterprise-mode.md)</ept>.","pos":[5181,5327]},{"content":"Note","pos":[5331,5335]},{"content":"If you decide to manually change the registry key, you can change the <bpt id=\"p1\">**</bpt>Enable<ept id=\"p1\">**</ept> setting to <ph id=\"ph1\">`[deployment url]/api/records/`</ph>, which automatically sends your reports to this page.","pos":[5341,5518]},{"content":"Setting up, collecting, and viewing reports","pos":[5524,5567]},{"content":"For logging, you’re going to need a valid URL that points to a server that can be listened to for updates to a user’s registry key.","pos":[5568,5699]},{"content":"This means you need to set up an endpoint server for the incoming POST messages, which are sent every time the user turns Enterprise Mode on or off from the <bpt id=\"p1\">**</bpt>Tools<ept id=\"p1\">**</ept> menu.","pos":[5700,5872]},{"content":"These POST messages go into your database, aggregating the report data by URL, giving you the total number of reports where users turned on Enterprise Mode, the total number of reports where users turned off Enterprise Mode, and the date of the last report.","pos":[5873,6130]},{"pos":[6157,6177],"content":"To set up the sample"},{"content":"Set up a server to collect your Enterprise Mode information from your users.","pos":[6185,6261]},{"pos":[6267,6467],"content":"Go to the Internet Explorer/<bpt id=\"p1\">[</bpt>EMIE-Data_Collection_Sample<ept id=\"p1\">](http://go.microsoft.com/fwlink/p/?LinkId=507401)</ept> page on GitHub and tap or click the <bpt id=\"p2\">**</bpt>Download ZIP<ept id=\"p2\">**</ept> button to download the complete project."},{"content":"Open Microsoft Visual Studio 2013 with Update 2, and then open the PhoneHomeSample.sln file.","pos":[6473,6565]},{"content":"On the <bpt id=\"p1\">**</bpt>Build<ept id=\"p1\">**</ept> menu, tap or click <bpt id=\"p2\">**</bpt>Build Solution<ept id=\"p2\">**</ept>.","pos":[6571,6626]},{"content":"The required packages are automatically downloaded and included in the solution.","pos":[6630,6710]},{"pos":[6737,6767],"content":"To set up your endpoint server"},{"pos":[6775,6839],"content":"Right-click on the name, PhoneHomeSample, and click <bpt id=\"p1\">**</bpt>Publish<ept id=\"p1\">**</ept>."},{"content":"Visual Studio, Publish menu","pos":[6847,6874]},{"pos":[6917,7019],"content":"In the <bpt id=\"p1\">**</bpt>Publish Web<ept id=\"p1\">**</ept> wizard, pick the publishing target and options that work for your organization."},{"pos":[7024,7205],"content":"**Important**<br>\nMake sure you have a database associated with your publishing target. Otherwise, your reports won’t be collected and you’ll have problems deploying the website.","leadings":["","   "],"nodes":[{"content":"Important","pos":[2,11]},{"content":"\nMake sure you have a database associated with your publishing target. Otherwise, your reports won’t be collected and you’ll have problems deploying the website.","pos":[17,178],"nodes":[{"content":"Make sure you have a database associated with your publishing target.","pos":[1,70]},{"content":"Otherwise, your reports won’t be collected and you’ll have problems deploying the website.","pos":[71,161]}]}]},{"content":"Visual Studio, Publish Web wizard","pos":[7214,7247]},{"content":"After you finish the publishing process, you need to test to make sure the app deployed successfully.","pos":[7284,7385]},{"pos":[7412,7444],"content":"To test, deploy, and use the app"},{"pos":[7452,7657],"content":"Open a registry editor on the computer where you deployed the app, go to the <ph id=\"ph1\">`HKEY_LOCAL_MACHINE\\SOFTWARE\\Policies\\Microsoft\\Internet Explorer\\Main\\EnterpriseMode`</ph> key, and change the <bpt id=\"p1\">**</bpt>Enable<ept id=\"p1\">**</ept> string to:"},{"pos":[7720,7771],"content":"Where <ph id=\"ph1\">`&lt;deploy_URL&gt;`</ph> points to your deployment URL."},{"content":"After you’re sure your deployment works, you can deploy it to your users using one of the following:","pos":[7777,7877]},{"pos":[7887,8052],"content":"Turn on the <bpt id=\"p1\">**</bpt>Let users turn on and use Enterprise Mode from the Tools menu<ept id=\"p1\">**</ept> Group Policy setting, putting your <ph id=\"ph1\">`&lt;deploy_URL&gt;`</ph> information into the <bpt id=\"p2\">**</bpt>Options<ept id=\"p2\">**</ept> box."},{"content":"Deploy the registry key in Step 3 using System Center or other management software.","pos":[8062,8145]},{"content":"Get your users to visit websites, turning Enterprise Mode on or off locally, as necessary.","pos":[8151,8241]},{"pos":[8268,8294],"content":"To view the report results"},{"content":"Go to <ph id=\"ph1\">`http://&lt;deploy_URL&gt;/List`</ph> to see the report results.","pos":[8302,8361]},{"content":"If you’re already on the webpage, you’ll need to refresh the page to see the results.","pos":[8365,8450]},{"content":"Enterprise Mode Result report with details","pos":[8458,8500]},{"content":"Troubleshooting publishing errors","pos":[8543,8576]},{"content":"If you have errors while you’re publishing your project, you should try to update your packages.","pos":[8577,8673]},{"pos":[8700,8723],"content":"To update your packages"},{"pos":[8731,8865],"content":"From the <bpt id=\"p1\">**</bpt>Tools<ept id=\"p1\">**</ept> menu of Microsoft Visual Studio, click <bpt id=\"p2\">**</bpt>NuGet Package Manager<ept id=\"p2\">**</ept>, and click <bpt id=\"p3\">**</bpt>Manage NuGet Packages for Solution<ept id=\"p3\">**</ept>."},{"content":"Nuget Package Manager for package updates","pos":[8873,8914]},{"content":"Click <bpt id=\"p1\">**</bpt>Updates<ept id=\"p1\">**</ept> on the left side of the tool, and click the <bpt id=\"p2\">**</bpt>Update All<ept id=\"p2\">**</ept> button.","pos":[8955,9039]},{"content":"You may need to do some additional package cleanup to remove older package versions.","pos":[9043,9127]},{"content":"Related topics","pos":[9132,9146]},{"content":"Download the Enterprise Mode Site List Manager (schema v.2)","pos":[9150,9209]},{"content":"Download the Enterprise Mode Site List Manager (schema v.1)","pos":[9263,9322]},{"content":"What is Enterprise Mode?","pos":[9376,9400]},{"content":"Use the Enterprise Mode Site List Manager","pos":[9433,9474]},{"content":"Turn on Enterprise Mode and use a site list","pos":[9525,9568]}],"content":"---\ndescription: Set up and turn on Enterprise Mode logging and data collection in your organization.\nms.assetid: 2e98a280-f677-422f-ba2e-f670362afcde\nauthor: eross-msft\nms.prod: ie11\nms.mktglfcycl: deploy\nms.sitesec: library\nms.pagetype: appcompat\ntitle: Set up Enterprise Mode logging and data collection (Internet Explorer 11 for IT Pros)\n---\n\n# Set up Enterprise Mode logging and data collection\n\n**Applies to:**\n\n-   Windows 10\n-   Windows 8.1\n-   Windows 7\n-   Windows Server 2012 R2\n-   Windows Server 2008 R2 with Service Pack 1 (SP1)\n\nUsing Group Policy, you can turn on Enterprise Mode for Internet Explorer and then you can turn on local user control using the **Let users turn on and use Enterprise Mode from the Tools menu** setting, located in the `Administrative Templates\\Windows Components\\Internet Explorer` category path. After you turn this setting on, your users can turn on Enterprise Mode locally, from the IE **Tools** menu.\n\n![enterprise mode option on the tools menu](images/ie-emie-toolsmenu.png)\n\nThe **Let users turn on and use Enterprise Mode from the Tools menu** setting also lets you decide where to send the user reports (as a URL). We recommend creating a custom HTTP port 81 to let your incoming user information go to a dedicated site. A dedicated site is important so you can quickly pick out the Enterprise Mode traffic from your other website traffic.\n\n![group policy to turn on enterprise mode](images/ie-emie-grouppolicy.png)\n\nGetting these reports lets you find out about sites that aren’t working right, so you can add them to your Enterprise Mode site list, without having to locate them all yourself. For more information about creating and using a site list, see the [Add multiple sites to the Enterprise Mode site list using a file and the Enterprise Mode Site List Manager (schema v.2)](add-multiple-sites-to-enterprise-mode-site-list-using-the-version-2-schema-and-enterprise-mode-tool.md) or the [Add multiple sites to the Enterprise Mode site list using a file and the Enterprise Mode Site List Manager (schema v.1)](add-multiple-sites-to-enterprise-mode-site-list-using-the-version-1-schema-and-enterprise-mode-tool.md) topic, based on your operating system.\n\n## Using ASP to collect your data\nWhen you turn logging on, you need a valid URL that points to a server that can be listened to for updates to a user’s registry key. This means you need to set up an endpoint server for the incoming POST messages, which are sent every time the user turns Enterprise Mode on or off from the **Tools** menu.\n\n ![](images/wedge.gif) **To set up an endpoint server**\n\n1.  Configure an IIS server to work with your Enterprise Mode data collection process. If you’re unsure how to set up IIS, see the [IIS installation webpage](http://go.microsoft.com/fwlink/p/?LinkId=507609).\n\n2.  Open Internet Information Services (IIS) and turn on the ASP components from the **Add Roles and Features Wizard**, **Server Roles** page.<p>\nThis lets you create an ASP form that accepts the incoming POST messages.\n\n3.  Open the Internet Information Services (IIS) Manager, click **Bindings**, highlight **Port 81**, click **Edit**, and then change the website information to point to Port 81 so it matches your custom-created port.\n\n    ![IIS Manager, editing website bindings](images/ie-emie-editbindings.png)\n\n4.  Open the **Logging** feature, pick **W3C** for the format, and click **Select Fields** to open the **W3C Logging Fields** box.\n\n    ![IIS Manager, setting logging options](images/ie-emie-logging.png)\n\n5.  Change the WC3 logging fields to include only the **Date**, **Client IP**, **User Name**, and **URI Query** standard fields, and then click **OK**.<p>\nUsing only these fields keeps the log file simple, giving you the date, client IP address, and the website URI information for any site changed by your users.\n\n6.  Apply these changes to your default website and close the IIS Manager.\n\n7.  Put your EmIE.asp file into the root of the web server, using this command:\n\n   ``` \n    <% @ LANGUAGE=javascript %>\n    <%\n    Response.AppendToLog(\" ;\" + Request.Form(\"URL\") + \" ;\" + Request.Form(\"EnterpriseMode\"));\n    %>\n    ```\nThis code logs your POST fields to your IIS log file, where you can review all of the collected data.\n\n\n### IIS log file information\nThis is what your log files will look like after you set everything up and at least one of your users has turned on Enterprise Mode locally from the **Tools** menu. You can see the URL of the problematic website and client IP address of the user that turned on Enterprise Mode.\n\n![Enterprise Mode log file](images/ie-emie-logfile.png)\n\n\n## Using the GitHub sample to collect your data\nMicrosoft has created the [EMIE-Data-Collection_Sample](http://go.microsoft.com/fwlink/p/?LinkId=507401) that shows how to collect your Enterprise Mode reports. This sample only shows how to collect data, it doesn’t show how to aggregate the data into your Enterprise Mode site list.<p>\nThis sample starts with you turning on Enterprise Mode and logging (either through Group Policy, or by manually setting the EnterpriseMode registry key) so that your users can use Enterprise Mode locally. For the steps to do this, go to [Turn on local control and logging for Enterprise Mode](turn-on-local-control-and-logging-for-enterprise-mode.md).\n\n**Note**<br>If you decide to manually change the registry key, you can change the **Enable** setting to `[deployment url]/api/records/`, which automatically sends your reports to this page.\n\n### Setting up, collecting, and viewing reports\nFor logging, you’re going to need a valid URL that points to a server that can be listened to for updates to a user’s registry key. This means you need to set up an endpoint server for the incoming POST messages, which are sent every time the user turns Enterprise Mode on or off from the **Tools** menu. These POST messages go into your database, aggregating the report data by URL, giving you the total number of reports where users turned on Enterprise Mode, the total number of reports where users turned off Enterprise Mode, and the date of the last report.\n\n ![](images/wedge.gif) **To set up the sample**\n\n1.  Set up a server to collect your Enterprise Mode information from your users.\n\n2.  Go to the Internet Explorer/[EMIE-Data_Collection_Sample](http://go.microsoft.com/fwlink/p/?LinkId=507401) page on GitHub and tap or click the **Download ZIP** button to download the complete project.\n\n3.  Open Microsoft Visual Studio 2013 with Update 2, and then open the PhoneHomeSample.sln file.\n\n4.  On the **Build** menu, tap or click **Build Solution**.<p>\nThe required packages are automatically downloaded and included in the solution.\n\n ![](images/wedge.gif) **To set up your endpoint server**\n\n1.  Right-click on the name, PhoneHomeSample, and click **Publish**.\n\n    ![Visual Studio, Publish menu](images/ie-emie-publishsolution.png)\n\n2.  In the **Publish Web** wizard, pick the publishing target and options that work for your organization.\n\n   **Important**<br>\n   Make sure you have a database associated with your publishing target. Otherwise, your reports won’t be collected and you’ll have problems deploying the website. \n\n    ![Visual Studio, Publish Web wizard](images/ie-emie-publishweb.png)\n\n   After you finish the publishing process, you need to test to make sure the app deployed successfully.\n\n ![](images/wedge.gif) **To test, deploy, and use the app**\n\n1.  Open a registry editor on the computer where you deployed the app, go to the `HKEY_LOCAL_MACHINE\\SOFTWARE\\Policies\\Microsoft\\Internet Explorer\\Main\\EnterpriseMode` key, and change the **Enable** string to:\n\n    ``` \"Enable\"=\"http://<deploy_URL>/api/records/\"\n    ```\n Where `<deploy_URL>` points to your deployment URL.\n\n2.  After you’re sure your deployment works, you can deploy it to your users using one of the following:\n\n    -   Turn on the **Let users turn on and use Enterprise Mode from the Tools menu** Group Policy setting, putting your `<deploy_URL>` information into the **Options** box.\n\n    -   Deploy the registry key in Step 3 using System Center or other management software.\n\n3.  Get your users to visit websites, turning Enterprise Mode on or off locally, as necessary.\n\n ![](images/wedge.gif) **To view the report results**\n\n-   Go to `http://<deploy_URL>/List` to see the report results.<p>\nIf you’re already on the webpage, you’ll need to refresh the page to see the results.\n\n    ![Enterprise Mode Result report with details](images/ie-emie-reportwdetails.png)\n\n\n### Troubleshooting publishing errors\nIf you have errors while you’re publishing your project, you should try to update your packages.\n\n ![](images/wedge.gif) **To update your packages**\n\n1.  From the **Tools** menu of Microsoft Visual Studio, click **NuGet Package Manager**, and click **Manage NuGet Packages for Solution**.\n\n    ![Nuget Package Manager for package updates](images/ie-emie-packageupdate.png)\n\n2.  Click **Updates** on the left side of the tool, and click the **Update All** button.<p>\nYou may need to do some additional package cleanup to remove older package versions.\n\n## Related topics\n- [Download the Enterprise Mode Site List Manager (schema v.2)](http://go.microsoft.com/fwlink/p/?LinkId=716853)\n- [Download the Enterprise Mode Site List Manager (schema v.1)](http://go.microsoft.com/fwlink/p/?LinkID=394378)\n- [What is Enterprise Mode?](what-is-enterprise-mode.md)\n- [Use the Enterprise Mode Site List Manager](use-the-enterprise-mode-site-list-manager.md)\n- [Turn on Enterprise Mode and use a site list](turn-on-enterprise-mode-and-use-a-site-list.md)\n \n\n \n\n\n\n"}