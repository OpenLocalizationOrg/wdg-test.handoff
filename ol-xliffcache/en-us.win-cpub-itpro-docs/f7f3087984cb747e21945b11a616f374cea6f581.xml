{"nodes":[{"content":"Build a distributed environment for Windows 10 deployment (Windows 10)","pos":[11,81]},{"content":"In this topic, you will learn how to replicate your Windows 10 deployment shares to facilitate the deployment of Windows 10 in remote or branch locations.","pos":[95,249]},{"content":"Build a distributed environment for Windows 10 deployment","pos":[456,513]},{"content":"Applies to","pos":[517,527]},{"content":"Windows 10","pos":[534,544]},{"content":"In this topic, you will learn how to replicate your Windows 10 deployment shares to facilitate the deployment of Windows 10 in remote or branch locations.","pos":[546,700]},{"content":"If you work in a distributed environment, replicating the deployment shares is an important part of the deployment solution.","pos":[701,825]},{"content":"With images reaching 5 GB in size or more, you can't deploy machines in a remote office over the wire.","pos":[826,928]},{"content":"You need to replicate the content, so that the clients can do local deployments.","pos":[929,1009]},{"content":"We will use four machines for this topic: DC01, MDT01, MDT02, and PC0006.","pos":[1011,1084]},{"content":"DC01 is a domain controller, MDT01 is a Windows Server 2012 R2 standard server, and PC0006 is a blank machine to which you will deploy Windows 10.","pos":[1085,1231]},{"content":"You will configure a second deployment server (MDT02) for a remote site (Stockholm) by replicating the deployment share in the original site (New York).","pos":[1232,1384]},{"content":"MDT01, MDT02, and PC0006 are members of the domain contoso.com for the fictitious Contoso Corporation.","pos":[1385,1487]},{"content":"For more details on the setup for this topic, please see <bpt id=\"p1\">[</bpt>Deploy Windows 10 with the Microsoft Deployment Toolkit<ept id=\"p1\">](deploy-windows-10-with-the-microsoft-deployment-toolkit.md#proof)</ept>.","pos":[1488,1669]},{"content":"figure 1","pos":[1673,1681]},{"content":"Figure 1.","pos":[1709,1718]},{"content":"The machines used in this topic.","pos":[1719,1751]},{"pos":[1782,1809],"content":"Replicate deployment shares"},{"content":"Replicating the content between MDT01 (New York) and MDT02 (Stockholm) can be done in a number of different ways.","pos":[1811,1924]},{"content":"The most common content replication solutions with Microsoft Deployment Toolkit (MDT) 2013 use either the Linked Deployment Shares (LDS) feature or Distributed File System Replication (DFS-R).","pos":[1925,2117]},{"content":"Some organizations have used a simple robocopy script for replication of the content.","pos":[2118,2203]},{"content":"Note","pos":[2207,2211]},{"content":"Robocopy has options that allow for synchronization between folders.","pos":[2216,2284]},{"content":"It has a simple reporting function; it supports transmission retry; and, by default, it will only copy/remove files from the source that are newer than files on the target.","pos":[2285,2457]},{"content":"Linked deployment shares in MDT 2013 Update 2","pos":[2464,2509]},{"content":"LDS is a built-in feature in MDT for replicating content.","pos":[2511,2568]},{"content":"However, LDS works best with strong connections such as LAN connections with low latency.","pos":[2569,2658]},{"content":"For most WAN links, DFS-R is the better option.","pos":[2659,2706]},{"content":"Why DFS-R is a better option","pos":[2712,2740]},{"content":"DFS-R is not only very fast and reliable, but it also offers central monitoring, bandwidth control, and a great delta replication engine.","pos":[2742,2879]},{"content":"DFS-R will work equally well whether you have 2 sites or 90.","pos":[2880,2940]},{"content":"When using DFS-R for MDT, we recommend running your deployment servers on Windows Server 2008 R2 or higher.","pos":[2941,3048]},{"content":"From that version on, you can configure the replication target(s) as read-only, which is exactly what you want for MDT.","pos":[3049,3168]},{"content":"This way, you can have your master deployment share centralized and replicate out changes as they happen.","pos":[3169,3274]},{"content":"DFS-R will quickly pick up changes at the central deployment share in MDT01 and replicate the delta changes to MDT02.","pos":[3275,3392]},{"pos":[3423,3489],"content":"Set up Distributed File System Replication (DFS-R) for replication"},{"content":"Setting up DFS-R for replication is a quick and straightforward process.","pos":[3491,3563]},{"content":"You prepare the deployment servers and then create a replication group.","pos":[3564,3635]},{"content":"To complete the setup, you configure some replication settings.","pos":[3636,3699]},{"content":"Prepare MDT01 for replication","pos":[3705,3734]},{"pos":[3739,3804],"content":"On MDT01, using Server Manager, click <bpt id=\"p1\">**</bpt>Add roles and features<ept id=\"p1\">**</ept>."},{"pos":[3809,3903],"content":"On the <bpt id=\"p1\">**</bpt>Select installation type<ept id=\"p1\">**</ept> page, select <bpt id=\"p2\">**</bpt>Role-based or feature-based installation<ept id=\"p2\">**</ept>."},{"pos":[3908,3999],"content":"On the <bpt id=\"p1\">**</bpt>Select destination server<ept id=\"p1\">**</ept> page, select <bpt id=\"p2\">**</bpt>MDT01.contoso.com<ept id=\"p2\">**</ept> and click <bpt id=\"p3\">**</bpt>Next<ept id=\"p3\">**</ept>."},{"pos":[4004,4141],"content":"On the <bpt id=\"p1\">**</bpt>Select server roles<ept id=\"p1\">**</ept> page, expand <bpt id=\"p2\">**</bpt>File and Storage Services (Installed)<ept id=\"p2\">**</ept> and expand <bpt id=\"p3\">**</bpt>File and iSCSI Services (Installed)<ept id=\"p3\">**</ept>."},{"content":"In the <bpt id=\"p1\">**</bpt>Roles<ept id=\"p1\">**</ept> list, select <bpt id=\"p2\">**</bpt>DFS Replication<ept id=\"p2\">**</ept>.","pos":[4146,4196]},{"content":"In the <bpt id=\"p1\">**</bpt>Add Roles and Features Wizard<ept id=\"p1\">**</ept> dialog box, select <bpt id=\"p2\">**</bpt>Add Features<ept id=\"p2\">**</ept>, and then click <bpt id=\"p3\">**</bpt>Next<ept id=\"p3\">**</ept>.","pos":[4197,4299]},{"content":"figure 2","pos":[4307,4315]},{"content":"Figure 2.","pos":[4347,4356]},{"content":"Adding the DFS Replication role to MDT01.","pos":[4357,4398]},{"pos":[4404,4485],"content":"On the <bpt id=\"p1\">**</bpt>Select features<ept id=\"p1\">**</ept> page, accept the default settings, and click <bpt id=\"p2\">**</bpt>Next<ept id=\"p2\">**</ept>."},{"pos":[4490,4557],"content":"On the <bpt id=\"p1\">**</bpt>Confirm installation selections<ept id=\"p1\">**</ept> page, click <bpt id=\"p2\">**</bpt>Install<ept id=\"p2\">**</ept>."},{"pos":[4562,4617],"content":"On the <bpt id=\"p1\">**</bpt>Installation progress<ept id=\"p1\">**</ept> page, click <bpt id=\"p2\">**</bpt>Close<ept id=\"p2\">**</ept>."},{"content":"Prepare MDT02 for replication","pos":[4623,4652]},{"pos":[4658,4723],"content":"On MDT02, using Server Manager, click <bpt id=\"p1\">**</bpt>Add roles and features<ept id=\"p1\">**</ept>."},{"pos":[4728,4822],"content":"On the <bpt id=\"p1\">**</bpt>Select installation type<ept id=\"p1\">**</ept> page, select <bpt id=\"p2\">**</bpt>Role-based or feature-based installation<ept id=\"p2\">**</ept>."},{"pos":[4827,4918],"content":"On the <bpt id=\"p1\">**</bpt>Select destination server<ept id=\"p1\">**</ept> page, select <bpt id=\"p2\">**</bpt>MDT02.contoso.com<ept id=\"p2\">**</ept> and click <bpt id=\"p3\">**</bpt>Next<ept id=\"p3\">**</ept>."},{"pos":[4923,5060],"content":"On the <bpt id=\"p1\">**</bpt>Select server roles<ept id=\"p1\">**</ept> page, expand <bpt id=\"p2\">**</bpt>File and Storage Services (Installed)<ept id=\"p2\">**</ept> and expand <bpt id=\"p3\">**</bpt>File and iSCSI Services (Installed)<ept id=\"p3\">**</ept>."},{"content":"In the <bpt id=\"p1\">**</bpt>Roles<ept id=\"p1\">**</ept> list, select <bpt id=\"p2\">**</bpt>DFS Replication<ept id=\"p2\">**</ept>.","pos":[5065,5115]},{"content":"In the <bpt id=\"p1\">**</bpt>Add Roles and Features Wizard<ept id=\"p1\">**</ept> dialog box, select <bpt id=\"p2\">**</bpt>Add Features<ept id=\"p2\">**</ept>, and then click <bpt id=\"p3\">**</bpt>Next<ept id=\"p3\">**</ept>.","pos":[5116,5218]},{"pos":[5223,5304],"content":"On the <bpt id=\"p1\">**</bpt>Select features<ept id=\"p1\">**</ept> page, accept the default settings, and click <bpt id=\"p2\">**</bpt>Next<ept id=\"p2\">**</ept>."},{"pos":[5309,5376],"content":"On the <bpt id=\"p1\">**</bpt>Confirm installation selections<ept id=\"p1\">**</ept> page, click <bpt id=\"p2\">**</bpt>Install<ept id=\"p2\">**</ept>."},{"pos":[5381,5436],"content":"On the <bpt id=\"p1\">**</bpt>Installation progress<ept id=\"p1\">**</ept> page, click <bpt id=\"p2\">**</bpt>Close<ept id=\"p2\">**</ept>."},{"content":"Create the MDTProduction folder on MDT02","pos":[5442,5482]},{"pos":[5488,5559],"content":"On MDT02, using File Explorer, create the <bpt id=\"p1\">**</bpt>E:<ph id=\"ph1\">\\\\</ph>MDTProduction<ept id=\"p1\">**</ept> folder."},{"content":"Share the <bpt id=\"p1\">**</bpt>E:<ph id=\"ph1\">\\\\</ph>MDTProduction<ept id=\"p1\">**</ept> folder as <bpt id=\"p2\">**</bpt>MDTProduction$<ept id=\"p2\">**</ept>.","pos":[5564,5625]},{"content":"Use the default permissions.","pos":[5626,5654]},{"content":"figure 3","pos":[5662,5670]},{"content":"Figure 3.","pos":[5702,5711]},{"content":"Sharing the <bpt id=\"p1\">**</bpt>E:<ph id=\"ph1\">\\\\</ph>MDTProduction folder<ept id=\"p1\">**</ept> on MDT02.","pos":[5712,5762]},{"content":"Configure the deployment share","pos":[5767,5797]},{"content":"When you have multiple deployment servers sharing the same content, you need to configure the Bootstrap.ini file with information about which server to connect to based on where the client is located.","pos":[5799,5999]},{"content":"In MDT, that can be done by using the DefaultGateway property.","pos":[6000,6062]},{"pos":[6067,6197],"content":"On MDT01, using Notepad, navigate to the <bpt id=\"p1\">**</bpt>E:<ph id=\"ph1\">\\\\</ph>MDTProduction<ph id=\"ph2\">\\\\</ph>Control<ept id=\"p1\">**</ept> folder and modify the Boostrap.ini file to look like this:"},{"pos":[6533,7078],"content":"**Note**  \nThe DeployRoot value needs to go into the Bootstrap.ini file, but you can use the same logic in the CustomSettings.ini file. For example, you can redirect the logs to the local deployment server (SLSHARE), or have the User State Migration Tool (USMT) migration store (UDDIR) local. To learn more about USMT, see [Refresh a Windows 7 computer with Windows 10](refresh-a-windows-7-computer-with-windows-10.md) and [Replace a Windows 7 computer with a Windows 10 computer](replace-a-windows-7-computer-with-a-windows-10-computer.md).","leadings":["","    "],"nodes":[{"content":"Note","pos":[2,6]},{"content":"The DeployRoot value needs to go into the Bootstrap.ini file, but you can use the same logic in the CustomSettings.ini file. For example, you can redirect the logs to the local deployment server (SLSHARE), or have the User State Migration Tool (USMT) migration store (UDDIR) local. To learn more about USMT, see [Refresh a Windows 7 computer with Windows 10](refresh-a-windows-7-computer-with-windows-10.md) and [Replace a Windows 7 computer with a Windows 10 computer](replace-a-windows-7-computer-with-a-windows-10-computer.md).","pos":[11,541],"nodes":[{"content":"The DeployRoot value needs to go into the Bootstrap.ini file, but you can use the same logic in the CustomSettings.ini file.","pos":[0,124]},{"content":"For example, you can redirect the logs to the local deployment server (SLSHARE), or have the User State Migration Tool (USMT) migration store (UDDIR) local.","pos":[125,281]},{"content":"To learn more about USMT, see <bpt id=\"p1\">[</bpt>Refresh a Windows 7 computer with Windows 10<ept id=\"p1\">](refresh-a-windows-7-computer-with-windows-10.md)</ept> and <bpt id=\"p2\">[</bpt>Replace a Windows 7 computer with a Windows 10 computer<ept id=\"p2\">](replace-a-windows-7-computer-with-a-windows-10-computer.md)</ept>.","pos":[282,530]}]}]},{"content":"Save the Bootstrap.ini file.","pos":[7089,7117]},{"pos":[7122,7245],"content":"Using the Deployment Workbench, right-click the <bpt id=\"p1\">**</bpt>MDT Production<ept id=\"p1\">**</ept> deployment share and select <bpt id=\"p2\">**</bpt>Update Deployment Share<ept id=\"p2\">**</ept>."},{"content":"figure 4","pos":[7253,7261]},{"content":"Figure 4.","pos":[7293,7302]},{"content":"Updating the MDT Production deployment share.","pos":[7303,7348]},{"content":"Use the default settings for the Update Deployment Share Wizard.","pos":[7354,7418]},{"content":"After the update is complete, use the Windows Deployment Services console.","pos":[7423,7497]},{"content":"In the <bpt id=\"p1\">**</bpt>Boot Images<ept id=\"p1\">**</ept> node, right-click the <bpt id=\"p2\">**</bpt>MDT Production x64<ept id=\"p2\">**</ept> boot image and select <bpt id=\"p3\">**</bpt>Replace Image<ept id=\"p3\">**</ept>.","pos":[7498,7606]},{"content":"figure 5","pos":[7614,7622]},{"content":"Figure 5.","pos":[7654,7663]},{"content":"Replacing the updated boot image in WDS.","pos":[7664,7704]},{"pos":[7710,7865],"content":"Browse and select the <bpt id=\"p1\">**</bpt>E:<ph id=\"ph1\">\\\\</ph>MDTProduction<ph id=\"ph2\">\\\\</ph>Boot<ph id=\"ph3\">\\\\</ph>LiteTouchPE<ph id=\"ph4\">\\_</ph>x64.wim<ept id=\"p1\">**</ept> boot image, and then complete Replace Boot Image Wizard using the default settings."},{"pos":[7895,7916],"content":"Replicate the content"},{"content":"Once the MDT01 and MDT02 servers are prepared, you are ready to configure the actual replication.","pos":[7917,8014]},{"content":"Create the replication group","pos":[8019,8047]},{"pos":[8052,8150],"content":"On MDT01, using DFS Management, right-click <bpt id=\"p1\">**</bpt>Replication<ept id=\"p1\">**</ept>, and select <bpt id=\"p2\">**</bpt>New Replication Group<ept id=\"p2\">**</ept>."},{"pos":[8155,8257],"content":"On the <bpt id=\"p1\">**</bpt>Replication Group Type<ept id=\"p1\">**</ept> page, select <bpt id=\"p2\">**</bpt>Multipurpose replication group<ept id=\"p2\">**</ept>, and click <bpt id=\"p3\">**</bpt>Next<ept id=\"p3\">**</ept>."},{"pos":[8262,8349],"content":"On the <bpt id=\"p1\">**</bpt>Name and Domain<ept id=\"p1\">**</ept> page, assign the <bpt id=\"p2\">**</bpt>MDTProduction<ept id=\"p2\">**</ept> name, and click <bpt id=\"p3\">**</bpt>Next<ept id=\"p3\">**</ept>."},{"pos":[8354,8465],"content":"On the <bpt id=\"p1\">**</bpt>Replication Group Members<ept id=\"p1\">**</ept> page, click <bpt id=\"p2\">**</bpt>Add<ept id=\"p2\">**</ept>, add <bpt id=\"p3\">**</bpt>MDT01<ept id=\"p3\">**</ept> and <bpt id=\"p4\">**</bpt>MDT02<ept id=\"p4\">**</ept>, and then click <bpt id=\"p5\">**</bpt>Next<ept id=\"p5\">**</ept>."},{"content":"figure 6","pos":[8473,8481]},{"content":"Figure 6.","pos":[8513,8522]},{"content":"Adding the Replication Group Members.","pos":[8523,8560]},{"pos":[8566,8653],"content":"On the <bpt id=\"p1\">**</bpt>Topology Selection<ept id=\"p1\">**</ept> page, select the <bpt id=\"p2\">**</bpt>Full mesh<ept id=\"p2\">**</ept> option and click <bpt id=\"p3\">**</bpt>Next<ept id=\"p3\">**</ept>."},{"pos":[8658,8763],"content":"On the <bpt id=\"p1\">**</bpt>Replication Group Schedule and Bandwidth<ept id=\"p1\">**</ept> page, accept the default settings and click <bpt id=\"p2\">**</bpt>Next<ept id=\"p2\">**</ept>."},{"pos":[8768,8836],"content":"On the <bpt id=\"p1\">**</bpt>Primary Member<ept id=\"p1\">**</ept> page, select <bpt id=\"p2\">**</bpt>MDT01<ept id=\"p2\">**</ept> and click <bpt id=\"p3\">**</bpt>Next<ept id=\"p3\">**</ept>."},{"pos":[8841,8990],"content":"On the <bpt id=\"p1\">**</bpt>Folders to Replicate<ept id=\"p1\">**</ept> page, click <bpt id=\"p2\">**</bpt>Add<ept id=\"p2\">**</ept>, type in <bpt id=\"p3\">**</bpt>E:<ph id=\"ph1\">\\\\</ph>MDTProduction<ept id=\"p3\">**</ept> as the folder to replicate, click <bpt id=\"p4\">**</bpt>OK<ept id=\"p4\">**</ept>, and then click <bpt id=\"p5\">**</bpt>Next<ept id=\"p5\">**</ept>."},{"pos":[8995,9102],"content":"On the <bpt id=\"p1\">**</bpt>Local Path of MDTProduction<ept id=\"p1\">**</ept> on the <bpt id=\"p2\">**</bpt>Other Members<ept id=\"p2\">**</ept> page, select <bpt id=\"p3\">**</bpt>MDT02<ept id=\"p3\">**</ept>, and click <bpt id=\"p4\">**</bpt>Edit<ept id=\"p4\">**</ept>."},{"pos":[9107,9344],"content":"On the <bpt id=\"p1\">**</bpt>Edit<ept id=\"p1\">**</ept> page, select the <bpt id=\"p2\">**</bpt>Enabled<ept id=\"p2\">**</ept> option, type in <bpt id=\"p3\">**</bpt>E:<ph id=\"ph1\">\\\\</ph>MDTProduction<ept id=\"p3\">**</ept> as the local path of folder, select the <bpt id=\"p4\">**</bpt>Make the selected replicated folder on this member read-only<ept id=\"p4\">**</ept> check box, click <bpt id=\"p5\">**</bpt>OK<ept id=\"p5\">**</ept>, and then click <bpt id=\"p6\">**</bpt>Next<ept id=\"p6\">**</ept>."},{"content":"figure 7","pos":[9352,9360]},{"content":"Figure 7.","pos":[9392,9401]},{"content":"Configure the MDT02 member.","pos":[9402,9429]},{"pos":[9435,9514],"content":"On the <bpt id=\"p1\">**</bpt>Review Settings and Create Replication Group<ept id=\"p1\">**</ept> page, click <bpt id=\"p2\">**</bpt>Create<ept id=\"p2\">**</ept>."},{"pos":[9519,9565],"content":"On the <bpt id=\"p1\">**</bpt>Confirmation<ept id=\"p1\">**</ept> page, click <bpt id=\"p2\">**</bpt>Close<ept id=\"p2\">**</ept>."},{"content":"Configure replicated folders","pos":[9570,9598]},{"pos":[9603,9692],"content":"On MDT01, using DFS Management, expand <bpt id=\"p1\">**</bpt>Replication<ept id=\"p1\">**</ept> and then select <bpt id=\"p2\">**</bpt>MDTProduction<ept id=\"p2\">**</ept>."},{"pos":[9697,9776],"content":"In the middle pane, right-click the <bpt id=\"p1\">**</bpt>MDT01<ept id=\"p1\">**</ept> member and select <bpt id=\"p2\">**</bpt>Properties<ept id=\"p2\">**</ept>."},{"pos":[9781,9877],"content":"On the <bpt id=\"p1\">**</bpt>MDT01 (MDTProduction) Properties<ept id=\"p1\">**</ept> page, configure the following and then click <bpt id=\"p2\">**</bpt>OK<ept id=\"p2\">**</ept>:"},{"pos":[9886,9940],"content":"In the <bpt id=\"p1\">**</bpt>Staging<ept id=\"p1\">**</ept> tab, set the quota to <bpt id=\"p2\">**</bpt>20480 MB<ept id=\"p2\">**</ept>."},{"pos":[9949,10370],"content":"In the **Advanced** tab, set the quota to **8192 MB**.\nIn this scenario the size of the deployment share is known, but you might need to change the values for your environment. A good rule of thumb is to get the size of the 16 largest files and make sure they fit in the staging area. Here is a Windows PowerShell example that calculates the size of the 16 largest files in the E:\\\\MDTProduction deployment share:","leadings":["","        "],"nodes":[{"content":"In the <bpt id=\"p1\">**</bpt>Advanced<ept id=\"p1\">**</ept> tab, set the quota to <bpt id=\"p2\">**</bpt>8192 MB<ept id=\"p2\">**</ept>.","pos":[0,54]},{"content":"In this scenario the size of the deployment share is known, but you might need to change the values for your environment.","pos":[55,176]},{"content":"A good rule of thumb is to get the size of the 16 largest files and make sure they fit in the staging area.","pos":[177,284]},{"content":"Here is a Windows PowerShell example that calculates the size of the 16 largest files in the E:<ph id=\"ph1\">\\\\</ph>MDTProduction deployment share:","pos":[285,413]}]},{"content":"figure 8","pos":[10566,10574]},{"content":"Figure 8.","pos":[10606,10615]},{"content":"Configure the Staging settings.","pos":[10616,10647]},{"pos":[10653,10732],"content":"In the middle pane, right-click the <bpt id=\"p1\">**</bpt>MDT02<ept id=\"p1\">**</ept> member and select <bpt id=\"p2\">**</bpt>Properties<ept id=\"p2\">**</ept>."},{"pos":[10737,10833],"content":"On the <bpt id=\"p1\">**</bpt>MDT02 (MDTProduction) Properties<ept id=\"p1\">**</ept> page, configure the following and then click <bpt id=\"p2\">**</bpt>OK<ept id=\"p2\">**</ept>:"},{"pos":[10842,10896],"content":"In the <bpt id=\"p1\">**</bpt>Staging<ept id=\"p1\">**</ept> tab, set the quota to <bpt id=\"p2\">**</bpt>20480 MB<ept id=\"p2\">**</ept>."},{"pos":[10905,10959],"content":"In the <bpt id=\"p1\">**</bpt>Advanced<ept id=\"p1\">**</ept> tab, set the quota to <bpt id=\"p2\">**</bpt>8192 MB<ept id=\"p2\">**</ept>."},{"content":"Note","pos":[10963,10967]},{"content":"It will take some time for the replication configuration to be picked up by the replication members (MDT01 and MDT02).","pos":[10972,11090]},{"content":"The time for the initial sync will depend on the WAN link speed between the sites.","pos":[11091,11173]},{"content":"After that, delta changes are replicated quickly.","pos":[11174,11223]},{"content":"Verify replication","pos":[11230,11248]},{"pos":[11253,11342],"content":"On MDT02, wait until you start to see content appear in the <bpt id=\"p1\">**</bpt>E:<ph id=\"ph1\">\\\\</ph>MDTProduction<ept id=\"p1\">**</ept> folder."},{"pos":[11347,11465],"content":"Using DFS Management, expand <bpt id=\"p1\">**</bpt>Replication<ept id=\"p1\">**</ept>, right-click <bpt id=\"p2\">**</bpt>MDTProduction<ept id=\"p2\">**</ept>, and select <bpt id=\"p3\">**</bpt>Create Diagnostics Report<ept id=\"p3\">**</ept>."},{"pos":[11470,11600],"content":"In the Diagnostics Report Wizard, on the <bpt id=\"p1\">**</bpt>Type of Diagnostics Report or Test<ept id=\"p1\">**</ept> page, select <bpt id=\"p2\">**</bpt>Health report<ept id=\"p2\">**</ept> and click <bpt id=\"p3\">**</bpt>Next<ept id=\"p3\">**</ept>."},{"pos":[11605,11683],"content":"On the <bpt id=\"p1\">**</bpt>Path and Name<ept id=\"p1\">**</ept> page, accept the default settings and click <bpt id=\"p2\">**</bpt>Next<ept id=\"p2\">**</ept>."},{"pos":[11688,11771],"content":"On the <bpt id=\"p1\">**</bpt>Members to Include<ept id=\"p1\">**</ept> page, accept the default settings and click <bpt id=\"p2\">**</bpt>Next<ept id=\"p2\">**</ept>."},{"pos":[11776,11848],"content":"On the <bpt id=\"p1\">**</bpt>Options<ept id=\"p1\">**</ept> page, accept the default settings and click <bpt id=\"p2\">**</bpt>Next<ept id=\"p2\">**</ept>."},{"pos":[11853,11921],"content":"On the <bpt id=\"p1\">**</bpt>Review Settings and Create Report<ept id=\"p1\">**</ept> page, click <bpt id=\"p2\">**</bpt>Create<ept id=\"p2\">**</ept>."},{"pos":[11926,12026],"content":"Open the report in Internet Explorer, and if necessary, select the <bpt id=\"p1\">**</bpt>Allow blocked content<ept id=\"p1\">**</ept> option."},{"content":"figure 9","pos":[12030,12038]},{"content":"Figure 9.","pos":[12066,12075]},{"content":"The DFS Replication Health Report.","pos":[12076,12110]},{"pos":[12141,12201],"content":"Configure Windows Deployment Services (WDS) in a remote site"},{"content":"Like you did in the previous topic for MDT01, you need to add the MDT Production Lite Touch x64 Boot image to Windows Deployment Services on MDT02.","pos":[12203,12350]},{"content":"For the following steps, we assume that WDS has already been installed on MDT02.","pos":[12351,12431]},{"pos":[12436,12527],"content":"On MDT02, using the WDS console, right-click <bpt id=\"p1\">**</bpt>Boot Images<ept id=\"p1\">**</ept> and select <bpt id=\"p2\">**</bpt>Add Boot Image<ept id=\"p2\">**</ept>."},{"content":"Browse to the E:<ph id=\"ph1\">\\\\</ph>MDTProduction<ph id=\"ph2\">\\\\</ph>Boot<ph id=\"ph3\">\\\\</ph>LiteTouchPE<ph id=\"ph4\">\\_</ph>x64.wim file and add the image with the default settings.","pos":[12532,12641]},{"pos":[12672,12719],"content":"Deploy the Windows 10 client to the remote site"},{"content":"Now you should have a solution ready for deploying the Windows 10 client to the remote site, Stockholm, connecting to the MDT Production deployment share replica on MDT02.","pos":[12721,12892]},{"content":"Create a virtual machine with the following settings:","pos":[12898,12951]},{"content":"Name: PC0006","pos":[12960,12972]},{"content":"Location: C:<ph id=\"ph1\">\\\\</ph>VMs","pos":[12981,12998]},{"content":"Generation: 2","pos":[13007,13020]},{"content":"Memory: 2048 MB","pos":[13029,13044]},{"content":"Hard disk: 60 GB (dynamic disk)","pos":[13053,13084]},{"content":"Start the PC0006 virtual machine, and press <bpt id=\"p1\">**</bpt>Enter<ept id=\"p1\">**</ept> to start the Pre-Boot Execution Environment (PXE) boot.","pos":[13089,13198]},{"content":"The machine will now load the Windows PE boot image from the WDS server.","pos":[13199,13271]},{"content":"After Windows Preinstallation Environment (Windows PE) has booted, complete the Windows Deployment Wizard using the following settings:","pos":[13276,13411]},{"content":"Password: P@ssw0rd","pos":[13420,13438]},{"content":"Select a task sequence to execute on this computer:","pos":[13447,13498]},{"content":"Windows 10 Enterprise x64 RTM Custom Image","pos":[13511,13553]},{"content":"Computer Name: PC0006","pos":[13566,13587]},{"content":"Applications: Select the Install - Adobe Reader XI - x86 application","pos":[13600,13668]},{"content":"The setup will now start and do the following:","pos":[13673,13719]},{"content":"Install the Windows 10 Enterprise operating system.","pos":[13728,13779]},{"content":"Install the added application.","pos":[13788,13818]},{"content":"Update the operating system via your local Windows Server Update Services (WSUS) server.","pos":[13827,13915]},{"content":"Related topics","pos":[13920,13934]},{"content":"Get started with the Microsoft Deployment Toolkit (MDT)","pos":[13937,13992]},{"content":"Create a Windows 10 reference image","pos":[14051,14086]},{"content":"Deploy a Windows 10 image using MDT 2013 Update 2","pos":[14130,14179]},{"content":"Refresh a Windows 7 computer with Windows 10","pos":[14223,14267]},{"content":"Replace a Windows 7 computer with a Windows 10 computer","pos":[14320,14375]},{"content":"Configure MDT settings","pos":[14439,14461]}],"content":"---\ntitle: Build a distributed environment for Windows 10 deployment (Windows 10)\ndescription: In this topic, you will learn how to replicate your Windows 10 deployment shares to facilitate the deployment of Windows 10 in remote or branch locations.\nms.assetid: a6cd5657-6a16-4fff-bfb4-44760902d00c\nkeywords: replication, replicate, deploy, configure, remote\nms.prod: w10\nms.mktglfcycl: deploy\nms.sitesec: library\nms.pagetype: mdt\nauthor: mtniehaus\n---\n\n# Build a distributed environment for Windows 10 deployment\n\n**Applies to**\n-   Windows 10\n\nIn this topic, you will learn how to replicate your Windows 10 deployment shares to facilitate the deployment of Windows 10 in remote or branch locations. If you work in a distributed environment, replicating the deployment shares is an important part of the deployment solution. With images reaching 5 GB in size or more, you can't deploy machines in a remote office over the wire. You need to replicate the content, so that the clients can do local deployments.\n\nWe will use four machines for this topic: DC01, MDT01, MDT02, and PC0006. DC01 is a domain controller, MDT01 is a Windows Server 2012 R2 standard server, and PC0006 is a blank machine to which you will deploy Windows 10. You will configure a second deployment server (MDT02) for a remote site (Stockholm) by replicating the deployment share in the original site (New York). MDT01, MDT02, and PC0006 are members of the domain contoso.com for the fictitious Contoso Corporation. For more details on the setup for this topic, please see [Deploy Windows 10 with the Microsoft Deployment Toolkit](deploy-windows-10-with-the-microsoft-deployment-toolkit.md#proof).\n\n![figure 1](images/mdt-10-fig01.png)\n\nFigure 1. The machines used in this topic.\n\n## <a href=\"\" id=\"sec01\"></a>Replicate deployment shares\n\nReplicating the content between MDT01 (New York) and MDT02 (Stockholm) can be done in a number of different ways. The most common content replication solutions with Microsoft Deployment Toolkit (MDT) 2013 use either the Linked Deployment Shares (LDS) feature or Distributed File System Replication (DFS-R). Some organizations have used a simple robocopy script for replication of the content.\n\n**Note**  \nRobocopy has options that allow for synchronization between folders. It has a simple reporting function; it supports transmission retry; and, by default, it will only copy/remove files from the source that are newer than files on the target.\n \n### Linked deployment shares in MDT 2013 Update 2\n\nLDS is a built-in feature in MDT for replicating content. However, LDS works best with strong connections such as LAN connections with low latency. For most WAN links, DFS-R is the better option.\n\n### Why DFS-R is a better option\n\nDFS-R is not only very fast and reliable, but it also offers central monitoring, bandwidth control, and a great delta replication engine. DFS-R will work equally well whether you have 2 sites or 90. When using DFS-R for MDT, we recommend running your deployment servers on Windows Server 2008 R2 or higher. From that version on, you can configure the replication target(s) as read-only, which is exactly what you want for MDT. This way, you can have your master deployment share centralized and replicate out changes as they happen. DFS-R will quickly pick up changes at the central deployment share in MDT01 and replicate the delta changes to MDT02.\n\n## <a href=\"\" id=\"sec02\"></a>Set up Distributed File System Replication (DFS-R) for replication\n\nSetting up DFS-R for replication is a quick and straightforward process. You prepare the deployment servers and then create a replication group. To complete the setup, you configure some replication settings.\n\n### Prepare MDT01 for replication\n1.  On MDT01, using Server Manager, click **Add roles and features**.\n2.  On the **Select installation type** page, select **Role-based or feature-based installation**.\n3.  On the **Select destination server** page, select **MDT01.contoso.com** and click **Next**.\n4.  On the **Select server roles** page, expand **File and Storage Services (Installed)** and expand **File and iSCSI Services (Installed)**.\n5.  In the **Roles** list, select **DFS Replication**. In the **Add Roles and Features Wizard** dialog box, select **Add Features**, and then click **Next**.\n\n    ![figure 2](images/mdt-10-fig02.png)\n\n    Figure 2. Adding the DFS Replication role to MDT01.\n\n6.  On the **Select features** page, accept the default settings, and click **Next**.\n7.  On the **Confirm installation selections** page, click **Install**.\n8.  On the **Installation progress** page, click **Close**.\n\n### Prepare MDT02 for replication\n\n1.  On MDT02, using Server Manager, click **Add roles and features**.\n2.  On the **Select installation type** page, select **Role-based or feature-based installation**.\n3.  On the **Select destination server** page, select **MDT02.contoso.com** and click **Next**.\n4.  On the **Select server roles** page, expand **File and Storage Services (Installed)** and expand **File and iSCSI Services (Installed)**.\n5.  In the **Roles** list, select **DFS Replication**. In the **Add Roles and Features Wizard** dialog box, select **Add Features**, and then click **Next**.\n6.  On the **Select features** page, accept the default settings, and click **Next**.\n7.  On the **Confirm installation selections** page, click **Install**.\n8.  On the **Installation progress** page, click **Close**.\n\n### Create the MDTProduction folder on MDT02\n\n1.  On MDT02, using File Explorer, create the **E:\\\\MDTProduction** folder.\n2.  Share the **E:\\\\MDTProduction** folder as **MDTProduction$**. Use the default permissions.\n\n    ![figure 3](images/mdt-10-fig03.png)\n\n    Figure 3. Sharing the **E:\\\\MDTProduction folder** on MDT02.\n### Configure the deployment share\n\nWhen you have multiple deployment servers sharing the same content, you need to configure the Bootstrap.ini file with information about which server to connect to based on where the client is located. In MDT, that can be done by using the DefaultGateway property.\n1.  On MDT01, using Notepad, navigate to the **E:\\\\MDTProduction\\\\Control** folder and modify the Boostrap.ini file to look like this:\n\n    ``` syntax\n    [Settings]\n    Priority=DefaultGateway, Default\n    [DefaultGateway]\n    192.168.1.1=NewYork\n    192.168.2.1=Stockholm\n    [NewYork]\n    DeployRoot=\\\\MDT01\\MDTProduction$\n    [Stockholm]\n    DeployRoot=\\\\MDT02\\MDTProduction$\n    [Default]\n    UserDomain=CONTOSO\n    UserID=MDT_BA\n    SkipBDDWelcome=YES\n    ```\n    **Note**  \n    The DeployRoot value needs to go into the Bootstrap.ini file, but you can use the same logic in the CustomSettings.ini file. For example, you can redirect the logs to the local deployment server (SLSHARE), or have the User State Migration Tool (USMT) migration store (UDDIR) local. To learn more about USMT, see [Refresh a Windows 7 computer with Windows 10](refresh-a-windows-7-computer-with-windows-10.md) and [Replace a Windows 7 computer with a Windows 10 computer](replace-a-windows-7-computer-with-a-windows-10-computer.md).\n     \n2.  Save the Bootstrap.ini file.\n3.  Using the Deployment Workbench, right-click the **MDT Production** deployment share and select **Update Deployment Share**.\n\n    ![figure 4](images/mdt-10-fig04.png)\n\n    Figure 4. Updating the MDT Production deployment share.\n\n4.  Use the default settings for the Update Deployment Share Wizard.\n5.  After the update is complete, use the Windows Deployment Services console. In the **Boot Images** node, right-click the **MDT Production x64** boot image and select **Replace Image**.\n\n    ![figure 5](images/mdt-10-fig05.png)\n\n    Figure 5. Replacing the updated boot image in WDS.\n\n6.  Browse and select the **E:\\\\MDTProduction\\\\Boot\\\\LiteTouchPE\\_x64.wim** boot image, and then complete Replace Boot Image Wizard using the default settings.\n## <a href=\"\" id=\"sec03\"></a>Replicate the content\nOnce the MDT01 and MDT02 servers are prepared, you are ready to configure the actual replication.\n### Create the replication group\n1.  On MDT01, using DFS Management, right-click **Replication**, and select **New Replication Group**.\n2.  On the **Replication Group Type** page, select **Multipurpose replication group**, and click **Next**.\n3.  On the **Name and Domain** page, assign the **MDTProduction** name, and click **Next**.\n4.  On the **Replication Group Members** page, click **Add**, add **MDT01** and **MDT02**, and then click **Next**.\n\n    ![figure 6](images/mdt-10-fig06.png)\n\n    Figure 6. Adding the Replication Group Members.\n\n5.  On the **Topology Selection** page, select the **Full mesh** option and click **Next**.\n6.  On the **Replication Group Schedule and Bandwidth** page, accept the default settings and click **Next**.\n7.  On the **Primary Member** page, select **MDT01** and click **Next**.\n8.  On the **Folders to Replicate** page, click **Add**, type in **E:\\\\MDTProduction** as the folder to replicate, click **OK**, and then click **Next**.\n9.  On the **Local Path of MDTProduction** on the **Other Members** page, select **MDT02**, and click **Edit**.\n10. On the **Edit** page, select the **Enabled** option, type in **E:\\\\MDTProduction** as the local path of folder, select the **Make the selected replicated folder on this member read-only** check box, click **OK**, and then click **Next**.\n\n    ![figure 7](images/mdt-10-fig07.png)\n\n    Figure 7. Configure the MDT02 member.\n\n11. On the **Review Settings and Create Replication Group** page, click **Create**.\n12. On the **Confirmation** page, click **Close**.\n### Configure replicated folders\n1.  On MDT01, using DFS Management, expand **Replication** and then select **MDTProduction**.\n2.  In the middle pane, right-click the **MDT01** member and select **Properties**.\n3.  On the **MDT01 (MDTProduction) Properties** page, configure the following and then click **OK**:\n    1.  In the **Staging** tab, set the quota to **20480 MB**.\n    2.  In the **Advanced** tab, set the quota to **8192 MB**.\n        In this scenario the size of the deployment share is known, but you might need to change the values for your environment. A good rule of thumb is to get the size of the 16 largest files and make sure they fit in the staging area. Here is a Windows PowerShell example that calculates the size of the 16 largest files in the E:\\\\MDTProduction deployment share:\n        ``` syntax\n        (Get-ChildItem E:\\MDTProduction -Recurse | Sort-Object Length -Descending | Select-Object -First 16 | Measure-Object -Property Length -Sum).Sum /1GB\n        ```\n\n    ![figure 8](images/mdt-10-fig08.png)\n\n    Figure 8. Configure the Staging settings.\n\n4.  In the middle pane, right-click the **MDT02** member and select **Properties**.\n5.  On the **MDT02 (MDTProduction) Properties** page, configure the following and then click **OK**:\n    1.  In the **Staging** tab, set the quota to **20480 MB**.\n    2.  In the **Advanced** tab, set the quota to **8192 MB**.\n\n**Note**  \nIt will take some time for the replication configuration to be picked up by the replication members (MDT01 and MDT02). The time for the initial sync will depend on the WAN link speed between the sites. After that, delta changes are replicated quickly.\n \n### Verify replication\n1.  On MDT02, wait until you start to see content appear in the **E:\\\\MDTProduction** folder.\n2.  Using DFS Management, expand **Replication**, right-click **MDTProduction**, and select **Create Diagnostics Report**.\n3.  In the Diagnostics Report Wizard, on the **Type of Diagnostics Report or Test** page, select **Health report** and click **Next**.\n4.  On the **Path and Name** page, accept the default settings and click **Next**.\n5.  On the **Members to Include** page, accept the default settings and click **Next**.\n6.  On the **Options** page, accept the default settings and click **Next**.\n7.  On the **Review Settings and Create Report** page, click **Create**.\n8.  Open the report in Internet Explorer, and if necessary, select the **Allow blocked content** option.\n\n![figure 9](images/mdt-10-fig09.png)\n\nFigure 9. The DFS Replication Health Report.\n\n## <a href=\"\" id=\"sec04\"></a>Configure Windows Deployment Services (WDS) in a remote site\n\nLike you did in the previous topic for MDT01, you need to add the MDT Production Lite Touch x64 Boot image to Windows Deployment Services on MDT02. For the following steps, we assume that WDS has already been installed on MDT02.\n1.  On MDT02, using the WDS console, right-click **Boot Images** and select **Add Boot Image**.\n2.  Browse to the E:\\\\MDTProduction\\\\Boot\\\\LiteTouchPE\\_x64.wim file and add the image with the default settings.\n\n## <a href=\"\" id=\"sec05\"></a>Deploy the Windows 10 client to the remote site\n\nNow you should have a solution ready for deploying the Windows 10 client to the remote site, Stockholm, connecting to the MDT Production deployment share replica on MDT02.\n\n1.  Create a virtual machine with the following settings:\n    1.  Name: PC0006\n    2.  Location: C:\\\\VMs\n    3.  Generation: 2\n    4.  Memory: 2048 MB\n    5.  Hard disk: 60 GB (dynamic disk)\n2.  Start the PC0006 virtual machine, and press **Enter** to start the Pre-Boot Execution Environment (PXE) boot. The machine will now load the Windows PE boot image from the WDS server.\n3.  After Windows Preinstallation Environment (Windows PE) has booted, complete the Windows Deployment Wizard using the following settings:\n    1.  Password: P@ssw0rd\n    2.  Select a task sequence to execute on this computer:\n        1.  Windows 10 Enterprise x64 RTM Custom Image\n        2.  Computer Name: PC0006\n        3.  Applications: Select the Install - Adobe Reader XI - x86 application\n4.  The setup will now start and do the following:\n    1.  Install the Windows 10 Enterprise operating system.\n    2.  Install the added application.\n    3.  Update the operating system via your local Windows Server Update Services (WSUS) server.\n\n## Related topics\n\n[Get started with the Microsoft Deployment Toolkit (MDT)](get-started-with-the-microsoft-deployment-toolkit.md)\n\n\n[Create a Windows 10 reference image](create-a-windows-10-reference-image.md)\n\n[Deploy a Windows 10 image using MDT 2013 Update 2](deploy-a-windows-10-image-using-mdt.md)\n\n[Refresh a Windows 7 computer with Windows 10](refresh-a-windows-7-computer-with-windows-10.md)\n\n[Replace a Windows 7 computer with a Windows 10 computer](replace-a-windows-7-computer-with-a-windows-10-computer.md)\n\n[Configure MDT settings](configure-mdt-2013-settings.md)\n \n \n"}