{"nodes":[{"content":"Planning for MBAM 2.5 High Availability","pos":[11,50]},{"content":"Planning for MBAM 2.5 High Availability","pos":[64,103]},{"content":"Planning for MBAM 2.5 High Availability","pos":[261,300]},{"content":"Microsoft BitLocker Administration and Monitoring (MBAM) can maintain high availability through use of one or more of the following technologies, which are described in the following sections:","pos":[303,495]},{"content":"SQL Server AlwaysOn availability groups","pos":[502,541]},{"content":"Microsoft SQL Server clustering","pos":[565,596]},{"content":"IIS Network Load Balancing","pos":[626,652]},{"content":"Database mirroring in SQL Server","pos":[680,712]},{"content":"Backing up MBAM databases by using the Volume Shadow Copy Service (VSS)","pos":[740,811]},{"content":"Use the information in the following sections to help you understand the options to deploy MBAM in a highly available configuration.","pos":[825,957]},{"pos":[996,1047],"content":"Support for SQL Server AlwaysOn availability groups"},{"content":"MBAM enables you to configure and manage availability groups for the databases in Microsoft SQL Server.","pos":[1050,1153]},{"content":"An availability group for MBAM supports a failover environment where the Compliance and Audit Database and the Recovery Database fail over together rather than separately.","pos":[1154,1325]},{"content":"An availability group supports a set of read/write primary databases and one to four sets of corresponding secondary databases.","pos":[1327,1454]},{"content":"Optionally, secondary databases can be made available for read-only permission, some backup operations, or for both.","pos":[1455,1571]},{"pos":[1573,1712],"content":"For information about how to set up availability groups, see <bpt id=\"p1\">[</bpt>AlwaysOn Availability Groups<ept id=\"p1\">](http://go.microsoft.com/fwlink/?LinkId=393277)</ept>."},{"pos":[1757,1788],"content":"Microsoft SQL Server clustering"},{"content":"You can run the MBAM 2.5 Compliance and Audit Database and the Recovery Database on computers that are running SQL Server clusters.","pos":[1791,1922]},{"pos":[1965,1991],"content":"IIS Network Load Balancing"},{"content":"You can use Network Load Balancing to configure a highly available environment for computers that are running the Administration and Monitoring Website (also known as Help Desk), the Self-Service Portal, and the web services, which are deployed through Internet Information Services (IIS).","pos":[1994,2283]},{"content":"Prerequisites","pos":[2289,2302]},{"content":"Before configuring load balancing, ensure that you have met the following prerequisites:","pos":[2304,2392]},{"content":"A load balancer must be available.","pos":[2398,2432]},{"content":"You can use load balancers from Microsoft or another company.","pos":[2433,2494]},{"content":"For more information about Microsoft load balancer technology, see <bpt id=\"p1\">[</bpt>Build a Web Farm with IIS Servers<ept id=\"p1\">](http://go.microsoft.com/fwlink/?LinkId=393326)</ept>.","pos":[2495,2645]},{"content":"At least two servers are running IIS and have met all of the MBAM prerequisites to support its web features, including ASP.NET MVC 4.","pos":[2651,2784]},{"content":"MBAM databases and reports are running on a server.","pos":[2790,2841]},{"pos":[2946,3010],"content":"MBAM-specific changes that are required to enable Load Balancing"},{"content":"Complete the following tasks:","pos":[3012,3041]},{"content":"Register a Service Principal Name (SPN) for the virtual host name under the domain account that you are using for the web application pools.","pos":[3047,3187]},{"content":"For example, if the virtual host name is mbamvirtual.contoso.com, and the domain account used for the web application pools is contoso<ph id=\"ph1\">\\\\</ph>mbamapppooluser, the following command registers the SPN appropriately.","pos":[3188,3395]},{"content":"Configure the following MBAM web features:","pos":[3531,3573]},{"content":"On each server that will host the MBAM web features, use the same domain account for the application pool administrative credentials.","pos":[3583,3716]},{"content":"Specify a host name that matches the virtual host name (DNS name) of the Load Balancing cluster.","pos":[3726,3822]},{"content":"For example, when you install MBAM on a server called \"NLB1\" with a virtual host name of <bpt id=\"p1\">**</bpt>mbamvirtual.contoso.com<ept id=\"p1\">**</ept>, ensure that the host name that you specify in the Windows PowerShell cmdlet is <bpt id=\"p2\">**</bpt>mbamvirtual.contoso.com<ept id=\"p2\">**</ept>.","pos":[3823,4048]},{"content":"If you are configuring the websites in a web farm with a load balancer, you must configure the websites to use the same machine key.","pos":[4054,4186]},{"pos":[4192,4348],"content":"For more information, see the following sections in <bpt id=\"p1\">[</bpt>machineKey Element (ASP.NET Settings Schema)<ept id=\"p1\">](http://msdn.microsoft.com/library/vstudio/w8h3skw9.aspx)</ept>:"},{"content":"Machine Key Explained","pos":[4358,4379]},{"content":"Web Farm Deployment Considerations","pos":[4389,4423]},{"pos":[4429,4579],"content":"For instructions about how to automatically generate a key, see <bpt id=\"p1\">[</bpt>Generate a Machine Key (IIS 7)<ept id=\"p1\">](https://technet.microsoft.com/library/cc772287.aspx)</ept>."},{"content":"The information about Load Balancing also applies to IIS Network Load Balancing (NLB) clusters in Windows Server 2012 or Windows Server 2008 R2.","pos":[4581,4725]},{"content":"The IIS Network Load Balancing functionality in Windows Server 2012 is generally the same as in Windows Server 2008 R2.","pos":[4726,4845]},{"content":"However, some task details are different in Windows Server 2012.","pos":[4846,4910]},{"content":"For information about new ways to do tasks, see <bpt id=\"p1\">[</bpt>Common Management Tasks and Navigation in Windows Server 2012 R2 Preview and Windows Server 2012<ept id=\"p1\">](http://go.microsoft.com/fwlink/?LinkId=316371)</ept>.","pos":[4911,5105]},{"pos":[5148,5180],"content":"Database mirroring in SQL Server"},{"content":"MBAM supports the use of SQL Server mirroring, where the Compliance and Audit Database and the Recovery Database are mirrored by using two instances of SQL Server for each database.","pos":[5183,5364]},{"content":"Before implementing mirroring, be aware that mirroring is slowly being phased out, in favor of availability groups, which are discussed earlier in this topic.","pos":[5365,5523]},{"content":"To implement mirroring for MBAM, you must specify the appropriate connection strings for the mirrored database configuration by using the <bpt id=\"p1\">**</bpt>Enable-MbamWebApplication<ept id=\"p1\">**</ept> Windows PowerShell cmdlet.","pos":[5525,5719]},{"content":"For more information about the MBAM 2.5 Windows PowerShell cmdlets, see <bpt id=\"p1\">[</bpt>Configuring MBAM 2.5 Server Features by Using Windows PowerShell<ept id=\"p1\">](configuring-mbam-25-server-features-by-using-windows-powershell.md)</ept>.","pos":[5720,5927]},{"content":"Examples of implementing SQL Server mirroring by using Windows PowerShell","pos":[5933,6006]},{"content":"The following examples show how you might implement SQL Server mirroring by using Windows PowerShell cmdlets.","pos":[6008,6117]},{"content":"Example 1","pos":[6121,6130]},{"content":"Example 2","pos":[6902,6911]},{"content":"More information about SQL Server mirroring","pos":[7473,7516]},{"content":"The following links provide more information about configuring SQL Server mirroring:","pos":[7518,7602]},{"content":"How to: Prepare a Mirror Database for Mirroring (Transact-SQL)","pos":[7609,7671]},{"content":"Establish a Database Mirroring Session Using Windows Authentication (SQL Server Management Studio)","pos":[7726,7824]},{"pos":[7906,7977],"content":"Backing up MBAM databases by using the Volume Shadow Copy Service (VSS)"},{"content":"MBAM provides a Volume Shadow Copy Service (VSS) writer, called the Microsoft BitLocker Administration and Management Writer.","pos":[7980,8105]},{"content":"This VSS writer facilitates the backup of the Compliance and Audit Database and the Recovery Database.","pos":[8106,8208]},{"content":"The VSS writer is registered on every server where you enable an MBAM web application.","pos":[8210,8296]},{"content":"The MBAM VSS writer depends on the SQL Server VSS Writer, which is registered as part of the Microsoft SQL Server installation.","pos":[8297,8424]},{"content":"Any backup technology that uses VSS writers to perform backup can discover the MBAM VSS writer.","pos":[8425,8520]},{"content":"Got a suggestion for MBAM?","pos":[8525,8551]},{"content":"Add or vote on suggestions <bpt id=\"p1\">[</bpt>here<ept id=\"p1\">](http://mbam.uservoice.com/forums/268571-microsoft-bitlocker-administration-and-monitoring)</ept>.","pos":[8554,8679]},{"content":"For MBAM issues, use the <bpt id=\"p1\">[</bpt>MBAM TechNet Forum<ept id=\"p1\">](https://social.technet.microsoft.com/Forums/home?forum=mdopmbam)</ept>.","pos":[8680,8791]},{"content":"Related topics","pos":[8796,8810]},{"content":"Planning to Deploy MBAM 2.5","pos":[8814,8841]}],"content":"---\ntitle: Planning for MBAM 2.5 High Availability\ndescription: Planning for MBAM 2.5 High Availability\nauthor: jamiejdt\nms.assetid: 1e29b30c-33f1-4a52-9442-8c1391f0049c\nms.pagetype: mdop, security\nms.mktglfcycl: manage\nms.sitesec: library\nms.prod: w10\n---\n\n\n# Planning for MBAM 2.5 High Availability\n\n\nMicrosoft BitLocker Administration and Monitoring (MBAM) can maintain high availability through use of one or more of the following technologies, which are described in the following sections:\n\n-   [SQL Server AlwaysOn availability groups](#bkmk-alwayson)\n\n-   [Microsoft SQL Server clustering](#bkmk-sql-clustering)\n\n-   [IIS Network Load Balancing](#bkmk-load-balance)\n\n-   [Database mirroring in SQL Server](#bkmk-db-mirroring)\n\n-   [Backing up MBAM databases by using the Volume Shadow Copy Service (VSS)](#bkmk-vss)\n\nUse the information in the following sections to help you understand the options to deploy MBAM in a highly available configuration.\n\n## <a href=\"\" id=\"bkmk-alwayson\"></a>Support for SQL Server AlwaysOn availability groups\n\n\nMBAM enables you to configure and manage availability groups for the databases in Microsoft SQL Server. An availability group for MBAM supports a failover environment where the Compliance and Audit Database and the Recovery Database fail over together rather than separately.\n\nAn availability group supports a set of read/write primary databases and one to four sets of corresponding secondary databases. Optionally, secondary databases can be made available for read-only permission, some backup operations, or for both.\n\nFor information about how to set up availability groups, see [AlwaysOn Availability Groups](http://go.microsoft.com/fwlink/?LinkId=393277).\n\n## <a href=\"\" id=\"bkmk-sql-clustering\"></a>Microsoft SQL Server clustering\n\n\nYou can run the MBAM 2.5 Compliance and Audit Database and the Recovery Database on computers that are running SQL Server clusters.\n\n## <a href=\"\" id=\"bkmk-load-balance\"></a>IIS Network Load Balancing\n\n\nYou can use Network Load Balancing to configure a highly available environment for computers that are running the Administration and Monitoring Website (also known as Help Desk), the Self-Service Portal, and the web services, which are deployed through Internet Information Services (IIS).\n\n### Prerequisites\n\nBefore configuring load balancing, ensure that you have met the following prerequisites:\n\n-   A load balancer must be available. You can use load balancers from Microsoft or another company. For more information about Microsoft load balancer technology, see [Build a Web Farm with IIS Servers](http://go.microsoft.com/fwlink/?LinkId=393326).\n\n-   At least two servers are running IIS and have met all of the MBAM prerequisites to support its web features, including ASP.NET MVC 4.\n\n-   MBAM databases and reports are running on a server.\n\n### <a href=\"\" id=\"-------------mbam-specific-changes-that-are-required-to-enable-load-balancing\"></a> MBAM-specific changes that are required to enable Load Balancing\n\nComplete the following tasks:\n\n1.  Register a Service Principal Name (SPN) for the virtual host name under the domain account that you are using for the web application pools. For example, if the virtual host name is mbamvirtual.contoso.com, and the domain account used for the web application pools is contoso\\\\mbamapppooluser, the following command registers the SPN appropriately.\n\n    `Setspn -s http//mbamvirtual contoso\\mbamapppooluser`\n\n    `Setspn -s http//mbamvirtual.contoso.com contoso\\mbamapppooluser`\n\n2.  Configure the following MBAM web features:\n\n    -   On each server that will host the MBAM web features, use the same domain account for the application pool administrative credentials.\n\n    -   Specify a host name that matches the virtual host name (DNS name) of the Load Balancing cluster. For example, when you install MBAM on a server called \"NLB1\" with a virtual host name of **mbamvirtual.contoso.com**, ensure that the host name that you specify in the Windows PowerShell cmdlet is **mbamvirtual.contoso.com**.\n\n3.  If you are configuring the websites in a web farm with a load balancer, you must configure the websites to use the same machine key.\n\n    For more information, see the following sections in [machineKey Element (ASP.NET Settings Schema)](http://msdn.microsoft.com/library/vstudio/w8h3skw9.aspx):\n\n    -   Machine Key Explained\n\n    -   Web Farm Deployment Considerations\n\n    For instructions about how to automatically generate a key, see [Generate a Machine Key (IIS 7)](https://technet.microsoft.com/library/cc772287.aspx).\n\nThe information about Load Balancing also applies to IIS Network Load Balancing (NLB) clusters in Windows Server 2012 or Windows Server 2008 R2. The IIS Network Load Balancing functionality in Windows Server 2012 is generally the same as in Windows Server 2008 R2. However, some task details are different in Windows Server 2012. For information about new ways to do tasks, see [Common Management Tasks and Navigation in Windows Server 2012 R2 Preview and Windows Server 2012](http://go.microsoft.com/fwlink/?LinkId=316371).\n\n## <a href=\"\" id=\"bkmk-db-mirroring\"></a>Database mirroring in SQL Server\n\n\nMBAM supports the use of SQL Server mirroring, where the Compliance and Audit Database and the Recovery Database are mirrored by using two instances of SQL Server for each database. Before implementing mirroring, be aware that mirroring is slowly being phased out, in favor of availability groups, which are discussed earlier in this topic.\n\nTo implement mirroring for MBAM, you must specify the appropriate connection strings for the mirrored database configuration by using the **Enable-MbamWebApplication** Windows PowerShell cmdlet. For more information about the MBAM 2.5 Windows PowerShell cmdlets, see [Configuring MBAM 2.5 Server Features by Using Windows PowerShell](configuring-mbam-25-server-features-by-using-windows-powershell.md).\n\n### Examples of implementing SQL Server mirroring by using Windows PowerShell\n\nThe following examples show how you might implement SQL Server mirroring by using Windows PowerShell cmdlets.\n\n**Example 1**\n\n``` syntax\nEnable-MbamWebApplication -AdministrationPortal -ComplianceAndAuditDBConnectionString 'Integrated Security=SSPI;Data Source=MyDatabaseServer;Failover Partner=myMirrorServerAddress;Initial Catalog=\"MBAM Compliance Status\";' -RecoveryDBConnectionString 'Integrated Security=SSPI;Data Source=MyDatabaseServer;Failover Partner=myMirrorServerAddress;Initial Catalog=\"MBAM Recovery and Hardware\";' -AdvancedHelpdeskAccessGroup “MyDomain\\AdvancedUserGroup” -HelpdeskAccessGroup “MyDomain\\StandardUserGroup” -ReportsReadOnlyAccessGroup \"MyDomain\\ReportUserGroup\" -ReportUrl \"https://MyReportServer/ReportServer\" -Port 443 -WebServiceApplicationPoolCredential (Get-Credential) -Certificate (dir cert:\\LocalMachine\\My\\E2A7EA5533890D6567E40DFC46F53B3D31D6B689)\n```\n\n**Example 2**\n\n``` syntax\nEnable-MbamWebApplication -SelfServicePortal -ComplianceAndAuditDBConnectionString 'Integrated Security=SSPI;Data Source=MyDatabaseServer; Failover Partner=myMirrorServerAddress;Initial Catalog=\"MBAM Compliance Status\";' -RecoveryDBConnectionString 'Integrated Security=SSPI;Data Source=MyDatabaseServer;I Failover Partner=myMirrorServerAddress;Initial Catalog=\"MBAM Recovery and Hardware\";' -Port 443 -WebServiceApplicationPoolCredential (Get-Credential) -Certificate (dir cert:\\LocalMachine\\My\\E2A7EA5533890D6567E40DFC46F53B3D31D6B689)\n```\n\n### More information about SQL Server mirroring\n\nThe following links provide more information about configuring SQL Server mirroring:\n\n-   [How to: Prepare a Mirror Database for Mirroring (Transact-SQL)](http://go.microsoft.com/fwlink/?LinkId=316375)\n\n-   [Establish a Database Mirroring Session Using Windows Authentication (SQL Server Management Studio)](http://go.microsoft.com/fwlink/?LinkId=316377)\n\n## <a href=\"\" id=\"bkmk-vss\"></a>Backing up MBAM databases by using the Volume Shadow Copy Service (VSS)\n\n\nMBAM provides a Volume Shadow Copy Service (VSS) writer, called the Microsoft BitLocker Administration and Management Writer. This VSS writer facilitates the backup of the Compliance and Audit Database and the Recovery Database.\n\nThe VSS writer is registered on every server where you enable an MBAM web application. The MBAM VSS writer depends on the SQL Server VSS Writer, which is registered as part of the Microsoft SQL Server installation. Any backup technology that uses VSS writers to perform backup can discover the MBAM VSS writer.\n\n## Got a suggestion for MBAM?\n\n\nAdd or vote on suggestions [here](http://mbam.uservoice.com/forums/268571-microsoft-bitlocker-administration-and-monitoring). For MBAM issues, use the [MBAM TechNet Forum](https://social.technet.microsoft.com/Forums/home?forum=mdopmbam).\n\n## Related topics\n\n\n[Planning to Deploy MBAM 2.5](planning-to-deploy-mbam-25.md)\n\n \n\n \n\n\n\n\n\n"}