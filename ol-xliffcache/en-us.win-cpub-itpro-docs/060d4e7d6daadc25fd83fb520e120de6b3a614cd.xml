{"nodes":[{"content":"Configure Key Exchange (Main Mode) Settings (Windows 10)","pos":[11,67]},{"content":"Configure Key Exchange (Main Mode) Settings","pos":[81,124]},{"content":"Configure Key Exchange (Main Mode) Settings","pos":[280,323]},{"content":"Applies to","pos":[327,337]},{"content":"Windows 10","pos":[344,354]},{"content":"Windows Server 2016 Technical Preview","pos":[359,396]},{"content":"This procedure shows you how to configure the main mode key exchange settings used to secure the IPsec authentication traffic.","pos":[398,524]},{"content":"Administrative credentials","pos":[528,554]},{"content":"To complete these procedures, you must be a member of the Domain Administrators group, or otherwise be delegated permissions to modify the GPOs.","pos":[558,702]},{"content":"To configure key exchange settings","pos":[706,740]},{"pos":[748,922],"content":"<bpt id=\"p1\">[</bpt>Open the Group Policy Management Console to Windows Firewall with Advanced Security<ept id=\"p1\">](open-the-group-policy-management-console-to-windows-firewall-with-advanced-security.md)</ept>."},{"pos":[928,1044],"content":"In the details pane on the main Windows Firewall with Advanced Security page, click <bpt id=\"p1\">**</bpt>Windows Firewall Properties<ept id=\"p1\">**</ept>."},{"pos":[1050,1101],"content":"On the <bpt id=\"p1\">**</bpt>IPsec Settings<ept id=\"p1\">**</ept> tab, click <bpt id=\"p2\">**</bpt>Customize<ept id=\"p2\">**</ept>."},{"pos":[1107,1201],"content":"In the <bpt id=\"p1\">**</bpt>Key exchange (Main Mode)<ept id=\"p1\">**</ept> section, click <bpt id=\"p2\">**</bpt>Advanced<ept id=\"p2\">**</ept>, and then click <bpt id=\"p3\">**</bpt>Customize<ept id=\"p3\">**</ept>."},{"content":"Select the security methods to be used to help protect the main mode negotiations between the two devices.","pos":[1207,1313]},{"content":"If the security methods displayed in the list are not what you want, then do the following:","pos":[1314,1405]},{"pos":[1411,1718],"content":"**Important**  \nIn Windows Vista, Windows Server 2008, or later, you can specify only one key exchange algorithm. This means that if you want to communicate by using IPsec with another device running Windows 8 or Windows Server 2012, then you must select the same key exchange algorithm on both devices.","leadings":["","    "],"nodes":[{"content":"Important","pos":[2,11]},{"content":"In Windows Vista, Windows Server 2008, or later, you can specify only one key exchange algorithm. This means that if you want to communicate by using IPsec with another device running Windows 8 or Windows Server 2012, then you must select the same key exchange algorithm on both devices.","pos":[16,303],"nodes":[{"content":"In Windows Vista, Windows Server 2008, or later, you can specify only one key exchange algorithm.","pos":[0,97]},{"content":"This means that if you want to communicate by using IPsec with another device running Windows 8 or Windows Server 2012, then you must select the same key exchange algorithm on both devices.","pos":[98,287]}]}]},{"content":"Also, if you create a connection security rule that specifies an option that requires AuthIP instead of IKE, then only the one combination of the top integrity and encryption security method are used in the negotiation.","pos":[1724,1943]},{"content":"Make sure that all of your devices that are running at least Windows Vista and Windows Server 2008 have the same methods at the top of the list and the same key exchange algorithm selected.","pos":[1944,2133]},{"pos":[2139,2632],"content":"**Note**  \nWhen AuthIP is used, no Diffie-Hellman key exchange protocol is used. Instead, when Kerberos V5 authentication is requested, the Kerberos V5 service ticket secret is used in place of a Diffie-Hellman value. When either certificate authentication or NTLM authentication is requested, a transport level security (TLS) session is established, and its secret is used in place of the Diffie-Hellman value. This happens no matter which Diffie-Hellman key exchange protocol you select.","leadings":["","    "],"nodes":[{"content":"Note","pos":[2,6]},{"content":"When AuthIP is used, no Diffie-Hellman key exchange protocol is used. Instead, when Kerberos V5 authentication is requested, the Kerberos V5 service ticket secret is used in place of a Diffie-Hellman value. When either certificate authentication or NTLM authentication is requested, a transport level security (TLS) session is established, and its secret is used in place of the Diffie-Hellman value. This happens no matter which Diffie-Hellman key exchange protocol you select.","pos":[11,489],"nodes":[{"content":"When AuthIP is used, no Diffie-Hellman key exchange protocol is used.","pos":[0,69]},{"content":"Instead, when Kerberos V5 authentication is requested, the Kerberos V5 service ticket secret is used in place of a Diffie-Hellman value.","pos":[70,206]},{"content":"When either certificate authentication or NTLM authentication is requested, a transport level security (TLS) session is established, and its secret is used in place of the Diffie-Hellman value.","pos":[207,400]},{"content":"This happens no matter which Diffie-Hellman key exchange protocol you select.","pos":[401,478]}]}]},{"pos":[2642,2751],"content":"Remove any of the security methods that you do not want by selecting the method and then clicking <bpt id=\"p1\">**</bpt>Remove<ept id=\"p1\">**</ept>."},{"pos":[2761,2940],"content":"Add any required security method combinations by clicking <bpt id=\"p1\">**</bpt>Add<ept id=\"p1\">**</ept>, selecting the appropriate encryption algorithm and integrity algorithm from the lists, and then clicking <bpt id=\"p2\">**</bpt>OK<ept id=\"p2\">**</ept>."},{"content":"<bpt id=\"p1\">**</bpt>Caution:<ept id=\"p1\">**</ept>  We recommend that you do not include MD5 or DES in any combination.","pos":[2951,3032]},{"content":"They are included for backward compatibility only.","pos":[3033,3083]},{"content":"After the list contains only the combinations you want, use the up and down arrows to the right of the list to arrange them in the order of preference.","pos":[3093,3244]},{"content":"The combination that appears first in the list is tried first, and so on.","pos":[3245,3318]},{"content":"From the list on the right, select the key exchange algorithm that you want to use.","pos":[3324,3407]},{"content":"<bpt id=\"p1\">**</bpt>Caution:<ept id=\"p1\">**</ept>  We recommend that you do not use Diffie-Hellman Group 1.","pos":[3414,3484]},{"content":"It is included for backward compatibility only.","pos":[3485,3532]},{"content":"In <bpt id=\"p1\">**</bpt>Key lifetime (in minutes)<ept id=\"p1\">**</ept>, type the number of minutes.","pos":[3539,3600]},{"content":"When the specified number of minutes has elapsed, any IPsec operation between the two devices requires a new key.","pos":[3601,3714]},{"content":"<bpt id=\"p1\">**</bpt>Note:<ept id=\"p1\">**</ept>  You need to balance performance with security requirements.","pos":[3721,3791]},{"content":"Although a shorter key lifetime results in better security, it also reduces performance.","pos":[3792,3880]},{"content":"In <bpt id=\"p1\">**</bpt>Key lifetime (in sessions)<ept id=\"p1\">**</ept>, type the number of sessions.","pos":[3886,3949]},{"content":"After the specified number of quick mode sessions have been created within the security association protected by this key, IPsec requires a new key.","pos":[3950,4098]},{"pos":[4104,4151],"content":"Click <bpt id=\"p1\">**</bpt>OK<ept id=\"p1\">**</ept> three times to save your settings."}],"content":"---\ntitle: Configure Key Exchange (Main Mode) Settings (Windows 10)\ndescription: Configure Key Exchange (Main Mode) Settings\nms.assetid: 5c593b6b-2cd9-43de-9b4e-95943fe82f52\nms.prod: w10\nms.mktglfcycl: deploy\nms.sitesec: library\nms.pagetype: security\nauthor: brianlic-msft\n---\n\n# Configure Key Exchange (Main Mode) Settings\n\n**Applies to**\n-   Windows 10\n-   Windows Server 2016 Technical Preview\n\nThis procedure shows you how to configure the main mode key exchange settings used to secure the IPsec authentication traffic.\n\n**Administrative credentials**\n\nTo complete these procedures, you must be a member of the Domain Administrators group, or otherwise be delegated permissions to modify the GPOs.\n\n**To configure key exchange settings**\n\n1.  [Open the Group Policy Management Console to Windows Firewall with Advanced Security](open-the-group-policy-management-console-to-windows-firewall-with-advanced-security.md).\n\n2.  In the details pane on the main Windows Firewall with Advanced Security page, click **Windows Firewall Properties**.\n\n3.  On the **IPsec Settings** tab, click **Customize**.\n\n4.  In the **Key exchange (Main Mode)** section, click **Advanced**, and then click **Customize**.\n\n5.  Select the security methods to be used to help protect the main mode negotiations between the two devices. If the security methods displayed in the list are not what you want, then do the following:\n\n    **Important**  \n    In Windows Vista, Windows Server 2008, or later, you can specify only one key exchange algorithm. This means that if you want to communicate by using IPsec with another device running Windows 8 or Windows Server 2012, then you must select the same key exchange algorithm on both devices.\n\n    Also, if you create a connection security rule that specifies an option that requires AuthIP instead of IKE, then only the one combination of the top integrity and encryption security method are used in the negotiation. Make sure that all of your devices that are running at least Windows Vista and Windows Server 2008 have the same methods at the top of the list and the same key exchange algorithm selected.\n\n    **Note**  \n    When AuthIP is used, no Diffie-Hellman key exchange protocol is used. Instead, when Kerberos V5 authentication is requested, the Kerberos V5 service ticket secret is used in place of a Diffie-Hellman value. When either certificate authentication or NTLM authentication is requested, a transport level security (TLS) session is established, and its secret is used in place of the Diffie-Hellman value. This happens no matter which Diffie-Hellman key exchange protocol you select.\n\n    1.  Remove any of the security methods that you do not want by selecting the method and then clicking **Remove**.\n\n    2.  Add any required security method combinations by clicking **Add**, selecting the appropriate encryption algorithm and integrity algorithm from the lists, and then clicking **OK**.\n\n        >**Caution:**  We recommend that you do not include MD5 or DES in any combination. They are included for backward compatibility only.\n\n    3.  After the list contains only the combinations you want, use the up and down arrows to the right of the list to arrange them in the order of preference. The combination that appears first in the list is tried first, and so on.\n\n6.  From the list on the right, select the key exchange algorithm that you want to use.\n\n    >**Caution:**  We recommend that you do not use Diffie-Hellman Group 1. It is included for backward compatibility only. \n\n7.  In **Key lifetime (in minutes)**, type the number of minutes. When the specified number of minutes has elapsed, any IPsec operation between the two devices requires a new key.\n\n    >**Note:**  You need to balance performance with security requirements. Although a shorter key lifetime results in better security, it also reduces performance.\n\n8.  In **Key lifetime (in sessions)**, type the number of sessions. After the specified number of quick mode sessions have been created within the security association protected by this key, IPsec requires a new key.\n\n9.  Click **OK** three times to save your settings.\n"}