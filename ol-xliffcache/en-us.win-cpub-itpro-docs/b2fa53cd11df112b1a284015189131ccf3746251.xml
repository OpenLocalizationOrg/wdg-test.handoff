{"nodes":[{"content":"How to Configure Microsoft SQL Server Mirroring Support for App-V","pos":[11,76]},{"content":"How to Configure Microsoft SQL Server Mirroring Support for App-V","pos":[90,155]},{"content":"How to Configure Microsoft SQL Server Mirroring Support for App-V","pos":[329,394]},{"content":"You can use the following procedure to configure your Microsoft Application Virtualization (App-V) environment to use Microsoft SQL Server database mirroring.","pos":[397,555]},{"content":"Configuring database mirroring can help with disaster recovery and failover scenarios.","pos":[556,642]},{"content":"App-V 4.5 SP2 supports all modes of database mirroring currently available for Microsoft SQL Server 2005 and SQL Server 2008.","pos":[643,768]},{"content":"Note","pos":[772,776]},{"content":"This procedure is written for administrators who are familiar with setting up and configuring SQL Server databases and database mirroring with Microsoft SQL Server, and therefore covers only the specific configuration settings that are unique to App-V.","pos":[781,1033]},{"content":"To configure your App-V environment to use Microsoft SQL Server database mirroring","pos":[1040,1122]},{"content":"Set up SQL Server database mirroring of the App-V database following your standard business practices for database mirroring.","pos":[1130,1255]},{"content":"Use the following links for general information about implementing Microsoft SQL Server database mirroring:","pos":[1256,1363]},{"pos":[1373,1522],"content":"<bpt id=\"p1\">**</bpt>Microsoft SQL 2005<ept id=\"p1\">**</ept>—<bpt id=\"p2\">[</bpt>Setting Up Database Mirroring<ept id=\"p2\">](http://go.microsoft.com/fwlink/?LinkId=187478)</ept> (http://go.microsoft.com/fwlink/?LinkId=187478)"},{"pos":[1532,1681],"content":"<bpt id=\"p1\">**</bpt>Microsoft SQL 2008<ept id=\"p1\">**</ept>—<bpt id=\"p2\">[</bpt>Setting Up Database Mirroring<ept id=\"p2\">](http://go.microsoft.com/fwlink/?LinkId=187477)</ept> (http://go.microsoft.com/fwlink/?LinkId=187477)"},{"pos":[1687,1905],"content":"In addition, you can find Best Practices information in <bpt id=\"p1\">[</bpt>Database Mirroring Best Practices and Performance Considerations<ept id=\"p1\">](http://go.microsoft.com/fwlink/?LinkId=190270)</ept> (http://go.microsoft.com/fwlink/?LinkId=190270)."},{"content":"After mirroring has been set up, verify that the App-V database shows a status of <bpt id=\"p1\">**</bpt>(Principal, Synchronized)<ept id=\"p1\">**</ept>, and the mirrored database shows a status of <bpt id=\"p2\">**</bpt>(Mirror, Synchronized / Restoring)<ept id=\"p2\">**</ept>.","pos":[1911,2107]},{"content":"Resolve any mirroring issues before proceeding to the next step.","pos":[2108,2172]},{"content":"For additional information about monitoring the status, see <bpt id=\"p1\">[</bpt>Monitoring Mirroring Status<ept id=\"p1\">](http://go.microsoft.com/fwlink/?LinkId=190279)</ept> (http://go.microsoft.com/fwlink/?LinkId=190279).","pos":[2173,2358]},{"pos":[2364,2607],"content":"On the SQL Server computer that hosts the mirror of the App-V database, create the SQL Server Login for the network service account of the App-V Management Server by using the account name <bpt id=\"p1\">**</bpt><ph id=\"ph1\">&amp;lt;</ph>domain<ph id=\"ph2\">&amp;gt;\\\\&amp;lt;</ph>ManagementServerHostName<ph id=\"ph3\">&amp;gt;$</ph><ept id=\"p1\">**</ept>."},{"content":"Install the Microsoft SQL Server Native Client on the App-V Management Server, and on the computer running the App-V Management Web Service if installed on a different computer.","pos":[2613,2790]},{"content":"If you plan to have additional App-V Management Servers connect to the mirrored SQL database for load balancing, you must install the Microsoft SQL Server Native Client on those computers as well.","pos":[2791,2987]},{"content":"You can download the Microsoft SQL Server Native Client from the <bpt id=\"p1\">[</bpt>Microsoft SQL Server 2008 Feature Pack<ept id=\"p1\">](http://go.microsoft.com/fwlink/?LinkId=187479)</ept> page in the Microsoft Download Center (http://go.microsoft.com/fwlink/?LinkId=187479).","pos":[2988,3227]},{"content":"Check the registry key <bpt id=\"p1\">**</bpt>HKEY<ph id=\"ph1\">\\_</ph>LOCAL<ph id=\"ph2\">\\_</ph>MACHINE<ph id=\"ph3\">\\\\</ph>SOFTWARE<ph id=\"ph4\">\\\\</ph>Microsoft<ph id=\"ph5\">\\\\</ph>Softgrid<ph id=\"ph6\">\\\\</ph>4.5<ph id=\"ph7\">\\\\</ph>Server<ph id=\"ph8\">\\\\</ph>SQLServerName<ept id=\"p1\">**</ept> and make sure that it contains only the host name of the SQL Server.","pos":[3233,3408]},{"content":"If it includes an instance name, for example <bpt id=\"p1\">*</bpt>serverhostname<ph id=\"ph1\">\\\\</ph>instancename<ept id=\"p1\">*</ept>, the instance name must be removed.","pos":[3409,3520]},{"pos":[3526,3789],"content":"**Important**  \nThe App-V Management Server uses the TCP/IP networking library to communicate with the SQL Server when database mirroring is enabled, and therefore instance names cannot be used. The port numbers must be specified in the registry keys instead.","leadings":["","    "],"nodes":[{"content":"Important","pos":[2,11]},{"content":"The App-V Management Server uses the TCP/IP networking library to communicate with the SQL Server when database mirroring is enabled, and therefore instance names cannot be used. The port numbers must be specified in the registry keys instead.","pos":[16,259],"nodes":[{"content":"The App-V Management Server uses the TCP/IP networking library to communicate with the SQL Server when database mirroring is enabled, and therefore instance names cannot be used.","pos":[0,178]},{"content":"The port numbers must be specified in the registry keys instead.","pos":[179,243]}]}]},{"content":"Check the registry key <bpt id=\"p1\">**</bpt>HKEY<ph id=\"ph1\">\\_</ph>LOCAL<ph id=\"ph2\">\\_</ph>MACHINE<ph id=\"ph3\">\\\\</ph>SOFTWARE<ph id=\"ph4\">\\\\</ph>Microsoft<ph id=\"ph5\">\\\\</ph>Softgrid<ph id=\"ph6\">\\\\</ph>4.5<ph id=\"ph7\">\\\\</ph>Server<ph id=\"ph8\">\\\\</ph>SQLServerPort<ept id=\"p1\">**</ept> and make sure that it contains the port number that is used for SQL on the SQL Server computer.","pos":[3802,4004]},{"content":"If you are using a named instance this key value must be set to the port that is used for the named instance.","pos":[4005,4114]},{"pos":[4120,4327],"content":"Create the registry key <bpt id=\"p1\">**</bpt>HKEY<ph id=\"ph1\">\\_</ph>LOCAL<ph id=\"ph2\">\\_</ph>MACHINE<ph id=\"ph3\">\\\\</ph>SOFTWARE<ph id=\"ph4\">\\\\</ph>Microsoft<ph id=\"ph5\">\\\\</ph>Softgrid<ph id=\"ph6\">\\\\</ph>4.5<ph id=\"ph7\">\\\\</ph>Server<ph id=\"ph8\">\\\\</ph>SQLFailoverServerName<ept id=\"p1\">**</ept> as REG<ph id=\"ph9\">\\_</ph>SZ and then set the value to the host name of the SQL Server that hosts the mirror."},{"content":"Create the registry key <bpt id=\"p1\">**</bpt>HKEY<ph id=\"ph1\">\\_</ph>LOCAL<ph id=\"ph2\">\\_</ph>MACHINE<ph id=\"ph3\">\\\\</ph>SOFTWARE<ph id=\"ph4\">\\\\</ph>Microsoft<ph id=\"ph5\">\\\\</ph>Softgrid<ph id=\"ph6\">\\\\</ph>4.5<ph id=\"ph7\">\\\\</ph>Server<ph id=\"ph8\">\\\\</ph>SQLFailoverServerPort<ept id=\"p1\">**</ept> as DWORD and then set the value to the port number that is used for SQL on the computer that is running SQL Server to host the mirror.","pos":[4333,4583]},{"content":"If you are using a named instance for the mirror this key value must be set to the port number that is used for the named instance.","pos":[4584,4715]},{"content":"On the computer that is running the App-V Management Web Service, configure the Universal Data Link (UDL) text file.","pos":[4721,4837]},{"content":"In the directory where App-V is installed, double-click <bpt id=\"p1\">**</bpt>SftMgmt.udl<ept id=\"p1\">**</ept> and specify the following values:","pos":[4838,4943]},{"pos":[4953,5039],"content":"On the <bpt id=\"p1\">**</bpt>Provider<ept id=\"p1\">**</ept> tab, select the OLE DB provider <bpt id=\"p2\">**</bpt>SQL Server Native Client 10.0<ept id=\"p2\">**</ept>."},{"content":"Click <bpt id=\"p1\">**</bpt>Next<ept id=\"p1\">**</ept> to select the <bpt id=\"p2\">**</bpt>Connection<ept id=\"p2\">**</ept> tab.","pos":[5049,5097]},{"content":"In the <bpt id=\"p1\">**</bpt>Server Name<ept id=\"p1\">**</ept> box, enter the server name of the SQL Server.","pos":[5098,5166]},{"content":"Next, select <bpt id=\"p1\">**</bpt>Use Windows NT Integrated Security<ept id=\"p1\">**</ept>.","pos":[5167,5219]},{"content":"Finally, click the list <bpt id=\"p1\">**</bpt>Select the database<ept id=\"p1\">**</ept>, and then select the App-V database name.","pos":[5220,5309]},{"content":"Click the <bpt id=\"p1\">**</bpt>All<ept id=\"p1\">**</ept> tab, and then select the entry <bpt id=\"p2\">**</bpt>Failover Partner<ept id=\"p2\">**</ept>.","pos":[5319,5389]},{"content":"Click <bpt id=\"p1\">**</bpt>Edit Value<ept id=\"p1\">**</ept>, and then enter the server name of the failover SQL Server.","pos":[5390,5470]},{"content":"Click <bpt id=\"p1\">**</bpt>OK<ept id=\"p1\">**</ept>.","pos":[5471,5484]},{"pos":[5490,6003],"content":"**Important**  \nThe App-V system uses Kerberos authentication. Therefore, when you configure SQL mirroring where Kerberos Authentication is enabled on the SQL Server and the SQL Server service runs under a domain user account, you must manually configure an SPN. For more information, see “When SQL Service Uses Domain-Based Account” in the article [Configuring App-V Administration for a Distributed Environment](http://go.microsoft.com/fwlink/?LinkId=203186) (http://go.microsoft.com/fwlink/?LinkId=203186).","leadings":["","    "],"nodes":[{"content":"Important","pos":[2,11]},{"content":"The App-V system uses Kerberos authentication. Therefore, when you configure SQL mirroring where Kerberos Authentication is enabled on the SQL Server and the SQL Server service runs under a domain user account, you must manually configure an SPN. For more information, see “When SQL Service Uses Domain-Based Account” in the article [Configuring App-V Administration for a Distributed Environment](http://go.microsoft.com/fwlink/?LinkId=203186) (http://go.microsoft.com/fwlink/?LinkId=203186).","pos":[16,509],"nodes":[{"content":"The App-V system uses Kerberos authentication.","pos":[0,46]},{"content":"Therefore, when you configure SQL mirroring where Kerberos Authentication is enabled on the SQL Server and the SQL Server service runs under a domain user account, you must manually configure an SPN.","pos":[47,246]},{"content":"For more information, see “When SQL Service Uses Domain-Based Account” in the article <bpt id=\"p1\">[</bpt>Configuring App-V Administration for a Distributed Environment<ept id=\"p1\">](http://go.microsoft.com/fwlink/?LinkId=203186)</ept> (http://go.microsoft.com/fwlink/?LinkId=203186).","pos":[247,493]}]}]},{"content":"To verify that database mirroring is running correctly, test the failover and confirm that the App-V Management Server continues to function correctly.","pos":[6016,6167]},{"pos":[6173,6333],"content":"**Important**  \nProceed with care, and follow your standard business practices to ensure that system operations are not disrupted in the event of a failure.","leadings":["","    "],"nodes":[{"content":"Important","pos":[2,11]},{"content":"Proceed with care, and follow your standard business practices to ensure that system operations are not disrupted in the event of a failure.","pos":[16,156]}]},{"content":"After the failover has occurred successfully, as verified by using the SQL Server status monitoring information, right-click the <bpt id=\"p1\">**</bpt>Applications<ept id=\"p1\">**</ept> node in the App-V Management Console, and then select <bpt id=\"p2\">**</bpt>Refresh<ept id=\"p2\">**</ept>.","pos":[6346,6558]},{"content":"The list of applications should display normally if the system is working correctly.","pos":[6559,6643]},{"content":"Related topics","pos":[6648,6662]},{"content":"How to Perform Administrative Tasks in the Application Virtualization Server Management Console","pos":[6666,6761]}],"content":"---\ntitle: How to Configure Microsoft SQL Server Mirroring Support for App-V\ndescription: How to Configure Microsoft SQL Server Mirroring Support for App-V\nauthor: jamiejdt\nms.assetid: 6d069eb5-109f-460a-836a-de49473b7035\nms.pagetype: mdop, appcompat, virtualization\nms.mktglfcycl: deploy\nms.sitesec: library\nms.prod: w8\n---\n\n\n# How to Configure Microsoft SQL Server Mirroring Support for App-V\n\n\nYou can use the following procedure to configure your Microsoft Application Virtualization (App-V) environment to use Microsoft SQL Server database mirroring. Configuring database mirroring can help with disaster recovery and failover scenarios. App-V 4.5 SP2 supports all modes of database mirroring currently available for Microsoft SQL Server 2005 and SQL Server 2008.\n\n**Note**  \nThis procedure is written for administrators who are familiar with setting up and configuring SQL Server databases and database mirroring with Microsoft SQL Server, and therefore covers only the specific configuration settings that are unique to App-V.\n\n \n\n**To configure your App-V environment to use Microsoft SQL Server database mirroring**\n\n1.  Set up SQL Server database mirroring of the App-V database following your standard business practices for database mirroring. Use the following links for general information about implementing Microsoft SQL Server database mirroring:\n\n    -   **Microsoft SQL 2005**—[Setting Up Database Mirroring](http://go.microsoft.com/fwlink/?LinkId=187478) (http://go.microsoft.com/fwlink/?LinkId=187478)\n\n    -   **Microsoft SQL 2008**—[Setting Up Database Mirroring](http://go.microsoft.com/fwlink/?LinkId=187477) (http://go.microsoft.com/fwlink/?LinkId=187477)\n\n    In addition, you can find Best Practices information in [Database Mirroring Best Practices and Performance Considerations](http://go.microsoft.com/fwlink/?LinkId=190270) (http://go.microsoft.com/fwlink/?LinkId=190270).\n\n2.  After mirroring has been set up, verify that the App-V database shows a status of **(Principal, Synchronized)**, and the mirrored database shows a status of **(Mirror, Synchronized / Restoring)**. Resolve any mirroring issues before proceeding to the next step. For additional information about monitoring the status, see [Monitoring Mirroring Status](http://go.microsoft.com/fwlink/?LinkId=190279) (http://go.microsoft.com/fwlink/?LinkId=190279).\n\n3.  On the SQL Server computer that hosts the mirror of the App-V database, create the SQL Server Login for the network service account of the App-V Management Server by using the account name **&lt;domain&gt;\\\\&lt;ManagementServerHostName&gt;$**.\n\n4.  Install the Microsoft SQL Server Native Client on the App-V Management Server, and on the computer running the App-V Management Web Service if installed on a different computer. If you plan to have additional App-V Management Servers connect to the mirrored SQL database for load balancing, you must install the Microsoft SQL Server Native Client on those computers as well. You can download the Microsoft SQL Server Native Client from the [Microsoft SQL Server 2008 Feature Pack](http://go.microsoft.com/fwlink/?LinkId=187479) page in the Microsoft Download Center (http://go.microsoft.com/fwlink/?LinkId=187479).\n\n5.  Check the registry key **HKEY\\_LOCAL\\_MACHINE\\\\SOFTWARE\\\\Microsoft\\\\Softgrid\\\\4.5\\\\Server\\\\SQLServerName** and make sure that it contains only the host name of the SQL Server. If it includes an instance name, for example *serverhostname\\\\instancename*, the instance name must be removed.\n\n    **Important**  \n    The App-V Management Server uses the TCP/IP networking library to communicate with the SQL Server when database mirroring is enabled, and therefore instance names cannot be used. The port numbers must be specified in the registry keys instead.\n\n     \n\n6.  Check the registry key **HKEY\\_LOCAL\\_MACHINE\\\\SOFTWARE\\\\Microsoft\\\\Softgrid\\\\4.5\\\\Server\\\\SQLServerPort** and make sure that it contains the port number that is used for SQL on the SQL Server computer. If you are using a named instance this key value must be set to the port that is used for the named instance.\n\n7.  Create the registry key **HKEY\\_LOCAL\\_MACHINE\\\\SOFTWARE\\\\Microsoft\\\\Softgrid\\\\4.5\\\\Server\\\\SQLFailoverServerName** as REG\\_SZ and then set the value to the host name of the SQL Server that hosts the mirror.\n\n8.  Create the registry key **HKEY\\_LOCAL\\_MACHINE\\\\SOFTWARE\\\\Microsoft\\\\Softgrid\\\\4.5\\\\Server\\\\SQLFailoverServerPort** as DWORD and then set the value to the port number that is used for SQL on the computer that is running SQL Server to host the mirror. If you are using a named instance for the mirror this key value must be set to the port number that is used for the named instance.\n\n9.  On the computer that is running the App-V Management Web Service, configure the Universal Data Link (UDL) text file. In the directory where App-V is installed, double-click **SftMgmt.udl** and specify the following values:\n\n    -   On the **Provider** tab, select the OLE DB provider **SQL Server Native Client 10.0**.\n\n    -   Click **Next** to select the **Connection** tab. In the **Server Name** box, enter the server name of the SQL Server. Next, select **Use Windows NT Integrated Security**. Finally, click the list **Select the database**, and then select the App-V database name.\n\n    -   Click the **All** tab, and then select the entry **Failover Partner**. Click **Edit Value**, and then enter the server name of the failover SQL Server. Click **OK**.\n\n    **Important**  \n    The App-V system uses Kerberos authentication. Therefore, when you configure SQL mirroring where Kerberos Authentication is enabled on the SQL Server and the SQL Server service runs under a domain user account, you must manually configure an SPN. For more information, see “When SQL Service Uses Domain-Based Account” in the article [Configuring App-V Administration for a Distributed Environment](http://go.microsoft.com/fwlink/?LinkId=203186) (http://go.microsoft.com/fwlink/?LinkId=203186).\n\n     \n\n10. To verify that database mirroring is running correctly, test the failover and confirm that the App-V Management Server continues to function correctly.\n\n    **Important**  \n    Proceed with care, and follow your standard business practices to ensure that system operations are not disrupted in the event of a failure.\n\n     \n\n    After the failover has occurred successfully, as verified by using the SQL Server status monitoring information, right-click the **Applications** node in the App-V Management Console, and then select **Refresh**. The list of applications should display normally if the system is working correctly.\n\n## Related topics\n\n\n[How to Perform Administrative Tasks in the Application Virtualization Server Management Console](how-to-perform-administrative-tasks-in-the-application-virtualization-server-management-console.md)\n\n \n\n \n\n\n\n\n\n"}