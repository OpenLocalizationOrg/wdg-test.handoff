{"nodes":[{"content":"Block untrusted fonts in an enterprise (Windows 10)","pos":[11,62]},{"content":"To help protect your company from attacks which may originate from untrusted or attacker controlled font files, we’ve created the Blocking Untrusted Fonts feature.","pos":[76,239]},{"content":"Block untrusted fonts in an enterprise","pos":[471,509]},{"content":"To help protect your company from attacks which may originate from untrusted or attacker controlled font files, we’ve created the Blocking Untrusted Fonts feature.","pos":[510,673]},{"content":"Using this feature, you can turn on a global setting that stops your employees from loading untrusted fonts processed using the Graphics Device Interface (GDI) onto your network.","pos":[674,852]},{"content":"Untrusted fonts are any font installed outside of the <ph id=\"ph1\">`%windir%/Fonts`</ph> directory.","pos":[853,934]},{"content":"Blocking untrusted fonts helps prevent both remote (web-based or email-based) and local EOP attacks that can happen during the font file-parsing process.","pos":[935,1088]},{"content":"What does this mean for me?","pos":[1093,1120]},{"content":"Blocking untrusted fonts helps improve your network and employee protection against font-processing-related attacks.","pos":[1121,1237]},{"content":"By default, this feature is not turned on.","pos":[1238,1280]},{"content":"How does this feature work?","pos":[1285,1312]},{"content":"There are 3 ways to use this feature:","pos":[1313,1350]},{"content":"On.","pos":[1358,1361]},{"content":"Helps stop any font processed using GDI from loading outside of the <ph id=\"ph1\">`%windir%/Fonts`</ph> directory.","pos":[1364,1459]},{"content":"It also turns on event logging.","pos":[1460,1491]},{"content":"Audit.","pos":[1499,1505]},{"content":"Turns on event logging, but doesn’t block fonts from loading, regardless of location.","pos":[1508,1593]},{"content":"The name of the apps that use untrusted fonts appear in your event log.","pos":[1594,1665]},{"content":"Note","pos":[1670,1674]},{"content":"If you aren’t quite ready to deploy this feature into your organization, you can run it in Audit mode to see if not loading untrusted fonts causes any usability or compatibility issues.","pos":[1680,1865]},{"content":"Exclude apps to load untrusted fonts.","pos":[1873,1910]},{"content":"You can exclude specific apps, allowing them to load untrusted fonts, even while this feature is turned on.","pos":[1913,2020]},{"content":"For instructions, see <bpt id=\"p1\">[</bpt>Fix apps having problems because of blocked fonts<ept id=\"p1\">](#fix-apps-having-problems-because-of-blocked-fonts)</ept>.","pos":[2021,2147]},{"content":"Potential reductions in functionality","pos":[2152,2189]},{"content":"After you turn this feature on, your employees might experience reduced functionality when:","pos":[2190,2281]},{"content":"Sending a print job to a remote printer server that uses this feature and where the spooler process hasn’t been specifically excluded.","pos":[2287,2421]},{"content":"In this situation, any fonts that aren’t already available in the server’s %windir%/Fonts folder won’t be used.","pos":[2422,2533]},{"content":"Printing using fonts provided by the installed printer’s graphics .dll file, outside of the %windir%/Fonts folder.","pos":[2539,2653]},{"content":"For more information, see <bpt id=\"p1\">[</bpt>Introduction to Printer Graphics DLLs<ept id=\"p1\">](http://go.microsoft.com/fwlink/p/?LinkId=522302)</ept>.","pos":[2654,2769]},{"content":"Using first or third-party apps that use memory-based fonts.","pos":[2775,2835]},{"content":"Using Internet Explorer to look at websites that use embedded fonts.","pos":[2841,2909]},{"content":"In this situation, the feature blocks the embedded font, causing the website to use a default font.","pos":[2910,3009]},{"content":"However, not all fonts have all of the characters, so the website might render differently.","pos":[3010,3101]},{"content":"Using desktop Office to look at documents with embedded fonts.","pos":[3107,3169]},{"content":"In this situation, content shows up using a default font picked by Office.","pos":[3170,3244]},{"content":"Turn on and use the Blocking Untrusted Fonts feature","pos":[3249,3301]},{"content":"To turn this feature on, off, or to use audit mode:","pos":[3302,3353]},{"pos":[3359,3486],"content":"Open the registry editor (regedit.exe) and go to <ph id=\"ph1\">`HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\Session Manager\\Kernel\\`</ph>."},{"pos":[3492,3627],"content":"If the <bpt id=\"p1\">**</bpt>MitigationOptions<ept id=\"p1\">**</ept> key isn't there, right-click and add a new <bpt id=\"p2\">**</bpt>QWORD (64-bit) Value<ept id=\"p2\">**</ept>, renaming it to <bpt id=\"p3\">**</bpt>MitigationOptions<ept id=\"p3\">**</ept>."},{"pos":[3633,3768],"content":"Update the <bpt id=\"p1\">**</bpt>Value data<ept id=\"p1\">**</ept> of the <bpt id=\"p2\">**</bpt>MitigationOptions<ept id=\"p2\">**</ept> key, making sure you keep your existing value, like in the important note below:"},{"content":"To turn this feature on.","pos":[3780,3804]},{"content":"Type <bpt id=\"p1\">**</bpt>1000000000000<ept id=\"p1\">**</ept>.","pos":[3807,3830]},{"content":"To turn this feature off.","pos":[3841,3866]},{"content":"Type <bpt id=\"p1\">**</bpt>2000000000000<ept id=\"p1\">**</ept>.","pos":[3869,3892]},{"content":"To audit with this feature.","pos":[3903,3930]},{"content":"Type <bpt id=\"p1\">**</bpt>3000000000000<ept id=\"p1\">**</ept>.","pos":[3933,3956]},{"content":"Important","pos":[3961,3970]},{"content":"Your existing <bpt id=\"p1\">**</bpt>MitigationOptions<ept id=\"p1\">**</ept> values should be saved during your update.","pos":[3976,4054]},{"content":"For example, if the current value is <bpt id=\"p1\">*</bpt>1000<ept id=\"p1\">*</ept>, your updated value should be <bpt id=\"p2\">*</bpt>1000000001000<ept id=\"p2\">*</ept>.","pos":[4055,4145]},{"content":"Restart your computer.","pos":[4152,4174]},{"content":"View the event log","pos":[4179,4197]},{"content":"After you turn this feature on, or start using Audit mode, you can look at your event logs for details.","pos":[4198,4301]},{"content":"To look at your event log","pos":[4305,4330]},{"pos":[4337,4454],"content":"Open the event viewer (eventvwr.exe) and go to <bpt id=\"p1\">**</bpt>Application and Service Logs/Microsoft/Windows/Win32k/Operational<ept id=\"p1\">**</ept>."},{"pos":[4459,4522],"content":"Scroll down to <bpt id=\"p1\">**</bpt>EventID: 260<ept id=\"p1\">**</ept> and review the relevant events."},{"content":"Event Example 1 - MS Word","pos":[4529,4554]},{"content":"WINWORD.EXE attempted loading a font that is restricted by font loading policy.","pos":[4561,4640]},{"content":"FontType: Memory","pos":[4645,4661]},{"content":"FontPath:","pos":[4666,4675]},{"content":"Blocked: true","pos":[4680,4693]},{"content":"Note","pos":[4699,4703]},{"content":"Because the <bpt id=\"p1\">**</bpt>FontType<ept id=\"p1\">**</ept> is <bpt id=\"p2\">*</bpt>Memory<ept id=\"p2\">*</ept>, there’s no associated <bpt id=\"p3\">**</bpt>FontPath.<ept id=\"p3\">**</ept>","pos":[4709,4782]},{"content":"Event Example 2 - Winlogon","pos":[4789,4815]},{"content":"Winlogon.exe attempted loading a font that is restricted by font loading policy.","pos":[4822,4902]},{"content":"FontType: File","pos":[4907,4921]},{"content":"FontPath:","pos":[4926,4935]},{"content":"Blocked: true","pos":[5020,5033]},{"content":"Note","pos":[5039,5043]},{"content":"Because the <bpt id=\"p1\">**</bpt>FontType<ept id=\"p1\">**</ept> is <bpt id=\"p2\">*</bpt>File<ept id=\"p2\">*</ept>, there’s also an associated <bpt id=\"p3\">**</bpt>FontPath.<ept id=\"p3\">**</ept>","pos":[5049,5125]},{"content":"Event Example 3 - Internet Explorer running in Audit mode","pos":[5132,5189]},{"content":"Iexplore.exe attempted loading a font that is restricted by font loading policy.","pos":[5196,5276]},{"content":"FontType: Memory","pos":[5281,5297]},{"content":"FontPath:","pos":[5302,5311]},{"content":"Blocked: false","pos":[5316,5330]},{"content":"Note","pos":[5336,5340]},{"content":"In Audit mode, the problem is recorded, but the font isn’t blocked.","pos":[5346,5413]},{"content":"Fix apps having problems because of blocked fonts","pos":[5418,5467]},{"content":"Your company may still need apps that are having problems because of blocked fonts, so we suggest that you first run this feature in Audit mode to determine which fonts are causing the problems.","pos":[5468,5662]},{"content":"After you figure out the problematic fonts, you can try to fix your apps in 2 ways: by directly installing the fonts into the %windir%/Fonts directory or by excluding the underlying processes and letting the fonts load.","pos":[5664,5883]},{"content":"As the default solution, we highly recommend that you install the problematic font.","pos":[5884,5967]},{"content":"Installing fonts is safer than excluding apps because excluded apps can load any font, trusted or untrusted.","pos":[5968,6076]},{"content":"To fix your apps by installing the problematic fonts (recommended)","pos":[6080,6146]},{"content":"On each computer with the app installed, right-click on the font name and click <bpt id=\"p1\">**</bpt>Install<ept id=\"p1\">**</ept>.","pos":[6154,6246]},{"content":"The font should automatically install into your <ph id=\"ph1\">`%windir%/Fonts`</ph> directory.","pos":[6249,6324]},{"content":"If it doesn’t, you’ll need to manually copy the font files into the <bpt id=\"p1\">**</bpt>Fonts<ept id=\"p1\">**</ept> directory and run the installation from there.","pos":[6325,6449]},{"content":"To fix your apps by excluding processes","pos":[6453,6492]},{"content":"On each computer with the app installed, open regedit.exe and go to <ph id=\"ph1\">`HKEY_LOCAL_MACHINE\\Software\\Microsoft\\Windows NT\\CurrentVersion\\Image File Execution Options\\&lt;process_image_name&gt;`</ph>.","pos":[6500,6684]},{"content":"Like, if you want to exclude Microsoft Word processes, you’d use <ph id=\"ph1\">`HKEY_LOCAL_MACHINE\\Software\\Microsoft\\Windows NT\\CurrentVersion\\Image File Execution Options\\Winword.exe`</ph>.","pos":[6685,6857]},{"pos":[6863,7111],"content":"Add any additional processes that need to be excluded here, and then turn the Blocking untrusted fonts feature on, using steps 2 and 3 in <bpt id=\"p1\">[</bpt>Turn on and use the Blocking Untrusted Fonts feature<ept id=\"p1\">](#turn-on-and-use-the-blocking-untrusted-fonts-feature)</ept>."}],"content":"---\ntitle: Block untrusted fonts in an enterprise (Windows 10)\ndescription: To help protect your company from attacks which may originate from untrusted or attacker controlled font files, we’ve created the Blocking Untrusted Fonts feature.\nms.assetid: a3354c8e-4208-4be6-bc19-56a572c361b4\nkeywords: font blocking, untrusted font blocking, block fonts, untrusted fonts\nms.prod: w10\nms.mktglfcycl: deploy\nms.pagetype: security\nms.sitesec: library\nauthor: eross-msft\n---\n\n# Block untrusted fonts in an enterprise\nTo help protect your company from attacks which may originate from untrusted or attacker controlled font files, we’ve created the Blocking Untrusted Fonts feature. Using this feature, you can turn on a global setting that stops your employees from loading untrusted fonts processed using the Graphics Device Interface (GDI) onto your network. Untrusted fonts are any font installed outside of the `%windir%/Fonts` directory. Blocking untrusted fonts helps prevent both remote (web-based or email-based) and local EOP attacks that can happen during the font file-parsing process.\n\n## What does this mean for me?\nBlocking untrusted fonts helps improve your network and employee protection against font-processing-related attacks. By default, this feature is not turned on.\n\n## How does this feature work?\nThere are 3 ways to use this feature:\n\n-   **On.** Helps stop any font processed using GDI from loading outside of the `%windir%/Fonts` directory. It also turns on event logging.\n\n-   **Audit.** Turns on event logging, but doesn’t block fonts from loading, regardless of location. The name of the apps that use untrusted fonts appear in your event log.<p>**Note**<br>If you aren’t quite ready to deploy this feature into your organization, you can run it in Audit mode to see if not loading untrusted fonts causes any usability or compatibility issues.\n\n-   **Exclude apps to load untrusted fonts.** You can exclude specific apps, allowing them to load untrusted fonts, even while this feature is turned on. For instructions, see [Fix apps having problems because of blocked fonts](#fix-apps-having-problems-because-of-blocked-fonts).\n\n## Potential reductions in functionality\nAfter you turn this feature on, your employees might experience reduced functionality when:\n\n-   Sending a print job to a remote printer server that uses this feature and where the spooler process hasn’t been specifically excluded. In this situation, any fonts that aren’t already available in the server’s %windir%/Fonts folder won’t be used.\n\n-   Printing using fonts provided by the installed printer’s graphics .dll file, outside of the %windir%/Fonts folder. For more information, see [Introduction to Printer Graphics DLLs](http://go.microsoft.com/fwlink/p/?LinkId=522302).\n\n-   Using first or third-party apps that use memory-based fonts.\n\n-   Using Internet Explorer to look at websites that use embedded fonts. In this situation, the feature blocks the embedded font, causing the website to use a default font. However, not all fonts have all of the characters, so the website might render differently.\n\n-   Using desktop Office to look at documents with embedded fonts. In this situation, content shows up using a default font picked by Office.\n\n## Turn on and use the Blocking Untrusted Fonts feature\nTo turn this feature on, off, or to use audit mode:\n\n1.  Open the registry editor (regedit.exe) and go to `HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Control\\Session Manager\\Kernel\\`.\n\n2.  If the **MitigationOptions** key isn't there, right-click and add a new **QWORD (64-bit) Value**, renaming it to **MitigationOptions**.\n\n3.  Update the **Value data** of the **MitigationOptions** key, making sure you keep your existing value, like in the important note below:\n\n    -   **To turn this feature on.** Type **1000000000000**.\n    -   **To turn this feature off.** Type **2000000000000**.\n    -   **To audit with this feature.** Type **3000000000000**.<p>**Important**<br>Your existing **MitigationOptions** values should be saved during your update. For example, if the current value is *1000*, your updated value should be *1000000001000*. \n\n4.  Restart your computer.\n\n## View the event log\nAfter you turn this feature on, or start using Audit mode, you can look at your event logs for details.\n\n**To look at your event log**\n\n1. Open the event viewer (eventvwr.exe) and go to **Application and Service Logs/Microsoft/Windows/Win32k/Operational**.\n\n2. Scroll down to **EventID: 260** and review the relevant events.\n<p>\n**Event Example 1 - MS Word**<br>\nWINWORD.EXE attempted loading a font that is restricted by font loading policy.<br>\nFontType: Memory<br>\nFontPath:<br>\nBlocked: true<p>\n**Note**<br>Because the **FontType** is *Memory*, there’s no associated **FontPath.**\n<p>\n**Event Example 2 - Winlogon**<br>\nWinlogon.exe attempted loading a font that is restricted by font loading policy.<br>\nFontType: File<br>\nFontPath: `\\??\\C:\\PROGRAM FILES (X86)\\COMMON FILES\\MICROSOFT SHARED\\EQUATION\\MTEXTRA.TTF`<br>\nBlocked: true<p>\n**Note**<br>Because the **FontType** is *File*, there’s also an associated **FontPath.**\n<p>\n**Event Example 3 - Internet Explorer running in Audit mode**<br>\nIexplore.exe attempted loading a font that is restricted by font loading policy.<br>\nFontType: Memory<br>\nFontPath:<br>\nBlocked: false<p>\n**Note**<br>In Audit mode, the problem is recorded, but the font isn’t blocked.\n\n## Fix apps having problems because of blocked fonts\nYour company may still need apps that are having problems because of blocked fonts, so we suggest that you first run this feature in Audit mode to determine which fonts are causing the problems.\n\nAfter you figure out the problematic fonts, you can try to fix your apps in 2 ways: by directly installing the fonts into the %windir%/Fonts directory or by excluding the underlying processes and letting the fonts load. As the default solution, we highly recommend that you install the problematic font. Installing fonts is safer than excluding apps because excluded apps can load any font, trusted or untrusted.\n\n**To fix your apps by installing the problematic fonts (recommended)**\n\n-   On each computer with the app installed, right-click on the font name and click **Install**.<p>The font should automatically install into your `%windir%/Fonts` directory. If it doesn’t, you’ll need to manually copy the font files into the **Fonts** directory and run the installation from there.\n\n**To fix your apps by excluding processes**\n\n1.  On each computer with the app installed, open regedit.exe and go to `HKEY_LOCAL_MACHINE\\Software\\Microsoft\\Windows NT\\CurrentVersion\\Image File Execution Options\\<process_image_name>`. Like, if you want to exclude Microsoft Word processes, you’d use `HKEY_LOCAL_MACHINE\\Software\\Microsoft\\Windows NT\\CurrentVersion\\Image File Execution Options\\Winword.exe`.\n\n2.  Add any additional processes that need to be excluded here, and then turn the Blocking untrusted fonts feature on, using steps 2 and 3 in [Turn on and use the Blocking Untrusted Fonts feature](#turn-on-and-use-the-blocking-untrusted-fonts-feature).\n\n \n\n \n\n\n\n\n\n"}