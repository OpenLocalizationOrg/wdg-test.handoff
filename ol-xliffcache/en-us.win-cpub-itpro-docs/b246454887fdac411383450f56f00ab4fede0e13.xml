{"nodes":[{"content":"Protecting cluster shared volumes and storage area networks with BitLocker (Windows 10)","pos":[11,98]},{"content":"This topic for IT pros describes how to protect CSVs and SANs with BitLocker.","pos":[112,189]},{"content":"Protecting cluster shared volumes and storage area networks with BitLocker","pos":[345,419]},{"content":"Applies to","pos":[423,433]},{"content":"Windows 10","pos":[440,450]},{"content":"This topic for IT pros describes how to protect CSVs and SANs with BitLocker.","pos":[452,529]},{"content":"BitLocker can protect both physical disk resources and cluster shared volumes version 2.0 (CSV2.0).","pos":[531,630]},{"content":"BitLocker on clustered volumes allows for an additional layer of protection for administrators wishing to protect sensitive, highly available data.","pos":[631,778]},{"content":"By adding additional protectors to the clustered volume, administrators can also add an additional barrier of security to resources within an organization by allowing only certain user accounts access to unlock the BitLocker volume.","pos":[779,1011]},{"pos":[1085,1132],"content":"Configuring BitLocker on Cluster Shared Volumes"},{"content":"Using BitLocker with Clustered Volumes","pos":[1138,1176]},{"content":"BitLocker on volumes within a cluster are managed based on how the cluster service \"views\" the volume to be protected.","pos":[1178,1296]},{"content":"The volume can be a physical disk resource such as a logical unit number (LUN) on a storage area network (SAN) or network attached storage (NAS).","pos":[1297,1442]},{"content":"<bpt id=\"p1\">**</bpt>Important<ept id=\"p1\">**</ept>  SANs used with BitLocker must have obtained Windows Hardware Certification.","pos":[1445,1535]},{"content":"For more info, see <bpt id=\"p1\">[</bpt>Windows Hardware Lab Kit<ept id=\"p1\">](https://msdn.microsoft.com/library/windows/hardware/dn930814.aspx)</ept>.","pos":[1536,1649]},{"content":"Alternatively, the volume can be a cluster-shared volume, a shared namespace, within the cluster.","pos":[1652,1749]},{"content":"Windows Server 2012 expanded the CSV architecture, now known as CSV2.0, to enable support for BitLocker.","pos":[1750,1854]},{"content":"When using BitLocker with volumes designated for a cluster, the volume will need to turn on BitLocker before its addition to the storage pool within cluster or put the resource into maintenance mode before BitLocker operations will complete.","pos":[1855,2097]},{"content":"Windows PowerShell or the manage-bde command line interface is the preferred method to manage BitLocker on CSV2.0 volumes.","pos":[2099,2221]},{"content":"This is recommended over the BitLocker Control Panel item because CSV2.0 volumes are mount points.","pos":[2222,2320]},{"content":"Mount points are an NTFS object that is used to provide an entry point to other volumes.","pos":[2321,2409]},{"content":"Mount points do not require the use of a drive letter.","pos":[2410,2464]},{"content":"Volumes that lack drive letters do not appear in the BitLocker Control Panel item.","pos":[2465,2547]},{"content":"Additionally, the new Active Directory-based protector option required for cluster disk resource or CSV2.0 resources is not available in the Control Panel item.","pos":[2548,2708]},{"content":"<bpt id=\"p1\">**</bpt>Note:<ept id=\"p1\">**</ept>  Mount points can be used to support remote mount points on SMB based network shares.","pos":[2711,2806]},{"content":"This type of share is not supported for BitLocker encryption.","pos":[2807,2868]},{"content":"For thinly provisioned storage, such as a Dynamic Virtual Hard Disk (VHD), BitLocker runs in Used Disk Space Only encryption mode.","pos":[2871,3001]},{"content":"You cannot use the <bpt id=\"p1\">**</bpt>manage-bde –WipeFreeSpace<ept id=\"p1\">**</ept> command to transition the volume to full-volume encryption on these types of volumes.","pos":[3002,3136]},{"content":"This occurs because Full Encryption requires an end marker for the volume and dynamically expanding VHDs do not have a static end of volume marker.","pos":[3137,3285]},{"content":"Active Directory-based protector","pos":[3291,3323]},{"content":"You can also use an Active Directory Domain Services (AD DS) protector for protecting clustered volumes held within your AD DS infrastructure.","pos":[3325,3467]},{"content":"The <bpt id=\"p1\">**</bpt>ADAccountOrGroup<ept id=\"p1\">**</ept> protector is a domain security identifier (SID)-based protector that can be bound to a user account, machine account or group.","pos":[3468,3619]},{"content":"When an unlock request is made for a protected volume, the BitLocker service interrupts the request and uses the BitLocker protect/unprotect APIs to unlock or deny the request.","pos":[3620,3796]},{"content":"BitLocker will unlock protected volumes without user intervention by attempting protectors in the following order:","pos":[3797,3911]},{"content":"Clear key","pos":[3917,3926]},{"content":"Driver-based auto-unlock key","pos":[3931,3959]},{"content":"ADAccountOrGroup protector","pos":[3964,3990]},{"content":"Service context protector","pos":[4000,4025]},{"content":"User protector","pos":[4034,4048]},{"content":"Registry-based auto-unlock key","pos":[4054,4084]},{"pos":[4087,4193],"content":"<bpt id=\"p1\">**</bpt>Note:<ept id=\"p1\">**</ept>  A Windows Server 2012 or later domain controller is required for this feature to work properly."},{"content":"Turning on BitLocker before adding disks to a cluster using Windows PowerShell","pos":[4200,4278]},{"content":"BitLocker encryption is available for disks before or after addition to a cluster storage pool.","pos":[4280,4375]},{"content":"The advantage of encrypting volumes prior to adding them to a cluster is that the disk resource does not require suspending the resource to complete the operation.","pos":[4376,4539]},{"content":"To turn on BitLocker for a disk before adding it to a cluster, do the following:","pos":[4540,4620]},{"content":"Install the BitLocker Drive Encryption feature if it is not already installed.","pos":[4626,4704]},{"content":"Ensure the disk is formatted NTFS and has a drive letter assigned to it.","pos":[4709,4781]},{"content":"Enable BitLocker on the volume using your choice of protector.","pos":[4786,4848]},{"content":"A password protector is used in the Windows PowerShell script example below.","pos":[4849,4925]},{"content":"Identify the name of the cluster with Windows PowerShell.","pos":[5012,5069]},{"pos":[5115,5213],"content":"Add an <bpt id=\"p1\">**</bpt>ADAccountOrGroup<ept id=\"p1\">**</ept>protector to the volume using the cluster name using a command such as:"},{"pos":[5328,5547],"content":"<bpt id=\"p1\">**</bpt>Warning:<ept id=\"p1\">**</ept>  You must add an <bpt id=\"p2\">**</bpt>ADAccountOrGroup<ept id=\"p2\">**</ept> protector using the cluster CNO for a BitLocker enabled volume to either be shared in a Cluster Shared Volume or to failover properly in a traditional failover cluster."},{"content":"Repeat steps 1-6 for each disk in the cluster.","pos":[5558,5604]},{"content":"Add the volume(s) to the cluster.","pos":[5609,5642]},{"content":"Turning on BitLocker for a clustered disk using Windows PowerShell","pos":[5648,5714]},{"content":"When the cluster service owns a disk resource already, it needs to be set into maintenance mode before BitLocker can be enabled.","pos":[5716,5844]},{"content":"Use the following steps for turning BitLocker on for a clustered disk:","pos":[5845,5915]},{"content":"Install the BitLocker Drive Encryption feature if it is not already installed.","pos":[5921,5999]},{"content":"Check the status of the cluster disk using Windows PowerShell.","pos":[6004,6066]},{"content":"Put the physical disk resource into maintenance mode using Windows PowerShell.","pos":[6137,6215]},{"content":"Enable BitLocker on the volume using your choice of protector.","pos":[6312,6374]},{"content":"A password protector is used in the example below.","pos":[6375,6425]},{"content":"Identify the name of the cluster with Windows PowerShell","pos":[6512,6568]},{"pos":[6614,6725],"content":"Add an <bpt id=\"p1\">**</bpt>ADAccountOrGroup<ept id=\"p1\">**</ept> protector with the Cluster Name Object (CNO) to the volume using a command such as:"},{"pos":[6840,7059],"content":"<bpt id=\"p1\">**</bpt>Warning:<ept id=\"p1\">**</ept>  You must add an <bpt id=\"p2\">**</bpt>ADAccountOrGroup<ept id=\"p2\">**</ept> protector using the cluster CNO for a BitLocker enabled volume to either be shared in a Cluster Shared Volume or to failover properly in a traditional failover cluster."},{"content":"Repeat steps 1-6 for each disk in the cluster.","pos":[7070,7116]},{"content":"Add the volume(s) to the cluster","pos":[7121,7153]},{"content":"Adding BitLocker encrypted volumes to a cluster using manage-bde","pos":[7159,7223]},{"content":"You can also use manage-bde to enable BitLocker on clustered volumes.","pos":[7225,7294]},{"content":"The steps needed to add a physical disk resource or CSV2.0 volume to an existing cluster includes the following:","pos":[7295,7407]},{"content":"Verify the BitLocker Drive Encryption feature is installed on the computer.","pos":[7413,7488]},{"content":"Ensure new storage is formatted as NTFS.","pos":[7493,7533]},{"content":"Encrypt the volume, add a recovery key and add the cluster administrator as a protector key using the manage-bde command line interface (see example):","pos":[7538,7688]},{"content":"BitLocker will check to see if the disk is already part of a cluster.","pos":[7776,7845]},{"content":"If it is, administrators will encounter a hard block.","pos":[7846,7899]},{"content":"Otherwise, the encryption will continue.","pos":[7900,7940]},{"content":"Using the -sync parameter is optional.","pos":[7953,7991]},{"content":"Using it ensures the command waits until the encryption for the volume is completed before releasing the volume for use in the cluster storage pool.","pos":[7992,8140]},{"content":"Open the Failover Cluster Manager snap-in or cluster PowerShell cmdlets to enable the disk to be clustered","pos":[8146,8252]},{"content":"Once the disk is clustered it can also be enabled for CSV.","pos":[8262,8320]},{"content":"During the resource online operation, cluster will check to see if the disk is BitLocker encrypted.","pos":[8326,8425]},{"content":"If the volume is not BitLocker enabled, traditional cluster online operations occur.","pos":[8435,8519]},{"content":"If the volume is BitLocker enabled, the following check occurs:","pos":[8528,8591]},{"content":"If volume is <bpt id=\"p1\">**</bpt>locked<ept id=\"p1\">**</ept>, BitLocker will impersonate the CNO and unlock the volume using the CNO protector.","pos":[8605,8711]},{"content":"If this operation fails an event will be logged that the volume could not be unlocked and the online operation will fail.","pos":[8712,8833]},{"content":"Once the disk is online in the storage pool, it can be added to a CSV by right clicking on the disk resource and choosing \"<bpt id=\"p1\">**</bpt>Add to cluster shared volumes<ept id=\"p1\">**</ept>\".","pos":[8839,8997]},{"content":"CSVs can include both encrypted and unencrypted volumes.","pos":[8998,9054]},{"content":"To check the status of a particular volume for BitLocker encryption, administrators can utilize the manage-bde -status command with a path to the volume inside the CSV namespace as seen in the example command line below.","pos":[9055,9275]},{"content":"Physical Disk Resources","pos":[9344,9367]},{"content":"Unlike CSV2.0 volumes, physical disk resources can only be accessed by one cluster node at a time.","pos":[9369,9467]},{"content":"This means that operations such as encrypting, decrypting, locking or unlocking volumes require context to perform.","pos":[9468,9583]},{"content":"For example, you cannot unlock or decrypt a physical disk resource if you are not administering the cluster node that owns the disk resource because the disk resource is not available.","pos":[9584,9768]},{"content":"Restrictions on BitLocker actions with cluster volumes","pos":[9774,9828]},{"content":"The following table contains information about both Physical Disk Resources (i.e. traditional failover cluster volumes) and Cluster Shared Volumes (CSV) and the actions that are allowed by BitLocker in each situation.","pos":[9830,10047]},{"content":"Action","pos":[10233,10239]},{"content":"On owner node of failover volume","pos":[10286,10318]},{"content":"On Metadata Server (MDS) of CSV","pos":[10365,10396]},{"content":"On (Data Server) DS of CSV","pos":[10443,10469]},{"content":"Maintenance Mode","pos":[10516,10532]},{"content":"Manage-bde –on","pos":[10603,10617]},{"content":"Blocked","pos":[10656,10663]},{"content":"Blocked","pos":[10693,10700]},{"content":"Blocked","pos":[10730,10737]},{"content":"Allowed","pos":[10767,10774]},{"content":"Manage-bde –off","pos":[10835,10850]},{"content":"Blocked","pos":[10889,10896]},{"content":"Blocked","pos":[10926,10933]},{"content":"Blocked","pos":[10963,10970]},{"content":"Allowed","pos":[11000,11007]},{"content":"Manage-bde Pause/Resume","pos":[11069,11092]},{"content":"Blocked","pos":[11131,11138]},{"content":"Blocked**","pos":[11168,11177]},{"content":"Blocked","pos":[11207,11214]},{"content":"Allowed","pos":[11244,11251]},{"content":"Manage-bde –lock","pos":[11312,11328]},{"content":"Blocked","pos":[11367,11374]},{"content":"Blocked","pos":[11404,11411]},{"content":"Blocked","pos":[11441,11448]},{"content":"Allowed","pos":[11478,11485]},{"content":"manage-bde –wipe","pos":[11547,11563]},{"content":"Blocked","pos":[11602,11609]},{"content":"Blocked","pos":[11639,11646]},{"content":"Blocked","pos":[11676,11683]},{"content":"Allowed","pos":[11713,11720]},{"content":"Unlock","pos":[11781,11787]},{"content":"Automatic via cluster service","pos":[11826,11855]},{"content":"Automatic via cluster service","pos":[11885,11914]},{"content":"Automatic via cluster service","pos":[11944,11973]},{"content":"Allowed","pos":[12003,12010]},{"content":"manage-bde –protector –add","pos":[12072,12098]},{"content":"Allowed","pos":[12137,12144]},{"content":"Allowed","pos":[12174,12181]},{"content":"Blocked","pos":[12211,12218]},{"content":"Allowed","pos":[12248,12255]},{"content":"manage-bde -protector -delete","pos":[12316,12345]},{"content":"Allowed","pos":[12384,12391]},{"content":"Allowed","pos":[12421,12428]},{"content":"Blocked","pos":[12458,12465]},{"content":"Allowed","pos":[12495,12502]},{"content":"manage-bde –autounlock","pos":[12564,12586]},{"content":"Allowed (not recommended)","pos":[12625,12650]},{"content":"Allowed (not recommended)","pos":[12680,12705]},{"content":"Blocked","pos":[12735,12742]},{"content":"Allowed (not recommended)","pos":[12772,12797]},{"content":"Manage-bde -upgrade","pos":[12858,12877]},{"content":"Allowed","pos":[12916,12923]},{"content":"Allowed","pos":[12953,12960]},{"content":"Blocked","pos":[12990,12997]},{"content":"Allowed","pos":[13027,13034]},{"content":"Shrink","pos":[13096,13102]},{"content":"Allowed","pos":[13141,13148]},{"content":"Allowed","pos":[13178,13185]},{"content":"Blocked","pos":[13215,13222]},{"content":"Allowed","pos":[13252,13259]},{"content":"Extend","pos":[13320,13326]},{"content":"Allowed","pos":[13365,13372]},{"content":"Allowed","pos":[13402,13409]},{"content":"Blocked","pos":[13439,13446]},{"content":"Allowed","pos":[13476,13483]},{"pos":[13520,13691],"content":"<bpt id=\"p1\">**</bpt>Note:<ept id=\"p1\">**</ept>  Although the manage-bde -pause command is Blocked in clusters, the cluster service will automatically resume a paused encryption or decryption from the MDS node"},{"content":"In the case where a physical disk resource experiences a failover event during conversion, the new owning node will detect the conversion is not complete and will complete the conversion process.","pos":[13694,13889]},{"content":"Other considerations when using BitLocker on CSV2.0","pos":[13895,13946]},{"content":"Some other considerations to take into account for BitLocker on clustered storage include the following:","pos":[13948,14052]},{"content":"BitLocker volumes have to be initialized and beginning encryption before they are available to add to a CSV2.0 volume.","pos":[14057,14175]},{"content":"If an administrator needs to decrypt a CSV volume, remove the volume from the cluster or put into disk maintenance mode.","pos":[14180,14300]},{"content":"You can add the CSV back to the cluster while waiting for decryption to complete.","pos":[14301,14382]},{"content":"If an administrator needs to start encrypting a CSV volume, remove the volume from the cluster or put it in maintenance mode.","pos":[14387,14512]},{"content":"If conversion is paused with encryption in progress and the CSV volume is offline from the cluster, the cluster thread (health check) will automatically resume conversion when the volume is online to the cluster.","pos":[14517,14729]},{"content":"If conversion is paused with encryption in progress and a physical disk resource volume is offline from the cluster, the BitLocker driver will automatically resume conversion when the volume is online to the cluster.","pos":[14734,14950]},{"content":"If conversion is paused with encryption in progress, while the CSV volume is in maintenance mode, the cluster thread (health check) will automatically resume conversion when moving the volume back from maintenance.","pos":[14955,15169]},{"content":"If conversion is paused with encryption in progress, while the disk resource volume is in maintenance mode, the BitLocker driver will automatically resume conversion when the volume is moved back from maintenance mode.","pos":[15174,15392]}],"content":"---\ntitle: Protecting cluster shared volumes and storage area networks with BitLocker (Windows 10)\ndescription: This topic for IT pros describes how to protect CSVs and SANs with BitLocker.\nms.assetid: ecd25a10-42c7-4d31-8a7e-ea52c8ebc092\nms.prod: w10\nms.mktglfcycl: deploy\nms.sitesec: library\nms.pagetype: security\nauthor: brianlic-msft\n---\n\n# Protecting cluster shared volumes and storage area networks with BitLocker\n\n**Applies to**\n-   Windows 10\n\nThis topic for IT pros describes how to protect CSVs and SANs with BitLocker.\n\nBitLocker can protect both physical disk resources and cluster shared volumes version 2.0 (CSV2.0). BitLocker on clustered volumes allows for an additional layer of protection for administrators wishing to protect sensitive, highly available data. By adding additional protectors to the clustered volume, administrators can also add an additional barrier of security to resources within an organization by allowing only certain user accounts access to unlock the BitLocker volume.\n\n## <a href=\"\" id=\"configuring-bitlocker-on-cluster-shared-volumes-\"></a>Configuring BitLocker on Cluster Shared Volumes\n\n### Using BitLocker with Clustered Volumes\n\nBitLocker on volumes within a cluster are managed based on how the cluster service \"views\" the volume to be protected. The volume can be a physical disk resource such as a logical unit number (LUN) on a storage area network (SAN) or network attached storage (NAS).\n\n>**Important**  SANs used with BitLocker must have obtained Windows Hardware Certification. For more info, see [Windows Hardware Lab Kit](https://msdn.microsoft.com/library/windows/hardware/dn930814.aspx).\n \nAlternatively, the volume can be a cluster-shared volume, a shared namespace, within the cluster. Windows Server 2012 expanded the CSV architecture, now known as CSV2.0, to enable support for BitLocker. When using BitLocker with volumes designated for a cluster, the volume will need to turn on \nBitLocker before its addition to the storage pool within cluster or put the resource into maintenance mode before BitLocker operations will complete.\n\nWindows PowerShell or the manage-bde command line interface is the preferred method to manage BitLocker on CSV2.0 volumes. This is recommended over the BitLocker Control Panel item because CSV2.0 volumes are mount points. Mount points are an NTFS object that is used to provide an entry point to other volumes. Mount points do not require the use of a drive letter. Volumes that lack drive letters do not appear in the BitLocker Control Panel item. Additionally, the new Active Directory-based protector option required for cluster disk resource or CSV2.0 resources is not available in the Control Panel item.\n\n>**Note:**  Mount points can be used to support remote mount points on SMB based network shares. This type of share is not supported for BitLocker encryption.\n \nFor thinly provisioned storage, such as a Dynamic Virtual Hard Disk (VHD), BitLocker runs in Used Disk Space Only encryption mode. You cannot use the **manage-bde –WipeFreeSpace** command to transition the volume to full-volume encryption on these types of volumes. This occurs because Full \nEncryption requires an end marker for the volume and dynamically expanding VHDs do not have a static end of volume marker.\n\n### Active Directory-based protector\n\nYou can also use an Active Directory Domain Services (AD DS) protector for protecting clustered volumes held within your AD DS infrastructure. The **ADAccountOrGroup** protector is a domain security identifier (SID)-based protector that can be bound to a user account, machine account or group. When an unlock request is made for a protected volume, the BitLocker service interrupts the request and uses the BitLocker protect/unprotect APIs to unlock or deny the request. BitLocker will unlock protected volumes without user intervention by attempting protectors in the following order:\n\n1.  Clear key\n2.  Driver-based auto-unlock key\n3.  ADAccountOrGroup protector\n\n    1.  Service context protector\n    2.  User protector\n\n4.  Registry-based auto-unlock key\n\n>**Note:**  A Windows Server 2012 or later domain controller is required for this feature to work properly.\n \n### Turning on BitLocker before adding disks to a cluster using Windows PowerShell\n\nBitLocker encryption is available for disks before or after addition to a cluster storage pool. The advantage of encrypting volumes prior to adding them to a cluster is that the disk resource does not require suspending the resource to complete the operation. To turn on BitLocker for a disk before adding it to a cluster, do the following:\n\n1.  Install the BitLocker Drive Encryption feature if it is not already installed.\n2.  Ensure the disk is formatted NTFS and has a drive letter assigned to it.\n3.  Enable BitLocker on the volume using your choice of protector. A password protector is used in the Windows PowerShell script example below.\n\n    ``` syntax\n    Enable-BitLocker E: -PasswordProtector -Password $pw\n    ```\n\n4.  Identify the name of the cluster with Windows PowerShell.\n\n    ``` syntax\n    Get-Cluster\n\n    ```\n5.  Add an **ADAccountOrGroup**protector to the volume using the cluster name using a command such as:\n\n    ``` syntax\n    Add-BitLockerProtector E: -ADAccountOrGroupProtector -ADAccountOrGroup CLUSTER$\n    ```\n\n    >**Warning:**  You must add an **ADAccountOrGroup** protector using the cluster CNO for a BitLocker enabled volume to either be shared in a Cluster Shared Volume or to failover properly in a traditional failover cluster.\n     \n6.  Repeat steps 1-6 for each disk in the cluster.\n7.  Add the volume(s) to the cluster.\n\n### Turning on BitLocker for a clustered disk using Windows PowerShell\n\nWhen the cluster service owns a disk resource already, it needs to be set into maintenance mode before BitLocker can be enabled. Use the following steps for turning BitLocker on for a clustered disk:\n\n1.  Install the BitLocker Drive Encryption feature if it is not already installed.\n2.  Check the status of the cluster disk using Windows PowerShell.\n\n    ``` syntax\n    Get-ClusterResource \"Cluster Disk 1\"\n    ```\n\n3.  Put the physical disk resource into maintenance mode using Windows PowerShell.\n\n    ``` syntax\n    Get-ClusterResource \"Cluster Disk 1\" | Suspend-ClusterResource\n    ```\n\n4.  Enable BitLocker on the volume using your choice of protector. A password protector is used in the example below.\n\n    ``` syntax\n    Enable-BitLocker E: -PasswordProtector -Password $pw\n    ```\n\n5.  Identify the name of the cluster with Windows PowerShell\n\n    ``` syntax\n    Get-Cluster\n    ```\n\n6.  Add an **ADAccountOrGroup** protector with the Cluster Name Object (CNO) to the volume using a command such as:\n\n    ``` syntax\n    Add-BitLockerProtector E: -ADAccountOrGroupProtector -ADAccountOrGroup CLUSTER$\n\n    ```\n    >**Warning:**  You must add an **ADAccountOrGroup** protector using the cluster CNO for a BitLocker enabled volume to either be shared in a Cluster Shared Volume or to failover properly in a traditional failover cluster.\n     \n7.  Repeat steps 1-6 for each disk in the cluster.\n8.  Add the volume(s) to the cluster\n\n### Adding BitLocker encrypted volumes to a cluster using manage-bde\n\nYou can also use manage-bde to enable BitLocker on clustered volumes. The steps needed to add a physical disk resource or CSV2.0 volume to an existing cluster includes the following:\n\n1.  Verify the BitLocker Drive Encryption feature is installed on the computer.\n2.  Ensure new storage is formatted as NTFS.\n3.  Encrypt the volume, add a recovery key and add the cluster administrator as a protector key using the manage-bde command line interface (see example):\n\n    -   `Manage-bde -on -used <drive letter> -RP -sid domain\\CNO$ -sync`\n\n        1.  BitLocker will check to see if the disk is already part of a cluster. If it is, administrators will encounter a hard block. Otherwise, the encryption will continue.\n        2.  Using the -sync parameter is optional. Using it ensures the command waits until the encryption for the volume is completed before releasing the volume for use in the cluster storage pool.\n\n4.  Open the Failover Cluster Manager snap-in or cluster PowerShell cmdlets to enable the disk to be clustered\n\n    -   Once the disk is clustered it can also be enabled for CSV.\n\n5.  During the resource online operation, cluster will check to see if the disk is BitLocker encrypted.\n\n    1.  If the volume is not BitLocker enabled, traditional cluster online operations occur.\n    2.  If the volume is BitLocker enabled, the following check occurs:\n\n        -   If volume is **locked**, BitLocker will impersonate the CNO and unlock the volume using the CNO protector. If this operation fails an event will be logged that the volume could not be unlocked and the online operation will fail.\n\n6.  Once the disk is online in the storage pool, it can be added to a CSV by right clicking on the disk resource and choosing \"**Add to cluster shared volumes**\".\nCSVs can include both encrypted and unencrypted volumes. To check the status of a particular volume for BitLocker encryption, administrators can utilize the manage-bde -status command with a path to the volume inside the CSV namespace as seen in the example command line below.\n\n``` syntax\nmanage-bde -status \"C:\\ClusterStorage\\volume1\"\n```\n\n### Physical Disk Resources\n\nUnlike CSV2.0 volumes, physical disk resources can only be accessed by one cluster node at a time. This means that operations such as encrypting, decrypting, locking or unlocking volumes require context to perform. For example, you cannot unlock or decrypt a physical disk resource if you are not administering the cluster node that owns the disk resource because the disk resource is not available.\n\n### Restrictions on BitLocker actions with cluster volumes\n\nThe following table contains information about both Physical Disk Resources (i.e. traditional failover cluster volumes) and Cluster Shared Volumes (CSV) and the actions that are allowed by BitLocker in each situation.\n\n<table>\n<colgroup>\n<col width=\"20%\" />\n<col width=\"20%\" />\n<col width=\"20%\" />\n<col width=\"20%\" />\n<col width=\"20%\" />\n</colgroup>\n<tbody>\n<tr class=\"odd\">\n<td align=\"left\"><p><strong>Action</strong></p></td>\n<td align=\"left\"><p><strong>On owner node of failover volume</strong></p></td>\n<td align=\"left\"><p><strong>On Metadata Server (MDS) of CSV</strong></p></td>\n<td align=\"left\"><p><strong>On (Data Server) DS of CSV</strong></p></td>\n<td align=\"left\"><p><strong>Maintenance Mode</strong></p></td>\n</tr>\n<tr class=\"even\">\n<td align=\"left\"><p><strong>Manage-bde –on</strong></p></td>\n<td align=\"left\"><p>Blocked</p></td>\n<td align=\"left\"><p>Blocked</p></td>\n<td align=\"left\"><p>Blocked</p></td>\n<td align=\"left\"><p>Allowed</p></td>\n</tr>\n<tr class=\"odd\">\n<td align=\"left\"><p><strong>Manage-bde –off</strong></p></td>\n<td align=\"left\"><p>Blocked</p></td>\n<td align=\"left\"><p>Blocked</p></td>\n<td align=\"left\"><p>Blocked</p></td>\n<td align=\"left\"><p>Allowed</p></td>\n</tr>\n<tr class=\"even\">\n<td align=\"left\"><p><strong>Manage-bde Pause/Resume</strong></p></td>\n<td align=\"left\"><p>Blocked</p></td>\n<td align=\"left\"><p>Blocked**</p></td>\n<td align=\"left\"><p>Blocked</p></td>\n<td align=\"left\"><p>Allowed</p></td>\n</tr>\n<tr class=\"odd\">\n<td align=\"left\"><p><strong>Manage-bde –lock</strong></p></td>\n<td align=\"left\"><p>Blocked</p></td>\n<td align=\"left\"><p>Blocked</p></td>\n<td align=\"left\"><p>Blocked</p></td>\n<td align=\"left\"><p>Allowed</p></td>\n</tr>\n<tr class=\"even\">\n<td align=\"left\"><p><strong>manage-bde –wipe</strong></p></td>\n<td align=\"left\"><p>Blocked</p></td>\n<td align=\"left\"><p>Blocked</p></td>\n<td align=\"left\"><p>Blocked</p></td>\n<td align=\"left\"><p>Allowed</p></td>\n</tr>\n<tr class=\"odd\">\n<td align=\"left\"><p><strong>Unlock</strong></p></td>\n<td align=\"left\"><p>Automatic via cluster service</p></td>\n<td align=\"left\"><p>Automatic via cluster service</p></td>\n<td align=\"left\"><p>Automatic via cluster service</p></td>\n<td align=\"left\"><p>Allowed</p></td>\n</tr>\n<tr class=\"even\">\n<td align=\"left\"><p><strong>manage-bde –protector –add</strong></p></td>\n<td align=\"left\"><p>Allowed</p></td>\n<td align=\"left\"><p>Allowed</p></td>\n<td align=\"left\"><p>Blocked</p></td>\n<td align=\"left\"><p>Allowed</p></td>\n</tr>\n<tr class=\"odd\">\n<td align=\"left\"><p><strong>manage-bde -protector -delete</strong></p></td>\n<td align=\"left\"><p>Allowed</p></td>\n<td align=\"left\"><p>Allowed</p></td>\n<td align=\"left\"><p>Blocked</p></td>\n<td align=\"left\"><p>Allowed</p></td>\n</tr>\n<tr class=\"even\">\n<td align=\"left\"><p><strong>manage-bde –autounlock</strong></p></td>\n<td align=\"left\"><p>Allowed (not recommended)</p></td>\n<td align=\"left\"><p>Allowed (not recommended)</p></td>\n<td align=\"left\"><p>Blocked</p></td>\n<td align=\"left\"><p>Allowed (not recommended)</p></td>\n</tr>\n<tr class=\"odd\">\n<td align=\"left\"><p><strong>Manage-bde -upgrade</strong></p></td>\n<td align=\"left\"><p>Allowed</p></td>\n<td align=\"left\"><p>Allowed</p></td>\n<td align=\"left\"><p>Blocked</p></td>\n<td align=\"left\"><p>Allowed</p></td>\n</tr>\n<tr class=\"even\">\n<td align=\"left\"><p><strong>Shrink</strong></p></td>\n<td align=\"left\"><p>Allowed</p></td>\n<td align=\"left\"><p>Allowed</p></td>\n<td align=\"left\"><p>Blocked</p></td>\n<td align=\"left\"><p>Allowed</p></td>\n</tr>\n<tr class=\"odd\">\n<td align=\"left\"><p><strong>Extend</strong></p></td>\n<td align=\"left\"><p>Allowed</p></td>\n<td align=\"left\"><p>Allowed</p></td>\n<td align=\"left\"><p>Blocked</p></td>\n<td align=\"left\"><p>Allowed</p></td>\n</tr>\n</tbody>\n</table>\n \n>**Note:**  Although the manage-bde -pause command is Blocked in clusters, the cluster service will automatically resume a paused encryption or decryption from the MDS node\n \nIn the case where a physical disk resource experiences a failover event during conversion, the new owning node will detect the conversion is not complete and will complete the conversion process.\n\n### Other considerations when using BitLocker on CSV2.0\n\nSome other considerations to take into account for BitLocker on clustered storage include the following:\n-   BitLocker volumes have to be initialized and beginning encryption before they are available to add to a CSV2.0 volume.\n-   If an administrator needs to decrypt a CSV volume, remove the volume from the cluster or put into disk maintenance mode. You can add the CSV back to the cluster while waiting for decryption to complete.\n-   If an administrator needs to start encrypting a CSV volume, remove the volume from the cluster or put it in maintenance mode.\n-   If conversion is paused with encryption in progress and the CSV volume is offline from the cluster, the cluster thread (health check) will automatically resume conversion when the volume is online to the cluster.\n-   If conversion is paused with encryption in progress and a physical disk resource volume is offline from the cluster, the BitLocker driver will automatically resume conversion when the volume is online to the cluster.\n-   If conversion is paused with encryption in progress, while the CSV volume is in maintenance mode, the cluster thread (health check) will automatically resume conversion when moving the volume back from maintenance.\n-   If conversion is paused with encryption in progress, while the disk resource volume is in maintenance mode, the BitLocker driver will automatically resume conversion when the volume is moved back from maintenance mode.\n"}