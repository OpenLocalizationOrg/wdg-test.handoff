{"nodes":[{"content":"How to Migrate the App-V SQL Database to a Different SQL Server","pos":[11,74]},{"content":"How to Migrate the App-V SQL Database to a Different SQL Server","pos":[88,151]},{"content":"How to Migrate the App-V SQL Database to a Different SQL Server","pos":[325,388]},{"content":"The following procedures describe in detail how to migrate the SQL database of the Microsoft Application Virtualization (App-V) Management Server to a different SQL Server.","pos":[391,563]},{"content":"Important","pos":[567,576]},{"content":"This procedure requires that the App-V server service is stopped and this will prevent end-users from using their applications.","pos":[581,708]},{"content":"To back up the App-V SQL database","pos":[715,748]},{"content":"Open the Services.msc program and stop the App-V Management Server service on all Management Servers that use the database to be migrated.","pos":[756,894]},{"content":"On the computer where the App-V database is located, open SQL Server Management Studio.","pos":[900,987]},{"pos":[993,1079],"content":"Expand the <bpt id=\"p1\">**</bpt>Databases<ept id=\"p1\">**</ept> node and locate the App-V database (default name is APPVIRT)."},{"pos":[1085,1159],"content":"Right-click the database and select <bpt id=\"p1\">**</bpt>Tasks<ept id=\"p1\">**</ept> and then select <bpt id=\"p2\">**</bpt>Back Up<ept id=\"p2\">**</ept>."},{"content":"Verify that <bpt id=\"p1\">**</bpt>Recovery model<ept id=\"p1\">**</ept> is set to <bpt id=\"p2\">**</bpt>SIMPLE<ept id=\"p2\">**</ept> and the <bpt id=\"p3\">**</bpt>Backup type<ept id=\"p3\">**</ept> is set to <bpt id=\"p4\">**</bpt>Full<ept id=\"p4\">**</ept>.","pos":[1165,1260]},{"content":"Change the <bpt id=\"p1\">**</bpt>Backup set<ept id=\"p1\">**</ept> and <bpt id=\"p2\">**</bpt>Destination<ept id=\"p2\">**</ept> settings if it is necessary.","pos":[1261,1335]},{"content":"Click <bpt id=\"p1\">**</bpt>OK<ept id=\"p1\">**</ept> to back up the database.","pos":[1341,1378]},{"content":"After the backup has completed successfully, click <bpt id=\"p1\">**</bpt>OK<ept id=\"p1\">**</ept>.","pos":[1379,1437]},{"content":"Open Windows Explorer and browse to the folder that contains the database backup file, for example APPVIRT.BAK.","pos":[1443,1554]},{"content":"Copy the database backup file to the destination computer that is running SQL Server.","pos":[1555,1640]},{"content":"To restore the App-V SQL database to the destination computer","pos":[1644,1705]},{"pos":[1713,1844],"content":"On the destination computer, open SQL Server Management Studio, right-click the <bpt id=\"p1\">**</bpt>Databases<ept id=\"p1\">**</ept> node and select <bpt id=\"p2\">**</bpt>Restore Database<ept id=\"p2\">**</ept>."},{"content":"Under <bpt id=\"p1\">**</bpt>Source for Restore<ept id=\"p1\">**</ept>, choose <bpt id=\"p2\">**</bpt>From device<ept id=\"p2\">**</ept> and then click the “<bpt id=\"p3\">**</bpt>…<ept id=\"p3\">**</ept>”","pos":[1850,1929]},{"content":"button.","pos":[1930,1937]},{"pos":[1943,2059],"content":"In the <bpt id=\"p1\">**</bpt>Specify Backup<ept id=\"p1\">**</ept> dialog box, make sure that the <bpt id=\"p2\">**</bpt>Backup Media<ept id=\"p2\">**</ept> is set to <bpt id=\"p3\">**</bpt>File<ept id=\"p3\">**</ept> and then click <bpt id=\"p4\">**</bpt>Add<ept id=\"p4\">**</ept>."},{"pos":[2065,2181],"content":"Select the backup file that you copied from the original computer that is running SQL Server, and then click <bpt id=\"p1\">**</bpt>OK<ept id=\"p1\">**</ept>."},{"pos":[2187,2251],"content":"Click <bpt id=\"p1\">**</bpt>OK<ept id=\"p1\">**</ept> and then click to select the backup set to restore."},{"pos":[2257,2388],"content":"Under <bpt id=\"p1\">**</bpt>Destination for restore<ept id=\"p1\">**</ept>, click the drop-down for <bpt id=\"p2\">**</bpt>To database<ept id=\"p2\">**</ept> and select the App-V database name, for example APPVIRT."},{"content":"Click <bpt id=\"p1\">**</bpt>OK<ept id=\"p1\">**</ept> to start the restore.","pos":[2394,2428]},{"content":"After the restore has completed successfully, click <bpt id=\"p1\">**</bpt>OK<ept id=\"p1\">**</ept>.","pos":[2429,2488]},{"pos":[2494,2572],"content":"Expand the <bpt id=\"p1\">**</bpt>Security<ept id=\"p1\">**</ept> node, right-click <bpt id=\"p2\">**</bpt>Logins<ept id=\"p2\">**</ept> and select <bpt id=\"p3\">**</bpt>New Login<ept id=\"p3\">**</ept>."},{"pos":[2578,2718],"content":"In the <bpt id=\"p1\">**</bpt>Login Name<ept id=\"p1\">**</ept> field, enter the Network Service account details for the App-V Management Server in the format of DOMAIN<ph id=\"ph1\">\\\\</ph>SERVERNAME$."},{"pos":[2724,2851],"content":"On the <bpt id=\"p1\">**</bpt>General<ept id=\"p1\">**</ept> page under <bpt id=\"p2\">**</bpt>Default database<ept id=\"p2\">**</ept> select the App-V database name, for example, APPVIRT, and then click <bpt id=\"p3\">**</bpt>OK<ept id=\"p3\">**</ept>."},{"content":"Under <bpt id=\"p1\">**</bpt>Select a page<ept id=\"p1\">**</ept>, click to select the <bpt id=\"p2\">**</bpt>User Mapping<ept id=\"p2\">**</ept> page.","pos":[2857,2924]},{"content":"Under <bpt id=\"p1\">**</bpt>Users mapped to this login<ept id=\"p1\">**</ept>, click the check box in the <bpt id=\"p2\">**</bpt>Map<ept id=\"p2\">**</ept> column to select the App-V database.","pos":[2925,3034]},{"pos":[3040,3160],"content":"Under <bpt id=\"p1\">**</bpt>Database role membership for: <ph id=\"ph1\">&amp;lt;</ph>appvdatabasename<ph id=\"ph2\">&amp;gt;</ph><ept id=\"p1\">**</ept>, click to select <bpt id=\"p2\">**</bpt>SFTEveryone<ept id=\"p2\">**</ept> and then click <bpt id=\"p3\">**</bpt>OK<ept id=\"p3\">**</ept>."},{"content":"Make sure that the Windows Firewall on the new computer that is running SQL Server is configured to allow the App-V Management Server to access the system.","pos":[3166,3321]},{"content":"Under <bpt id=\"p1\">**</bpt>Administrative Tools<ept id=\"p1\">**</ept>, use the <bpt id=\"p2\">**</bpt>Windows Firewall with Advanced Security<ept id=\"p2\">**</ept> program to create an <bpt id=\"p3\">**</bpt>Inbound Rule<ept id=\"p3\">**</ept> for the port that is used by SQL Server (default is port 1433).","pos":[3322,3507]},{"content":"To migrate the App-V SQL Server Agent jobs","pos":[3511,3553]},{"pos":[3561,3719],"content":"On the original computer that is running SQL Server, in SQL Server Management Studio, expand the <bpt id=\"p1\">**</bpt>SQL Server Agent<ept id=\"p1\">**</ept> node, and then expand the <bpt id=\"p2\">**</bpt>Jobs<ept id=\"p2\">**</ept> node."},{"pos":[3725,3889],"content":"Right-click the following four App-V jobs and select <bpt id=\"p1\">**</bpt>Script Job as | CREATE to | File<ept id=\"p1\">**</ept>, and save each script to a folder and give each script a descriptive name."},{"content":"Softgrid Database (appvdbname) Check Usage History","pos":[3901,3951]},{"content":"Softgrid Database (appvdbname) Close Orphaned Sessions","pos":[3965,4019]},{"content":"Softgrid Database (appvdbname) Enforce Size Limit","pos":[4033,4082]},{"content":"Softgrid Database (appvdbname) Monitor Alert/Job Status","pos":[4096,4151]},{"content":"Copy the four script files (.sql) to the destination computer that is running SQL Server and open SQL Server Management Studio.","pos":[4159,4286]},{"content":"In Windows Explorer, right-click each .sql file and then click <bpt id=\"p1\">**</bpt>Run<ept id=\"p1\">**</ept>.","pos":[4292,4363]},{"content":"Each script will open in a query window in SQL Server Management Studio.","pos":[4364,4436]},{"content":"Click <bpt id=\"p1\">**</bpt>Execute<ept id=\"p1\">**</ept> for each script and verify that each is completed successfully.","pos":[4437,4518]},{"pos":[4524,4642],"content":"Refresh the <bpt id=\"p1\">**</bpt>Jobs<ept id=\"p1\">**</ept> node under the <bpt id=\"p2\">**</bpt>SQL Server Agent<ept id=\"p2\">**</ept> node and confirm that the four jobs are created successfully."},{"content":"To update the configuration of the App-V Management Server","pos":[4646,4704]},{"content":"On the App-V Management Server, modify the following registry keys:","pos":[4712,4779]},{"pos":[4789,4826],"content":"<bpt id=\"p1\">**</bpt>SQLServerName<ept id=\"p1\">**</ept><ph id=\"ph1\"> = &amp;lt;</ph>newservername"},{"pos":[4840,4877],"content":"<bpt id=\"p1\">**</bpt>SQLServerPort<ept id=\"p1\">**</ept><ph id=\"ph1\"> = &amp;lt;</ph>newserverport"},{"content":"Then restart the App-V server service.","pos":[4887,4925]},{"content":"Browse to find the file SftMgmt.udl under the App-V Management Server installation directory (default is C:<ph id=\"ph1\">\\\\</ph>Program Files<ph id=\"ph2\">\\\\</ph>Microsoft System Center App Virt Management Server<ph id=\"ph3\">\\\\</ph>App Virt Management Service).","pos":[4931,5136]},{"content":"Right-click the file and select <bpt id=\"p1\">**</bpt>Open<ept id=\"p1\">**</ept>.","pos":[5137,5178]},{"content":"On the <bpt id=\"p1\">**</bpt>Connection<ept id=\"p1\">**</ept> tab, enter the name of the destination computer that is running SQL Server, and then click <bpt id=\"p2\">**</bpt>Test Connection<ept id=\"p2\">**</ept>.","pos":[5184,5317]},{"content":"When the test is successful, click <bpt id=\"p1\">**</bpt>OK<ept id=\"p1\">**</ept> and then click <bpt id=\"p2\">**</bpt>OK<ept id=\"p2\">**</ept> again.","pos":[5318,5388]},{"content":"For App-V Management Server versions before 4.5 SP2, you must update the SQL Logging settings.","pos":[5394,5488]},{"content":"Under <bpt id=\"p1\">**</bpt>Server Groups<ept id=\"p1\">**</ept>, right-click the server group the server is a member of and select <bpt id=\"p2\">**</bpt>Properties<ept id=\"p2\">**</ept>.","pos":[5489,5595]},{"pos":[5601,5691],"content":"On the <bpt id=\"p1\">**</bpt>Logging<ept id=\"p1\">**</ept> tab click to select the <bpt id=\"p2\">**</bpt>SQL Database<ept id=\"p2\">**</ept> entry and then click <bpt id=\"p3\">**</bpt>Edit<ept id=\"p3\">**</ept>."},{"content":"Change the <bpt id=\"p1\">**</bpt>DNS Host Name<ept id=\"p1\">**</ept> to the host name of the new computer that is running SQL Server and then click <bpt id=\"p2\">**</bpt>OK<ept id=\"p2\">**</ept>.","pos":[5697,5812]},{"content":"Click <bpt id=\"p1\">**</bpt>OK<ept id=\"p1\">**</ept> two times more, and then restart the App-V server service.","pos":[5813,5884]},{"content":"Open the App-V Management Console, right-click the <bpt id=\"p1\">**</bpt>Applications<ept id=\"p1\">**</ept> node and select <bpt id=\"p2\">**</bpt>Refresh<ept id=\"p2\">**</ept>.","pos":[5890,5986]},{"content":"The list of applications should be displayed as before.","pos":[5987,6042]}],"content":"---\ntitle: How to Migrate the App-V SQL Database to a Different SQL Server\ndescription: How to Migrate the App-V SQL Database to a Different SQL Server\nauthor: jamiejdt\nms.assetid: 353892a1-9327-4489-a19c-4ec7bd1b736f\nms.pagetype: mdop, appcompat, virtualization\nms.mktglfcycl: deploy\nms.sitesec: library\nms.prod: w8\n---\n\n\n# How to Migrate the App-V SQL Database to a Different SQL Server\n\n\nThe following procedures describe in detail how to migrate the SQL database of the Microsoft Application Virtualization (App-V) Management Server to a different SQL Server.\n\n**Important**  \nThis procedure requires that the App-V server service is stopped and this will prevent end-users from using their applications.\n\n \n\n**To back up the App-V SQL database**\n\n1.  Open the Services.msc program and stop the App-V Management Server service on all Management Servers that use the database to be migrated.\n\n2.  On the computer where the App-V database is located, open SQL Server Management Studio.\n\n3.  Expand the **Databases** node and locate the App-V database (default name is APPVIRT).\n\n4.  Right-click the database and select **Tasks** and then select **Back Up**.\n\n5.  Verify that **Recovery model** is set to **SIMPLE** and the **Backup type** is set to **Full**. Change the **Backup set** and **Destination** settings if it is necessary.\n\n6.  Click **OK** to back up the database. After the backup has completed successfully, click **OK**.\n\n7.  Open Windows Explorer and browse to the folder that contains the database backup file, for example APPVIRT.BAK. Copy the database backup file to the destination computer that is running SQL Server.\n\n**To restore the App-V SQL database to the destination computer**\n\n1.  On the destination computer, open SQL Server Management Studio, right-click the **Databases** node and select **Restore Database**.\n\n2.  Under **Source for Restore**, choose **From device** and then click the “**…**” button.\n\n3.  In the **Specify Backup** dialog box, make sure that the **Backup Media** is set to **File** and then click **Add**.\n\n4.  Select the backup file that you copied from the original computer that is running SQL Server, and then click **OK**.\n\n5.  Click **OK** and then click to select the backup set to restore.\n\n6.  Under **Destination for restore**, click the drop-down for **To database** and select the App-V database name, for example APPVIRT.\n\n7.  Click **OK** to start the restore. After the restore has completed successfully, click **OK**.\n\n8.  Expand the **Security** node, right-click **Logins** and select **New Login**.\n\n9.  In the **Login Name** field, enter the Network Service account details for the App-V Management Server in the format of DOMAIN\\\\SERVERNAME$.\n\n10. On the **General** page under **Default database** select the App-V database name, for example, APPVIRT, and then click **OK**.\n\n11. Under **Select a page**, click to select the **User Mapping** page. Under **Users mapped to this login**, click the check box in the **Map** column to select the App-V database.\n\n12. Under **Database role membership for: &lt;appvdatabasename&gt;**, click to select **SFTEveryone** and then click **OK**.\n\n13. Make sure that the Windows Firewall on the new computer that is running SQL Server is configured to allow the App-V Management Server to access the system. Under **Administrative Tools**, use the **Windows Firewall with Advanced Security** program to create an **Inbound Rule** for the port that is used by SQL Server (default is port 1433).\n\n**To migrate the App-V SQL Server Agent jobs**\n\n1.  On the original computer that is running SQL Server, in SQL Server Management Studio, expand the **SQL Server Agent** node, and then expand the **Jobs** node.\n\n2.  Right-click the following four App-V jobs and select **Script Job as | CREATE to | File**, and save each script to a folder and give each script a descriptive name.\n\n    -   **Softgrid Database (appvdbname) Check Usage History**\n\n    -   **Softgrid Database (appvdbname) Close Orphaned Sessions**\n\n    -   **Softgrid Database (appvdbname) Enforce Size Limit**\n\n    -   **Softgrid Database (appvdbname) Monitor Alert/Job Status**\n\n3.  Copy the four script files (.sql) to the destination computer that is running SQL Server and open SQL Server Management Studio.\n\n4.  In Windows Explorer, right-click each .sql file and then click **Run**. Each script will open in a query window in SQL Server Management Studio. Click **Execute** for each script and verify that each is completed successfully.\n\n5.  Refresh the **Jobs** node under the **SQL Server Agent** node and confirm that the four jobs are created successfully.\n\n**To update the configuration of the App-V Management Server**\n\n1.  On the App-V Management Server, modify the following registry keys:\n\n    -   **SQLServerName** = &lt;newservername&gt;\n\n    -   **SQLServerPort** = &lt;newserverport&gt;\n\n    Then restart the App-V server service.\n\n2.  Browse to find the file SftMgmt.udl under the App-V Management Server installation directory (default is C:\\\\Program Files\\\\Microsoft System Center App Virt Management Server\\\\App Virt Management Service). Right-click the file and select **Open**.\n\n3.  On the **Connection** tab, enter the name of the destination computer that is running SQL Server, and then click **Test Connection**. When the test is successful, click **OK** and then click **OK** again.\n\n4.  For App-V Management Server versions before 4.5 SP2, you must update the SQL Logging settings. Under **Server Groups**, right-click the server group the server is a member of and select **Properties**.\n\n5.  On the **Logging** tab click to select the **SQL Database** entry and then click **Edit**.\n\n6.  Change the **DNS Host Name** to the host name of the new computer that is running SQL Server and then click **OK**. Click **OK** two times more, and then restart the App-V server service.\n\n7.  Open the App-V Management Console, right-click the **Applications** node and select **Refresh**. The list of applications should be displayed as before.\n\n \n\n \n\n\n\n\n\n"}