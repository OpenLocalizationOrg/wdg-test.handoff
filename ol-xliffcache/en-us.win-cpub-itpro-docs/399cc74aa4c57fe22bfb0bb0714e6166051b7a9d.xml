{"nodes":[{"content":"Planning GPO Deployment (Windows 10)","pos":[11,47]},{"content":"Planning GPO Deployment","pos":[61,84]},{"content":"Planning GPO Deployment","pos":[240,263]},{"content":"Applies to","pos":[267,277]},{"content":"Windows 10","pos":[284,294]},{"content":"Windows Server 2016 Technical Preview","pos":[299,336]},{"content":"You can control which GPOs are applied to devices in Active Directory in a combination of three ways:","pos":[338,439]},{"content":"<bpt id=\"p1\">**</bpt>Active Directory organizational unit hierarchy<ept id=\"p1\">**</ept>.","pos":[445,496]},{"content":"This involves linking the GPO to a specific OU in the Active Directory OU hierarchy.","pos":[497,581]},{"content":"All devices in the OU and its subordinate containers receive and apply the GPO.","pos":[582,661]},{"content":"Controlling GPO application through linking to OUs is typically used when you can organize the OU hierarchy according to your domain isolation zone requirements.","pos":[667,828]},{"content":"GPOs can apply settings to devices based on their location within Active Directory.","pos":[829,912]},{"content":"If a device is moved from one OU to another, the policy linked to the second OU will eventually take effect when Group Policy detects the change during polling.","pos":[913,1073]},{"content":"<bpt id=\"p1\">**</bpt>Security group filtering<ept id=\"p1\">**</ept>.","pos":[1079,1108]},{"content":"This involves linking the GPOs to the domain level (or other parent OU) in the OU hierarchy, and then selecting which devices receive the GPO by using permissions that only allow correct group members to apply the GPO.","pos":[1109,1327]},{"content":"The security group filters are attached to the GPOs themselves.","pos":[1333,1396]},{"content":"A group is added to the security group filter of the GPO in Active Directory, and then assigned Read and Apply Group Policy permissions.","pos":[1397,1533]},{"content":"Other groups can be explicitly denied Read and Apply Group Policy permissions.","pos":[1534,1612]},{"content":"Only those devices whose group membership are granted Read and Apply Group Policy permissions without any explicit deny permissions can apply the GPO.","pos":[1613,1763]},{"content":"<bpt id=\"p1\">**</bpt>WMI filtering<ept id=\"p1\">**</ept>.","pos":[1769,1787]},{"content":"A WMI filter is a query that is run dynamically when the GPO is evaluated.","pos":[1788,1862]},{"content":"If a device is a member of the result set when the WMI filter query runs, the GPO is applied to the device.","pos":[1863,1970]},{"content":"A WMI filter consists of one or more conditions that are evaluated against the local device.","pos":[1976,2068]},{"content":"You can check almost any characteristic of the device, its operating system, and its installed programs.","pos":[2069,2173]},{"content":"If all of the specified conditions are true for the device, the GPO is applied; otherwise the GPO is ignored.","pos":[2174,2283]},{"content":"This guide uses a combination of security group filtering and WMI filtering to provide the most flexible options.","pos":[2285,2398]},{"content":"If you follow this guidance, even though there might be five different GPOs linked to a specific group because of operating system version differences, only the correct GPO is applied.","pos":[2399,2583]},{"content":"General considerations","pos":[2588,2610]},{"content":"Deploy your GPOs before you add any device accounts to the groups that receive the GPOs.","pos":[2616,2704]},{"content":"That way you can add your devices to the groups in a controlled manner.","pos":[2705,2776]},{"content":"Be sure to add only a few test devices at first.","pos":[2777,2825]},{"content":"Before adding many group members, examine the results on the test devices and verify that the configured firewall and connection security rules have the effect that you want.","pos":[2826,3000]},{"content":"See the following sections for some suggestions on what to test before you continue.","pos":[3001,3085]},{"content":"Test your deployed groups and GPOs","pos":[3090,3124]},{"content":"After you have deployed your GPOs and added some test devices to the groups, confirm the following before you continue with more group members:","pos":[3126,3269]},{"content":"Examine the GPOs that are both assigned to and filtered from the device.","pos":[3275,3347]},{"content":"Run the <bpt id=\"p1\">**</bpt>gpresult<ept id=\"p1\">**</ept> tool at a command prompt.","pos":[3348,3394]},{"content":"Examine the rules deployed to the device.","pos":[3400,3441]},{"content":"Open the Windows Firewall with Advanced Security MMC snap-in, expand the <bpt id=\"p1\">**</bpt>Monitoring<ept id=\"p1\">**</ept> node, and then expand the <bpt id=\"p2\">**</bpt>Firewall<ept id=\"p2\">**</ept> and <bpt id=\"p3\">**</bpt>Connection Security<ept id=\"p3\">**</ept> nodes.","pos":[3442,3603]},{"content":"Verify that communications are authenticated.","pos":[3609,3654]},{"content":"Open the Windows Firewall with Advanced Security MMC snap-in, expand the <bpt id=\"p1\">**</bpt>Monitoring<ept id=\"p1\">**</ept> node, expand the <bpt id=\"p2\">**</bpt>Security Associations<ept id=\"p2\">**</ept> node, and then click <bpt id=\"p3\">**</bpt>Main Mode<ept id=\"p3\">**</ept>.","pos":[3655,3821]},{"content":"Verify that communications are encrypted when the devices require it.","pos":[3827,3896]},{"content":"Open the Windows Firewall with Advanced Security MMC snap-in, expand the <bpt id=\"p1\">**</bpt>Monitoring<ept id=\"p1\">**</ept> node, expand the <bpt id=\"p2\">**</bpt>Security Associations<ept id=\"p2\">**</ept> node, and then select <bpt id=\"p3\">**</bpt>Quick Mode<ept id=\"p3\">**</ept>.","pos":[3897,4065]},{"content":"Encrypted connections display a value other than <bpt id=\"p1\">**</bpt>None<ept id=\"p1\">**</ept> in the <bpt id=\"p2\">**</bpt>ESP Confidentiality<ept id=\"p2\">**</ept> column.","pos":[4066,4162]},{"content":"Verify that your programs are unaffected.","pos":[4168,4209]},{"content":"Run them and confirm that they still work as expected.","pos":[4210,4264]},{"content":"After you have confirmed that the GPOs have been correctly applied, and that the devices are now communicating by using IPsec network traffic in request mode, you can begin to add more devices to the group accounts, in manageable numbers at a time.","pos":[4266,4514]},{"content":"Continue to monitor and confirm the correct application of the GPOs to the devices.","pos":[4515,4598]},{"content":"Do not enable require mode until deployment is complete","pos":[4603,4658]},{"content":"If you deploy a GPO that requires authentication to a device before the other devices have a GPO deployed, communication between them might not be possible.","pos":[4660,4816]},{"content":"Wait until you have all the zones and their GPOs deployed in request mode and confirm (as described in the previous section) that the devices are successfully communicating by using IPsec.","pos":[4817,5005]},{"content":"If there are problems with GPO deployment, or errors in configuration of one or more of the IPsec GPOs, devices can continue to operate, because request mode enables any device to fall back to clear communications.","pos":[5007,5221]},{"content":"Only after you have added all of the devices to their zones, and you have confirmed that communications are working as expected, you can start changing the request mode rules to require mode rules where it is required in the zones.","pos":[5223,5454]},{"content":"We recommend that you enable require mode in the zones one zone at a time, pausing to confirm that they are functioning properly before you continue.","pos":[5455,5604]},{"content":"Turn the required mode setting on for the server isolation zones first, then the encryption zone, and then the isolated domain.","pos":[5605,5732]},{"content":"Do not change the boundary zone GPO, because it must stay in request mode for both inbound and outbound connections.","pos":[5734,5850]},{"content":"If you create other zones that require either inbound or outbound require mode, make the setting change in a manner that applies the setting in stages from the smaller groups of devices to the larger groups.","pos":[5852,6059]},{"content":"Example Woodgrove Bank deployment plans","pos":[6064,6103]},{"content":"Woodgrove Bank links all its GPOs to the domain level container in the Active Directory OU hierarchy.","pos":[6105,6206]},{"content":"It then uses the following WMI filters and security group filters to control the application of the GPOs to the correct subset of devices.","pos":[6207,6345]},{"content":"All of the GPOs have the User Configuration section disabled to improve performance.","pos":[6346,6430]},{"content":"GPO<ph id=\"ph1\">\\_</ph>DOMISO<ph id=\"ph2\">\\_</ph>Firewall","pos":[6436,6457]},{"content":"<bpt id=\"p1\">**</bpt>WMI filter<ept id=\"p1\">**</ept>.","pos":[6463,6478]},{"content":"The WMI filter allows this GPO to apply only to devices that match the following WMI query:","pos":[6479,6570]},{"content":"<bpt id=\"p1\">**</bpt>Note:<ept id=\"p1\">**</ept>  This excludes domain controllers (which report a ProductType value of 2).","pos":[6668,6752]},{"content":"Do not include domain controllers in the isolated domain if there are devices running versions of Windows earlier than Windows Vista and Windows Server 2008.","pos":[6753,6910]},{"content":"<bpt id=\"p1\">**</bpt>Security filter<ept id=\"p1\">**</ept>.","pos":[6920,6940]},{"content":"This GPO grants Read and Apply Group Policy permissions only to devices that are members of the group CG<ph id=\"ph1\">\\_</ph>DOMISO<ph id=\"ph2\">\\_</ph>IsolatedDomain.","pos":[6941,7070]},{"content":"The GPO also explicitly denies Read and Apply Group Policy permissions to members of the CG<ph id=\"ph1\">\\_</ph>DOMISO<ph id=\"ph2\">\\_</ph>NO<ph id=\"ph3\">\\_</ph>IPSEC.","pos":[7071,7182]},{"content":"GPO<ph id=\"ph1\">\\_</ph>DOMISO<ph id=\"ph2\">\\_</ph>IsolatedDomain<ph id=\"ph3\">\\_</ph>Clients","pos":[7188,7224]},{"content":"<bpt id=\"p1\">**</bpt>WMI filter<ept id=\"p1\">**</ept>.","pos":[7230,7245]},{"content":"The WMI filter allows this GPO to apply only to devices that match the following WMI query:","pos":[7246,7337]},{"content":"<bpt id=\"p1\">**</bpt>Security filter<ept id=\"p1\">**</ept>.","pos":[7433,7453]},{"content":"This GPO grants Read and Apply Group Policy permissions only to devices that are members of the group CG<ph id=\"ph1\">\\_</ph>DOMISO<ph id=\"ph2\">\\_</ph>IsolatedDomain.","pos":[7454,7583]},{"content":"The GPO also explicitly denies Read and Apply Group Policy permissions to members of the group CG<ph id=\"ph1\">\\_</ph>DOMISO<ph id=\"ph2\">\\_</ph>NO<ph id=\"ph3\">\\_</ph>IPSEC.","pos":[7584,7701]},{"content":"GPO<ph id=\"ph1\">\\_</ph>DOMISO<ph id=\"ph2\">\\_</ph>IsolatedDomain<ph id=\"ph3\">\\_</ph>Servers","pos":[7707,7743]},{"content":"<bpt id=\"p1\">**</bpt>WMI filter<ept id=\"p1\">**</ept>.","pos":[7749,7764]},{"content":"The WMI filter allows this GPO to apply only to devices that match the following WMI query:","pos":[7765,7856]},{"content":"<bpt id=\"p1\">**</bpt>Note:<ept id=\"p1\">**</ept>  This excludes domain controllers (which report a ProductType value of 2).","pos":[7953,8037]},{"content":"Do not include domain controllers in the isolated domain if there are devices that are running versions of Windows earlier than Windows Vista and Windows Server 2008.","pos":[8038,8204]},{"content":"<bpt id=\"p1\">**</bpt>Security filter<ept id=\"p1\">**</ept>.","pos":[8210,8230]},{"content":"This GPO grants Read and Apply Group Policy permissions only to devices that are members of the group CG<ph id=\"ph1\">\\_</ph>DOMISO<ph id=\"ph2\">\\_</ph>IsolatedDomain.","pos":[8231,8360]},{"content":"The GPO also explicitly denies Read and Apply Group Policy permissions to members of the group CG<ph id=\"ph1\">\\_</ph>DOMISO<ph id=\"ph2\">\\_</ph>NO<ph id=\"ph3\">\\_</ph>IPSEC.","pos":[8361,8478]},{"content":"GPO<ph id=\"ph1\">\\_</ph>DOMISO<ph id=\"ph2\">\\_</ph>Boundary","pos":[8484,8505]},{"content":"<bpt id=\"p1\">**</bpt>WMI filter<ept id=\"p1\">**</ept>.","pos":[8511,8526]},{"content":"The WMI filter allows this GPO to apply only to devices that match the following WMI query:","pos":[8527,8618]},{"content":"<bpt id=\"p1\">**</bpt>Note:<ept id=\"p1\">**</ept>  This excludes domain controllers (which report a ProductType value of 2).","pos":[8715,8799]},{"content":"Do not include domain controllers in the isolated domain if there are devices that are running versions of Windows earlier than Windows Vista and Windows Server 2008.","pos":[8800,8966]},{"content":"<bpt id=\"p1\">**</bpt>Security filter<ept id=\"p1\">**</ept>.","pos":[8972,8992]},{"content":"This GPO grants Read and Apply Group Policy permissions only to devices that are members of the group CG<ph id=\"ph1\">\\_</ph>DOMISO<ph id=\"ph2\">\\_</ph>Boundary.","pos":[8993,9116]},{"content":"The GPO also explicitly denies Read and Apply Group Policy permissions to members of the group CG<ph id=\"ph1\">\\_</ph>DOMISO<ph id=\"ph2\">\\_</ph>NO<ph id=\"ph3\">\\_</ph>IPSEC.","pos":[9117,9234]},{"content":"GPO<ph id=\"ph1\">\\_</ph>DOMISO<ph id=\"ph2\">\\_</ph>Encryption","pos":[9240,9263]},{"content":"<bpt id=\"p1\">**</bpt>WMI filter<ept id=\"p1\">**</ept>.","pos":[9269,9284]},{"content":"The WMI filter allows this GPO to apply only to devices that match the following WMI query:","pos":[9285,9376]},{"content":"<bpt id=\"p1\">**</bpt>Note:<ept id=\"p1\">**</ept>  This excludes domain controllers (which report a ProductType value of 2).","pos":[9473,9557]},{"content":"Do not include domain controllers in the isolated domain if there are devices that are running versions of Windows earlier than Windows Vista and Windows Server 2008.","pos":[9558,9724]},{"content":"<bpt id=\"p1\">**</bpt>Security filter<ept id=\"p1\">**</ept>.","pos":[9730,9750]},{"content":"This GPO grants Read and Apply permissions in Group Policy only to devices that are members of the group CG<ph id=\"ph1\">\\_</ph>DOMISO<ph id=\"ph2\">\\_</ph>Encryption.","pos":[9751,9879]},{"content":"The GPO also explicitly denies Read and Apply permissions in Group Policy to members of the group CG<ph id=\"ph1\">\\_</ph>DOMISO<ph id=\"ph2\">\\_</ph>NO<ph id=\"ph3\">\\_</ph>IPSEC.","pos":[9880,10000]}],"content":"---\ntitle: Planning GPO Deployment (Windows 10)\ndescription: Planning GPO Deployment\nms.assetid: b38adfb1-1371-4227-a887-e6d118809de1\nms.prod: w10\nms.mktglfcycl: deploy\nms.sitesec: library\nms.pagetype: security\nauthor: brianlic-msft\n---\n\n# Planning GPO Deployment\n\n**Applies to**\n-   Windows 10\n-   Windows Server 2016 Technical Preview\n\nYou can control which GPOs are applied to devices in Active Directory in a combination of three ways:\n\n-   **Active Directory organizational unit hierarchy**. This involves linking the GPO to a specific OU in the Active Directory OU hierarchy. All devices in the OU and its subordinate containers receive and apply the GPO.\n\n    Controlling GPO application through linking to OUs is typically used when you can organize the OU hierarchy according to your domain isolation zone requirements. GPOs can apply settings to devices based on their location within Active Directory. If a device is moved from one OU to another, the policy linked to the second OU will eventually take effect when Group Policy detects the change during polling.\n\n-   **Security group filtering**. This involves linking the GPOs to the domain level (or other parent OU) in the OU hierarchy, and then selecting which devices receive the GPO by using permissions that only allow correct group members to apply the GPO.\n\n    The security group filters are attached to the GPOs themselves. A group is added to the security group filter of the GPO in Active Directory, and then assigned Read and Apply Group Policy permissions. Other groups can be explicitly denied Read and Apply Group Policy permissions. Only those devices whose group membership are granted Read and Apply Group Policy permissions without any explicit deny permissions can apply the GPO.\n\n-   **WMI filtering**. A WMI filter is a query that is run dynamically when the GPO is evaluated. If a device is a member of the result set when the WMI filter query runs, the GPO is applied to the device.\n\n    A WMI filter consists of one or more conditions that are evaluated against the local device. You can check almost any characteristic of the device, its operating system, and its installed programs. If all of the specified conditions are true for the device, the GPO is applied; otherwise the GPO is ignored.\n\nThis guide uses a combination of security group filtering and WMI filtering to provide the most flexible options. If you follow this guidance, even though there might be five different GPOs linked to a specific group because of operating system version differences, only the correct GPO is applied.\n\n## General considerations\n\n-   Deploy your GPOs before you add any device accounts to the groups that receive the GPOs. That way you can add your devices to the groups in a controlled manner. Be sure to add only a few test devices at first. Before adding many group members, examine the results on the test devices and verify that the configured firewall and connection security rules have the effect that you want. See the following sections for some suggestions on what to test before you continue.\n\n## Test your deployed groups and GPOs\n\nAfter you have deployed your GPOs and added some test devices to the groups, confirm the following before you continue with more group members:\n\n-   Examine the GPOs that are both assigned to and filtered from the device. Run the **gpresult** tool at a command prompt.\n\n-   Examine the rules deployed to the device. Open the Windows Firewall with Advanced Security MMC snap-in, expand the **Monitoring** node, and then expand the **Firewall** and **Connection Security** nodes.\n\n-   Verify that communications are authenticated. Open the Windows Firewall with Advanced Security MMC snap-in, expand the **Monitoring** node, expand the **Security Associations** node, and then click **Main Mode**.\n\n-   Verify that communications are encrypted when the devices require it. Open the Windows Firewall with Advanced Security MMC snap-in, expand the **Monitoring** node, expand the **Security Associations** node, and then select **Quick Mode**. Encrypted connections display a value other than **None** in the **ESP Confidentiality** column.\n\n-   Verify that your programs are unaffected. Run them and confirm that they still work as expected.\n\nAfter you have confirmed that the GPOs have been correctly applied, and that the devices are now communicating by using IPsec network traffic in request mode, you can begin to add more devices to the group accounts, in manageable numbers at a time. Continue to monitor and confirm the correct application of the GPOs to the devices.\n\n## Do not enable require mode until deployment is complete\n\nIf you deploy a GPO that requires authentication to a device before the other devices have a GPO deployed, communication between them might not be possible. Wait until you have all the zones and their GPOs deployed in request mode and confirm (as described in the previous section) that the devices are successfully communicating by using IPsec.\n\nIf there are problems with GPO deployment, or errors in configuration of one or more of the IPsec GPOs, devices can continue to operate, because request mode enables any device to fall back to clear communications.\n\nOnly after you have added all of the devices to their zones, and you have confirmed that communications are working as expected, you can start changing the request mode rules to require mode rules where it is required in the zones. We recommend that you enable require mode in the zones one zone at a time, pausing to confirm that they are functioning properly before you continue. Turn the required mode setting on for the server isolation zones first, then the encryption zone, and then the isolated domain.\n\nDo not change the boundary zone GPO, because it must stay in request mode for both inbound and outbound connections.\n\nIf you create other zones that require either inbound or outbound require mode, make the setting change in a manner that applies the setting in stages from the smaller groups of devices to the larger groups.\n\n## Example Woodgrove Bank deployment plans\n\nWoodgrove Bank links all its GPOs to the domain level container in the Active Directory OU hierarchy. It then uses the following WMI filters and security group filters to control the application of the GPOs to the correct subset of devices. All of the GPOs have the User Configuration section disabled to improve performance.\n\n### GPO\\_DOMISO\\_Firewall\n\n-   **WMI filter**. The WMI filter allows this GPO to apply only to devices that match the following WMI query:\n\n    `select * from Win32_OperatingSystem where Version like \"6.%\" and ProductType <> \"2\"`\n\n    >**Note:**  This excludes domain controllers (which report a ProductType value of 2). Do not include domain controllers in the isolated domain if there are devices running versions of Windows earlier than Windows Vista and Windows Server 2008.\n    \n-   **Security filter**. This GPO grants Read and Apply Group Policy permissions only to devices that are members of the group CG\\_DOMISO\\_IsolatedDomain. The GPO also explicitly denies Read and Apply Group Policy permissions to members of the CG\\_DOMISO\\_NO\\_IPSEC.\n\n### GPO\\_DOMISO\\_IsolatedDomain\\_Clients\n\n-   **WMI filter**. The WMI filter allows this GPO to apply only to devices that match the following WMI query:\n\n    `select * from Win32_OperatingSystem where Version like \"6.%\" and ProductType = \"1\"`\n\n-   **Security filter**. This GPO grants Read and Apply Group Policy permissions only to devices that are members of the group CG\\_DOMISO\\_IsolatedDomain. The GPO also explicitly denies Read and Apply Group Policy permissions to members of the group CG\\_DOMISO\\_NO\\_IPSEC.\n\n### GPO\\_DOMISO\\_IsolatedDomain\\_Servers\n\n-   **WMI filter**. The WMI filter allows this GPO to apply only to devices that match the following WMI query:\n\n    `select * from Win32_OperatingSystem where Version like \"6.%\" and ProductType = \"3\"`\n\n    >**Note:**  This excludes domain controllers (which report a ProductType value of 2). Do not include domain controllers in the isolated domain if there are devices that are running versions of Windows earlier than Windows Vista and Windows Server 2008.\n\n-   **Security filter**. This GPO grants Read and Apply Group Policy permissions only to devices that are members of the group CG\\_DOMISO\\_IsolatedDomain. The GPO also explicitly denies Read and Apply Group Policy permissions to members of the group CG\\_DOMISO\\_NO\\_IPSEC.\n\n### GPO\\_DOMISO\\_Boundary\n\n-   **WMI filter**. The WMI filter allows this GPO to apply only to devices that match the following WMI query:\n\n    `select * from Win32_OperatingSystem where Version like \"6.%\" and ProductType = \"3\"`\n\n    >**Note:**  This excludes domain controllers (which report a ProductType value of 2). Do not include domain controllers in the isolated domain if there are devices that are running versions of Windows earlier than Windows Vista and Windows Server 2008.\n\n-   **Security filter**. This GPO grants Read and Apply Group Policy permissions only to devices that are members of the group CG\\_DOMISO\\_Boundary. The GPO also explicitly denies Read and Apply Group Policy permissions to members of the group CG\\_DOMISO\\_NO\\_IPSEC.\n\n### GPO\\_DOMISO\\_Encryption\n\n-   **WMI filter**. The WMI filter allows this GPO to apply only to devices that match the following WMI query:\n\n    `select * from Win32_OperatingSystem where Version like \"6.%\" and ProductType = \"3\"`\n\n    >**Note:**  This excludes domain controllers (which report a ProductType value of 2). Do not include domain controllers in the isolated domain if there are devices that are running versions of Windows earlier than Windows Vista and Windows Server 2008.\n\n-   **Security filter**. This GPO grants Read and Apply permissions in Group Policy only to devices that are members of the group CG\\_DOMISO\\_Encryption. The GPO also explicitly denies Read and Apply permissions in Group Policy to members of the group CG\\_DOMISO\\_NO\\_IPSEC.\n"}