{"nodes":[{"content":"Using provisioning files to update registry settings that may change","pos":[34,102]},{"content":"Using provisioning files to update registry settings that may change","pos":[209,277]},{"content":"Using provisioning files to update registry settings that may change","pos":[285,353]},{"content":"Standard package updates are not applied to registry data that have been changed—for example, by a user who alters a menu setting that is stored in the registry.","pos":[356,517]},{"content":"To update the values of this category of registry data, provisioning XML (provxml) must be used.","pos":[518,614]},{"content":"If provxml is not used to update the registry data that has been changed since the device was flashed in the factory, the update will report success to the user, but the registry changes in a standard update will not be applied.","pos":[615,843]},{"content":"Important","pos":[847,856]},{"content":"Registry updates for entries that will not be changed can be handled by using standard updates.","pos":[861,956]},{"content":"Only use provxml files in updates when there is an unavoidable need to update registry entries that may change.","pos":[957,1068]},{"pos":[1178,1204],"content":"Registry update strategies"},{"content":"To avoid the need to update existing registry data, your code could be updated to read the existing registry data and migrate it to a new key, so that any existing user settings are preserved.","pos":[1207,1399]},{"content":"Alternatively, approaches such as adding a version number check when the application starts (to determine which registry values to use) may be appropriate.","pos":[1400,1555]},{"content":"If none of these approaches are possible, provxml can be used to overwrite the existing registry settings.","pos":[1556,1662]},{"pos":[1841,1880],"content":"Updating registry settings with provxml"},{"content":"Most updates can be created without the need for provisioning XML (provxml).","pos":[1883,1959]},{"content":"But there are certain situations where the use of provxml may be required.","pos":[1960,2034]},{"content":"If a registry value can be modified by a user setting or code that executes on the phone at any time before the update is applied, standard package updates respect those changes and do not overwrite the existing registry data.","pos":[2035,2261]},{"content":"In this situation, the provxml described here must be used.","pos":[2262,2321]},{"content":"You can use OMA CP provisioning using provxml.","pos":[2323,2369]},{"content":"This sample provxml sets the value of a single registry entry.","pos":[2371,2433]},{"content":"Use the following syntax for the provxml file naming:","pos":[2702,2755]},{"content":"For the value of <bpt id=\"p1\">*</bpt>n<ept id=\"p1\">*</ept> for the first update, start with 001 and increment the value for each subsequent update.","pos":[2806,2915]},{"content":"All provxml updates are applied in the order specified by <bpt id=\"p1\">*</bpt>n<ept id=\"p1\">*</ept>.","pos":[2916,2978]},{"pos":[3195,3229],"content":"Creating a package for the provxml"},{"content":"Create a package file that places these files in the proper update directory as shown.","pos":[3232,3318]},{"content":"Provide an appropriate Owner value.","pos":[3319,3354]},{"content":"For more info, see <bpt id=\"p1\">[</bpt>Primary elements and attributes of a package project file<ept id=\"p1\">](https://msdn.microsoft.com/library/dn756796)</ept>.","pos":[3355,3479]},{"content":"Generate the package, and then include the provisioning package in the OS image that will be used to submit updates to Microsoft.","pos":[3965,4094]},{"content":"For more information, see <bpt id=\"p1\">[</bpt>Creating packages<ept id=\"p1\">](https://msdn.microsoft.com/library/dn756642)</ept> and <bpt id=\"p2\">[</bpt>Submit an update<ept id=\"p2\">](submit-an-update.md)</ept>.","pos":[4095,4230]},{"pos":[4436,4484],"content":"Resetting the phone and provxml registry updates"},{"content":"Update provxml files are processed after an update has been applied to the device.","pos":[4487,4569]},{"content":"When the update is applied, the registry changes are stored in both the base OS image and the current, active registry.","pos":[4570,4689]},{"content":"This means that when the device is reset, the registry changes that were delivered in an update are present, but updates to associated store apps that use those registry settings may not be present on the device.","pos":[4690,4902]},{"content":"As OEMs prepare updates, they must identify possible usage scenarios, such as the phone being reset, and test those to create the desired user experience.","pos":[4903,5057]},{"pos":[5227,5263],"content":"Testing provisioning file in updates"},{"content":"Two scenarios must be tested to validate an update provisioning file:","pos":[5266,5335]},{"content":"Update—Using a base image, apply the update.","pos":[5341,5385]},{"content":"Verify that the changes in the provxml were applied.","pos":[5386,5438]},{"content":"Reset—To test this after the phone has been updated, use <bpt id=\"p1\">**</bpt>Settings<ept id=\"p1\">**</ept> <ph id=\"ph1\">&amp;gt;</ph> <bpt id=\"p2\">**</bpt>System<ept id=\"p2\">**</ept> <ph id=\"ph2\">&amp;gt;</ph> <bpt id=\"p3\">**</bpt>About<ept id=\"p3\">**</ept> <ph id=\"ph3\">&amp;gt;</ph> <bpt id=\"p4\">**</bpt>Reset your phone<ept id=\"p4\">**</ept>.","pos":[5444,5571]},{"content":"Verify that the update changes in the provxml were applied.","pos":[5572,5631]},{"content":"It is important to verify that the update will work properly if the user has altered settings that the update targets.","pos":[5633,5751]},{"content":"In addition, the standard guidance for update testing should be followed.","pos":[5752,5825]},{"content":"For more info, see <bpt id=\"p1\">[</bpt>Test an update<ept id=\"p1\">](test-an-update.md)</ept>.","pos":[5826,5881]},{"pos":[6030,6059],"content":"Provxml update error handling"},{"content":"During an update, provxml files are processed on a best-effort basis.","pos":[6062,6131]},{"content":"If a provxml file cannot be processed due to formatting errors or permissions issues, the file is skipped, and processing of subsequent provxmls continues.","pos":[6132,6287]},{"content":"In development of the prvoxml, you can check the status that is stored in the registry at <bpt id=\"p1\">**</bpt>HKLM<ph id=\"ph1\">\\\\</ph>Software<ph id=\"ph2\">\\\\</ph>Microsoft<ph id=\"ph3\">\\\\</ph>Windows<ph id=\"ph4\">\\\\</ph>CurrentVersion<ph id=\"ph5\">\\\\</ph>DataMigrationFramework<ph id=\"ph6\">\\\\</ph>ProvisioningStatus<ph id=\"ph7\">\\\\</ph>Microsoft<ept id=\"p1\">**</ept>.","pos":[6288,6488]},{"content":"A registry entry is created for each provxml file that is processed, and the HRESULT from processing the file is stored as the entry value.","pos":[6489,6628]}],"content":"---\nauthor: kpacquer\nDescription: Using provisioning files to update registry settings that may change\nms.assetid: 77262c4c-69e2-456e-909b-27bd4e0d21f1\nMSHAttr: 'PreferredLib:/library/windows/hardware'\ntitle: Using provisioning files to update registry settings that may change\n---\n\n# Using provisioning files to update registry settings that may change\n\n\nStandard package updates are not applied to registry data that have been changed—for example, by a user who alters a menu setting that is stored in the registry. To update the values of this category of registry data, provisioning XML (provxml) must be used. If provxml is not used to update the registry data that has been changed since the device was flashed in the factory, the update will report success to the user, but the registry changes in a standard update will not be applied.\n\n**Important**  \nRegistry updates for entries that will not be changed can be handled by using standard updates. Only use provxml files in updates when there is an unavoidable need to update registry entries that may change.\n\n \n\n## <span id=\"AvoidingTheNeed\"></span><span id=\"avoidingtheneed\"></span><span id=\"AVOIDINGTHENEED\"></span>Registry update strategies\n\n\nTo avoid the need to update existing registry data, your code could be updated to read the existing registry data and migrate it to a new key, so that any existing user settings are preserved. Alternatively, approaches such as adding a version number check when the application starts (to determine which registry values to use) may be appropriate. If none of these approaches are possible, provxml can be used to overwrite the existing registry settings.\n\n## <span id=\"Updating_registry_settings_with_provxml\"></span><span id=\"updating_registry_settings_with_provxml\"></span><span id=\"UPDATING_REGISTRY_SETTINGS_WITH_PROVXML\"></span>Updating registry settings with provxml\n\n\nMost updates can be created without the need for provisioning XML (provxml). But there are certain situations where the use of provxml may be required. If a registry value can be modified by a user setting or code that executes on the phone at any time before the update is applied, standard package updates respect those changes and do not overwrite the existing registry data. In this situation, the provxml described here must be used.\n\nYou can use OMA CP provisioning using provxml.\n\nThis sample provxml sets the value of a single registry entry.\n\n``` syntax\n<wap-provisioningdoc>\n  <characteristic type=\"Registry\">\n    <characteristic type=\"HKLM\\Software\\ExampleRegistryKey>\n      <parm name=\"ExampleSettingName\" value=\"0\" datatype=\"integer\"/>\n    </characteristic>\n  </characteristic>\n</wap-provisioningdoc>\n```\n\nUse the following syntax for the provxml file naming:\n\n``` syntax\nmxipupdate_PackageName_n.provxml\n```\n\nFor the value of *n* for the first update, start with 001 and increment the value for each subsequent update. All provxml updates are applied in the order specified by *n*.\n\n``` syntax\nmxipupdate_updateExample_001.provxml\n```\n\n## <span id=\"Creating_a_package_for_the_provxml\"></span><span id=\"creating_a_package_for_the_provxml\"></span><span id=\"CREATING_A_PACKAGE_FOR_THE_PROVXML\"></span>Creating a package for the provxml\n\n\nCreate a package file that places these files in the proper update directory as shown. Provide an appropriate Owner value. For more info, see [Primary elements and attributes of a package project file](https://msdn.microsoft.com/library/dn756796).\n\n``` syntax\n<?xml version=\"1.0\" encoding=\"utf-8\"?>\n<Package xmlns=\"urn:Microsoft.WindowsPhone/PackageSchema.v8.00\"\n    Owner=\"Contoso\"\n    OwnerType=\"OEM\"\n    Platform=\"\" \n    Component=\"Update\"\n    SubComponent=\"PROVXML\"\n    ReleaseType=\"Production\"\n>\n  <Components>\n    <OSComponent>\n      <Files>\n        <File Source=\"mxipupdate_updateExample_001.provxml\" \n          DestinationDir=\"$(runtime.updateProvxmlOEM)\" />\n      </Files>\n    </OSComponent>\n  </Components>\n</Package>\n```\n\nGenerate the package, and then include the provisioning package in the OS image that will be used to submit updates to Microsoft. For more information, see [Creating packages](https://msdn.microsoft.com/library/dn756642) and [Submit an update](submit-an-update.md).\n\n## <span id=\"Resetting_the_phone_and_provxml_registry_updates\"></span><span id=\"resetting_the_phone_and_provxml_registry_updates\"></span><span id=\"RESETTING_THE_PHONE_AND_PROVXML_REGISTRY_UPDATES\"></span>Resetting the phone and provxml registry updates\n\n\nUpdate provxml files are processed after an update has been applied to the device. When the update is applied, the registry changes are stored in both the base OS image and the current, active registry. This means that when the device is reset, the registry changes that were delivered in an update are present, but updates to associated store apps that use those registry settings may not be present on the device. As OEMs prepare updates, they must identify possible usage scenarios, such as the phone being reset, and test those to create the desired user experience.\n\n## <span id=\"Testing_provisioning_file_in_updates\"></span><span id=\"testing_provisioning_file_in_updates\"></span><span id=\"TESTING_PROVISIONING_FILE_IN_UPDATES\"></span>Testing provisioning file in updates\n\n\nTwo scenarios must be tested to validate an update provisioning file:\n\n-   Update—Using a base image, apply the update. Verify that the changes in the provxml were applied.\n\n-   Reset—To test this after the phone has been updated, use **Settings** &gt; **System** &gt; **About** &gt; **Reset your phone**. Verify that the update changes in the provxml were applied.\n\nIt is important to verify that the update will work properly if the user has altered settings that the update targets. In addition, the standard guidance for update testing should be followed. For more info, see [Test an update](test-an-update.md).\n\n## <span id=\"Provxml_update_error_handling\"></span><span id=\"provxml_update_error_handling\"></span><span id=\"PROVXML_UPDATE_ERROR_HANDLING\"></span>Provxml update error handling\n\n\nDuring an update, provxml files are processed on a best-effort basis. If a provxml file cannot be processed due to formatting errors or permissions issues, the file is skipped, and processing of subsequent provxmls continues. In development of the prvoxml, you can check the status that is stored in the registry at **HKLM\\\\Software\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\DataMigrationFramework\\\\ProvisioningStatus\\\\Microsoft**. A registry entry is created for each provxml file that is processed, and the HRESULT from processing the file is stored as the entry value.\n\n \n\n \n\n\n\n\n\n"}