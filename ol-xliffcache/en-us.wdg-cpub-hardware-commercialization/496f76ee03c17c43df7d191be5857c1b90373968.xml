{"nodes":[{"content":"Deploy Windows RE","pos":[34,51]},{"content":"Deploy Windows RE","pos":[158,175]},{"content":"Deploy Windows RE","pos":[183,200]},{"content":"Use these steps to deploy Windows® Recovery Environment (Windows RE) to a new computer, to help end users repair a PC when a system failure occurs.","pos":[203,350]},{"pos":[451,464],"content":"Prerequisites"},{"content":"To complete this walkthrough, you need the following:","pos":[467,520]},{"content":"A destination computer that has been configured with a Windows RE tools partition, and optionally, a recovery image partition.","pos":[526,652]},{"content":"For more information, see <bpt id=\"p1\">[</bpt>Capture and Apply Windows, System, and Recovery Partitions<ept id=\"p1\">](capture-and-apply-windows-system-and-recovery-partitions.md)</ept>.","pos":[653,801]},{"content":"Optional: Customize your recovery media.","pos":[806,846]},{"content":"For more information, see <bpt id=\"p1\">[</bpt>Customize Windows RE<ept id=\"p1\">](customize-windows-re.md)</ept>.","pos":[847,921]},{"content":"Optional: Customize your recovery media to include custom tools.","pos":[926,990]},{"content":"For more information, see <bpt id=\"p1\">[</bpt>Add a Custom Tool to the Windows RE Boot Options Menu<ept id=\"p1\">](add-a-custom-tool-to-the-windows-re-boot-options-menu.md)</ept>.","pos":[991,1131]},{"pos":[1238,1263],"content":"Step 1: Deploy Windows RE"},{"content":"Create a new directory in the Windows RE Tools partition, and then copy your custom Windows RE tools image (Winre.wim) to this directory.","pos":[1270,1407]},{"content":"The following are examples based on your firmware type:","pos":[1408,1463]},{"content":"UEFI:","pos":[1471,1476]},{"content":"where <bpt id=\"p1\">*</bpt>T:<ept id=\"p1\">*</ept> is the drive letter of your Windows RE Tools partition.","pos":[1615,1681]},{"content":"For example:","pos":[1682,1694]},{"content":"BIOS:","pos":[1702,1707]},{"pos":[1846,1881],"content":"where <bpt id=\"p1\">*</bpt>S:<ept id=\"p1\">*</ept> is the system partition."},{"content":"Register your custom Windows RE tools image:","pos":[1887,1931]},{"content":"UEFI:","pos":[1939,1944]},{"pos":[2068,2113],"content":"where <bpt id=\"p1\">*</bpt>T:<ept id=\"p1\">*</ept> is the Windows RE Tools partition."},{"content":"BIOS","pos":[2121,2125]},{"pos":[2249,2284],"content":"where <bpt id=\"p1\">*</bpt>S:<ept id=\"p1\">*</ept> is the System partition."},{"pos":[2290,2427],"content":"Optional: If you have added a custom tool to your Windows RE boot image, register it so that it will appear on the <bpt id=\"p1\">**</bpt>Boot Options<ept id=\"p1\">**</ept> menu:"},{"pos":[2554,2721],"content":"For more information about adding a custom tool, see <bpt id=\"p1\">[</bpt>Add a Custom Tool to the Windows RE Boot Options Menu<ept id=\"p1\">](add-a-custom-tool-to-the-windows-re-boot-options-menu.md)</ept>."},{"content":"Optional: Configure a hardware recovery button (or button combination) to run a secondary boot path that contains Windows RE.","pos":[2727,2852]},{"content":"For more information, see <bpt id=\"p1\">[</bpt>Add a Hardware Recovery Button to Start Windows RE<ept id=\"p1\">](add-a-hardware-recovery-button-to-start-windows-re.md)</ept>.","pos":[2853,2987]},{"pos":[3091,3158],"content":"Step 2: Identify the Recovery Partitions and Hide the Drive Letters"},{"pos":[3161,3362],"content":"<bpt id=\"p1\">**</bpt>Note<ept id=\"p1\">**</ept>   If you want to configure push-button reset features for Windows 8 editions, skip this section, and go to the topic: <bpt id=\"p2\">[</bpt>Deploy Push-Button Reset Features<ept id=\"p2\">](deploy-push-button-reset-features.md)</ept>."},{"content":"Configure your partitions as recovery partitions, and then conceal the drive letters so the partitions don't appear in common Windows menus, such as File Explorer.","pos":[3367,3530]},{"content":"Prepare a DiskPart script to identify the recovery partitions and to hide drive letters","pos":[3534,3621]},{"content":"In Notepad, create a text file that includes commands to identify and hide the recovery partitions.","pos":[3629,3728]},{"content":"The following examples are based on your firmware type:","pos":[3729,3784]},{"content":"UEFI:","pos":[3792,3797]},{"content":"Use the ID: PARTITION<ph id=\"ph1\">\\_</ph>MSFT<ph id=\"ph2\">\\_</ph>RECOVERY<ph id=\"ph3\">\\_</ph>GUID (de94bba4-06d1-4d40-a16a-bfd50179d6ac) to define the partitions as recovery partitions.","pos":[3805,3936]},{"content":"Use the GPT attributes: 0x8000000000000001 to hide the drive letters and to mark them as required, by using a combination of two attributes: GPT<ph id=\"ph1\">\\_</ph>BASIC<ph id=\"ph2\">\\_</ph>DATA<ph id=\"ph3\">\\_</ph>ATTRIBUTE<ph id=\"ph4\">\\_</ph>NO<ph id=\"ph5\">\\_</ph>DRIVE<ph id=\"ph6\">\\_</ph>LETTER and GPT<ph id=\"ph7\">\\_</ph>ATTRIBUTE<ph id=\"ph8\">\\_</ph>PLATFORM<ph id=\"ph9\">\\_</ph>REQUIRED.","pos":[3942,4169]},{"pos":[4175,4331],"content":"For more information about UEFI hard drive partition attributes, see <bpt id=\"p1\">[</bpt>PARTITION<ph id=\"ph1\">\\_</ph>INFORMATION<ph id=\"ph2\">\\_</ph>GPT structure<ept id=\"p1\">](http://go.microsoft.com/fwlink/?LinkId=240300)</ept>."},{"content":"BIOS:","pos":[4791,4796]},{"pos":[4804,4919],"content":"Use the attribute: <ph id=\"ph1\">`id=27`</ph> to define the system partition, and use the <ph id=\"ph2\">`remove`</ph> command to remove the drive letter."},{"content":"Save your completed file as either E:<ph id=\"ph1\">\\\\</ph>Recovery<ph id=\"ph2\">\\\\</ph>HideRecoveryPartitions-UEFI.txt or E:<ph id=\"ph3\">\\\\</ph>Recovery<ph id=\"ph4\">\\\\</ph>HideRecoveryPartitions-BIOS.txt, based on your firmware type.","pos":[5083,5242]},{"content":"Identify and hide the drive letters","pos":[5246,5281]},{"content":"Run the diskpart script to identify and hide the recovery partitions:","pos":[5289,5358]},{"pos":[5454,5502],"content":"Where <bpt id=\"p1\">*</bpt><ph id=\"ph1\">&amp;lt;</ph>firmware<ph id=\"ph2\">&amp;gt;</ph><ept id=\"p1\">*</ept> is either UEFI or BIOS."},{"content":"Verify that the Windows RE configuration is set correctly","pos":[5506,5563]},{"content":"Open an administrative command prompt.","pos":[5571,5609]},{"content":"Verify the Windows RE information:","pos":[5615,5649]},{"content":"Verify the following:","pos":[5698,5719]},{"content":"Windows RE status is enabled.","pos":[5729,5758]},{"content":"Windows RE location is on the correct partition.","pos":[5767,5815]},{"content":"The BCD GUID entry for WinRE is the same as the WinRE GUID entry in the file: reagent.xml.","pos":[5824,5914]},{"content":"On BIOS-based PCs, this file is on the system partition, at <ph id=\"ph1\">\\\\</ph>Recovery<ph id=\"ph2\">\\\\</ph>(GUID)<ph id=\"ph3\">\\\\</ph>.","pos":[5915,5996]},{"content":"On UEFI-based PCs, this file is on the Windows RE Tools partition, at <ph id=\"ph1\">\\\\</ph>Recovery<ph id=\"ph2\">\\\\</ph>WindowsRE<ph id=\"ph3\">\\\\</ph>.","pos":[5997,6091]},{"content":"WinRE is located in the <ph id=\"ph1\">\\\\</ph>Recovery<ph id=\"ph2\">\\\\</ph>WindowsRE directory","pos":[6100,6155]},{"pos":[6193,6207],"content":"Related topics"},{"content":"Windows Recovery Environment (Windows RE) Technical Reference","pos":[6211,6272]},{"content":"DISM Image Management Command-Line Options","pos":[6342,6384]},{"content":"Customize Windows RE","pos":[6439,6459]},{"content":"Add a Custom Tool to the Windows RE Boot Options Menu","pos":[6488,6541]}],"content":"---\nauthor: Justinha\nDescription: Deploy Windows RE\nms.assetid: 93c71c50-b3f9-49f7-bf3a-32a412b048ed\nMSHAttr: 'PreferredLib:/library/windows/hardware'\ntitle: Deploy Windows RE\n---\n\n# Deploy Windows RE\n\n\nUse these steps to deploy Windows® Recovery Environment (Windows RE) to a new computer, to help end users repair a PC when a system failure occurs.\n\n## <span id=\"Prerequisites\"></span><span id=\"prerequisites\"></span><span id=\"PREREQUISITES\"></span>Prerequisites\n\n\nTo complete this walkthrough, you need the following:\n\n-   A destination computer that has been configured with a Windows RE tools partition, and optionally, a recovery image partition. For more information, see [Capture and Apply Windows, System, and Recovery Partitions](capture-and-apply-windows-system-and-recovery-partitions.md).\n-   Optional: Customize your recovery media. For more information, see [Customize Windows RE](customize-windows-re.md).\n-   Optional: Customize your recovery media to include custom tools. For more information, see [Add a Custom Tool to the Windows RE Boot Options Menu](add-a-custom-tool-to-the-windows-re-boot-options-menu.md).\n\n## <span id=\"DeployWindowsRE\"></span><span id=\"deploywindowsre\"></span><span id=\"DEPLOYWINDOWSRE\"></span>Step 1: Deploy Windows RE\n\n\n1.  Create a new directory in the Windows RE Tools partition, and then copy your custom Windows RE tools image (Winre.wim) to this directory. The following are examples based on your firmware type:\n\n    **UEFI:**\n\n    ``` syntax\n    mkdir T:\\Recovery\\WindowsRE\n\n    xcopy /h W:\\Windows\\System32\\Recovery\\Winre.wim T:\\Recovery\\WindowsRE\n    ```\n\n    where *T:* is the drive letter of your Windows RE Tools partition. For example:\n\n    **BIOS:**\n\n    ``` syntax\n    mkdir S:\\Recovery\\WindowsRE\n\n    xcopy /h W:\\Windows\\System32\\Recovery\\Winre.wim S:\\Recovery\\WindowsRE\n    ```\n\n    where *S:* is the system partition.\n\n2.  Register your custom Windows RE tools image:\n\n    **UEFI:**\n\n    ``` syntax\n    C:\\Windows\\System32\\Reagentc /setreimage /path T:\\Recovery\\WindowsRE /target W:\\Windows\n    ```\n\n    where *T:* is the Windows RE Tools partition.\n\n    **BIOS**\n\n    ``` syntax\n    C:\\Windows\\System32\\Reagentc /setreimage /path S:\\Recovery\\WindowsRE /target W:\\Windows\n    ```\n\n    where *S:* is the System partition.\n\n3.  Optional: If you have added a custom tool to your Windows RE boot image, register it so that it will appear on the **Boot Options** menu:\n\n    ``` syntax\n    Reagentc /setbootshelllink /configfile E:\\Recovery\\BootMenu\\AddDiagnosticsToolToBootMenu.xml\n    ```\n\n    For more information about adding a custom tool, see [Add a Custom Tool to the Windows RE Boot Options Menu](add-a-custom-tool-to-the-windows-re-boot-options-menu.md).\n\n4.  Optional: Configure a hardware recovery button (or button combination) to run a secondary boot path that contains Windows RE. For more information, see [Add a Hardware Recovery Button to Start Windows RE](add-a-hardware-recovery-button-to-start-windows-re.md).\n\n## <span id=\"PrepareScripts\"></span><span id=\"preparescripts\"></span><span id=\"PREPARESCRIPTS\"></span>Step 2: Identify the Recovery Partitions and Hide the Drive Letters\n\n\n**Note**   If you want to configure push-button reset features for Windows 8 editions, skip this section, and go to the topic: [Deploy Push-Button Reset Features](deploy-push-button-reset-features.md).\n\n \n\nConfigure your partitions as recovery partitions, and then conceal the drive letters so the partitions don't appear in common Windows menus, such as File Explorer.\n\n**Prepare a DiskPart script to identify the recovery partitions and to hide drive letters**\n\n1.  In Notepad, create a text file that includes commands to identify and hide the recovery partitions. The following examples are based on your firmware type:\n\n    **UEFI:**\n\n    Use the ID: PARTITION\\_MSFT\\_RECOVERY\\_GUID (de94bba4-06d1-4d40-a16a-bfd50179d6ac) to define the partitions as recovery partitions.\n\n    Use the GPT attributes: 0x8000000000000001 to hide the drive letters and to mark them as required, by using a combination of two attributes: GPT\\_BASIC\\_DATA\\_ATTRIBUTE\\_NO\\_DRIVE\\_LETTER and GPT\\_ATTRIBUTE\\_PLATFORM\\_REQUIRED.\n\n    For more information about UEFI hard drive partition attributes, see [PARTITION\\_INFORMATION\\_GPT structure](http://go.microsoft.com/fwlink/?LinkId=240300).\n\n    ``` syntax\n    rem == HideRecoveryPartitions-UEFI.txt\n    select disk 0\n    select partition 1\n    remove\n    set id=de94bba4-06d1-4d40-a16a-bfd50179d6ac\n    gpt attributes=0x8000000000000001\n    rem == If Push-button reset features are included, add the following commands:\n    rem    select partition 5\n    rem    remove\n    rem    set id=de94bba4-06d1-4d40-a16a-bfd50179d6ac\n    rem    gpt attributes=0x8000000000000001\n    list volume\n    ```\n\n    **BIOS:**\n\n    Use the attribute: `id=27` to define the system partition, and use the `remove` command to remove the drive letter.\n\n    ``` syntax\n    rem == HideRecoveryPartitions-BIOS.txt\n    select disk 0\n    select partition 3\n    set id=27\n    remove\n    list volume\n    exit\n    ```\n\n2.  Save your completed file as either E:\\\\Recovery\\\\HideRecoveryPartitions-UEFI.txt or E:\\\\Recovery\\\\HideRecoveryPartitions-BIOS.txt, based on your firmware type.\n\n**Identify and hide the drive letters**\n\n-   Run the diskpart script to identify and hide the recovery partitions:\n\n    ``` syntax\n    Diskpart /s E:\\Recovery\\HideRecoveryPartitions-<firmware>.txt\n    ```\n\n    Where *&lt;firmware&gt;* is either UEFI or BIOS.\n\n**Verify that the Windows RE configuration is set correctly**\n\n-   Open an administrative command prompt.\n\n    Verify the Windows RE information:\n\n    ``` syntax\n    reagentc /info\n    ```\n\n    Verify the following:\n\n    -   Windows RE status is enabled.\n    -   Windows RE location is on the correct partition.\n    -   The BCD GUID entry for WinRE is the same as the WinRE GUID entry in the file: reagent.xml. On BIOS-based PCs, this file is on the system partition, at \\\\Recovery\\\\(GUID)\\\\. On UEFI-based PCs, this file is on the Windows RE Tools partition, at \\\\Recovery\\\\WindowsRE\\\\.\n    -   WinRE is located in the \\\\Recovery\\\\WindowsRE directory\n\n## <span id=\"related_topics\"></span>Related topics\n\n\n[Windows Recovery Environment (Windows RE) Technical Reference](windows-recovery-environment--windows-re--technical-reference.md)\n\n[DISM Image Management Command-Line Options](dism-image-management-command-line-options-s14.md)\n\n[Customize Windows RE](customize-windows-re.md)\n\n[Add a Custom Tool to the Windows RE Boot Options Menu](add-a-custom-tool-to-the-windows-re-boot-options-menu.md)\n\n \n\n \n\n\n\n\n\n\n"}