{"nodes":[{"content":"Lab 2b: Windows desktop apps and data: capturing changes","pos":[35,91]},{"content":"Lab 2b: Windows desktop apps and data: capturing changes","pos":[200,256]},{"content":"Lab 2b: Windows desktop apps and data: capturing changes","pos":[265,321]},{"content":"You can use audit mode to add Windows desktop applications and other data to the device.","pos":[324,412]},{"content":"After doing this, we'll use the ScanState tool to capture these changes into a provisioning package so they can be used by the recovery tools.","pos":[413,555]},{"content":"We'll also show you how to generalize the image, which prepares the Windows files to be captured and applied to other devices.","pos":[557,683]},{"pos":[850,885],"content":"Step 1: Prepare a copy of ScanState"},{"content":"On your technician PC, plug in another USB key or drive.","pos":[892,948]},{"pos":[953,1043],"content":"In File Explorer, create a new folder on the USB key, for example: <bpt id=\"p1\">**</bpt>D:<ph id=\"ph1\">\\\\</ph>ScanState<ph id=\"ph2\">\\_</ph>x64<ept id=\"p1\">**</ept>."},{"content":"Copy the files from <bpt id=\"p1\">**</bpt>\"C:<ph id=\"ph1\">\\\\</ph>Program Files (x86)<ph id=\"ph2\">\\\\</ph>Windows Kits<ph id=\"ph3\">\\\\</ph>10<ph id=\"ph4\">\\\\</ph>Assessment and Deployment Kit<ph id=\"ph5\">\\\\</ph>User State Migration Tool<ph id=\"ph6\">\\\\</ph>amd64\"<ept id=\"p1\">**</ept> into <bpt id=\"p2\">**</bpt>D:<ph id=\"ph7\">\\\\</ph>ScanState<ph id=\"ph8\">\\_</ph>x64<ept id=\"p2\">**</ept>.","pos":[1048,1209]},{"content":"You don't need to copy the subfolders.","pos":[1210,1248]},{"content":"Copy the files from <bpt id=\"p1\">**</bpt>\"C:<ph id=\"ph1\">\\\\</ph>Program Files (x86)<ph id=\"ph2\">\\\\</ph>Windows Kits<ph id=\"ph3\">\\\\</ph>10<ph id=\"ph4\">\\\\</ph>Assessment and Deployment Kit<ph id=\"ph5\">\\\\</ph>Windows Setup<ph id=\"ph6\">\\\\</ph>amd64<ph id=\"ph7\">\\\\</ph>Sources\"<ept id=\"p1\">**</ept> into <bpt id=\"p2\">**</bpt>D:<ph id=\"ph8\">\\\\</ph>ScanState<ph id=\"ph9\">\\_</ph>x64<ept id=\"p2\">**</ept>.","pos":[1253,1411]},{"content":"There will be duplicate files, it's OK to skip copying these files.","pos":[1412,1479]},{"content":"You don't need to copy the subfolders.","pos":[1480,1518]},{"pos":[1977,2011],"content":"Prepare a device for image capture"},{"content":"Get into audit mode","pos":[2016,2035]},{"content":"Boot up the reference device, if it's not already booted.","pos":[2043,2100]},{"pos":[2105,2224],"content":"If the device boots to the <bpt id=\"p1\">**</bpt>Languages<ept id=\"p1\">**</ept> or the <bpt id=\"p2\">**</bpt>Get going fast<ept id=\"p2\">**</ept> screen, press <bpt id=\"p3\">**</bpt>Ctrl+Shift+F3<ept id=\"p3\">**</ept> to enter Audit mode."},{"content":"In audit mode, the device reboots to the Desktop, and the System Preparation Tool (Sysprep) appears.","pos":[2229,2329]},{"content":"Ignore Sysprep for now.","pos":[2330,2353]},{"content":"Verify drivers and packages","pos":[2357,2384]},{"pos":[2392,2464],"content":"Right-click the <bpt id=\"p1\">**</bpt>Start<ept id=\"p1\">**</ept> button, and select <bpt id=\"p2\">**</bpt>Command Prompt (Admin)<ept id=\"p2\">**</ept>."},{"content":"Verify that the drivers appear correctly:","pos":[2469,2510]},{"content":"If you've added the sample driver, look for \"Provider Name: DMI Test team\"","pos":[2590,2664]},{"content":"Verify that the packages appear correctly:","pos":[2670,2712]},{"content":"Review the resulting list of packages and verify that the list contains the package.","pos":[2793,2877]},{"content":"For example:","pos":[2878,2890]},{"pos":[3219,3264],"content":"Step 3: Install a Classic Windows application"},{"content":"Install a Classic Windows application.","pos":[3271,3309]},{"content":"For example, to install Office 2013, put in a USB key with the Office installation program, open File Explorer and navigate to <bpt id=\"p1\">**</bpt>oemsetup.en-us.cmd<ept id=\"p1\">**</ept>.","pos":[3310,3460]},{"content":"To learn more, download the Office OPK Update image from the Office OPK Connect site.","pos":[3461,3546]},{"pos":[3776,3832],"content":"Step 4: Capture your changes into a provisioning package"},{"content":"Capture the changes into the provisioning package, and save it on the hard drive:","pos":[3839,3920]},{"pos":[4066,4128],"content":"where <bpt id=\"p1\">*</bpt>D<ept id=\"p1\">*</ept> is the drive letter of the USB drive with ScanState."},{"pos":[4134,4207],"content":"<bpt id=\"p1\">**</bpt>Note<ept id=\"p1\">**</ept>  Optional: Delete the ScanState logfile: <ph id=\"ph1\">`del C:\\Scanstate.log`</ph>."},{"pos":[4220,4370],"content":"Prepare the device for the end user: Right-click <bpt id=\"p1\">**</bpt>Start<ept id=\"p1\">**</ept>, select <bpt id=\"p2\">**</bpt>Command Prompt (Admin)<ept id=\"p2\">**</ept>, and from the command prompt, run the following command:"},{"content":"The Sysprep tool reseals the device.","pos":[4474,4510]},{"content":"This process can take several minutes.","pos":[4511,4549]},{"content":"After the process completes, the device shuts down automatically.","pos":[4550,4615]},{"content":"Boot to Windows PE and prepare to capture","pos":[4619,4660]},{"content":"Plug in the lab USB key with Windows Preinstallation Environment (WinPE).","pos":[4668,4741]},{"pos":[4746,4892],"content":"Turn on the device and press the key that opens the boot-device selection menu for the device (for example, the <bpt id=\"p1\">**</bpt>Esc<ept id=\"p1\">**</ept> key or <bpt id=\"p2\">**</bpt>Volume Up<ept id=\"p2\">**</ept> key)."},{"content":"Select the option in the firmware menus to boot to the USB flash drive.","pos":[4898,4969]},{"content":"<bpt id=\"p1\">**</bpt>Warning<ept id=\"p1\">**</ept>   If Windows begins booting instead of Windows PE, you must generalize the device again before capturing the image: After Windows boots, press <bpt id=\"p2\">**</bpt>Ctrl+Shift+F3<ept id=\"p2\">**</ept> to enter audit mode.","pos":[4975,5168]},{"content":"The device will reboot.","pos":[5169,5192]},{"content":"Generalize the device again: <ph id=\"ph1\">`C:\\Windows\\System32\\Sysprep\\sysprep /oobe /generalize /shutdown`</ph>.","pos":[5193,5288]},{"content":"Optional: speed up the optimization and image capture processes by setting the power scheme to High performance:","pos":[5301,5413]},{"content":"Find the drive letters by using DiskPart:","pos":[5496,5537]},{"pos":[5625,5749],"content":"For example, the drives can be lettered like this: <bpt id=\"p1\">*</bpt>C<ept id=\"p1\">*</ept> = Windows; <bpt id=\"p2\">*</bpt>D<ept id=\"p2\">*</ept> is the lab USB key, and <bpt id=\"p3\">*</bpt>E<ept id=\"p3\">*</ept> is an external hard drive."},{"content":"Note that some partitions might not receive a drive letter.","pos":[5755,5814]},{"content":"Optimize the image to take up less drive space (optional)","pos":[5818,5875]},{"content":"Convert the Classic Windows application and files outside of the provisioning package into pointer files which reference the contents inside the provisioning package.","pos":[5883,6049]},{"content":"This is known as single-instancing the image:","pos":[6050,6095]},{"pos":[6242,6297],"content":"where <bpt id=\"p1\">*</bpt>C<ept id=\"p1\">*</ept> is the drive letter of the Windows partition."},{"pos":[6303,6366],"content":"<bpt id=\"p1\">**</bpt>Warning<ept id=\"p1\">**</ept>  Do not put quotes with the /ImagePath:C:<ph id=\"ph1\">\\\\</ph> option."},{"content":"Cleanup the Windows files:","pos":[6379,6405]},{"content":"where <bpt id=\"p1\">*</bpt>C<ept id=\"p1\">*</ept> is the drive letter of the Windows partition.","pos":[6537,6592]},{"content":"If DISM /Resetbase is a long-running operation, you can specify the /Defer parameter with /Resetbase to defer any long-running cleanup operations to the next automatic maintenance.","pos":[6593,6773]},{"content":"But we highly recommend you <bpt id=\"p1\">**</bpt>only<ept id=\"p1\">**</ept> use /Defer as an option in the factory where DISM /Resetbase requires more than 30 minutes to complete.","pos":[6774,6914]},{"pos":[7051,7076],"content":"Step 5: Capture the image"},{"content":"Capture the image of the Windows partition, and then copy it to the external drive or share:","pos":[7083,7175]},{"pos":[7323,7434],"content":"where <bpt id=\"p1\">*</bpt>C<ept id=\"p1\">*</ept> is the drive letter of the Windows partition and <bpt id=\"p2\">*</bpt>French and Desktop Applications<ept id=\"p2\">*</ept> is the image name."},{"content":"The DISM tool captures the Windows partition into a new image file.","pos":[7440,7507]},{"content":"This process can take several minutes.","pos":[7508,7546]},{"content":"<bpt id=\"p1\">**</bpt>Troubleshooting<ept id=\"p1\">**</ept>: If you receive an: \"A parameter is incorrect\" error message when you try to capture or copy the file to the USB key, the file might be too large for the destination file system.","pos":[7552,7750]},{"content":"Copy the file to a different drive that is formatted as NTFS.","pos":[7751,7812]},{"pos":[8129,8214],"content":"Step 6: Apply the image to a new device (optional, to be done in the factory process)"},{"content":"This represents the steps you'd use in the factory.","pos":[8217,8268]},{"content":"For the purposes of the lab, reuse the reference device for this.","pos":[8269,8334]},{"content":"Prepare a place to store your files","pos":[8338,8373]},{"content":"For this step, you'll need another USB key, or an external hard drive or network location that can handle large files.","pos":[8381,8499]},{"content":"To format a separate USB key to accept large files: On your technician PC, go to File Explorer, right-click the drive and select <bpt id=\"p1\">**</bpt>Format<ept id=\"p1\">**</ept>.","pos":[8508,8648]},{"content":"Select File system: <bpt id=\"p1\">**</bpt>NTFS<ept id=\"p1\">**</ept>, accept all other defaults, and click <bpt id=\"p2\">**</bpt>OK<ept id=\"p2\">**</ept>.","pos":[8649,8723]},{"content":"Then, connect the USB key to the reference device.","pos":[8733,8783]},{"content":"To use a network file share: On your reference device, map a drive.","pos":[8793,8860]},{"content":"Example: <bpt id=\"p1\">**</bpt>net use N: <ph id=\"ph1\">\\\\\\\\</ph>server<ph id=\"ph2\">\\\\</ph>share<ept id=\"p1\">**</ept>.","pos":[8861,8903]},{"content":"<bpt id=\"p1\">**</bpt>Note<ept id=\"p1\">**</ept>  You won't be able to use the WinPE key.","pos":[8912,8961]},{"content":"To make WinPE bootable for both UEFI and BIOS-based systems, WinPE formats the key using the FAT32 file system, which has a 4GB limit.","pos":[8962,9096]},{"content":"For other ways to get around this limit, see <bpt id=\"p1\">[</bpt>Split a Windows image file (.wim) for FAT32 media or to span across multiple DVDs<ept id=\"p1\">](http://go.microsoft.com/fwlink/?LinkId=526946)</ept>.","pos":[9097,9273]},{"content":"Copy C:<ph id=\"ph1\">\\\\</ph>WindowsWithOffice.wim to the storage USB drive or network share.","pos":[9290,9363]},{"content":"Skip this step if the reference device is already booted to WinPE.","pos":[9365,9431]},{"content":"Boot to WinPE","pos":[9435,9448]},{"content":"Connect the WinPE USB drive to your reference device.","pos":[9456,9509]},{"content":"Turn off the device, and then boot to the WinPE USB drive.","pos":[9514,9572]},{"content":"You usually do this by powering on the device and quickly pressing a key (for example, the <bpt id=\"p1\">**</bpt>Esc<ept id=\"p1\">**</ept> key or the <bpt id=\"p2\">**</bpt>Volume up<ept id=\"p2\">**</ept> key).","pos":[9573,9702]},{"pos":[9708,10161],"content":"**Note**   On some devices, you might need to go into the boot menus to choose the USB drive. If you're given a choice between booting in UEFI mode or BIOS mode, choose UEFI mode. For more info, see [Boot to UEFI Mode or Legacy BIOS mode](http://go.microsoft.com/fwlink/?LinkId=526943).\nIf the device does not boot from the USB drive, see the troubleshooting tips in [WinPE: Create USB Bootable drive](http://go.microsoft.com/fwlink/?LinkId=526944).","leadings":["","    "],"nodes":[{"content":"<bpt id=\"p1\">**</bpt>Note<ept id=\"p1\">**</ept>   On some devices, you might need to go into the boot menus to choose the USB drive.","pos":[0,93]},{"content":"If you're given a choice between booting in UEFI mode or BIOS mode, choose UEFI mode.","pos":[94,179]},{"content":"For more info, see <bpt id=\"p1\">[</bpt>Boot to UEFI Mode or Legacy BIOS mode<ept id=\"p1\">](http://go.microsoft.com/fwlink/?LinkId=526943)</ept>.","pos":[180,286]},{"content":"If the device does not boot from the USB drive, see the troubleshooting tips in <bpt id=\"p1\">[</bpt>WinPE: Create USB Bootable drive<ept id=\"p1\">](http://go.microsoft.com/fwlink/?LinkId=526944)</ept>.","pos":[287,449]}]},{"content":"WinPE starts at a command line, and runs <bpt id=\"p1\">**</bpt>wpeinit<ept id=\"p1\">**</ept> to set up the system.","pos":[10174,10248]},{"content":"This can take a few minutes.","pos":[10249,10277]},{"content":"Format and set up the hard drive partitions on the reference device","pos":[10281,10348]},{"content":"On the reference device, connect the storage USB key or network share.","pos":[10356,10426]},{"content":"Find the drive letters by using DiskPart:","pos":[10431,10472]},{"pos":[10560,10686],"content":"For example, the drives can be lettered like this: <bpt id=\"p1\">*</bpt>C<ept id=\"p1\">*</ept> = Windows; <bpt id=\"p2\">*</bpt>D<ept id=\"p2\">*</ept> is the WinPE USB key, and <bpt id=\"p3\">*</bpt>E<ept id=\"p3\">*</ept> is an external hard drive."},{"content":"Some partitions might not receive a drive letter.","pos":[10692,10741]},{"content":"Format the primary hard drive, create the partitions, and apply the image by using the pre-made lab script:","pos":[10747,10854]},{"pos":[10945,10998],"content":"where <bpt id=\"p1\">*</bpt>D<ept id=\"p1\">*</ept> is the drive letter of the USB flash drive."},{"content":"The script changes the power configuration for high performance, and then creates and configures the partitions based on the firmware on the PC (either UEFI or BIOS).","pos":[11004,11170]},{"content":"Shut down or reboot your device, either by holding down the power button for a full five seconds, or by using the following command:","pos":[11176,11308]}],"content":"---\nauthor: Justinha\nDescription: 'Lab 2b: Windows desktop apps and data: capturing changes'\nms.assetid: 142bc507-64db-43dd-8432-4a19af3c568c\nMSHAttr: 'PreferredLib:/library/windows/hardware'\ntitle: 'Lab 2b: Windows desktop apps and data: capturing changes'\n---\n\n# Lab 2b: Windows desktop apps and data: capturing changes\n\n\nYou can use audit mode to add Windows desktop applications and other data to the device. After doing this, we'll use the ScanState tool to capture these changes into a provisioning package so they can be used by the recovery tools.\n\nWe'll also show you how to generalize the image, which prepares the Windows files to be captured and applied to other devices.\n\n## <span id=\"Step_1__Prepare_a_copy_of_ScanState\"></span><span id=\"step_1__prepare_a_copy_of_scanstate\"></span><span id=\"STEP_1__PREPARE_A_COPY_OF_SCANSTATE\"></span>Step 1: Prepare a copy of ScanState\n\n\n1.  On your technician PC, plug in another USB key or drive.\n2.  In File Explorer, create a new folder on the USB key, for example: **D:\\\\ScanState\\_x64**.\n3.  Copy the files from **\"C:\\\\Program Files (x86)\\\\Windows Kits\\\\10\\\\Assessment and Deployment Kit\\\\User State Migration Tool\\\\amd64\"** into **D:\\\\ScanState\\_x64**. You don't need to copy the subfolders.\n4.  Copy the files from **\"C:\\\\Program Files (x86)\\\\Windows Kits\\\\10\\\\Assessment and Deployment Kit\\\\Windows Setup\\\\amd64\\\\Sources\"** into **D:\\\\ScanState\\_x64**. There will be duplicate files, it's OK to skip copying these files. You don't need to copy the subfolders.\n\n``` syntax\nmd C:\\ScanState_amd64\nxcopy /E \"C:\\Program Files (x86)\\Windows Kits\\10\\Assessment and Deployment Kit\\User State Migration Tool\\amd64\" D:\\ScanState_x64\nxcopy /E /Y \"C:\\Program Files (x86)\\Windows Kits\\10\\Assessment and Deployment Kit\\Windows Setup\\amd64\\Sources\" D:\\ScanState_x64\n```\n\n## <span id=\"Prepare_a_device_for_image_capture\"></span><span id=\"prepare_a_device_for_image_capture\"></span><span id=\"PREPARE_A_DEVICE_FOR_IMAGE_CAPTURE\"></span>Prepare a device for image capture\n\n\n**Get into audit mode**\n\n1.  Boot up the reference device, if it's not already booted.\n2.  If the device boots to the **Languages** or the **Get going fast** screen, press **Ctrl+Shift+F3** to enter Audit mode.\n3.  In audit mode, the device reboots to the Desktop, and the System Preparation Tool (Sysprep) appears. Ignore Sysprep for now.\n\n**Verify drivers and packages**\n\n1.  Right-click the **Start** button, and select **Command Prompt (Admin)**.\n2.  Verify that the drivers appear correctly:\n\n    ``` syntax\n    C:\\Windows\\System32\\Dism /Get-Drivers /Online\n    ```\n\n    If you've added the sample driver, look for \"Provider Name: DMI Test team\"\n\n3.  Verify that the packages appear correctly:\n\n    ``` syntax\n    C:\\Windows\\System32\\Dism /Get-Packages /Online\n    ```\n\n    Review the resulting list of packages and verify that the list contains the package. For example:\n\n    ``` syntax\n    Package Identity : Microsoft-Windows-Client-LanguagePack  ...  fr-FR~10.0.10240.0\n    State : Installed\n    ```\n\n## <span id=\"Step_3__Install_a_Classic_Windows_application\"></span><span id=\"step_3__install_a_classic_windows_application\"></span><span id=\"STEP_3__INSTALL_A_CLASSIC_WINDOWS_APPLICATION\"></span>Step 3: Install a Classic Windows application\n\n\n-   Install a Classic Windows application. For example, to install Office 2013, put in a USB key with the Office installation program, open File Explorer and navigate to **oemsetup.en-us.cmd**. To learn more, download the Office OPK Update image from the Office OPK Connect site.\n\n## <span id=\"Step_4__Capture_your_changes_into_a_provisioning_package\"></span><span id=\"step_4__capture_your_changes_into_a_provisioning_package\"></span><span id=\"STEP_4__CAPTURE_YOUR_CHANGES_INTO_A_PROVISIONING_PACKAGE\"></span>Step 4: Capture your changes into a provisioning package\n\n\n1.  Capture the changes into the provisioning package, and save it on the hard drive:\n\n    ``` syntax\n    D:\\ScanState_x64\\scanstate.exe /apps /ppkg C:\\Recovery\\Customizations\\usmt.ppkg /o /c /v:13 /l:C:\\ScanState.log\n    ```\n\n    where *D* is the drive letter of the USB drive with ScanState.\n\n    **Note**  Optional: Delete the ScanState logfile: `del C:\\Scanstate.log`.\n\n     \n\n2.  Prepare the device for the end user: Right-click **Start**, select **Command Prompt (Admin)**, and from the command prompt, run the following command:\n\n    ``` syntax\n     \n    C:\\Windows\\System32\\Sysprep\\sysprep /oobe /generalize /shutdown\n    ```\n\n    The Sysprep tool reseals the device. This process can take several minutes. After the process completes, the device shuts down automatically.\n\n**Boot to Windows PE and prepare to capture**\n\n1.  Plug in the lab USB key with Windows Preinstallation Environment (WinPE).\n2.  Turn on the device and press the key that opens the boot-device selection menu for the device (for example, the **Esc** key or **Volume Up** key).\n\n    Select the option in the firmware menus to boot to the USB flash drive.\n\n    **Warning**   If Windows begins booting instead of Windows PE, you must generalize the device again before capturing the image: After Windows boots, press **Ctrl+Shift+F3** to enter audit mode. The device will reboot. Generalize the device again: `C:\\Windows\\System32\\Sysprep\\sysprep /oobe /generalize /shutdown`.\n\n     \n\n3.  Optional: speed up the optimization and image capture processes by setting the power scheme to High performance:\n\n    ``` syntax\n    powercfg /s 8c5e7fda-e8bf-4a96-9a85-a6e23a8c635c\n    ```\n\n4.  Find the drive letters by using DiskPart:\n\n    ``` syntax\n    diskpart\n    DISKPART> list volume\n    DISKPART> exit\n    ```\n\n    For example, the drives can be lettered like this: *C* = Windows; *D* is the lab USB key, and *E* is an external hard drive.\n\n    Note that some partitions might not receive a drive letter.\n\n**Optimize the image to take up less drive space (optional)**\n\n1.  Convert the Classic Windows application and files outside of the provisioning package into pointer files which reference the contents inside the provisioning package. This is known as single-instancing the image:\n\n    ``` syntax\n    DISM /Apply-CustomDataImage /CustomDataImage:C:\\Recovery\\Customizations\\USMT.ppkg /ImagePath:C:\\ /SingleInstance\n    ```\n\n    where *C* is the drive letter of the Windows partition.\n\n    **Warning**  Do not put quotes with the /ImagePath:C:\\\\ option.\n\n     \n\n2.  Cleanup the Windows files:\n\n    ``` syntax\n    md temp\n\n    DISM /Cleanup-Image /Image=C:\\ /StartComponentCleanup /ResetBase /ScratchDir:C:\\Temp\n    ```\n\n    where *C* is the drive letter of the Windows partition. If DISM /Resetbase is a long-running operation, you can specify the /Defer parameter with /Resetbase to defer any long-running cleanup operations to the next automatic maintenance. But we highly recommend you **only** use /Defer as an option in the factory where DISM /Resetbase requires more than 30 minutes to complete.\n\n## <span id=\"Step_5__Capture_the_image\"></span><span id=\"step_5__capture_the_image\"></span><span id=\"STEP_5__CAPTURE_THE_IMAGE\"></span>Step 5: Capture the image\n\n\n-   Capture the image of the Windows partition, and then copy it to the external drive or share:\n\n    ``` syntax\n    dism /Capture-Image /CaptureDir:C:\\ /ImageFile:\"C:\\WindowsWithOffice.wim\" /Name:\"French and desktop applications\"\n    ```\n\n    where *C* is the drive letter of the Windows partition and *French and Desktop Applications* is the image name.\n\n    The DISM tool captures the Windows partition into a new image file. This process can take several minutes.\n\n    **Troubleshooting**: If you receive an: \"A parameter is incorrect\" error message when you try to capture or copy the file to the USB key, the file might be too large for the destination file system. Copy the file to a different drive that is formatted as NTFS.\n\n## <span id=\"Step_6__Apply_the_image_to_a_new_device__optional__to_be_done_in_the_factory_process_\"></span><span id=\"step_6__apply_the_image_to_a_new_device__optional__to_be_done_in_the_factory_process_\"></span><span id=\"STEP_6__APPLY_THE_IMAGE_TO_A_NEW_DEVICE__OPTIONAL__TO_BE_DONE_IN_THE_FACTORY_PROCESS_\"></span>Step 6: Apply the image to a new device (optional, to be done in the factory process)\n\n\nThis represents the steps you'd use in the factory. For the purposes of the lab, reuse the reference device for this.\n\n**Prepare a place to store your files**\n\n1.  For this step, you'll need another USB key, or an external hard drive or network location that can handle large files.\n    -   To format a separate USB key to accept large files: On your technician PC, go to File Explorer, right-click the drive and select **Format**. Select File system: **NTFS**, accept all other defaults, and click **OK**.\n\n        Then, connect the USB key to the reference device.\n\n    -   To use a network file share: On your reference device, map a drive. Example: **net use N: \\\\\\\\server\\\\share**.\n    -   **Note**  You won't be able to use the WinPE key. To make WinPE bootable for both UEFI and BIOS-based systems, WinPE formats the key using the FAT32 file system, which has a 4GB limit. For other ways to get around this limit, see [Split a Windows image file (.wim) for FAT32 media or to span across multiple DVDs](http://go.microsoft.com/fwlink/?LinkId=526946).\n\n         \n\n2.  Copy C:\\\\WindowsWithOffice.wim to the storage USB drive or network share.\n\nSkip this step if the reference device is already booted to WinPE.\n\n**Boot to WinPE**\n\n1.  Connect the WinPE USB drive to your reference device.\n2.  Turn off the device, and then boot to the WinPE USB drive. You usually do this by powering on the device and quickly pressing a key (for example, the **Esc** key or the **Volume up** key).\n\n    **Note**   On some devices, you might need to go into the boot menus to choose the USB drive. If you're given a choice between booting in UEFI mode or BIOS mode, choose UEFI mode. For more info, see [Boot to UEFI Mode or Legacy BIOS mode](http://go.microsoft.com/fwlink/?LinkId=526943).\n    If the device does not boot from the USB drive, see the troubleshooting tips in [WinPE: Create USB Bootable drive](http://go.microsoft.com/fwlink/?LinkId=526944).\n\n     \n\n    WinPE starts at a command line, and runs **wpeinit** to set up the system. This can take a few minutes.\n\n**Format and set up the hard drive partitions on the reference device**\n\n1.  On the reference device, connect the storage USB key or network share.\n2.  Find the drive letters by using DiskPart:\n\n    ``` syntax\n    diskpart\n    DISKPART> list volume\n    DISKPART> exit\n    ```\n\n    For example, the drives can be lettered like this: *C* = Windows; *D* is the WinPE USB key, and *E* is an external hard drive.\n\n    Some partitions might not receive a drive letter.\n\n3.  Format the primary hard drive, create the partitions, and apply the image by using the pre-made lab script:\n\n    ``` syntax\n    D:\n    Walkthrough-Deploy.bat \"D:\\WindowsWithOffice.wim\"\n    ```\n\n    where *D* is the drive letter of the USB flash drive.\n\n    The script changes the power configuration for high performance, and then creates and configures the partitions based on the firmware on the PC (either UEFI or BIOS).\n\n4.  Shut down or reboot your device, either by holding down the power button for a full five seconds, or by using the following command:\n\n    ``` syntax\n    wpeutil shutdown\n    ```\n\n \n\n \n\n\n\n\n\n"}