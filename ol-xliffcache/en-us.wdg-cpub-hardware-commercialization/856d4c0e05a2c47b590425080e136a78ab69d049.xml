{"nodes":[{"content":"Working with WIM MMOS images","pos":[34,62]},{"content":"Working with WIM MMOS images","pos":[169,197]},{"content":"Working with WIM MMOS images","pos":[205,233]},{"content":"You can temporarily copy a WIM (Windows Imaging) image over to a device and then boot to that image running in volatile RAM memory.","pos":[236,367]},{"content":"This capability can be used to service the device using MMOS.","pos":[368,429]},{"content":"For more info about MMOS, see <bpt id=\"p1\">[</bpt>Microsoft Manufacturing OS<ept id=\"p1\">](microsoft-manufacturing-os.md)</ept>.","pos":[430,520]},{"content":"The advantage of using this approach for servicing is that you will not need to reserve space on the retail OS for code that is only used in servicing.","pos":[521,672]},{"content":"Minimizing the space that is consumed by the OS is an important consideration in low cost devices.","pos":[673,771]},{"content":"Important","pos":[775,784]},{"content":"Only MMOS test images are currently supported.","pos":[789,835]},{"content":"Retail signing is not currently supported.","pos":[836,878]},{"pos":[1003,1023],"content":"Creating a WIM Image"},{"content":"Before you create a WIM image, you must complete the steps described in the following topics:","pos":[1026,1119]},{"content":"MMOS image definition","pos":[1122,1143]},{"content":"In addition, follow these guidelines to prepare an image so that it will operate properly when converted to a WIM image.","pos":[1172,1292]},{"content":"The following XML shows an example of the Microsoft features that can be used in a test WIM Image.","pos":[1298,1396]},{"content":"You may want to add additional features such as battery charging (ENABLE<ph id=\"ph1\">\\_</ph>MMOS<ph id=\"ph2\">\\_</ph>CHARGING) depending on your needs.","pos":[1592,1706]},{"content":"For additional info about the MMOS features, see <bpt id=\"p1\">[</bpt>MMOS image definition<ept id=\"p1\">](mmos-image-definition.md)</ept>.","pos":[1707,1806]},{"content":"Do not include packages that access other partitions on the device.","pos":[1812,1879]},{"content":"Because the WIM is loaded and running in RAM, it is not able to access other partitions and the OS cannot contain packages that reference other partitions.","pos":[1880,2035]},{"content":"After you complete the steps in the preceding topics, use the <bpt id=\"p1\">**</bpt>ImgToWIM<ept id=\"p1\">**</ept> command to convert the signed FFU image to a WIM image.","pos":[2037,2167]},{"content":"The ImgToWim executable is located in %WPDKCONTENTROOT%<ph id=\"ph1\">\\\\</ph>Tools<ph id=\"ph2\">\\\\</ph>bin<ph id=\"ph3\">\\\\</ph>i386.","pos":[2168,2242]},{"content":"The usage is summarized here.","pos":[2243,2272]},{"pos":[2328,2424],"content":"When you enter the <bpt id=\"p1\">**</bpt>ImgToWim<ept id=\"p1\">**</ept> command, you should see output that is similar to the following."},{"pos":[3302,3326],"content":"Booting from a WIM Image"},{"content":"Use the FFUTool <bpt id=\"p1\">**</bpt>WIM<ept id=\"p1\">**</ept> option to boot from a WIM image.","pos":[3329,3385]},{"content":"The usage is summarized here.","pos":[3386,3415]},{"content":"To boot the device from a WIM image, complete the following steps.","pos":[3464,3530]},{"content":"Set up the PC side flashing tools.","pos":[3536,3570]},{"content":"Put the device in flashing mode by holding the volume up button while powering up the device.","pos":[3576,3669]},{"content":"After the device is in flashing mode, connect the USB cable to your computer.","pos":[3670,3747]},{"content":"Use the <bpt id=\"p1\">**</bpt>FFUTool<ept id=\"p1\">**</ept> command with the <bpt id=\"p2\">**</bpt>-WIM<ept id=\"p2\">**</ept> option to boot a device from a WIM image.","pos":[3753,3840]},{"content":"It is located in %WPDKCONTENTROOT%<ph id=\"ph1\">\\\\</ph>Tools<ph id=\"ph2\">\\\\</ph>bin<ph id=\"ph3\">\\\\</ph>i386.","pos":[3841,3894]},{"content":"When you enter the <bpt id=\"p1\">**</bpt>FFUTool -WIM<ept id=\"p1\">**</ept> command, you should see output that is similar to the following.","pos":[3895,3995]},{"content":"The ffutool sends a WIM opcode to the device, along with information about the size of the image.","pos":[4244,4341]},{"content":"Next a RAM buffer is allocated that will hold image.","pos":[4342,4394]},{"content":"The ffutool then transfers the WIM image to the device.","pos":[4395,4450]},{"content":"Once it’s fully transferred, the device boots into the WIM image in memory.","pos":[4451,4526]},{"content":"Note","pos":[4530,4534]},{"content":"The current MMOS WIM images may not display the rotating disc graphic but MMOS is still functional.","pos":[4539,4638]}],"content":"---\nauthor: kpacquer\nDescription: Working with WIM MMOS images\nms.assetid: c995e207-1b89-4d49-ad46-1ccc750737ec\nMSHAttr: 'PreferredLib:/library/windows/hardware'\ntitle: Working with WIM MMOS images\n---\n\n# Working with WIM MMOS images\n\n\nYou can temporarily copy a WIM (Windows Imaging) image over to a device and then boot to that image running in volatile RAM memory. This capability can be used to service the device using MMOS. For more info about MMOS, see [Microsoft Manufacturing OS](microsoft-manufacturing-os.md). The advantage of using this approach for servicing is that you will not need to reserve space on the retail OS for code that is only used in servicing. Minimizing the space that is consumed by the OS is an important consideration in low cost devices.\n\n**Important**  \nOnly MMOS test images are currently supported. Retail signing is not currently supported.\n\n \n\n## <span id=\"Creating_a_WIM_Image\"></span><span id=\"creating_a_wim_image\"></span><span id=\"CREATING_A_WIM_IMAGE\"></span>Creating a WIM Image\n\n\nBefore you create a WIM image, you must complete the steps described in the following topics:\n\n[MMOS image definition](mmos-image-definition.md)\n\nIn addition, follow these guidelines to prepare an image so that it will operate properly when converted to a WIM image.\n\n-   The following XML shows an example of the Microsoft features that can be used in a test WIM Image.\n\n    ``` syntax\n    <Microsoft>\n      <Feature>MOBILECOREBOOTSH</Feature>\n      <Feature>ENABLE_BOOT_KEYS_TEST</Feature>\n      <Feature>ENABLE_IP_OVER_USB</Feature>\n    </Microsoft>\n    ```\n\n    You may want to add additional features such as battery charging (ENABLE\\_MMOS\\_CHARGING) depending on your needs. For additional info about the MMOS features, see [MMOS image definition](mmos-image-definition.md).\n\n-   Do not include packages that access other partitions on the device. Because the WIM is loaded and running in RAM, it is not able to access other partitions and the OS cannot contain packages that reference other partitions.\n\nAfter you complete the steps in the preceding topics, use the **ImgToWIM** command to convert the signed FFU image to a WIM image. The ImgToWim executable is located in %WPDKCONTENTROOT%\\\\Tools\\\\bin\\\\i386. The usage is summarized here.\n\n``` syntax\nImgToWIM <FFUFileName> <WIMFileName> \n```\n\nWhen you enter the **ImgToWim** command, you should see output that is similar to the following.\n\n``` syntax\nC:\\TestWIM>ImgToWim MMOS.ffu MMOSWim.wim\nReading the image file: MMOS.ffu\nETW Log Path: C:\\Users\\USER1\\AppData\\Local\\Temp\\storage_session_1210.etl\nOS Version: Microsoft Windows NT 6.2.9200.0\nOpenDiskInternal: Creating empty virtual disk.\nNo mounted WP disks found.\nStorage Service: Created a new image in 0.7 seconds.\nAddAccessPath: Mount point for volume MainOS: C:\\Users\\USER1\\AppData\\Local\\Temp\n\\oji20cvi.mq5.mnt\\.\n\nCreating WIM at 'C:\\TestWIM\\MMOSWim.wim' ...\n\nCapturing 'MainOS'...\nWIM creation complete.\nDismountFullFlashImage:[2.87] Cleaning up temporary paths.\nCleanupTemporaryPaths: Cleaning up temporary path C:\\Users\\USER1\\AppData\\Local\\\nTemp\\oji20cvi.mq5.mnt\\.\nStorage Service: Dismounting the image in 2.9 seconds.\n```\n\n## <span id=\"Booting_from_a_WIM_Image\"></span><span id=\"booting_from_a_wim_image\"></span><span id=\"BOOTING_FROM_A_WIM_IMAGE\"></span>Booting from a WIM Image\n\n\nUse the FFUTool **WIM** option to boot from a WIM image. The usage is summarized here.\n\n``` syntax\nffutool -WIM <WIMFileName.wim>\n```\n\nTo boot the device from a WIM image, complete the following steps.\n\n1.  Set up the PC side flashing tools.\n\n2.  Put the device in flashing mode by holding the volume up button while powering up the device. After the device is in flashing mode, connect the USB cable to your computer.\n\n3.  Use the **FFUTool** command with the **-WIM** option to boot a device from a WIM image. It is located in %WPDKCONTENTROOT%\\\\Tools\\\\bin\\\\i386. When you enter the **FFUTool -WIM** command, you should see output that is similar to the following.\n\n    ``` syntax\n    C:\\> ffutool -wim MMOSWim.wim\n    Found device:\n    Name:   Contoso.MSM8960.JD301_ATT.3.2.1\n    ID:     00000011-f151-a509-0000-000000000000\n    Booting WIM: MMOSWim.wim\n    WIM transfer completed in 26.550073 seconds.\n    ```\n\nThe ffutool sends a WIM opcode to the device, along with information about the size of the image. Next a RAM buffer is allocated that will hold image. The ffutool then transfers the WIM image to the device. Once it’s fully transferred, the device boots into the WIM image in memory.\n\n**Note**  \nThe current MMOS WIM images may not display the rotating disc graphic but MMOS is still functional.\n\n \n\n \n\n \n\n\n\n\n\n"}