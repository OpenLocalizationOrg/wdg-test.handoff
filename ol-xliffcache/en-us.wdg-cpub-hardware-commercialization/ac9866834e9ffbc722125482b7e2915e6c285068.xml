{"nodes":[{"content":"diskidlehistogram","pos":[11,28]},{"content":"diskidlehistogram","pos":[42,59]},{"content":"diskidlehistogram","pos":[248,265]},{"content":"This action produces a histogram that displays all disk activity and idle time.","pos":[268,347]},{"content":"Options","pos":[621,628]},{"content":"<bpt id=\"p1\">**</bpt>-disknum<ept id=\"p1\">**</ept><bpt id=\"p2\">*</bpt><ph id=\"ph1\">&amp;lt;</ph>n<ph id=\"ph2\">&amp;gt;</ph><ept id=\"p2\">*</ept>","pos":[663,686]},{"content":"<bpt id=\"p1\">*</bpt>n<ept id=\"p1\">*</ept> indicates the disk number (0-based disk index).","pos":[689,740]},{"content":"The default value is to output histograms for all disks.","pos":[741,797]},{"content":"<bpt id=\"p1\">**</bpt>-buckets<ept id=\"p1\">**</ept><bpt id=\"p2\">*</bpt>B1 B2 … Bn<ept id=\"p2\">*</ept>","pos":[838,862]},{"content":"Arguments indicate different ranges of idle length, in seconds.","pos":[865,928]},{"content":"Default buckets are as follows:","pos":[929,960]},{"content":"0 s, 1 s","pos":[968,976]},{"content":"1 s, 5 s","pos":[986,994]},{"content":"5 s, 60 s","pos":[1004,1013]},{"content":"60 s, 180 s","pos":[1023,1034]},{"content":"180 s, 600 s","pos":[1044,1056]},{"content":"600 s, 900 s","pos":[1066,1078]},{"content":"900 s, 1200 s","pos":[1088,1101]},{"content":"1200 s, 1800 s","pos":[1111,1125]},{"content":"1800 s, +inf","pos":[1135,1147]},{"content":"A disk idle histogram displays the distribution of disk idle time and the number of idle periods over different ranges of idle period length, as illustrated by the example values in the following table.","pos":[1151,1353]},{"content":"Less than 1 second","pos":[1508,1526]},{"content":"1-600 seconds","pos":[1536,1549]},{"content":"More than 600 seconds","pos":[1559,1580]},{"content":"Idle time","pos":[1633,1642]},{"content":"1000","pos":[1659,1663]},{"content":"1000","pos":[1680,1684]},{"content":"2000","pos":[1701,1705]},{"content":"Percent of total idle time","pos":[1746,1772]},{"content":"25","pos":[1789,1791]},{"content":"25","pos":[1808,1810]},{"content":"50","pos":[1827,1829]},{"content":"Idle count","pos":[1869,1879]},{"content":"90","pos":[1896,1898]},{"content":"5","pos":[1915,1916]},{"content":"5","pos":[1933,1934]},{"content":"Percent of total idle count","pos":[1975,2002]},{"content":"90","pos":[2019,2021]},{"content":"5","pos":[2038,2039]},{"content":"5","pos":[2056,2057]},{"content":"The first row shows the histogram’s buckets: different ranges of idle length.","pos":[2095,2172]},{"content":"The second row shows the accumulated idle time for each bucket.","pos":[2174,2237]},{"content":"For example, the accumulated idle time for all idle periods shorter than 1 second is 1000 seconds.","pos":[2238,2336]},{"content":"The third row calculates the percentage of idle time for each bucket by dividing the idle time for a bucket by the total idle time.","pos":[2338,2469]},{"content":"The fourth row is the count of idle periods captured for each bucket.","pos":[2471,2540]},{"content":"In this example, there are 90 idle periods lasting less than one second.","pos":[2541,2613]},{"content":"The last row calculates the percentage of idle periods for each bucket by dividing the number of idle periods for a bucket by the total number of idle periods.","pos":[2615,2774]},{"pos":[2776,2872],"content":"The follow command would produce the buckets in the following list: <bpt id=\"p1\">**</bpt>-buckets 1s 5s 60s 180s<ept id=\"p1\">**</ept>:"},{"content":"0, 1 s","pos":[2880,2886]},{"content":"1 s, 5 s","pos":[2896,2904]},{"content":"5 s, 60 s","pos":[2914,2923]},{"content":"60 s, 180 s","pos":[2933,2944]},{"content":"180 s, +inf","pos":[2954,2965]},{"content":"<bpt id=\"p1\">**</bpt>-idletimeout<ept id=\"p1\">**</ept><bpt id=\"p2\">*</bpt>T1 T2 … Tn<ept id=\"p2\">*</ept>","pos":[3012,3040]},{"content":"Arguments indicate the idle timeout, in seconds.","pos":[3043,3091]},{"content":"The default values are 5, 60, 180, 600, and 1800.","pos":[3092,3141]},{"content":"<bpt id=\"p1\">**</bpt>-idletheshold<ept id=\"p1\">**</ept><bpt id=\"p2\">*</bpt><ph id=\"ph1\">&amp;lt;</ph>t<ph id=\"ph2\">&amp;gt;</ph><ept id=\"p2\">*</ept>","pos":[3180,3208]},{"content":"Arguments indicate the idle threshold, in seconds.","pos":[3211,3261]},{"content":"Idle periods shorter than this threshold are ignored.","pos":[3262,3315]},{"content":"<bpt id=\"p1\">**</bpt>-spindownOverhead<ept id=\"p1\">**</ept><bpt id=\"p2\">*</bpt><ph id=\"ph1\">\\[</ph>t<ph id=\"ph2\">\\]</ph><ept id=\"p2\">*</ept>","pos":[3358,3386]},{"content":"If you do not specify an argument, the default value is 0.","pos":[3389,3447]},{"content":"Using a sequence of disk I/O timestamps and a specified idle timeout, you can compute when the disk would be spun down and how much time it can stay in spun-down state, as illustrated in the following table.","pos":[3449,3656]},{"content":"Timeout, in seconds","pos":[3821,3840]},{"content":"5","pos":[3850,3851]},{"content":"60","pos":[3861,3863]},{"content":"180","pos":[3873,3876]},{"content":"600","pos":[3886,3889]},{"content":"Estimated spindown opportunity time, in seconds","pos":[3942,3989]},{"content":"3800","pos":[4006,4010]},{"content":"2000","pos":[4027,4031]},{"content":"1000","pos":[4048,4052]},{"content":"500","pos":[4069,4072]},{"content":"Estimated spindown opportunity count","pos":[4113,4149]},{"content":"500","pos":[4166,4169]},{"content":"100","pos":[4186,4189]},{"content":"50","pos":[4206,4208]},{"content":"10","pos":[4225,4227]},{"content":"The first row shows the idle timeout values of interest for estimating spun-down time.","pos":[4265,4351]},{"content":"The second row shows the estimated total spun-down time corresponding to each timeout.","pos":[4352,4438]},{"content":"In this example, a timeout of 5 seconds yielded the total spun-down time of 3800 seconds.","pos":[4439,4528]},{"content":"The third row shows the estimated number of times the disk is spun down for each timeout value.","pos":[4529,4624]},{"content":"<bpt id=\"p1\">**</bpt>-spinupOverhead<ept id=\"p1\">**</ept><bpt id=\"p2\">*</bpt>T<ept id=\"p2\">*</ept>","pos":[4663,4685]},{"content":"If you do not specify an argument, the default value is 0 seconds.","pos":[4688,4754]},{"content":"<bpt id=\"p1\">**</bpt>-exc<ph id=\"ph1\">\\_</ph>file<ept id=\"p1\">**</ept><bpt id=\"p2\">*</bpt>File1 File1 … FileN<ept id=\"p2\">*</ept>","pos":[4805,4840]},{"content":"Files matching the provided full file paths are excluded.","pos":[4843,4900]},{"content":"You must specify the full file path for each file you want to exclude.","pos":[4901,4971]},{"content":"<bpt id=\"p1\">**</bpt>-exc<ph id=\"ph1\">\\_</ph>filestr<ept id=\"p1\">**</ept><bpt id=\"p2\">*</bpt>String1 String2 … StringN<ept id=\"p2\">*</ept>","pos":[5031,5075]},{"content":"Files containing one or more of the provided strings are excluded.","pos":[5078,5144]},{"content":"<bpt id=\"p1\">**</bpt>-exc<ph id=\"ph1\">\\_</ph>filere<ept id=\"p1\">**</ept><bpt id=\"p2\">*</bpt><ph id=\"ph2\">&amp;lt;</ph>regx<ph id=\"ph3\">&amp;gt;</ph><ept id=\"p2\">*</ept>","pos":[5184,5214]},{"content":"Files matching the provided ATL regular expression are excluded.","pos":[5217,5281]},{"content":"For example, you can ignore all files ending with .dll by specifying the expression \".<ph id=\"ph1\">\\*\\\\</ph>.dll\".","pos":[5282,5378]},{"content":"<bpt id=\"p1\">**</bpt>Note<ept id=\"p1\">**</ept>   When defining a new line, you must include a return character.","pos":[5380,5453]},{"content":"Instead of using <bpt id=\"p1\">**</bpt><ph id=\"ph1\">\\\\</ph>n<ept id=\"p1\">**</ept>, use <bpt id=\"p2\">**</bpt><ph id=\"ph2\">\\\\</ph>r<ph id=\"ph3\">\\\\</ph>n<ept id=\"p2\">**</ept>.","pos":[5454,5495]},{"content":"By including both characters (carriage return = r; line feed = n), you create a line terminator.","pos":[5496,5592]},{"content":"This is helpful when creating a <bpt id=\"p1\">[</bpt>regions of interest<ept id=\"p1\">](regions-of-interest.md)</ept> file.","pos":[5593,5676]},{"content":"Remarks","pos":[5684,5691]},{"content":"There are a few system files whose disk I/Os are in response to disk I/Os to other files.","pos":[5694,5783]},{"content":"These system files include the following:","pos":[5784,5825]},{"content":"$LogFiles","pos":[5831,5840]},{"content":"$Mft","pos":[5846,5850]},{"content":"$Bitmap","pos":[5856,5863]},{"content":"lastalive0.dat","pos":[5869,5883]},{"content":"lastalive1.dat","pos":[5889,5903]},{"content":"$UsnJrnl:$J","pos":[5909,5920]},{"content":"It can be difficult to differentiate which disk I/Os to other files cause a particular disk I/O to the above system files.","pos":[5922,6044]},{"content":"Consequently, if you want to see the impact of the files that you have excluded, you must also exclude these system files.","pos":[6045,6167]},{"content":"Because these system files’ disk I/Os are in response to or \"piggyback\" on other disk I/Os, ignoring only these system files themselves is not expected to change the disk idle histogram significantly.","pos":[6168,6368]},{"content":"Output from this action can be imported into a spreadsheet for sorting and analysis.","pos":[6370,6454]},{"content":"Two additional metrics are provided for the output:","pos":[6455,6506]},{"content":"AvgIOInterval","pos":[6544,6557]},{"content":"For a particular file, this is the average interval between two subsequent I/Os to this file.","pos":[6562,6655]},{"content":"This metric can be misleading if a file has tiny I/O intervals, such as intervals of less than 1 second.","pos":[6656,6760]},{"content":"Even if this file also has large I/O intervals, such as 30 minutes, the average IO interval may look much worse than another file with medium short I/O intervals, such as 10 minutes.","pos":[6761,6943]},{"content":"In this case, you could use <ph id=\"ph1\">`-idlethreshold T`</ph> to remove idle periods of less than 1 second from the analysis.","pos":[6944,7054]},{"content":"MaxIOInterval","pos":[7092,7105]},{"content":"For each file, this is the maximum interval between two subsequent I/Os to this file.","pos":[7110,7195]},{"content":"The output is sorted based on this metric by default.","pos":[7196,7249]},{"content":"A file with one large I/O interval can still have frequent I/Os on average.","pos":[7250,7325]},{"content":"Note","pos":[7329,7333]},{"content":"Use both of these metrics and per-file histograms for a comprehensive picture of disk activity.","pos":[7338,7433]},{"content":"Avoid perturbing the disk(s) under study by using a different physical disk (or device such as a USB flash drive) to collect the trace.","pos":[7438,7573]},{"content":"Example","pos":[7578,7585]},{"content":"The following example shows a typical use of this action with default parameters","pos":[7588,7668]},{"content":"Collect information on disk I/Os as well as related information, such as registry/cswitch/stacks, in case deeper analysis is needed.","pos":[7739,7871]},{"content":"can be used to reduce trace file size.","pos":[7890,7928]},{"content":"The following example shows a set of recommended Xperf flags.","pos":[7929,7990]},{"content":"Related topics","pos":[8275,8289]},{"content":"Xperf Actions","pos":[8293,8306]}],"content":"---\ntitle: diskidlehistogram\ndescription: diskidlehistogram\nMSHAttr:\n- 'PreferredSiteName:MSDN'\n- 'PreferredLib:/library/windows/hardware'\nms.assetid: 16552102-b666-4c50-b530-87b31c4838be\nms.prod: W10\nms.mktglfcycl: operate\nms.sitesec: msdn\n---\n\n# diskidlehistogram\n\n\nThis action produces a histogram that displays all disk activity and idle time.\n\n``` syntax\n-a diskidlehistogram [-disknum <n>] [-buckets B1 B2 ... Bn] [-idletimeout T1 T2 ... Tn] [-idletheshold <t>] [-spindownOverhead [t]] [-spinupOverhead [t]] [-exc_file File1 File2 ... FileN] [-exc_filestr String1 String2 ... StringN] [-exc_filere <regex>]\n```\n\n## Options\n\n\n<a href=\"\" id=\"-disknum-n-\"></a>**-disknum***&lt;n&gt;*  \n*n* indicates the disk number (0-based disk index). The default value is to output histograms for all disks.\n\n<a href=\"\" id=\"-bucketsb1-b2---bn\"></a>**-buckets***B1 B2 … Bn*  \nArguments indicate different ranges of idle length, in seconds. Default buckets are as follows:\n\n-   \\[0 s, 1 s\\]\n\n-   \\[1 s, 5 s\\]\n\n-   \\[5 s, 60 s\\]\n\n-   \\[60 s, 180 s\\]\n\n-   \\[180 s, 600 s\\]\n\n-   \\[600 s, 900 s\\]\n\n-   \\[900 s, 1200 s\\]\n\n-   \\[1200 s, 1800 s\\]\n\n-   \\[1800 s, +inf\\]\n\nA disk idle histogram displays the distribution of disk idle time and the number of idle periods over different ranges of idle period length, as illustrated by the example values in the following table.\n\n<table>\n<colgroup>\n<col width=\"25%\" />\n<col width=\"25%\" />\n<col width=\"25%\" />\n<col width=\"25%\" />\n</colgroup>\n<thead>\n<tr class=\"header\">\n<th></th>\n<th>Less than 1 second</th>\n<th>1-600 seconds</th>\n<th>More than 600 seconds</th>\n</tr>\n</thead>\n<tbody>\n<tr class=\"odd\">\n<td><p>Idle time</p></td>\n<td><p>1000</p></td>\n<td><p>1000</p></td>\n<td><p>2000</p></td>\n</tr>\n<tr class=\"even\">\n<td><p>Percent of total idle time</p></td>\n<td><p>25</p></td>\n<td><p>25</p></td>\n<td><p>50</p></td>\n</tr>\n<tr class=\"odd\">\n<td><p>Idle count</p></td>\n<td><p>90</p></td>\n<td><p>5</p></td>\n<td><p>5</p></td>\n</tr>\n<tr class=\"even\">\n<td><p>Percent of total idle count</p></td>\n<td><p>90</p></td>\n<td><p>5</p></td>\n<td><p>5</p></td>\n</tr>\n</tbody>\n</table>\n\n \n\nThe first row shows the histogram’s buckets: different ranges of idle length.\n\nThe second row shows the accumulated idle time for each bucket. For example, the accumulated idle time for all idle periods shorter than 1 second is 1000 seconds.\n\nThe third row calculates the percentage of idle time for each bucket by dividing the idle time for a bucket by the total idle time.\n\nThe fourth row is the count of idle periods captured for each bucket. In this example, there are 90 idle periods lasting less than one second.\n\nThe last row calculates the percentage of idle periods for each bucket by dividing the number of idle periods for a bucket by the total number of idle periods.\n\nThe follow command would produce the buckets in the following list: **-buckets 1s 5s 60s 180s**:\n\n-   \\[0, 1 s\\]\n\n-   \\[1 s, 5 s\\]\n\n-   \\[5 s, 60 s\\]\n\n-   \\[60 s, 180 s\\]\n\n-   \\[180 s, +inf\\]\n\n<a href=\"\" id=\"-idletimeoutt1-t2---tn\"></a>**-idletimeout***T1 T2 … Tn*  \nArguments indicate the idle timeout, in seconds. The default values are 5, 60, 180, 600, and 1800.\n\n<a href=\"\" id=\"-idletheshold-t-\"></a>**-idletheshold***&lt;t&gt;*  \nArguments indicate the idle threshold, in seconds. Idle periods shorter than this threshold are ignored.\n\n<a href=\"\" id=\"-spindownoverhead-t-\"></a>**-spindownOverhead***\\[t\\]*  \nIf you do not specify an argument, the default value is 0.\n\nUsing a sequence of disk I/O timestamps and a specified idle timeout, you can compute when the disk would be spun down and how much time it can stay in spun-down state, as illustrated in the following table.\n\n<table>\n<colgroup>\n<col width=\"20%\" />\n<col width=\"20%\" />\n<col width=\"20%\" />\n<col width=\"20%\" />\n<col width=\"20%\" />\n</colgroup>\n<thead>\n<tr class=\"header\">\n<th>Timeout, in seconds</th>\n<th>5</th>\n<th>60</th>\n<th>180</th>\n<th>600</th>\n</tr>\n</thead>\n<tbody>\n<tr class=\"odd\">\n<td><p>Estimated spindown opportunity time, in seconds</p></td>\n<td><p>3800</p></td>\n<td><p>2000</p></td>\n<td><p>1000</p></td>\n<td><p>500</p></td>\n</tr>\n<tr class=\"even\">\n<td><p>Estimated spindown opportunity count</p></td>\n<td><p>500</p></td>\n<td><p>100</p></td>\n<td><p>50</p></td>\n<td><p>10</p></td>\n</tr>\n</tbody>\n</table>\n\n \n\nThe first row shows the idle timeout values of interest for estimating spun-down time. The second row shows the estimated total spun-down time corresponding to each timeout. In this example, a timeout of 5 seconds yielded the total spun-down time of 3800 seconds. The third row shows the estimated number of times the disk is spun down for each timeout value.\n\n<a href=\"\" id=\"-spinupoverheadt\"></a>**-spinupOverhead***T*  \nIf you do not specify an argument, the default value is 0 seconds.\n\n<a href=\"\" id=\"-exc-filefile1-file1---filen\"></a>**-exc\\_file***File1 File1 … FileN*  \nFiles matching the provided full file paths are excluded. You must specify the full file path for each file you want to exclude.\n\n<a href=\"\" id=\"-exc-filestrstring1-string2---stringn\"></a>**-exc\\_filestr***String1 String2 … StringN*  \nFiles containing one or more of the provided strings are excluded.\n\n<a href=\"\" id=\"-exc-filere-regx-\"></a>**-exc\\_filere***&lt;regx&gt;*  \nFiles matching the provided ATL regular expression are excluded. For example, you can ignore all files ending with .dll by specifying the expression \".\\*\\\\.dll\".\n\n**Note**   When defining a new line, you must include a return character. Instead of using **\\\\n**, use **\\\\r\\\\n**. By including both characters (carriage return = r; line feed = n), you create a line terminator. This is helpful when creating a [regions of interest](regions-of-interest.md) file.\n\n \n\n## Remarks\n\n\nThere are a few system files whose disk I/Os are in response to disk I/Os to other files. These system files include the following:\n\n-   $LogFiles\n\n-   $Mft\n\n-   $Bitmap\n\n-   lastalive0.dat\n\n-   lastalive1.dat\n\n-   $UsnJrnl:$J\n\nIt can be difficult to differentiate which disk I/Os to other files cause a particular disk I/O to the above system files. Consequently, if you want to see the impact of the files that you have excluded, you must also exclude these system files. Because these system files’ disk I/Os are in response to or \"piggyback\" on other disk I/Os, ignoring only these system files themselves is not expected to change the disk idle histogram significantly.\n\nOutput from this action can be imported into a spreadsheet for sorting and analysis. Two additional metrics are provided for the output:\n\n<a href=\"\" id=\"avgiointerval\"></a>**AvgIOInterval**  \nFor a particular file, this is the average interval between two subsequent I/Os to this file. This metric can be misleading if a file has tiny I/O intervals, such as intervals of less than 1 second. Even if this file also has large I/O intervals, such as 30 minutes, the average IO interval may look much worse than another file with medium short I/O intervals, such as 10 minutes. In this case, you could use `-idlethreshold T` to remove idle periods of less than 1 second from the analysis.\n\n<a href=\"\" id=\"maxiointerval\"></a>**MaxIOInterval**  \nFor each file, this is the maximum interval between two subsequent I/Os to this file. The output is sorted based on this metric by default. A file with one large I/O interval can still have frequent I/Os on average.\n\n**Note**  \nUse both of these metrics and per-file histograms for a comprehensive picture of disk activity.\n\n \n\nAvoid perturbing the disk(s) under study by using a different physical disk (or device such as a USB flash drive) to collect the trace.\n\n## Example\n\n\nThe following example shows a typical use of this action with default parameters\n\n``` syntax\nXperf -i Trace.etl -a diskidlehistogram > output.csv\n```\n\nCollect information on disk I/Os as well as related information, such as registry/cswitch/stacks, in case deeper analysis is needed. `Compact_cswitch` can be used to reduce trace file size. The following example shows a set of recommended Xperf flags.\n\n``` syntax\nxperf -on dispatcher+PROC_THREAD+LOADER+CSWITCH+COMPACT_CSWITCH +registry+DISK_IO+DISK_IO_INIT+FILEIO -stackwalk cswitch+readythread+DiskReadInit+DiskWriteInit+DiskFlushInit -buffersize 1024\nsleep <desired trace time in seconds> or run scenario\nxperf -d trace.etl\n```\n\n## Related topics\n\n\n[Xperf Actions](xperf-actions.md)\n\n \n\n \n\n\n\n\n\n\n\n"}