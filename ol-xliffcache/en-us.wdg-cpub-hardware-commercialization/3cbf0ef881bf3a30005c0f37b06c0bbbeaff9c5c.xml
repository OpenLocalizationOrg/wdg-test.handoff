{"nodes":[{"content":"Results for the Streaming Media Performance Assessment","pos":[11,65]},{"content":"Results for the Streaming Media Performance Assessment","pos":[79,133]},{"content":"Results for the Streaming Media Performance Assessment","pos":[319,373]},{"content":"The Streaming Media Performance assessment helps you assess and improve a computers streaming media performance.","pos":[376,488]},{"content":"This assessment uses a streaming server application that is deployed either on a local computer or on a remote server.","pos":[489,607]},{"content":"The assessment starts Internet Explorer® 10 and plays back the media content from start to finish or to a specified time.","pos":[608,729]},{"content":"Then, Internet Explorer closes and results are generated.","pos":[730,787]},{"content":"This topic provides guidance for understanding the results of Streaming Media performance assessment in addition to guidance on how to use those results to identify and resolve common issues that negatively affect the streaming media experience.","pos":[789,1034]},{"content":"Although Internet Explorer is used as a streaming client in this analysis, the techniques discussed in this topic can be applied to improve the general streaming media experience on Windows.","pos":[1035,1225]},{"content":"In this topic:","pos":[1227,1241]},{"content":"Goals File","pos":[1248,1258]},{"content":"Metrics","pos":[1279,1286]},{"content":"Issues","pos":[1309,1315]},{"pos":[1341,1496],"content":"For more information about this assessment, system requirements and assessment settings, see <bpt id=\"p1\">[</bpt>Streaming Media Performance<ept id=\"p1\">](streaming-media-performance.md)</ept>."},{"pos":[1532,1542],"content":"Goals File"},{"content":"You can create custom goals to measure your improvements in the Results View.","pos":[1545,1622]},{"content":"Goals files are a triage tool that can help you understand how a PC is performing and to compare PCs in your business.","pos":[1623,1741]},{"content":"For example, goals for a basic laptop might be different than the goals you set for a high end desktop computer, or market expectations might change in such a way that you want the flexibility to define different goals and key requirements as time passes and technology improves.","pos":[1743,2022]},{"content":"When a metric value is compared to the goal for that metric, the status is color coded in the Result View as follows:","pos":[2024,2141]},{"content":"Light purple means that the system has a great user experience and that there are no perceived problems.","pos":[2147,2251]},{"content":"Medium purple means that the user experience is tolerable and you can optimize the system.","pos":[2257,2347]},{"content":"Review the recommendations and analysis to see what improvements can be made to the system.","pos":[2348,2439]},{"content":"These can be software changes, configuration changes or hardware changes.","pos":[2440,2513]},{"content":"Dark purple means that the system has a poor user experience and that there is significant room for improvements.","pos":[2519,2632]},{"content":"Review the recommendations and analysis to see the improvements that can be made to the system.","pos":[2633,2728]},{"content":"These can be software changes, configuration changes or hardware changes.","pos":[2729,2802]},{"content":"You might have to consider making tradeoffs to deliver a high quality Windows experience.","pos":[2803,2892]},{"content":"No color means that there are no goals defined for the metric.","pos":[2898,2960]},{"content":"Note","pos":[2964,2968]},{"content":"In the Windows Assessment Toolkit for Windows 8, some assessments include default goals files.","pos":[2973,3067]},{"content":"The first time you view results using this version of the tools, the default goals file is used.","pos":[3068,3164]},{"content":"However, you can also define custom goals for Windows 8 the same way that you can for Windows 8.1 and Windows 10.","pos":[3165,3278]},{"content":"You can set the goals file location and add a goals file to that location before you can use the UI to apply the custom goals.","pos":[3283,3409]},{"content":"Once a goals file is selected it will continue to be the goals file that is used for any results that are opened.","pos":[3410,3523]},{"content":"Only one goals file can be used at a time.","pos":[3525,3567]},{"content":"Goals for all assessments are set in a single goals file.","pos":[3568,3625]},{"content":"The assessment tools will search for goals in the following order:","pos":[3626,3692]},{"content":"A custom goals file","pos":[3698,3717]},{"content":"Goals that are defined in the results file","pos":[3723,3765]},{"content":"Goals that are defined in the assessment manifest","pos":[3771,3820]},{"content":"You can use the sample goals file that is provided at %PROGRAMFILES%<ph id=\"ph1\">\\\\</ph>Windows Kits<ph id=\"ph2\">\\\\</ph>10<ph id=\"ph3\">\\\\</ph>Assessment and Deployment Kit<ph id=\"ph4\">\\\\</ph>Windows Assessment Toolkit<ph id=\"ph5\">\\\\</ph>SDK<ph id=\"ph6\">\\\\</ph>Samples<ph id=\"ph7\">\\\\</ph>Goals to create your own goals file.","pos":[3822,4019]},{"content":"Note","pos":[4023,4027]},{"content":"You cannot package a goals file with a job, but you can store it on a share for others to use.","pos":[4032,4126]},{"pos":[4167,4174],"content":"Metrics"},{"content":"The Streaming Media Performance assessment reports audio and video glitch metrics.","pos":[4177,4259]},{"content":"Instead of directly reporting the count of video glitches encountered, the glitches are classified based on human perception.","pos":[4260,4385]},{"content":"Most people start perceiving video and audio being out-of-sync in the range of 80ms to 160ms.","pos":[4386,4479]},{"content":"Within this time range, the number of consecutive frames that can glitch in a 30 FPS video before it can be perceived, is calculated.","pos":[4480,4613]},{"content":"Based on the count of consecutive frames that have glitches, the video glitches are classified as major, medium or minor glitches as follows:","pos":[4614,4755]},{"content":"Count of consecutive frames with glitches","pos":[4860,4901]},{"content":"Glitch classification","pos":[4911,4932]},{"content":"1","pos":[4985,4986]},{"content":"Minor glitch","pos":[5003,5015]},{"content":"2 to 4","pos":[5056,5062]},{"content":"Medium glitch","pos":[5079,5092]},{"content":"=5","pos":[5136,5138]},{"content":"Major glitch","pos":[5155,5167]},{"content":"The 60 second playback duration of the assessment workload can be divided into 60 1-second intervals.","pos":[5205,5306]},{"content":"Based on the type of glitches that occurred in an interval, every interval is classified as either a major, medium, minor or no-glitch interval.","pos":[5307,5451]},{"content":"For example, a medium glitch interval is one in which at least one medium glitch occurred but no major glitch was noticed.","pos":[5452,5574]},{"content":"Similarly a minor glitch interval is one in which at least one minor glitch occurred but no medium or major glitches were noticed.","pos":[5575,5705]},{"content":"By default, this assessment runs 3 iterations of the workloads.","pos":[5707,5770]},{"content":"However, the video plays 5 times during 3 iterations.","pos":[5771,5824]},{"content":"The first iteration is to initialize Internet Explorer, and then there are 3 video playbacks for calculating the metrics.","pos":[5825,5946]},{"content":"The last iteration is for assessing the results.","pos":[5947,5995]},{"content":"<bpt id=\"p1\">**</bpt>Training iteration<ept id=\"p1\">**</ept>.","pos":[6001,6024]},{"content":"This is the first iteration to ensure that Internet Explorer DLLS are loaded.","pos":[6025,6102]},{"content":"<bpt id=\"p1\">**</bpt>Timing iterations<ept id=\"p1\">**</ept>.","pos":[6108,6130]},{"content":"These iterations serve as a basis for the metric values.","pos":[6131,6187]},{"content":"The metric values are an average of these three iterations.","pos":[6188,6247]},{"content":"By default, three full iterations of 60 seconds of streaming generate StreamingMediaAssessment.etl trace files that are used for calculating metrics.","pos":[6248,6397]},{"content":"During these iterations only light logging is enabled to reduce the overhead of instrumentation on generated metrics.","pos":[6398,6515]},{"content":"As a result, detailed diagnostic events are not collected in this trace file.","pos":[6516,6593]},{"content":"<bpt id=\"p1\">**</bpt>Analysis iteration<ept id=\"p1\">**</ept>.","pos":[6599,6622]},{"content":"This iteration collects information while the assessment is running and serves as basis for issues generated by the assessments.","pos":[6623,6751]},{"content":"This is a full iteration of 60 seconds of streaming.","pos":[6752,6804]},{"content":"During this iteration verbose logging is enabled to collect detailed diagnostic information.","pos":[6805,6897]},{"content":"The trace file that is generated in this iteration (StreamingMediaAssessmentDiagTrace.etl) is analyzed by the assessment to detect common media-related issues on the system.","pos":[6898,7071]},{"content":"Links to the trace files are available in the details pane in the UI.","pos":[7073,7142]},{"content":"To see the values for individual iterations, in the Results View, right-click the results column header, and then choose <bpt id=\"p1\">**</bpt>Show iterations<ept id=\"p1\">**</ept>.","pos":[7143,7284]},{"pos":[7330,7336],"content":"Issues"},{"content":"This assessment performs advanced issue analysis and provides links to Windows Performance Analyzer (WPA) to troubleshoot the issues that are identified.","pos":[7339,7492]},{"content":"In most cases, you can choose the WPA in-depth analysis link to troubleshoot the issues that appear.","pos":[7493,7593]},{"content":"When WPA opens, additional details about disk activity or CPU activity might be available depending on the type of issue identified.","pos":[7594,7726]},{"content":"For more information about in-depth analysis issues and recommendations, see <bpt id=\"p1\">[</bpt>Common In-Depth Analysis Issues<ept id=\"p1\">](common-in-depth-analysis-issues.md)</ept>.","pos":[7727,7874]},{"content":"When the assessment is started, it performs certain preliminary checks on the computer that ensure consistent results can be generated across different uses of the assessment.","pos":[7876,8051]},{"content":"Various warning can appear in the assessment results if the warnings are not addressed before the assessment runs.","pos":[8052,8166]},{"content":"After completing the Streaming media assessment, based on the automated analysis of the diagnostic trace file, the assessment generates issues for common media problems identified in the system.","pos":[8167,8361]},{"content":"These issues can be analyzed in WPA.","pos":[8362,8398]},{"content":"In addition to addressing the generated issues, additional manual analysis can be performed on the diagnostic trace file by using WPA and GPUView, a tool that is included in the Windows Performance Toolkit.","pos":[8399,8605]},{"content":"This section includes:","pos":[8607,8629]},{"content":"Common Problems","pos":[8636,8651]},{"content":"Pre-check Warnings","pos":[8684,8702]},{"content":"Analyzing Generated Issues","pos":[8726,8752]},{"content":"Correlating Glitches","pos":[8784,8804]},{"content":"Software vs. Hardware Decoding","pos":[8837,8867]},{"content":"High GPU Utilization","pos":[8900,8920]},{"content":"The assessment reports an exit code of 0x80050006","pos":[8948,8997]},{"pos":[9058,9073],"content":"Common Problems"},{"content":"Some of the main causes for audio glitches include the following:","pos":[9075,9140]},{"content":"Long running Interrupt Service Routines (ISR) and Deferred Procedure Calls (DPC)","pos":[9148,9228]},{"content":"An ISR is a device driver routine that the kernel’s interrupt dispatcher transfers control to when a device issues an interrupt.","pos":[9236,9364]},{"content":"In Windows I/O model, ISRs run at a high device interrupt request level (IRQL), so that they perform as little work as possible to avoid blocking lower-level interrupts unnecessarily.","pos":[9365,9548]},{"content":"An ISR usually queues a DPC, which runs at a lower IRQL, to execute the rest of interrupt processing.","pos":[9549,9650]},{"content":"DPCs should not run longer than 100 microseconds and ISRs should not run longer than 25 microseconds.","pos":[9651,9752]},{"content":"In addition to other system performance affects, long-running ISRs and DPCs may cause delays in the audio engine that result in audio glitches.","pos":[9753,9896]},{"content":"An ISR or DPC running for durations greater than 1ms to 3ms can affect media performance on a system.","pos":[9897,9998]},{"content":"Similar to long-running ISRs and DPCs, frequent ISRs and DPCs (an ISR/DPC storm) can have similar effects on performance.","pos":[9999,10120]},{"content":"Usually such ISR and DPC problems are found in network, storage, and graphics drivers.","pos":[10121,10207]},{"content":"The assessment generates a warning for long-running ISR/DPC between 1ms to 3ms and an error for durations greater than 3ms.","pos":[10208,10331]},{"content":"For more information, see <bpt id=\"p1\">[</bpt>Analyzing Generated Issues<ept id=\"p1\">](#bkmk-streaminganalyze)</ept>.","pos":[10332,10411]},{"content":"Kernel worker thread running at dispatch level","pos":[10419,10465]},{"content":"In addition to DPCs some kernel worker threads might also be running at dispatch level (IRQL = 2).","pos":[10473,10571]},{"content":"Similarly these can also cause delays that result in audio glitches.","pos":[10572,10640]},{"content":"To detect such cases, look for low priority system threads that run non-stop for long durations without being preempted.","pos":[10641,10761]},{"content":"Client side starvation","pos":[10769,10791]},{"content":"This is when the source cannot read from disk or network fast enough to keep up with real-time decoding and rendering.","pos":[10799,10917]},{"content":"For example, the disk may be pegged by a hard page fault and as a result samples cannot be read from the disk in a faster than real-time manner.","pos":[10918,11062]},{"content":"The top causes of video glitches include the following:","pos":[11064,11119]},{"pos":[11125,11186],"content":"<bpt id=\"p1\">**</bpt>Downstream bottleneck<ept id=\"p1\">**</ept>: Source Starvation (disk is pegged)"},{"pos":[11192,11286],"content":"<bpt id=\"p1\">**</bpt>Midstream bottleneck<ept id=\"p1\">**</ept>: Decoder is maxed out (either software or hardware decoder is pegged)"},{"pos":[11292,11368],"content":"<bpt id=\"p1\">**</bpt>Upstream bottleneck<ept id=\"p1\">**</ept>: GPU is pegged or experiencing slow memory transfers"},{"pos":[11408,11426],"content":"Pre-check Warnings"},{"content":"Before starting the assessment (streaming the video), the Streaming Media Performance assessment runs some pre-checks on the system.","pos":[11428,11560]},{"content":"When these pre-checks fail, the assessment generates errors and warnings.","pos":[11561,11634]},{"content":"While errors block the assessment from running, warnings are non-blocking and allow the assessment to continue.","pos":[11635,11746]},{"content":"Some important pre-checks which affect the assessment results include the following:","pos":[11747,11831]},{"content":"AC Power is required (Warning)","pos":[11839,11869]},{"content":"We recommend running the Streaming media performance assessment on a computer that uses AC power, because some devices on the computer can scale down while they are running on battery, affecting the assessment results.","pos":[11877,12095]},{"content":"Running with VGA driver is not recommended (Warning)","pos":[12103,12155]},{"content":"Missing display drivers, such as the Microsoft basic display driver, can cause additional video glitches.","pos":[12163,12268]},{"content":"To obtain accurate results, ensure that the correct display drivers are installed before you run the assessment.","pos":[12269,12381]},{"content":"For additional details on drivers, run the <bpt id=\"p1\">[</bpt>Driver Verification<ept id=\"p1\">](driver-verification.md)</ept> assessment.","pos":[12382,12482]},{"content":"Running without an active audio rendering device is not recommended (Warning)","pos":[12490,12567]},{"content":"If there are no audio rendering devices on the system, some of the assessment results related to audio might not be accurate.","pos":[12575,12700]},{"content":"If you have audio devices, install drivers for them before you run the assessment.","pos":[12701,12783]},{"content":"If there are no built-in speakers in the computer, connect a headphone or a speaker to the audio output port of the computer to resolve this warning.","pos":[12784,12933]},{"content":"Remote session is not recommended (Warning)","pos":[12941,12984]},{"content":"To obtain more accurate results, we recommend that the assessment is run locally on the computer (instead of using a remote desktop session).","pos":[12992,13133]},{"content":"Multi-monitor (Warning)","pos":[13141,13164]},{"content":"To obtain more accurate results, we recommend running the assessment on a computer that has only a single monitor attached.","pos":[13172,13295]},{"content":"Since the assessment starts Internet Explorer in kiosk mode (full screen), on a single monitor system, Internet Explorer is the only top-level window to be composited to the desktop.","pos":[13296,13478]},{"content":"On a multi-monitor computer, there may be other top-level windows.","pos":[13479,13545]},{"content":"This can influence the assessment results.","pos":[13546,13588]},{"pos":[13636,13662],"content":"Analyzing Generated Issues"},{"content":"In most cases, you can choose the WPA in-depth analysis link to troubleshoot the issues that are generated.","pos":[13664,13771]},{"content":"This opens the StreamingMediaAssessmentDiagTrace.etl in WPA with an appropriate profile for analyzing the issue.","pos":[13772,13884]},{"content":"In WPA, you can expand the issue in <bpt id=\"p1\">**</bpt>Issue Details and Areas of Investigation<ept id=\"p1\">**</ept> to narrow down the problem.","pos":[13885,13993]},{"content":"For more information about in-depth analysis issues and recommendations, see <bpt id=\"p1\">[</bpt>Common In-Depth Analysis Issues<ept id=\"p1\">](common-in-depth-analysis-issues.md)</ept>.","pos":[13994,14141]},{"pos":[14190,14210],"content":"Correlating Glitches"},{"content":"After analyzing the issues generated by the assessment, additional analysis can be performed by opening the diagnostic trace in WPA, and then using the <bpt id=\"p1\">**</bpt>Streaming Media Analysis<ept id=\"p1\">**</ept> link.","pos":[14212,14398]},{"content":"This starts WPA with a view which is appropriate for streaming media trace analysis.","pos":[14399,14483]},{"content":"The first table of interest is the <bpt id=\"p1\">**</bpt>Activities<ept id=\"p1\">**</ept> table which provides a hierarchical view of activities (or intervals) which occurred during the analysis iteration of the assessment.","pos":[14485,14668]},{"content":"For example, the following intervals can be examined:","pos":[14669,14722]},{"content":"Streaming Media Assessment – root interval of the assessment, spanning the entire trace.","pos":[14728,14816]},{"content":"Streaming Media Assessment Iteration – an interval for every iteration of the assessment in the trace file; by default the diagnostic trace will contain only one iteration.","pos":[14822,14994]},{"content":"Workload – an interval for every workload video in the iteration.","pos":[15000,15065]},{"content":"By default, only 1080p workload is present.","pos":[15066,15109]},{"content":"Media Engine Lifetime – the interval in which the workload video was streamed.","pos":[15115,15193]},{"content":"When you find an interval of interest in the trace, select the interval in WPA, and zoom into the selection to narrow down the analysis.","pos":[15195,15331]},{"content":"The glitch events that were logged can be viewed in the <bpt id=\"p1\">**</bpt>Generic Events<ept id=\"p1\">**</ept> table (the bottom most table in the WPA analysis tab).","pos":[15333,15462]},{"content":"Select the <bpt id=\"p1\">**</bpt>Glitch Events<ept id=\"p1\">**</ept> preset in the Generic Events table to filter by the required glitch.","pos":[15463,15560]},{"content":"Having more of these glitch events in the trace indicates a relatively bad streaming experience on the system.","pos":[15561,15671]},{"content":"To analyze the reason for these glitches, try to correlate them with graphs of other summary tables in WPA.","pos":[15672,15779]},{"content":"By correlating the glitch events with other summary tables, possible issues in the system can be identified.","pos":[15780,15888]},{"pos":[15937,15967],"content":"Software vs. Hardware Decoding"},{"content":"Software or hardware decoding can be used for decoding the H.264 video which is streamed in this assessment.","pos":[15969,16077]},{"content":"If the graphics card on the system does not support decoding of H.264 video, then software is used for decoding.","pos":[16078,16190]},{"content":"With software, the decoding work is performed in the CPU instead of using the GPU.","pos":[16191,16273]},{"content":"In this case, the CPU can be pegged.","pos":[16274,16310]},{"content":"This makes it unable to keep up with the real-time decoding needs of the video stream, which results in glitches.","pos":[16311,16424]},{"content":"The ability to use hardware decoding can be determined by the DXVA2 modes supported by the graphics card.","pos":[16426,16531]},{"content":"DXVA2 modes with DXVA2<ph id=\"ph1\">\\_</ph>ModeH264<ph id=\"ph2\">\\_</ph>VLD prefix (such as DXVA2<ph id=\"ph3\">\\_</ph>ModeH264<ph id=\"ph4\">\\_</ph>VLD<ph id=\"ph5\">\\_</ph>FGT) indicate that the graphics card can support hardware decoding of H.264 video.","pos":[16532,16690]},{"content":"The DXVA2 modes supported by the graphics card can be obtained from the JobResults XML file in the following XML element: /AxeJobResults/ MachineConfiguration/EcoSysInfo/Graphics/DXVA2Modes.","pos":[16691,16881]},{"content":"The JobResults XML file location is displayed in the Result View details pane.","pos":[16882,16960]},{"pos":[17004,17024],"content":"High GPU Utilization"},{"content":"Video glitches can also be caused due to upstream bottleneck when the GPU is pegged.","pos":[17026,17110]},{"content":"GPU utilization can be visualized by opening the Streaming media diagnostic trace in the GPUView tool.","pos":[17111,17213]},{"content":"The GPUView tool can read logged video and kernel events from an event trace log (.etl) file and presents the data graphically.","pos":[17214,17341]},{"content":"The GPUView tool is part of Windows Performance Toolkit and is available in the following location after installation: \"%ProgramFiles(x86)%<ph id=\"ph1\">\\\\</ph>Windows Kits<ph id=\"ph2\">\\\\</ph>10<ph id=\"ph3\">\\\\</ph>Windows Performance Toolkit<ph id=\"ph4\">\\\\</ph>gpuview<ph id=\"ph5\">\\\\</ph>GPUView.exe\".","pos":[17342,17552]},{"content":"The streaming media diagnostic trace has a path similar to: \"<ph id=\"ph1\">&amp;lt;</ph>Job Results Directory<ph id=\"ph2\">&amp;gt;\\\\</ph>000<ph id=\"ph3\">\\_</ph>StreamingMedia<ph id=\"ph4\">\\\\</ph>StreamingMediaAssessmentDiagTrace.etl\".","pos":[17553,17705]},{"content":"GPUView can be used to determine the performance of the graphics processing unit (GPU) and the central processing unit (CPU) with regard to direct memory access (DMA) buffer processing (and all other video processing) on the video hardware.","pos":[17707,17947]},{"content":"Developers and testers can use GPUView to show different kinds of events that might lead to unusual conditions like glitches, preparation delays, and poor synchronization.","pos":[17948,18119]},{"content":"For more information about how to use GPUView, see the documentation help file, GPUView.chm, that is installed with the tool.","pos":[18120,18245]},{"pos":[18280,18329],"content":"The assessment reports an exit code of 0x80050006"},{"content":"This error occurs when maintenance tasks have been registered on the PC but have not completed before the assessment run.","pos":[18331,18452]},{"content":"This prevents the assessment from running, as maintenance tasks often impact assessment metrics.","pos":[18453,18549]},{"content":"To resolve this issue, do one of the following:","pos":[18551,18598]},{"content":"Ensure that the computer is connected to a network and is running on AC power.","pos":[18604,18682]},{"content":"Manually initiate pending maintenance tasks with the following command from an elevated prompt:","pos":[18683,18778]},{"content":"Disable regular and idle maintenance tasks, and stop all maintenance tasks before running the assessment.","pos":[18834,18939]},{"content":"Related topics","pos":[18944,18958]},{"content":"Streaming Media Performance","pos":[18962,18989]},{"content":"Windows Assessment Toolkit Technical Reference","pos":[19025,19071]},{"content":"Assessments","pos":[19126,19137]},{"content":"Common In-Depth Analysis Issues","pos":[19157,19188]},{"content":"Connected Standby Energy Efficiency","pos":[19228,19263]}],"content":"---\ntitle: Results for the Streaming Media Performance Assessment\ndescription: Results for the Streaming Media Performance Assessment\nMSHAttr:\n- 'PreferredSiteName:MSDN'\n- 'PreferredLib:/library/windows/hardware'\nms.assetid: 238eba8e-fe97-4422-be7a-88e4e232de8a\nms.prod: W10\nms.mktglfcycl: plan\nms.sitesec: msdn\n---\n\n# Results for the Streaming Media Performance Assessment\n\n\nThe Streaming Media Performance assessment helps you assess and improve a computers streaming media performance. This assessment uses a streaming server application that is deployed either on a local computer or on a remote server. The assessment starts Internet Explorer® 10 and plays back the media content from start to finish or to a specified time. Then, Internet Explorer closes and results are generated.\n\nThis topic provides guidance for understanding the results of Streaming Media performance assessment in addition to guidance on how to use those results to identify and resolve common issues that negatively affect the streaming media experience. Although Internet Explorer is used as a streaming client in this analysis, the techniques discussed in this topic can be applied to improve the general streaming media experience on Windows.\n\nIn this topic:\n\n-   [Goals File](#bkmk-goals)\n\n-   [Metrics](#bkmk-metrics)\n\n-   [Issues](#bkmk-streamingissues)\n\nFor more information about this assessment, system requirements and assessment settings, see [Streaming Media Performance](streaming-media-performance.md).\n\n## <a href=\"\" id=\"bkmk-goals\"></a>Goals File\n\n\nYou can create custom goals to measure your improvements in the Results View. Goals files are a triage tool that can help you understand how a PC is performing and to compare PCs in your business.\n\nFor example, goals for a basic laptop might be different than the goals you set for a high end desktop computer, or market expectations might change in such a way that you want the flexibility to define different goals and key requirements as time passes and technology improves.\n\nWhen a metric value is compared to the goal for that metric, the status is color coded in the Result View as follows:\n\n-   Light purple means that the system has a great user experience and that there are no perceived problems.\n\n-   Medium purple means that the user experience is tolerable and you can optimize the system. Review the recommendations and analysis to see what improvements can be made to the system. These can be software changes, configuration changes or hardware changes.\n\n-   Dark purple means that the system has a poor user experience and that there is significant room for improvements. Review the recommendations and analysis to see the improvements that can be made to the system. These can be software changes, configuration changes or hardware changes. You might have to consider making tradeoffs to deliver a high quality Windows experience.\n\n-   No color means that there are no goals defined for the metric.\n\n**Note**  \nIn the Windows Assessment Toolkit for Windows 8, some assessments include default goals files. The first time you view results using this version of the tools, the default goals file is used. However, you can also define custom goals for Windows 8 the same way that you can for Windows 8.1 and Windows 10.\n\n \n\nYou can set the goals file location and add a goals file to that location before you can use the UI to apply the custom goals. Once a goals file is selected it will continue to be the goals file that is used for any results that are opened.\n\nOnly one goals file can be used at a time. Goals for all assessments are set in a single goals file. The assessment tools will search for goals in the following order:\n\n1.  A custom goals file\n\n2.  Goals that are defined in the results file\n\n3.  Goals that are defined in the assessment manifest\n\nYou can use the sample goals file that is provided at %PROGRAMFILES%\\\\Windows Kits\\\\10\\\\Assessment and Deployment Kit\\\\Windows Assessment Toolkit\\\\SDK\\\\Samples\\\\Goals to create your own goals file.\n\n**Note**  \nYou cannot package a goals file with a job, but you can store it on a share for others to use.\n\n \n\n## <a href=\"\" id=\"bkmk-metrics\"></a>Metrics\n\n\nThe Streaming Media Performance assessment reports audio and video glitch metrics. Instead of directly reporting the count of video glitches encountered, the glitches are classified based on human perception. Most people start perceiving video and audio being out-of-sync in the range of 80ms to 160ms. Within this time range, the number of consecutive frames that can glitch in a 30 FPS video before it can be perceived, is calculated. Based on the count of consecutive frames that have glitches, the video glitches are classified as major, medium or minor glitches as follows:\n\n<table>\n<colgroup>\n<col width=\"50%\" />\n<col width=\"50%\" />\n</colgroup>\n<thead>\n<tr class=\"header\">\n<th>Count of consecutive frames with glitches</th>\n<th>Glitch classification</th>\n</tr>\n</thead>\n<tbody>\n<tr class=\"odd\">\n<td><p>1</p></td>\n<td><p>Minor glitch</p></td>\n</tr>\n<tr class=\"even\">\n<td><p>2 to 4</p></td>\n<td><p>Medium glitch</p></td>\n</tr>\n<tr class=\"odd\">\n<td><p>&gt;=5</p></td>\n<td><p>Major glitch</p></td>\n</tr>\n</tbody>\n</table>\n\n \n\nThe 60 second playback duration of the assessment workload can be divided into 60 1-second intervals. Based on the type of glitches that occurred in an interval, every interval is classified as either a major, medium, minor or no-glitch interval. For example, a medium glitch interval is one in which at least one medium glitch occurred but no major glitch was noticed. Similarly a minor glitch interval is one in which at least one minor glitch occurred but no medium or major glitches were noticed.\n\nBy default, this assessment runs 3 iterations of the workloads. However, the video plays 5 times during 3 iterations. The first iteration is to initialize Internet Explorer, and then there are 3 video playbacks for calculating the metrics. The last iteration is for assessing the results.\n\n-   **Training iteration**. This is the first iteration to ensure that Internet Explorer DLLS are loaded.\n\n-   **Timing iterations**. These iterations serve as a basis for the metric values. The metric values are an average of these three iterations. By default, three full iterations of 60 seconds of streaming generate StreamingMediaAssessment.etl trace files that are used for calculating metrics. During these iterations only light logging is enabled to reduce the overhead of instrumentation on generated metrics. As a result, detailed diagnostic events are not collected in this trace file.\n\n-   **Analysis iteration**. This iteration collects information while the assessment is running and serves as basis for issues generated by the assessments. This is a full iteration of 60 seconds of streaming. During this iteration verbose logging is enabled to collect detailed diagnostic information. The trace file that is generated in this iteration (StreamingMediaAssessmentDiagTrace.etl) is analyzed by the assessment to detect common media-related issues on the system.\n\nLinks to the trace files are available in the details pane in the UI. To see the values for individual iterations, in the Results View, right-click the results column header, and then choose **Show iterations**.\n\n## <a href=\"\" id=\"bkmk-streamingissues\"></a>Issues\n\n\nThis assessment performs advanced issue analysis and provides links to Windows Performance Analyzer (WPA) to troubleshoot the issues that are identified. In most cases, you can choose the WPA in-depth analysis link to troubleshoot the issues that appear. When WPA opens, additional details about disk activity or CPU activity might be available depending on the type of issue identified. For more information about in-depth analysis issues and recommendations, see [Common In-Depth Analysis Issues](common-in-depth-analysis-issues.md).\n\nWhen the assessment is started, it performs certain preliminary checks on the computer that ensure consistent results can be generated across different uses of the assessment. Various warning can appear in the assessment results if the warnings are not addressed before the assessment runs. After completing the Streaming media assessment, based on the automated analysis of the diagnostic trace file, the assessment generates issues for common media problems identified in the system. These issues can be analyzed in WPA. In addition to addressing the generated issues, additional manual analysis can be performed on the diagnostic trace file by using WPA and GPUView, a tool that is included in the Windows Performance Toolkit.\n\nThis section includes:\n\n-   [Common Problems](#bkmk-streamingproblems)\n\n-   [Pre-check Warnings](#bkmk-precheck)\n\n-   [Analyzing Generated Issues](#bkmk-streaminganalyze)\n\n-   [Correlating Glitches](#bkmk-streamingglitches)\n\n-   [Software vs. Hardware Decoding](#bkmk-streamingsoftware)\n\n-   [High GPU Utilization](#bkmk-streaminggpu)\n\n-   [The assessment reports an exit code of 0x80050006](#exitcode)\n\n### <a href=\"\" id=\"bkmk-streamingproblems\"></a>Common Problems\n\nSome of the main causes for audio glitches include the following:\n\n-   **Long running Interrupt Service Routines (ISR) and Deferred Procedure Calls (DPC)**\n\n    An ISR is a device driver routine that the kernel’s interrupt dispatcher transfers control to when a device issues an interrupt. In Windows I/O model, ISRs run at a high device interrupt request level (IRQL), so that they perform as little work as possible to avoid blocking lower-level interrupts unnecessarily. An ISR usually queues a DPC, which runs at a lower IRQL, to execute the rest of interrupt processing. DPCs should not run longer than 100 microseconds and ISRs should not run longer than 25 microseconds. In addition to other system performance affects, long-running ISRs and DPCs may cause delays in the audio engine that result in audio glitches. An ISR or DPC running for durations greater than 1ms to 3ms can affect media performance on a system. Similar to long-running ISRs and DPCs, frequent ISRs and DPCs (an ISR/DPC storm) can have similar effects on performance. Usually such ISR and DPC problems are found in network, storage, and graphics drivers. The assessment generates a warning for long-running ISR/DPC between 1ms to 3ms and an error for durations greater than 3ms. For more information, see [Analyzing Generated Issues](#bkmk-streaminganalyze).\n\n-   **Kernel worker thread running at dispatch level**\n\n    In addition to DPCs some kernel worker threads might also be running at dispatch level (IRQL = 2). Similarly these can also cause delays that result in audio glitches. To detect such cases, look for low priority system threads that run non-stop for long durations without being preempted.\n\n-   **Client side starvation**\n\n    This is when the source cannot read from disk or network fast enough to keep up with real-time decoding and rendering. For example, the disk may be pegged by a hard page fault and as a result samples cannot be read from the disk in a faster than real-time manner.\n\nThe top causes of video glitches include the following:\n\n1.  **Downstream bottleneck**: Source Starvation (disk is pegged)\n\n2.  **Midstream bottleneck**: Decoder is maxed out (either software or hardware decoder is pegged)\n\n3.  **Upstream bottleneck**: GPU is pegged or experiencing slow memory transfers\n\n### <a href=\"\" id=\"bkmk-precheck\"></a>Pre-check Warnings\n\nBefore starting the assessment (streaming the video), the Streaming Media Performance assessment runs some pre-checks on the system. When these pre-checks fail, the assessment generates errors and warnings. While errors block the assessment from running, warnings are non-blocking and allow the assessment to continue. Some important pre-checks which affect the assessment results include the following:\n\n-   **AC Power is required (Warning)**\n\n    We recommend running the Streaming media performance assessment on a computer that uses AC power, because some devices on the computer can scale down while they are running on battery, affecting the assessment results.\n\n-   **Running with VGA driver is not recommended (Warning)**\n\n    Missing display drivers, such as the Microsoft basic display driver, can cause additional video glitches. To obtain accurate results, ensure that the correct display drivers are installed before you run the assessment. For additional details on drivers, run the [Driver Verification](driver-verification.md) assessment.\n\n-   **Running without an active audio rendering device is not recommended (Warning)**\n\n    If there are no audio rendering devices on the system, some of the assessment results related to audio might not be accurate. If you have audio devices, install drivers for them before you run the assessment. If there are no built-in speakers in the computer, connect a headphone or a speaker to the audio output port of the computer to resolve this warning.\n\n-   **Remote session is not recommended (Warning)**\n\n-   To obtain more accurate results, we recommend that the assessment is run locally on the computer (instead of using a remote desktop session).\n\n-   **Multi-monitor (Warning)**\n\n    To obtain more accurate results, we recommend running the assessment on a computer that has only a single monitor attached. Since the assessment starts Internet Explorer in kiosk mode (full screen), on a single monitor system, Internet Explorer is the only top-level window to be composited to the desktop. On a multi-monitor computer, there may be other top-level windows. This can influence the assessment results.\n\n### <a href=\"\" id=\"bkmk-streaminganalyze\"></a>Analyzing Generated Issues\n\nIn most cases, you can choose the WPA in-depth analysis link to troubleshoot the issues that are generated. This opens the StreamingMediaAssessmentDiagTrace.etl in WPA with an appropriate profile for analyzing the issue. In WPA, you can expand the issue in **Issue Details and Areas of Investigation** to narrow down the problem. For more information about in-depth analysis issues and recommendations, see [Common In-Depth Analysis Issues](common-in-depth-analysis-issues.md).\n\n### <a href=\"\" id=\"bkmk-streamingglitches\"></a>Correlating Glitches\n\nAfter analyzing the issues generated by the assessment, additional analysis can be performed by opening the diagnostic trace in WPA, and then using the **Streaming Media Analysis** link. This starts WPA with a view which is appropriate for streaming media trace analysis.\n\nThe first table of interest is the **Activities** table which provides a hierarchical view of activities (or intervals) which occurred during the analysis iteration of the assessment. For example, the following intervals can be examined:\n\n-   Streaming Media Assessment – root interval of the assessment, spanning the entire trace.\n\n-   Streaming Media Assessment Iteration – an interval for every iteration of the assessment in the trace file; by default the diagnostic trace will contain only one iteration.\n\n-   Workload – an interval for every workload video in the iteration. By default, only 1080p workload is present.\n\n-   Media Engine Lifetime – the interval in which the workload video was streamed.\n\nWhen you find an interval of interest in the trace, select the interval in WPA, and zoom into the selection to narrow down the analysis.\n\nThe glitch events that were logged can be viewed in the **Generic Events** table (the bottom most table in the WPA analysis tab). Select the **Glitch Events** preset in the Generic Events table to filter by the required glitch. Having more of these glitch events in the trace indicates a relatively bad streaming experience on the system. To analyze the reason for these glitches, try to correlate them with graphs of other summary tables in WPA. By correlating the glitch events with other summary tables, possible issues in the system can be identified.\n\n### <a href=\"\" id=\"bkmk-streamingsoftware\"></a>Software vs. Hardware Decoding\n\nSoftware or hardware decoding can be used for decoding the H.264 video which is streamed in this assessment. If the graphics card on the system does not support decoding of H.264 video, then software is used for decoding. With software, the decoding work is performed in the CPU instead of using the GPU. In this case, the CPU can be pegged. This makes it unable to keep up with the real-time decoding needs of the video stream, which results in glitches.\n\nThe ability to use hardware decoding can be determined by the DXVA2 modes supported by the graphics card. DXVA2 modes with DXVA2\\_ModeH264\\_VLD prefix (such as DXVA2\\_ModeH264\\_VLD\\_FGT) indicate that the graphics card can support hardware decoding of H.264 video. The DXVA2 modes supported by the graphics card can be obtained from the JobResults XML file in the following XML element: /AxeJobResults/ MachineConfiguration/EcoSysInfo/Graphics/DXVA2Modes. The JobResults XML file location is displayed in the Result View details pane.\n\n### <a href=\"\" id=\"bkmk-streaminggpu\"></a>High GPU Utilization\n\nVideo glitches can also be caused due to upstream bottleneck when the GPU is pegged. GPU utilization can be visualized by opening the Streaming media diagnostic trace in the GPUView tool. The GPUView tool can read logged video and kernel events from an event trace log (.etl) file and presents the data graphically. The GPUView tool is part of Windows Performance Toolkit and is available in the following location after installation: \"%ProgramFiles(x86)%\\\\Windows Kits\\\\10\\\\Windows Performance Toolkit\\\\gpuview\\\\GPUView.exe\". The streaming media diagnostic trace has a path similar to: \"&lt;Job Results Directory&gt;\\\\000\\_StreamingMedia\\\\StreamingMediaAssessmentDiagTrace.etl\".\n\nGPUView can be used to determine the performance of the graphics processing unit (GPU) and the central processing unit (CPU) with regard to direct memory access (DMA) buffer processing (and all other video processing) on the video hardware. Developers and testers can use GPUView to show different kinds of events that might lead to unusual conditions like glitches, preparation delays, and poor synchronization. For more information about how to use GPUView, see the documentation help file, GPUView.chm, that is installed with the tool.\n\n### <a href=\"\" id=\"exitcode\"></a>The assessment reports an exit code of 0x80050006\n\nThis error occurs when maintenance tasks have been registered on the PC but have not completed before the assessment run. This prevents the assessment from running, as maintenance tasks often impact assessment metrics.\n\nTo resolve this issue, do one of the following:\n\n1.  Ensure that the computer is connected to a network and is running on AC power. Manually initiate pending maintenance tasks with the following command from an elevated prompt:\n\n    `rundll32.exe advapi32.dll,ProcessIdleTasks`\n\n2.  Disable regular and idle maintenance tasks, and stop all maintenance tasks before running the assessment.\n\n## Related topics\n\n\n[Streaming Media Performance](streaming-media-performance.md)\n\n[Windows Assessment Toolkit Technical Reference](windows-assessment-toolkit-technical-reference.md)\n\n[Assessments](assessments.md)\n\n[Common In-Depth Analysis Issues](common-in-depth-analysis-issues.md)\n\n[Connected Standby Energy Efficiency](connected-standby-energy-efficiency.md)\n\n \n\n \n\n\n\n\n\n\n\n"}