{"nodes":[{"content":"Lab 2a: Answer files: Update settings and run scripts","pos":[35,88]},{"content":"Lab 2a: Answer files: Update settings and run scripts","pos":[197,250]},{"content":"Lab 2a: Answer files: Update settings and run scripts","pos":[259,312]},{"content":"Answer files (or Unattend files) can be used to modify Windows settings in your images during Setup.","pos":[315,415]},{"content":"You can also create scripts that you can inject into your offline images, so that you can efficiently make changes to multiple images without ever booting them.","pos":[416,576]},{"content":"diagram of creating a new answer file","pos":[580,617]},{"pos":[719,744],"content":"Windows settings overview"},{"content":"While you can set many Windows settings in audit mode, some settings can only be set by using an answer file or Windows Imaging and Configuration Designer (ICD), such as adding manufacturer’s support information.","pos":[747,959]},{"content":"A full list of answer file settings (also known as Unattend settings) is in the <bpt id=\"p1\">[</bpt>Unattended Windows Setup Reference<ept id=\"p1\">](https://msdn.microsoft.com/library/windows/hardware/dn923277)</ept>.","pos":[960,1139]},{"content":"Enterprises can control other settings by using Group Policy.","pos":[1141,1202]},{"content":"For more info, see <bpt id=\"p1\">[</bpt>Group Policy<ept id=\"p1\">](http://go.microsoft.com/fwlink/p/?linkid=268543)</ept>.","pos":[1203,1286]},{"content":"You canspecify which configuration pass to add new settings:","pos":[1288,1348]},{"content":"<bpt id=\"p1\">**</bpt>1 windowsPE<ept id=\"p1\">**</ept>: These settings are used by the Windows Setup installation program.","pos":[1354,1437]},{"content":"If you’re modifying existing images, you can usually ignore these settings.","pos":[1438,1513]},{"content":"<bpt id=\"p1\">**</bpt>4 specialize<ept id=\"p1\">**</ept>: Most settings should be added here.","pos":[1518,1571]},{"content":"These settings are triggered both at the beginning of audit mode and at the beginning of OOBE.","pos":[1572,1666]},{"content":"If you need to make multiple updates or test settings, generalize the device again and add another batch of settings in the Specialize Configuration pass.","pos":[1667,1821]},{"pos":[1826,1880],"content":"<bpt id=\"p1\">**</bpt>6 auditUser<ept id=\"p1\">**</ept>: Runs as soon as you start audit mode."},{"content":"This is a great time to run a system test script - we'll add <bpt id=\"p1\">[</bpt>Microsoft-Windows-Deployment<ph id=\"ph1\">\\\\</ph>RunAsynchronousCommand<ept id=\"p1\">](https://msdn.microsoft.com/library/windows/hardware/dn915797)</ept> as our example.","pos":[1886,2079]},{"content":"To learn more, see <bpt id=\"p1\">[</bpt>Add a Custom Script to Windows Setup<ept id=\"p1\">](add-a-custom-script-to-windows-setup.md)</ept>.","pos":[2080,2179]},{"content":"<bpt id=\"p1\">**</bpt>7 oobeSystem<ept id=\"p1\">**</ept>: Use sparingly.","pos":[2185,2217]},{"content":"Most of these settings run after the user completes OOBE.","pos":[2218,2275]},{"content":"The exception is the Microsoft-Windows-Deployment<ph id=\"ph1\">\\\\</ph>Reseal<ph id=\"ph2\">\\\\</ph><bpt id=\"p1\">[</bpt>Mode<ept id=\"p1\">](https://msdn.microsoft.com/library/windows/hardware/dn923110)</ept> = Audit setting, which we’ll use to bypass OOBE and boot the PC into audit mode.","pos":[2276,2484]},{"content":"If your script relies on knowing which language the user selects during OOBE, you’d add it to the oobeSystem pass.","pos":[2490,2604]},{"pos":[2610,2734],"content":"For info on the other configuration passes, see <bpt id=\"p1\">[</bpt>Windows Setup Configuration Passes<ept id=\"p1\">](windows-setup-configuration-passes.md)</ept>."},{"content":"<bpt id=\"p1\">**</bpt>Note<ept id=\"p1\">**</ept>  These settings could be lost if the user resets their PC with the built-in recovery tools.","pos":[2736,2836]},{"content":"To see how to make sure these settings stay on the device during a reset, see <bpt id=\"p1\">[</bpt>Sample scripts<ept id=\"p1\">](windows-deployment-sample-scripts-sxs.md)</ept>: Keeping Windows settings through a recovery.","pos":[2837,3019]},{"pos":[3089,3121],"content":"Create and modify an answer file"},{"content":"Create a catalog file","pos":[3126,3147]},{"pos":[3155,3194],"content":"Start <bpt id=\"p1\">**</bpt>Windows System Image Manager<ept id=\"p1\">**</ept>."},{"pos":[3200,3253],"content":"On the <bpt id=\"p1\">**</bpt>File<ept id=\"p1\">**</ept> menu, click <bpt id=\"p2\">**</bpt>Select Windows Image<ept id=\"p2\">**</ept>."},{"content":"In the <bpt id=\"p1\">**</bpt>Select a Windows Image<ept id=\"p1\">**</ept> dialog, browse to and select the base-image file.","pos":[3259,3342]},{"content":"Next, select an edition of Windows, for example, Windows 10 Pro, and click <bpt id=\"p1\">**</bpt>OK<ept id=\"p1\">**</ept>.","pos":[3343,3425]},{"content":"Click <bpt id=\"p1\">**</bpt>Yes<ept id=\"p1\">**</ept> to create the catalog file.","pos":[3426,3467]},{"content":"Windows SIM creates the file based on the base-image file, and saves it to the Windows desktop.","pos":[3468,3563]},{"content":"This process can take several minutes.","pos":[3564,3602]},{"content":"The catalog file appears in the <bpt id=\"p1\">**</bpt>Windows Image<ept id=\"p1\">**</ept> pane.","pos":[3608,3663]},{"content":"Windows SIM also lists the configurable components and packages in that image.","pos":[3664,3742]},{"pos":[3748,3842],"content":"<bpt id=\"p1\">**</bpt>Troubleshooting:<ept id=\"p1\">**</ept> If Windows SIM does not create the catalog file, try the following steps:"},{"content":"Make sure you are using a Windows 10 for desktop editions (Home, Pro, Enterprise, and Education) version of the Windows Assessment and Deployment Kit (Windows ADK) tools.","pos":[3852,4022]},{"content":"To create a catalog file for either 32-bit or ARM-based devices, use a 32-bit device.","pos":[4032,4117]},{"pos":[4127,4289],"content":"Make sure the Windows base-image file <bpt id=\"p1\">**</bpt>(<ph id=\"ph1\">\\\\</ph>Sources<ph id=\"ph2\">\\\\</ph>Install.wim<ept id=\"p1\">**</ept>) is in a folder that has read-write privileges, such as a USB flash drive or on your hard drive."},{"content":"Create an answer file","pos":[4293,4314]},{"pos":[4322,4370],"content":"On the <bpt id=\"p1\">**</bpt>File<ept id=\"p1\">**</ept> menu, click <bpt id=\"p2\">**</bpt>New Answer File<ept id=\"p2\">**</ept>."},{"pos":[4376,4432],"content":"The new answer file appears in the <bpt id=\"p1\">**</bpt>Answer File<ept id=\"p1\">**</ept> pane."},{"content":"<bpt id=\"p1\">**</bpt>Note<ept id=\"p1\">**</ept>   If you open an existing answer file, you might be prompted to associate the answer file with the image.","pos":[4438,4552]},{"content":"Click <bpt id=\"p1\">**</bpt>Yes<ept id=\"p1\">**</ept>.","pos":[4553,4567]},{"content":"Add new answer file settings","pos":[4578,4606]},{"content":"Set the device to automatically boot to audit mode:","pos":[4614,4665]},{"pos":[4671,4842],"content":"In the <bpt id=\"p1\">**</bpt>Windows Image<ept id=\"p1\">**</ept> pane, expand <bpt id=\"p2\">**</bpt>Components<ept id=\"p2\">**</ept>, right-click <bpt id=\"p3\">**</bpt>amd64<ph id=\"ph1\">\\_</ph>Microsoft-Windows-Deployment<ph id=\"ph2\">\\_</ph>(version)<ept id=\"p3\">**</ept>, and then select <bpt id=\"p4\">**</bpt>Add Setting to Pass 7 oobeSystem<ept id=\"p4\">**</ept>."},{"pos":[4848,4967],"content":"In the <bpt id=\"p1\">**</bpt>Answer File<ept id=\"p1\">**</ept> pane, select <bpt id=\"p2\">**</bpt>Components<ph id=\"ph1\">\\\\</ph>7 oobeSystem<ph id=\"ph2\">\\\\</ph>amd64<ph id=\"ph3\">\\_</ph>Microsoft-Windows-Deployment<ph id=\"ph4\">\\_</ph>neutral<ph id=\"ph5\">\\\\</ph>Reseal<ept id=\"p2\">**</ept>."},{"pos":[4973,5057],"content":"In the <bpt id=\"p1\">**</bpt>Reseal Properties<ept id=\"p1\">**</ept> pane, in the <bpt id=\"p2\">**</bpt>Settings<ept id=\"p2\">**</ept> section, select Mode=<ph id=\"ph1\">`Audit`</ph>."},{"content":"Prepare a script to run after Audit mode begins.","pos":[5063,5111]},{"pos":[5117,5263],"content":"In the <bpt id=\"p1\">**</bpt>Windows Image<ept id=\"p1\">**</ept> pane, right-click <bpt id=\"p2\">**</bpt>amd64<ph id=\"ph1\">\\_</ph> Microsoft-Windows-Deployment<ph id=\"ph2\">\\_</ph>(version)<ept id=\"p2\">**</ept> and then click <bpt id=\"p3\">**</bpt>Add Setting to Pass 6 auditUser<ept id=\"p3\">**</ept>."},{"content":"In the <bpt id=\"p1\">**</bpt>Answer File<ept id=\"p1\">**</ept> pane, expand <bpt id=\"p2\">**</bpt>Components<ph id=\"ph1\">\\\\</ph>6 auditUser<ph id=\"ph2\">\\\\</ph>amd64<ph id=\"ph3\">\\_</ph>Microsoft-Windows-Deployment<ph id=\"ph4\">\\_</ph>neutral<ph id=\"ph5\">\\\\</ph>RunAsynchronous<ept id=\"p2\">**</ept>.","pos":[5269,5396]},{"content":"Right-click <bpt id=\"p1\">**</bpt>RunAsynchronousCommand Properties<ept id=\"p1\">**</ept> and click <bpt id=\"p2\">**</bpt>Insert New AsynchronousCommand<ept id=\"p2\">**</ept>.","pos":[5397,5492]},{"pos":[5498,5600],"content":"In the <bpt id=\"p1\">**</bpt>AsynchronousCommand Properties<ept id=\"p1\">**</ept> pane, in the <bpt id=\"p2\">**</bpt>Settings<ept id=\"p2\">**</ept> section, add the following values:"},{"content":"Save the answer file","pos":[5735,5755]},{"pos":[5763,5839],"content":"Save the answer file, for example: <bpt id=\"p1\">**</bpt>C:<ph id=\"ph1\">\\\\</ph>AnswerFiles<ph id=\"ph2\">\\\\</ph>BootToAudit-x64.xml<ept id=\"p1\">**</ept>."},{"pos":[5845,5942],"content":"<bpt id=\"p1\">**</bpt>Note<ept id=\"p1\">**</ept>   Windows SIM will not allow you to save the answer file into the mounted image folders."},{"content":"Create a script","pos":[5953,5968]},{"pos":[5976,6077],"content":"Copy the following sample script into Notepad, and save it as <bpt id=\"p1\">**</bpt>C:<ph id=\"ph1\">\\\\</ph>AnswerFiles<ph id=\"ph2\">\\\\</ph>SampleCommand.cmd<ept id=\"p1\">**</ept>."},{"pos":[6614,6657],"content":"Add the answer file and script to the image"},{"content":"Mount the Windows image.","pos":[6664,6688]},{"content":"The mounting process maps the contents of an image file to a location where you can view and modify the mounted image.","pos":[6689,6807]},{"pos":[6976,7098],"content":"Where <bpt id=\"p1\">*</bpt>C<ept id=\"p1\">*</ept> is the drive letter of the drive that contains the image and <bpt id=\"p2\">*</bpt>1<ept id=\"p2\">*</ept> is the index of the image that you want to use."},{"content":"This step can take several minutes.","pos":[7104,7139]},{"content":"Copy the answer file into the image into the <ph id=\"ph1\">\\\\</ph>Windows<ph id=\"ph2\">\\\\</ph>Panther folder, and name it unattend.xml.","pos":[7145,7242]},{"content":"Create the folder if it doesn’t exist.","pos":[7243,7281]},{"content":"If there’s an existing answer file, replace it or use Windows System Image Manager to edit/combine settings if necessary.","pos":[7282,7403]},{"content":"Commit the changes and unmount the Windows image:","pos":[7692,7741]},{"pos":[7832,7899],"content":"where <bpt id=\"p1\">*</bpt>C<ept id=\"p1\">*</ept> is the drive letter of the drive that contains the image."},{"content":"This process may take several minutes.","pos":[7905,7943]},{"content":"Verify your customizations","pos":[7947,7973]},{"pos":[7981,8154],"content":"Apply the Windows image to a new device as described in <bpt id=\"p1\">[</bpt>Lab 2: Classic-style deployment<ept id=\"p1\">](part-2--classic-style-deployment.md)</ept>, Step 15: Apply Windows images using a script."},{"content":"When audit mode starts, the script should start automatically.","pos":[8159,8221]},{"content":"In File Explorer, check to see if the file: <bpt id=\"p1\">**</bpt>C:<ph id=\"ph1\">\\\\</ph>Fabrikam<ph id=\"ph2\">\\\\</ph>DxDiag-TestLogFiles.txt<ept id=\"p1\">**</ept> exists.","pos":[8226,8319]},{"content":"If so, your sample script ran correctly.","pos":[8320,8360]},{"pos":[8362,8536],"content":"While in Audit mode, you can start <bpt id=\"p1\">[</bpt>Lab 2b: Windows desktop apps and data: capturing changes<ept id=\"p1\">](prepare-a-snapshot-of-the-pc-generalize-and-capture-windows-images-blue-sxs.md)</ept>."}],"content":"---\nauthor: Justinha\nDescription: 'Lab 2a: Answer files: Update settings and run scripts'\nms.assetid: a29101dc-4922-44ee-a758-d555e6cf39fa\nMSHAttr: 'PreferredLib:/library/windows/hardware'\ntitle: 'Lab 2a: Answer files: Update settings and run scripts'\n---\n\n# Lab 2a: Answer files: Update settings and run scripts\n\n\nAnswer files (or Unattend files) can be used to modify Windows settings in your images during Setup. You can also create scripts that you can inject into your offline images, so that you can efficiently make changes to multiple images without ever booting them.\n\n![diagram of creating a new answer file](images/dep-win8-sxs-createanswerfile.jpg)\n\n## <span id=\"overview\"></span><span id=\"OVERVIEW\"></span>Windows settings overview\n\n\nWhile you can set many Windows settings in audit mode, some settings can only be set by using an answer file or Windows Imaging and Configuration Designer (ICD), such as adding manufacturer’s support information. A full list of answer file settings (also known as Unattend settings) is in the [Unattended Windows Setup Reference](https://msdn.microsoft.com/library/windows/hardware/dn923277).\n\nEnterprises can control other settings by using Group Policy. For more info, see [Group Policy](http://go.microsoft.com/fwlink/p/?linkid=268543).\n\nYou canspecify which configuration pass to add new settings:\n\n-   **1 windowsPE**: These settings are used by the Windows Setup installation program. If you’re modifying existing images, you can usually ignore these settings.\n-   **4 specialize**: Most settings should be added here. These settings are triggered both at the beginning of audit mode and at the beginning of OOBE. If you need to make multiple updates or test settings, generalize the device again and add another batch of settings in the Specialize Configuration pass.\n-   **6 auditUser**: Runs as soon as you start audit mode.\n\n    This is a great time to run a system test script - we'll add [Microsoft-Windows-Deployment\\\\RunAsynchronousCommand](https://msdn.microsoft.com/library/windows/hardware/dn915797) as our example. To learn more, see [Add a Custom Script to Windows Setup](add-a-custom-script-to-windows-setup.md).\n\n-   **7 oobeSystem**: Use sparingly. Most of these settings run after the user completes OOBE. The exception is the Microsoft-Windows-Deployment\\\\Reseal\\\\[Mode](https://msdn.microsoft.com/library/windows/hardware/dn923110) = Audit setting, which we’ll use to bypass OOBE and boot the PC into audit mode.\n\n    If your script relies on knowing which language the user selects during OOBE, you’d add it to the oobeSystem pass.\n\n-   For info on the other configuration passes, see [Windows Setup Configuration Passes](windows-setup-configuration-passes.md).\n\n**Note**  These settings could be lost if the user resets their PC with the built-in recovery tools. To see how to make sure these settings stay on the device during a reset, see [Sample scripts](windows-deployment-sample-scripts-sxs.md): Keeping Windows settings through a recovery.\n\n \n\n## <span id=\"createanswer\"></span><span id=\"CREATEANSWER\"></span>Create and modify an answer file\n\n\n**Create a catalog file**\n\n1.  Start **Windows System Image Manager**.\n\n2.  On the **File** menu, click **Select Windows Image**.\n\n3.  In the **Select a Windows Image** dialog, browse to and select the base-image file. Next, select an edition of Windows, for example, Windows 10 Pro, and click **OK**. Click **Yes** to create the catalog file. Windows SIM creates the file based on the base-image file, and saves it to the Windows desktop. This process can take several minutes.\n\n    The catalog file appears in the **Windows Image** pane. Windows SIM also lists the configurable components and packages in that image.\n\n    **Troubleshooting:** If Windows SIM does not create the catalog file, try the following steps:\n\n    -   Make sure you are using a Windows 10 for desktop editions (Home, Pro, Enterprise, and Education) version of the Windows Assessment and Deployment Kit (Windows ADK) tools.\n\n    -   To create a catalog file for either 32-bit or ARM-based devices, use a 32-bit device.\n\n    -   Make sure the Windows base-image file **(\\\\Sources\\\\Install.wim**) is in a folder that has read-write privileges, such as a USB flash drive or on your hard drive.\n\n**Create an answer file**\n\n-   On the **File** menu, click **New Answer File**.\n\n    The new answer file appears in the **Answer File** pane.\n\n    **Note**   If you open an existing answer file, you might be prompted to associate the answer file with the image. Click **Yes**.\n\n     \n\n**Add new answer file settings**\n\n1.  Set the device to automatically boot to audit mode:\n\n    In the **Windows Image** pane, expand **Components**, right-click **amd64\\_Microsoft-Windows-Deployment\\_(version)**, and then select **Add Setting to Pass 7 oobeSystem**.\n\n    In the **Answer File** pane, select **Components\\\\7 oobeSystem\\\\amd64\\_Microsoft-Windows-Deployment\\_neutral\\\\Reseal**.\n\n    In the **Reseal Properties** pane, in the **Settings** section, select Mode=`Audit`.\n\n2.  Prepare a script to run after Audit mode begins.\n\n    In the **Windows Image** pane, right-click **amd64\\_ Microsoft-Windows-Deployment\\_(version)** and then click **Add Setting to Pass 6 auditUser**.\n\n    In the **Answer File** pane, expand **Components\\\\6 auditUser\\\\amd64\\_Microsoft-Windows-Deployment\\_neutral\\\\RunAsynchronous**. Right-click **RunAsynchronousCommand Properties** and click **Insert New AsynchronousCommand**.\n\n    In the **AsynchronousCommand Properties** pane, in the **Settings** section, add the following values:\n\n    `Path = C:\\Fabrikam\\SampleCommand.cmd`\n\n    `Description = Sample command to run a system diagnostic check.`\n\n    `Order = 1`\n\n**Save the answer file**\n\n-   Save the answer file, for example: **C:\\\\AnswerFiles\\\\BootToAudit-x64.xml**.\n\n    **Note**   Windows SIM will not allow you to save the answer file into the mounted image folders.\n\n     \n\n**Create a script**\n\n-   Copy the following sample script into Notepad, and save it as **C:\\\\AnswerFiles\\\\SampleCommand.cmd**.\n\n    ``` syntax\n    @rem Scan the integrity of system files \n    @rem (Required after removing the base English language from an image)\n    sfc.exe /scannow\n\n    @rem Check to see if your drivers are digitally signed, and send output to a log file.\n    md C:\\Fabrikam\n    C:\\Windows\\System32\\dxdiag /t C:\\Fabrikam\\DxDiag-TestLogFiles.txt\n    ```\n\n## <span id=\"Add_the_answer_file_and_script_to_the_image\"></span><span id=\"add_the_answer_file_and_script_to_the_image\"></span><span id=\"ADD_THE_ANSWER_FILE_AND_SCRIPT_TO_THE_IMAGE\"></span>Add the answer file and script to the image\n\n\n1.  Mount the Windows image. The mounting process maps the contents of an image file to a location where you can view and modify the mounted image.\n\n    ``` syntax\n    md C:\\mount\\windows\n    Dism /Mount-Image /ImageFile:\"C:\\Images\\WindowsWithOffice.wim\" /Index:1 /MountDir:\"C:\\mount\\windows\" /Optimize\n    ```\n\n    Where *C* is the drive letter of the drive that contains the image and *1* is the index of the image that you want to use.\n\n    This step can take several minutes.\n\n2.  Copy the answer file into the image into the \\\\Windows\\\\Panther folder, and name it unattend.xml. Create the folder if it doesn’t exist. If there’s an existing answer file, replace it or use Windows System Image Manager to edit/combine settings if necessary.\n\n    ``` syntax\n    MkDir c:\\mount\\windows\\Windows\\Panther\n    Copy C:\\AnswerFiles\\BootToAudit-x64.xml  C:\\mount\\windows\\Windows\\Panther\\unattend.xml\n    MkDir c:\\mount\\windows\\Fabrikam\n    Copy C:\\AnswerFiles\\SampleCommand.cmd    C:\\mount\\windows\\Fabrikam\\SampleCommand.cmd\n    ```\n\n3.  Commit the changes and unmount the Windows image:\n\n    ``` syntax\n    Dism /Unmount-Image /MountDir:\"C:\\mount\\windows\" /Commit\n    ```\n\n    where *C* is the drive letter of the drive that contains the image.\n\n    This process may take several minutes.\n\n**Verify your customizations**\n\n1.  Apply the Windows image to a new device as described in [Lab 2: Classic-style deployment](part-2--classic-style-deployment.md), Step 15: Apply Windows images using a script.\n2.  When audit mode starts, the script should start automatically.\n3.  In File Explorer, check to see if the file: **C:\\\\Fabrikam\\\\DxDiag-TestLogFiles.txt** exists. If so, your sample script ran correctly.\n\nWhile in Audit mode, you can start [Lab 2b: Windows desktop apps and data: capturing changes](prepare-a-snapshot-of-the-pc-generalize-and-capture-windows-images-blue-sxs.md).\n\n \n\n \n\n\n\n\n\n"}