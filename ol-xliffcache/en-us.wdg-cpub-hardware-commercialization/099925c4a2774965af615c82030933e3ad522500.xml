{"nodes":[{"content":"Add Device Drivers to Windows During Windows Setup","pos":[34,84]},{"content":"Add Device Drivers to Windows During Windows Setup","pos":[191,241]},{"content":"Add Device Drivers to Windows During Windows Setup","pos":[249,299]},{"content":"To install Windows® on some hardware designs, you may need to add device drivers to Windows Setup.","pos":[302,400]},{"content":"You can add drivers to Windows Setup by using an answer file that specifies the path to the driver files.","pos":[401,506]},{"content":"To do this in new installations, you add the Microsoft-Windows-PnpCustomizationWinPE component during the <bpt id=\"p1\">[</bpt>windowsPE<ept id=\"p1\">](windowspe.md)</ept> configuration pass, add the driver paths, and then specify the answer file.","pos":[507,714]},{"content":"You can also modify existing images and add and remove drivers.","pos":[716,779]},{"content":"You can service offline images in several ways.","pos":[780,827]},{"content":"For example, you can add the Microsoft-Windows-PnpCustomizationsNonWinPE component during the <bpt id=\"p1\">[</bpt>offlineServicing<ept id=\"p1\">](offlineservicing.md)</ept> configuration pass, add or remove the driver paths, and then specify the name of the answer file.","pos":[828,1059]},{"content":"For more information about how to modify drivers on an offline Windows image by using an answer file, and also other methods of adding drivers to and removing drivers from an existing image, see <bpt id=\"p1\">[</bpt>Add and Remove Drivers to an Offline Windows Image<ept id=\"p1\">](add-and-remove-drivers-to-an-offline-windows-image.md)</ept>.","pos":[1060,1363]},{"pos":[1419,1463],"content":"Add Drivers to New Installations (windowsPE)"},{"pos":[1466,1561],"content":"For new installations, you add drivers during the <bpt id=\"p1\">[</bpt>windowsPE<ept id=\"p1\">](windowspe.md)</ept> configuration pass."},{"content":"This method initializes Windows Preinstallation Environment (Windows PE) and processes Windows PE settings from the answer file, as follows:","pos":[1563,1703]},{"content":"Windows stages the Windows PE drivers in the RAM driver store..","pos":[1709,1772]},{"content":"Windows loads boot-critical drivers that Windows PE requires to access the local disk and network.","pos":[1773,1871]},{"content":"When you right-click <bpt id=\"p1\">**</bpt>DevicePaths<ept id=\"p1\">**</ept> and select <bpt id=\"p2\">**</bpt>Insert New PathAndCredentials into Windows PE<ept id=\"p2\">**</ept>, Windows PE processes other Windows PE customizations that the answer file specifies.","pos":[1872,2055]},{"content":"The Windows Setup process applies the Windows image.","pos":[2061,2113]},{"content":"Boot-critical drivers appear on the Windows image before Setup installs that image.","pos":[2114,2197]},{"content":"Other drivers that you added to the Windows PE driver store appear in the Windows image driver store.","pos":[2198,2299]},{"content":"When Windows Setup processes the <bpt id=\"p1\">[</bpt>offlineServicing<ept id=\"p1\">](offlineservicing.md)</ept> pass, Windows Setup also adds any drivers that the driver path specifies to the Windows image driver store.","pos":[2300,2480]},{"content":"To add a device driver during the windowsPE pass","pos":[2484,2532]},{"content":"Use Windows System Image Manager (Windows SIM) to create an answer file that contains the paths to the device drivers that you intend to install.","pos":[2540,2685]},{"pos":[2691,2826],"content":"Add the <bpt id=\"p1\">**</bpt>Microsoft-Windows-PnpCustomizationsWinPE<ept id=\"p1\">**</ept> component to your answer file in the <bpt id=\"p2\">[</bpt>windowsPE<ept id=\"p2\">](windowspe.md)</ept> configuration pass."},{"content":"Expand the <bpt id=\"p1\">**</bpt>Microsoft-Windows-PnpCustomizationsWinPE<ept id=\"p1\">**</ept> node in the answer file.","pos":[2832,2912]},{"content":"Right-click <bpt id=\"p1\">**</bpt>DevicePaths<ept id=\"p1\">**</ept>, and then select <bpt id=\"p2\">**</bpt>Insert New PathAndCredentials<ept id=\"p2\">**</ept>.","pos":[2913,2992]},{"pos":[2998,3045],"content":"A new <bpt id=\"p1\">**</bpt>PathAndCredentials<ept id=\"p1\">**</ept> list item appears."},{"pos":[3051,3134],"content":"For each location that you access, add a separate <bpt id=\"p1\">**</bpt>PathAndCredentials<ept id=\"p1\">**</ept> list item."},{"content":"You can include multiple device driver paths by adding multiple <bpt id=\"p1\">**</bpt>PathAndCredentials<ept id=\"p1\">**</ept> list items.","pos":[3140,3238]},{"content":"If you add multiple list items, you must increment the <ph id=\"ph1\">`Key`</ph> value for each path.","pos":[3239,3320]},{"content":"For example, if you add two separate driver paths, the first path uses the <ph id=\"ph1\">`Key`</ph> value of <ph id=\"ph2\">`1`</ph>, and the second path uses the <ph id=\"ph3\">`Key`</ph> value of <ph id=\"ph4\">`2`</ph>.","pos":[3321,3464]},{"content":"Save the answer file, and then close Windows SIM.","pos":[3470,3519]},{"content":"The answer file must resemble the following example:","pos":[3520,3572]},{"content":"Boot to Windows PE.","pos":[4533,4552]},{"content":"At a command prompt, run Windows Setup.","pos":[4558,4597]},{"content":"Specify the name of the answer file.","pos":[4598,4634]},{"content":"For example:","pos":[4635,4647]},{"content":"Windows Setup adds the device drivers in the <ph id=\"ph1\">\\\\\\\\</ph>server<ph id=\"ph2\">\\\\</ph>share<ph id=\"ph3\">\\\\</ph>drivers path to the system during the setup process.","pos":[4713,4829]},{"content":"For more information about drivers, see <bpt id=\"p1\">[</bpt>Device Drivers and Deployment Overview<ept id=\"p1\">](device-drivers-and-deployment-overview.md)</ept> and <bpt id=\"p2\">[</bpt>Add a Driver Online in Audit Mode<ept id=\"p2\">](add-a-driver-online-in-audit-mode.md)</ept>.","pos":[4831,5033]},{"content":"For more information about Windows components, see <bpt id=\"p1\">[</bpt>Unattended Windows Setup Reference<ept id=\"p1\">](http://go.microsoft.com/fwlink/?LinkId=206281)</ept>.","pos":[5034,5169]},{"pos":[5207,5221],"content":"Related topics"},{"content":"Windows Setup Technical Reference","pos":[5225,5258]},{"content":"Boot from a DVD","pos":[5300,5315]},{"content":"Deploy a Custom Image","pos":[5339,5360]},{"content":"Boot Windows to Audit Mode or OOBE","pos":[5390,5424]},{"content":"Use a Configuration Set with Windows Setup","pos":[5467,5509]},{"content":"Add a Custom Script to Windows Setup","pos":[5560,5596]}],"content":"---\nauthor: Justinha\nDescription: Add Device Drivers to Windows During Windows Setup\nms.assetid: adb22778-06a2-493a-81de-3a1306a0b208\nMSHAttr: 'PreferredLib:/library/windows/hardware'\ntitle: Add Device Drivers to Windows During Windows Setup\n---\n\n# Add Device Drivers to Windows During Windows Setup\n\n\nTo install Windows® on some hardware designs, you may need to add device drivers to Windows Setup. You can add drivers to Windows Setup by using an answer file that specifies the path to the driver files. To do this in new installations, you add the Microsoft-Windows-PnpCustomizationWinPE component during the [windowsPE](windowspe.md) configuration pass, add the driver paths, and then specify the answer file.\n\nYou can also modify existing images and add and remove drivers. You can service offline images in several ways. For example, you can add the Microsoft-Windows-PnpCustomizationsNonWinPE component during the [offlineServicing](offlineservicing.md) configuration pass, add or remove the driver paths, and then specify the name of the answer file. For more information about how to modify drivers on an offline Windows image by using an answer file, and also other methods of adding drivers to and removing drivers from an existing image, see [Add and Remove Drivers to an Offline Windows Image](add-and-remove-drivers-to-an-offline-windows-image.md).\n\n## <span id=\"bkmk_1\"></span><span id=\"BKMK_1\"></span> Add Drivers to New Installations (windowsPE)\n\n\nFor new installations, you add drivers during the [windowsPE](windowspe.md) configuration pass.\n\nThis method initializes Windows Preinstallation Environment (Windows PE) and processes Windows PE settings from the answer file, as follows:\n\n1.  Windows stages the Windows PE drivers in the RAM driver store.. Windows loads boot-critical drivers that Windows PE requires to access the local disk and network. When you right-click **DevicePaths** and select **Insert New PathAndCredentials into Windows PE**, Windows PE processes other Windows PE customizations that the answer file specifies.\n\n2.  The Windows Setup process applies the Windows image. Boot-critical drivers appear on the Windows image before Setup installs that image. Other drivers that you added to the Windows PE driver store appear in the Windows image driver store. When Windows Setup processes the [offlineServicing](offlineservicing.md) pass, Windows Setup also adds any drivers that the driver path specifies to the Windows image driver store.\n\n**To add a device driver during the windowsPE pass**\n\n1.  Use Windows System Image Manager (Windows SIM) to create an answer file that contains the paths to the device drivers that you intend to install.\n\n2.  Add the **Microsoft-Windows-PnpCustomizationsWinPE** component to your answer file in the [windowsPE](windowspe.md) configuration pass.\n\n3.  Expand the **Microsoft-Windows-PnpCustomizationsWinPE** node in the answer file. Right-click **DevicePaths**, and then select **Insert New PathAndCredentials**.\n\n    A new **PathAndCredentials** list item appears.\n\n4.  For each location that you access, add a separate **PathAndCredentials** list item.\n\n    You can include multiple device driver paths by adding multiple **PathAndCredentials** list items. If you add multiple list items, you must increment the `Key` value for each path. For example, if you add two separate driver paths, the first path uses the `Key` value of `1`, and the second path uses the `Key` value of `2`.\n\n5.  Save the answer file, and then close Windows SIM. The answer file must resemble the following example:\n\n    ``` syntax\n    <?xml version=\"1.0\" encoding=\"utf-8\" ?> \n    <unattend xmlns=\"urn:schemas-microsoft-com:unattend\">\n       <settings pass=\"windowsPE\">\n          <component name=\"Microsoft-Windows-PnpCustomizationsWinPE\" processorArchitecture=\"x86\" publicKeyToken=\"31bf3856ad364e35\" language=\"neutral\" versionScope=\"nonSxS\" xmlns:wcm=\"http://schemas.microsoft.com/WMIConfig/2002/State\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\">\n             <DriverPaths>\n                <PathAndCredentials wcm:keyValue=\"1\" wcm:action=\"add\">\n                   <Credentials>\n                      <Domain>Fabrikam</Domain> \n                      <Password>MyPassword</Password> \n                      <Username>MyUserName</Username> \n                   </Credentials>\n                   <Path>\\\\server\\share\\drivers</Path> \n                </PathAndCredentials>\n             </DriverPaths>\n          </component>\n       </settings>\n    </unattend>\n    ```\n\n6.  Boot to Windows PE.\n\n7.  At a command prompt, run Windows Setup. Specify the name of the answer file. For example:\n\n    ``` syntax\n    Setup /unattend:C:\\unattend.xml\n    ```\n\n    Windows Setup adds the device drivers in the \\\\\\\\server\\\\share\\\\drivers path to the system during the setup process.\n\nFor more information about drivers, see [Device Drivers and Deployment Overview](device-drivers-and-deployment-overview.md) and [Add a Driver Online in Audit Mode](add-a-driver-online-in-audit-mode.md). For more information about Windows components, see [Unattended Windows Setup Reference](http://go.microsoft.com/fwlink/?LinkId=206281).\n\n## <span id=\"related_topics\"></span>Related topics\n\n\n[Windows Setup Technical Reference](windows-setup-technical-reference.md)\n\n[Boot from a DVD](boot-from-a-dvd.md)\n\n[Deploy a Custom Image](deploy-a-custom-image.md)\n\n[Boot Windows to Audit Mode or OOBE](boot-windows-to-audit-mode-or-oobe.md)\n\n[Use a Configuration Set with Windows Setup](use-a-configuration-set-with-windows-setup.md)\n\n[Add a Custom Script to Windows Setup](add-a-custom-script-to-windows-setup.md)\n\n \n\n \n\n\n\n\n\n\n"}