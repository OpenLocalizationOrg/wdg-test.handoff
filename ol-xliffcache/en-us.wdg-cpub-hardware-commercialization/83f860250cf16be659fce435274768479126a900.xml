{"nodes":[{"content":"Configure Windows Firewall with Advanced Security by Using an Answer File","pos":[34,107]},{"content":"Configure Windows Firewall with Advanced Security by Using an Answer File","pos":[214,287]},{"content":"Configure Windows Firewall with Advanced Security by Using an Answer File","pos":[295,368]},{"content":"For unattended installations, you can configure Windows® Firewall with Advanced Security settings in an answer file by using the Networking-MPSSVC-Svc component.","pos":[371,532]},{"content":"In addition to the answer file (Unattend.xml) settings for Windows Firewall with Advanced Security, you can create a <bpt id=\"p1\">**</bpt>RunSynchronous<ept id=\"p1\">**</ept> command that runs <bpt id=\"p2\">**</bpt>Netsh advfirewall<ept id=\"p2\">**</ept> commands during the <bpt id=\"p3\">[</bpt>auditUser<ept id=\"p3\">](audituser.md)</ept> or <bpt id=\"p4\">[</bpt>oobeSystem<ept id=\"p4\">](oobesystem.md)</ept> configuration pass.","pos":[533,805]},{"pos":[1107,1187],"content":"Adding, Modifying, or Deleting Rules for Windows Firewall with Advanced Security"},{"content":"Use <bpt id=\"p1\">**</bpt>RunSynchronous<ept id=\"p1\">**</ept> commands only to add, modify, or delete rules for Windows Firewall with Advanced Security.","pos":[1190,1303]},{"content":"To modify rule groups, use the <bpt id=\"p1\">**</bpt>FirewallGroups<ept id=\"p1\">**</ept> setting in the <bpt id=\"p2\">**</bpt>Networking-MPSSVC-Svc<ept id=\"p2\">**</ept> component.","pos":[1304,1405]},{"content":"For more information about Windows components and settings that you can add to an answer file, see the <bpt id=\"p1\">[</bpt>Unattended Windows Setup Reference Guide<ept id=\"p1\">](http://go.microsoft.com/fwlink/?LinkId=206281)</ept>.","pos":[1406,1599]},{"content":"To add a Netsh command to an answer file","pos":[1603,1643]},{"content":"On your technician computer, open Windows System Image Manager (Windows SIM).","pos":[1651,1728]},{"content":"Click <bpt id=\"p1\">**</bpt>Start<ept id=\"p1\">**</ept>, type <bpt id=\"p2\">**</bpt>Windows System Image Manager<ept id=\"p2\">**</ept>, and then select <bpt id=\"p3\">**</bpt>Windows System Image Manager<ept id=\"p3\">**</ept>.","pos":[1729,1834]},{"content":"Create a new answer file, or update an existing answer file.","pos":[1840,1900]},{"content":"For more information, see <bpt id=\"p1\">[</bpt>Create or Open an Answer File<ept id=\"p1\">](https://msdn.microsoft.com/library/windows/hardware/dn915085)</ept> and <bpt id=\"p2\">[</bpt>Best Practices for Authoring Answer Files<ept id=\"p2\">](https://msdn.microsoft.com/library/windows/hardware/dn915073)</ept>.","pos":[1901,2131]},{"pos":[2137,2186],"content":"On the <bpt id=\"p1\">**</bpt>Insert<ept id=\"p1\">**</ept> menu, click <bpt id=\"p2\">**</bpt>RunSynchronous<ept id=\"p2\">**</ept>."},{"content":"Select the configuration pass where you want to install the command.","pos":[2192,2260]},{"content":"This can be the <bpt id=\"p1\">[</bpt>auditUser<ept id=\"p1\">](audituser.md)</ept> or <bpt id=\"p2\">[</bpt>oobeSystem<ept id=\"p2\">](oobesystem.md)</ept> configuration pass.","pos":[2261,2353]},{"pos":[2359,2490],"content":"**Note**  \nDon't use the **RunSynchronousNetsh advfirewall** command during the [specialize](specialize.md) configuration pass.","leadings":["","    "],"nodes":[{"content":"Note","pos":[2,6]},{"content":"Don't use the <bpt id=\"p1\">**</bpt>RunSynchronousNetsh advfirewall<ept id=\"p1\">**</ept> command during the <bpt id=\"p2\">[</bpt>specialize<ept id=\"p2\">](specialize.md)</ept> configuration pass.","pos":[11,127]}]},{"pos":[2503,2557],"content":"The <bpt id=\"p1\">**</bpt>Create Synchronous Command<ept id=\"p1\">**</ept> dialog box appears."},{"content":"In the <bpt id=\"p1\">**</bpt>Enter command line<ept id=\"p1\">**</ept> box, type the command-line syntax, like <bpt id=\"p2\">**</bpt>Netsh advfirewall firewall<ept id=\"p2\">**</ept>.","pos":[2563,2664]},{"content":"For more information, see the <bpt id=\"p1\">[</bpt>Network Shell (Netsh) Technical Reference<ept id=\"p1\">](http://go.microsoft.com/fwlink/?LinkId=234733)</ept>.","pos":[2665,2786]},{"pos":[2792,2884],"content":"In the <bpt id=\"p1\">**</bpt>Order<ept id=\"p1\">**</ept> box, select the order of the commands that will run, and then click <bpt id=\"p2\">**</bpt>OK<ept id=\"p2\">**</ept>."},{"content":"The command is added to the answer file in the selected configuration pass, as follows:","pos":[2890,2977]},{"pos":[2987,3127],"content":"Commands that are added to the <bpt id=\"p1\">**</bpt>6 auditUser passes<ept id=\"p1\">**</ept> configuration pass appear in the setting Microsoft-Windows-Deployment<ph id=\"ph1\">\\\\</ph>RunSynchronous."},{"pos":[3137,3276],"content":"Commands that are added to the <bpt id=\"p1\">**</bpt>7 oobeSystem<ept id=\"p1\">**</ept> configuration pass appear in the setting Microsoft-Windows-Shell-Setup<ph id=\"ph1\">\\\\</ph>FirstLogonCommands."},{"pos":[3282,3436],"content":"In the <bpt id=\"p1\">**</bpt>SynchronousCommand Properties<ept id=\"p1\">**</ept> pane, in the <bpt id=\"p2\">**</bpt>Settings<ept id=\"p2\">**</ept> section next to <bpt id=\"p3\">**</bpt>Description<ept id=\"p3\">**</ept>, enter a description like <bpt id=\"p4\">**</bpt>Enable Windows Messenger<ept id=\"p4\">**</ept>."},{"content":"The command is added to the answer file under the configuration pass that you selected.","pos":[3442,3529]},{"content":"This example illustrates how an incoming rule for Windows Messenger is configured:","pos":[3530,3612]},{"content":"Note","pos":[4128,4132]},{"content":"The <bpt id=\"p1\">**</bpt>Netsh advfirewall<ept id=\"p1\">**</ept> command requires administrator permissions to run.","pos":[4137,4213]},{"content":"If the <bpt id=\"p1\">**</bpt>RunSynchronous<ept id=\"p1\">**</ept> command runs in a configuration pass that runs in user context, that user account must have administrator permissions.","pos":[4214,4358]},{"pos":[4558,4603],"content":"Using the Netsh Advfirewall Command-Line Tool"},{"pos":[4606,4749],"content":"The following example illustrates how to add a new outgoing firewall rule to block a port by using the <bpt id=\"p1\">**</bpt>Netsh advfirewall<ept id=\"p1\">**</ept> command-line tool."},{"content":"To add a new outgoing firewall rule","pos":[4753,4788]},{"content":"At an elevated command prompt, enter syntax that adds a new outgoing firewall rule to block a port.","pos":[4796,4895]},{"content":"For example:","pos":[4896,4908]},{"content":"where the blocked port is TCP port 80.","pos":[5044,5082]},{"content":"You can convert <bpt id=\"p1\">**</bpt>Netsh<ept id=\"p1\">**</ept> commands to Windows PowerShell commands.","pos":[5084,5150]},{"content":"For more information, see the <bpt id=\"p1\">[</bpt>Netshell to Powershell Conversion Guide<ept id=\"p1\">](http://go.microsoft.com/fwlink/?LinkId=234734)</ept>.","pos":[5151,5270]},{"pos":[5308,5322],"content":"Related topics"},{"content":"Windows Deployment Options","pos":[5326,5352]}],"content":"---\nauthor: Justinha\nDescription: Configure Windows Firewall with Advanced Security by Using an Answer File\nms.assetid: 6243caf7-3b74-431e-b6f9-76b98106bf42\nMSHAttr: 'PreferredLib:/library/windows/hardware'\ntitle: Configure Windows Firewall with Advanced Security by Using an Answer File\n---\n\n# Configure Windows Firewall with Advanced Security by Using an Answer File\n\n\nFor unattended installations, you can configure Windows® Firewall with Advanced Security settings in an answer file by using the Networking-MPSSVC-Svc component. In addition to the answer file (Unattend.xml) settings for Windows Firewall with Advanced Security, you can create a **RunSynchronous** command that runs **Netsh advfirewall** commands during the [auditUser](audituser.md) or [oobeSystem](oobesystem.md) configuration pass.\n\n## <span id=\"Adding__Modifying__or_Deleting_Rules_for_Windows_Firewall_with_Advanced_Security\"></span><span id=\"adding__modifying__or_deleting_rules_for_windows_firewall_with_advanced_security\"></span><span id=\"ADDING__MODIFYING__OR_DELETING_RULES_FOR_WINDOWS_FIREWALL_WITH_ADVANCED_SECURITY\"></span>Adding, Modifying, or Deleting Rules for Windows Firewall with Advanced Security\n\n\nUse **RunSynchronous** commands only to add, modify, or delete rules for Windows Firewall with Advanced Security. To modify rule groups, use the **FirewallGroups** setting in the **Networking-MPSSVC-Svc** component. For more information about Windows components and settings that you can add to an answer file, see the [Unattended Windows Setup Reference Guide](http://go.microsoft.com/fwlink/?LinkId=206281).\n\n**To add a Netsh command to an answer file**\n\n1.  On your technician computer, open Windows System Image Manager (Windows SIM). Click **Start**, type **Windows System Image Manager**, and then select **Windows System Image Manager**.\n\n2.  Create a new answer file, or update an existing answer file. For more information, see [Create or Open an Answer File](https://msdn.microsoft.com/library/windows/hardware/dn915085) and [Best Practices for Authoring Answer Files](https://msdn.microsoft.com/library/windows/hardware/dn915073).\n\n3.  On the **Insert** menu, click **RunSynchronous**.\n\n4.  Select the configuration pass where you want to install the command. This can be the [auditUser](audituser.md) or [oobeSystem](oobesystem.md) configuration pass.\n\n    **Note**  \n    Don't use the **RunSynchronousNetsh advfirewall** command during the [specialize](specialize.md) configuration pass.\n\n     \n\n5.  The **Create Synchronous Command** dialog box appears.\n\n6.  In the **Enter command line** box, type the command-line syntax, like **Netsh advfirewall firewall**. For more information, see the [Network Shell (Netsh) Technical Reference](http://go.microsoft.com/fwlink/?LinkId=234733).\n\n7.  In the **Order** box, select the order of the commands that will run, and then click **OK**.\n\n    The command is added to the answer file in the selected configuration pass, as follows:\n\n    1.  Commands that are added to the **6 auditUser passes** configuration pass appear in the setting Microsoft-Windows-Deployment\\\\RunSynchronous.\n\n    2.  Commands that are added to the **7 oobeSystem** configuration pass appear in the setting Microsoft-Windows-Shell-Setup\\\\FirstLogonCommands.\n\n8.  In the **SynchronousCommand Properties** pane, in the **Settings** section next to **Description**, enter a description like **Enable Windows Messenger**.\n\n9.  The command is added to the answer file under the configuration pass that you selected. This example illustrates how an incoming rule for Windows Messenger is configured:\n\n    ``` syntax\n          <RunSynchronous>\n             <RunSynchronousCommand wcm:action=\"add\">\n                <Path>Netsh advfirewall firewall \n                      add rule name=\"allow messenger\" dir=in \n                      program=\"c:\\programfiles\\messenger\\msmsgs.exe\"\n                      action=allow\n                </Path>\n                <Description>Enable Windows Messenger</Description>\n                <Order>1</Order>\n             </RunSynchronousCommand>\n          </RunSynchronous>\n    ```\n\n**Note**  \nThe **Netsh advfirewall** command requires administrator permissions to run. If the **RunSynchronous** command runs in a configuration pass that runs in user context, that user account must have administrator permissions.\n\n \n\n## <span id=\"Using_the_Netsh_Advfirewall_Command-Line_Tool\"></span><span id=\"using_the_netsh_advfirewall_command-line_tool\"></span><span id=\"USING_THE_NETSH_ADVFIREWALL_COMMAND-LINE_TOOL\"></span>Using the Netsh Advfirewall Command-Line Tool\n\n\nThe following example illustrates how to add a new outgoing firewall rule to block a port by using the **Netsh advfirewall** command-line tool.\n\n**To add a new outgoing firewall rule**\n\n-   At an elevated command prompt, enter syntax that adds a new outgoing firewall rule to block a port. For example:\n\n    ``` syntax\n    Netsh advfirewall firewall add rule name=\"allow80\" protocol=TCP\n    dir=out localport=80 action=block\n    ```\n\n    where the blocked port is TCP port 80.\n\nYou can convert **Netsh** commands to Windows PowerShell commands. For more information, see the [Netshell to Powershell Conversion Guide](http://go.microsoft.com/fwlink/?LinkId=234734).\n\n## <span id=\"related_topics\"></span>Related topics\n\n\n[Windows Deployment Options](windows-deployment-options.md)\n\n \n\n \n\n\n\n\n\n\n"}