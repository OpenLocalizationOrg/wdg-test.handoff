{"nodes":[{"content":"Using a host PC to reboot a device to flashing mode and get version information","pos":[34,113]},{"content":"Using a host PC to reboot a device to flashing mode and get version information","pos":[220,299]},{"content":"Using a host PC to reboot a device to flashing mode and get version information","pos":[307,386]},{"content":"When a Windows 10 Mobile device is connected to a host PC via a USB cable, you can perform the following tasks in an application that is running on the host PC.","pos":[389,549]},{"content":"These tasks are useful in certain manufacturing or customer care scenarios.","pos":[550,625]},{"content":"Reboot the device into flashing mode.","pos":[631,668]},{"content":"Retrieve version information from the device.","pos":[674,719]},{"content":"The host app uses the Windows Portable Devices API to accomplish these tasks.","pos":[721,798]},{"pos":[998,1044],"content":"Understanding the Windows Portable Devices API"},{"content":"The Windows Portable Devices (WPD) API is a COM-based API that enables computers to communicate with attached devices.","pos":[1047,1165]},{"content":"To learn more about this API, refer to the following resources:","pos":[1166,1229]},{"pos":[1235,1457],"content":"<bpt id=\"p1\">[</bpt>Windows Portable Devices<ept id=\"p1\">](http://msdn.microsoft.com/library/windows/desktop/dd388998.aspx)</ept>: This section of the MSDN library provides architecture guidance and reference documentation for the Windows Portable Devices API."},{"pos":[1463,1810],"content":"<bpt id=\"p1\">[</bpt>Portable Devices COM API Sample<ept id=\"p1\">](http://code.msdn.microsoft.com/windowsdesktop/Portable-Devices-COM-API-fd4a5f7d)</ept>: This sample demonstrates how to use the Windows Portable Devices API to perform a variety of tasks, including enumerating connected devices, reading properties of content on a connected device, and sending MTP commands to a device."},{"pos":[1816,2116],"content":"<bpt id=\"p1\">[</bpt>Portable Devices Services COM API Sample<ept id=\"p1\">](http://code.msdn.microsoft.com/windowsdesktop/Portable-Devices-COM-API-b1e2db21)</ept>: This sample demonstrates how to use the Windows Portable Devices API to perform a variety of operations on device services, including enumerating services and service content."},{"pos":[2409,2486],"content":"Discovering Windows 10 Mobile devices that are connected to the host computer"},{"content":"Before the host app can reboot a device to flashing mode or retrieve version information from the device, the host apps must discover all devices that are connected to the computer.","pos":[2489,2670]},{"pos":[2676,2968],"content":"Create an <bpt id=\"p1\">[</bpt>IPortableDeviceManager<ept id=\"p1\">](http://msdn.microsoft.com/library/windows/desktop/dd388688.aspx)</ept> object and use the <bpt id=\"p2\">[</bpt>IPortableDeviceManager::GetDevices<ept id=\"p2\">](http://msdn.microsoft.com/library/windows/desktop/dd388693.aspx)</ept> function to get the collection of device IDs for all connected devices."},{"content":"Enumerate through the collection of device IDs to determine which connected device is a Windows 10 Mobile For each device ID, create an <bpt id=\"p1\">[</bpt>IPortableDevice<ept id=\"p1\">](http://msdn.microsoft.com/library/windows/desktop/dd319361.aspx)</ept> object and then use the <bpt id=\"p2\">[</bpt>IPortableDevice::Content<ept id=\"p2\">](http://msdn.microsoft.com/library/windows/desktop/dd375688.aspx)</ept> and <bpt id=\"p3\">[</bpt>IPortableDeviceContent::Properties<ept id=\"p3\">](http://msdn.microsoft.com/library/windows/desktop/dd388540.aspx)</ept> functions to retrieve the value of the WPD<ph id=\"ph1\">\\_</ph>DEVICE<ph id=\"ph2\">\\_</ph>MODEL<ph id=\"ph3\">\\_</ph>UNIQUE<ph id=\"ph4\">\\_</ph>ID device property for the device.","pos":[2974,3516]},{"content":"If the device is a Windows 10 Mobile device, the value of the WPD<ph id=\"ph1\">\\_</ph>DEVICE<ph id=\"ph2\">\\_</ph>MODEL<ph id=\"ph3\">\\_</ph>UNIQUE<ph id=\"ph4\">\\_</ph>ID property is a GUID with the following value.","pos":[3517,3654]},{"pos":[3919,3952],"content":"Examples and additional resources"},{"pos":[3954,4144],"content":"The following code examples in the <bpt id=\"p1\">[</bpt>Portable Devices COM API Sample<ept id=\"p1\">](http://code.msdn.microsoft.com/windowsdesktop/Portable-Devices-COM-API-fd4a5f7d)</ept> demonstrate the following related tasks:"},{"pos":[4150,4317],"content":"Creating an <bpt id=\"p1\">[</bpt>IPortableDeviceManager<ept id=\"p1\">](http://msdn.microsoft.com/library/windows/desktop/dd388688.aspx)</ept> object: see the <ph id=\"ph1\">`ChooseDevice`</ph> function in DeviceEnumeration.cpp."},{"pos":[4323,4436],"content":"Getting the device IDs of all connected devices: see the <ph id=\"ph1\">`EnumerateAllDevices`</ph> function in DeviceEnumeration.cpp."},{"pos":[4442,4538],"content":"Retrieving device properties: see the <ph id=\"ph1\">`ReadContentProperties`</ph> function in ContentProperties.cpp."},{"content":"For more info about enumerating devices and retrieving device properties, see the following articles:","pos":[4540,4641]},{"content":"Enumerating Devices","pos":[4648,4667]},{"content":"Device Properties","pos":[4740,4757]},{"content":"Retrieving Properties for a Single Object","pos":[4830,4871]},{"pos":[5164,5219],"content":"Rebooting a Windows 10 Mobile device into flashing mode"},{"pos":[5222,5441],"content":"After you have an <bpt id=\"p1\">[</bpt>IPortableDevice<ept id=\"p1\">](http://msdn.microsoft.com/library/windows/desktop/dd319361.aspx)</ept> object that represents a Windows 10 Mobile device, you can send an MTP command to reboot the phone into flashing mode."},{"pos":[5447,5607],"content":"Create an <bpt id=\"p1\">[</bpt>IPortableDeviceValues<ept id=\"p1\">](http://msdn.microsoft.com/library/windows/desktop/dd319461.aspx)</ept> object and configure it to set up the MTP command parameters:"},{"content":"Call <bpt id=\"p1\">[</bpt>IPortableDeviceValues::SetGuidValue<ept id=\"p1\">](http://msdn.microsoft.com/library/windows/desktop/dd375671.aspx)</ept>.","pos":[5617,5725]},{"content":"Pass WPD<ph id=\"ph1\">\\_</ph>PROPERTY<ph id=\"ph2\">\\_</ph>COMMON<ph id=\"ph3\">\\_</ph>COMMAND<ph id=\"ph4\">\\_</ph>CATEGORY to the <bpt id=\"p1\">*</bpt>key<ept id=\"p1\">*</ept> parameter and pass WPD<ph id=\"ph5\">\\_</ph>COMMAND<ph id=\"ph6\">\\_</ph>MTP<ph id=\"ph7\">\\_</ph>EXT<ph id=\"ph8\">\\_</ph>EXECUTE<ph id=\"ph9\">\\_</ph>COMMAND<ph id=\"ph10\">\\_</ph>WITHOUT<ph id=\"ph11\">\\_</ph>DATA<ph id=\"ph12\">\\_</ph>PHASE.fmtid to the <bpt id=\"p2\">*</bpt>Value<ept id=\"p2\">*</ept> parameter.","pos":[5726,5898]},{"content":"Call <bpt id=\"p1\">[</bpt>IPortableDeviceValues::SetUnsignedIntegerValue<ept id=\"p1\">](http://msdn.microsoft.com/library/windows/desktop/dd375681.aspx)</ept>.","pos":[5908,6027]},{"content":"Pass WPD<ph id=\"ph1\">\\_</ph>PROPERTY<ph id=\"ph2\">\\_</ph>COMMON<ph id=\"ph3\">\\_</ph>COMMAND<ph id=\"ph4\">\\_</ph>ID to the <bpt id=\"p1\">*</bpt>key<ept id=\"p1\">*</ept> parameter and pass WPD<ph id=\"ph5\">\\_</ph>COMMAND<ph id=\"ph6\">\\_</ph>MTP<ph id=\"ph7\">\\_</ph>EXT<ph id=\"ph8\">\\_</ph>EXECUTE<ph id=\"ph9\">\\_</ph>COMMAND<ph id=\"ph10\">\\_</ph>WITHOUT<ph id=\"ph11\">\\_</ph>DATA<ph id=\"ph12\">\\_</ph>PHASE.pid to the <bpt id=\"p2\">*</bpt>Value<ept id=\"p2\">*</ept> parameter.","pos":[6028,6192]},{"content":"Call <bpt id=\"p1\">[</bpt>IPortableDeviceValues::SetUnsignedIntegerValue<ept id=\"p1\">](http://msdn.microsoft.com/library/windows/desktop/dd375681.aspx)</ept> again.","pos":[6202,6327]},{"content":"Pass WPD<ph id=\"ph1\">\\_</ph>PROPERTY<ph id=\"ph2\">\\_</ph>MTP<ph id=\"ph3\">\\_</ph>EXT<ph id=\"ph4\">\\_</ph>OPERATION<ph id=\"ph5\">\\_</ph>CODE to the <bpt id=\"p1\">*</bpt>key<ept id=\"p1\">*</ept> parameter and pass the value <bpt id=\"p2\">**</bpt>0x9401<ept id=\"p2\">**</ept> to the <bpt id=\"p3\">*</bpt>Value<ept id=\"p3\">*</ept> parameter.","pos":[6328,6452]},{"content":"This value represents the MTP command that reboots the phone into flashing mode.","pos":[6453,6533]},{"pos":[6543,6665],"content":"Create an <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>IPortableDevicePropVariantCollection<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/hardware/ff597589)</ept> object."},{"content":"Call <bpt id=\"p1\">[</bpt><bpt id=\"p2\">**</bpt>IPortableDeviceValues::SetIPortableDevicePropVariantCollectionValue<ept id=\"p2\">**</ept><ept id=\"p1\">](https://msdn.microsoft.com/library/windows/hardware/ff597632)</ept>.","pos":[6675,6816]},{"content":"Pass WPD<ph id=\"ph1\">\\_</ph>PROPERTY<ph id=\"ph2\">\\_</ph>MTP<ph id=\"ph3\">\\_</ph>EXT<ph id=\"ph4\">\\_</ph>OPERATION<ph id=\"ph5\">\\_</ph>PARAMS to the <bpt id=\"p1\">*</bpt>key<ept id=\"p1\">*</ept> parameter and pass the <bpt id=\"p2\">[</bpt><bpt id=\"p3\">**</bpt>IPortableDevicePropVariantCollection<ept id=\"p3\">**</ept><ept id=\"p2\">](https://msdn.microsoft.com/library/windows/hardware/ff597589)</ept> object to the <bpt id=\"p4\">*</bpt>pValue<ept id=\"p4\">*</ept> parameter.","pos":[6817,7039]},{"content":"Call <bpt id=\"p1\">[</bpt>IPortableDevice::SendCommand<ept id=\"p1\">](http://msdn.microsoft.com/library/windows/desktop/dd375691.aspx)</ept> to send the MTP command.","pos":[7045,7170]},{"content":"Pass the initialized <bpt id=\"p1\">[</bpt>IPortableDeviceValues<ept id=\"p1\">](http://msdn.microsoft.com/library/windows/desktop/dd319461.aspx)</ept> object to the <bpt id=\"p2\">*</bpt>pParameters<ept id=\"p2\">*</ept> parameter.","pos":[7171,7319]},{"content":"This operation sends the MTP command to reboot the phone into flashing mode.","pos":[7320,7396]},{"pos":[7558,7591],"content":"Examples and additional resources"},{"content":"The following code examples demonstrate how to set up MTP command parameters and send an MTP command:","pos":[7593,7694]},{"pos":[7700,7897],"content":"<bpt id=\"p1\">[</bpt>Issuing the GetNumObjects Command<ept id=\"p1\">](http://msdn.microsoft.com/library/windows/desktop/ff384842.aspx)</ept>: This topic in the MSDN library demonstrates how to send the standard GetNumObjects MTP command."},{"pos":[7903,8083],"content":"The <ph id=\"ph1\">`SendhintsCommand`</ph> function in ContentEnumeration.cpp in the <bpt id=\"p1\">[</bpt>Portable Devices COM API Sample<ept id=\"p1\">](http://code.msdn.microsoft.com/windowsdesktop/Portable-Devices-COM-API-fd4a5f7d)</ept>."},{"pos":[8085,8270],"content":"For more information about sending MTP commands using the Windows Portable Devices API, see <bpt id=\"p1\">[</bpt>Supporting MTP Extensions<ept id=\"p1\">](http://msdn.microsoft.com/library/windows/desktop/ff384848.aspx)</ept>."},{"pos":[8518,8580],"content":"Retrieving version information from a Windows 10 Mobile device"},{"content":"After you determine the device ID for a Windows 10 Mobile device that is connected to the host computer, you can use a Windows 10 Mobile-specific device service named MtpDuDeviceService to retrieve version information from the device.","pos":[8583,8817]},{"content":"Note","pos":[8821,8825]},{"content":"If the device is protected with a PIN, the MtpDuDeviceService is only available if the PIN has been entered and the device is unlocked.","pos":[8830,8965]},{"pos":[9112,9139],"content":"Open the MtpDuDeviceService"},{"pos":[9141,9321],"content":"First, enumerate through the device services to open an <bpt id=\"p1\">[</bpt>IPortableDeviceService<ept id=\"p1\">](http://msdn.microsoft.com/library/windows/desktop/dd319445.aspx)</ept> object for the MtpDuDeviceService."},{"content":"Get an array of IDs for all device services supported by the device.","pos":[9327,9395]},{"content":"To do this, cast the existing <bpt id=\"p1\">[</bpt>IPortableDeviceManager<ept id=\"p1\">](http://msdn.microsoft.com/library/windows/desktop/dd388688.aspx)</ept> object to an <bpt id=\"p2\">[</bpt>IPortableDeviceServiceManager<ept id=\"p2\">](http://msdn.microsoft.com/library/windows/desktop/dd319402.aspx)</ept> and call the <bpt id=\"p3\">[</bpt>IPortableDeviceServiceManager::GetDeviceServices<ept id=\"p3\">](http://msdn.microsoft.com/library/windows/desktop/dd319408.aspx)</ept> method.","pos":[9396,9762]},{"content":"Pass the device ID for the Windows 10 Mobile device to the <bpt id=\"p1\">*</bpt>pszPnPDeviceID<ept id=\"p1\">*</ept> parameter and the value <bpt id=\"p2\">[</bpt>GUID<ph id=\"ph1\">\\_</ph>DEVINTERFACE<ph id=\"ph2\">\\_</ph>WPD<ph id=\"ph3\">\\_</ph>SERVICE<ept id=\"p2\">](http://msdn.microsoft.com/library/windows/desktop/dd319319.aspx)</ept> to the <bpt id=\"p3\">*</bpt>guidServiceCategory<ept id=\"p3\">*</ept> parameter.","pos":[9763,10002]},{"content":"The array of service IDs is returned in the <bpt id=\"p1\">*</bpt>pServices<ept id=\"p1\">*</ept> parameter.","pos":[10003,10069]},{"content":"Iterate through the array of service IDs, and perform the following tasks for each service ID:","pos":[10075,10169]},{"content":"Create an <bpt id=\"p1\">[</bpt>IPortableDeviceService<ept id=\"p1\">](http://msdn.microsoft.com/library/windows/desktop/dd319445.aspx)</ept> object and call the <bpt id=\"p2\">[</bpt>IPortableDeviceService::Open<ept id=\"p2\">](http://msdn.microsoft.com/library/windows/desktop/dd319453.aspx)</ept> function to open the service.","pos":[10179,10424]},{"content":"Pass the current service ID to the <bpt id=\"p1\">*</bpt>pszPnPServiceID<ept id=\"p1\">*</ept> parameter.","pos":[10425,10488]},{"content":"Get the service object ID by calling the <bpt id=\"p1\">[</bpt>IPortableDeviceService::GetServiceObjectID<ept id=\"p1\">](http://msdn.microsoft.com/library/windows/desktop/dd319449.aspx)</ept> function.","pos":[10498,10658]},{"content":"You need the service object ID to access properties of the service.","pos":[10659,10726]},{"pos":[10736,11121],"content":"Use the <bpt id=\"p1\">[</bpt>IPortableDeviceService::Content<ept id=\"p1\">](http://msdn.microsoft.com/library/windows/desktop/dd319445.aspx)</ept> and <bpt id=\"p2\">[</bpt>IPortableDeviceContent::Properties<ept id=\"p2\">](http://msdn.microsoft.com/library/windows/desktop/dd388540.aspx)</ept> functions to retrieve the collection of properties for the service (an <bpt id=\"p3\">[</bpt>IPortableDeviceProperties<ept id=\"p3\">](http://msdn.microsoft.com/library/windows/desktop/dd388696.aspx)</ept> object)."},{"content":"Create an <bpt id=\"p1\">[</bpt>IPortableDeviceKeyCollection<ept id=\"p1\">](http://msdn.microsoft.com/library/windows/desktop/dd388548.aspx)</ept> object and add the WPD-defined WPD<ph id=\"ph1\">\\_</ph>OBJECT<ph id=\"ph2\">\\_</ph>NAME property key to this collection.","pos":[11131,11318]},{"content":"This property key indicates that you are retrieving the display name for the service.","pos":[11319,11404]},{"content":"Call the <bpt id=\"p1\">[</bpt>IPortableDeviceProperties::GetValues<ept id=\"p1\">](http://msdn.microsoft.com/library/windows/desktop/dd388714.aspx)</ept> function to retrieve an <bpt id=\"p2\">[</bpt>IPortableDeviceValues<ept id=\"p2\">](http://msdn.microsoft.com/library/windows/desktop/dd319461.aspx)</ept> object that contains the property values.","pos":[11414,11681]},{"content":"Pass the service object ID to the <bpt id=\"p1\">*</bpt>pszObjectID<ept id=\"p1\">*</ept> parameter and the initialized <bpt id=\"p2\">[</bpt>IPortableDeviceKeyCollection<ept id=\"p2\">](http://msdn.microsoft.com/library/windows/desktop/dd388548.aspx)</ept> object to the <bpt id=\"p3\">*</bpt>pKeys<ept id=\"p3\">*</ept> parameter.","pos":[11682,11888]},{"pos":[11898,12101],"content":"Call the <bpt id=\"p1\">[</bpt>IPortableDeviceValues::GetStringValue<ept id=\"p1\">](http://msdn.microsoft.com/library/windows/desktop/dd375661.aspx)</ept> function, and pass the WPD-defined WPD<ph id=\"ph1\">\\_</ph>OBJECT<ph id=\"ph2\">\\_</ph>NAME property key to the <bpt id=\"p2\">*</bpt>key<ept id=\"p2\">*</ept> parameter."},{"content":"If the <bpt id=\"p1\">[</bpt>IPortableDeviceValues::GetStringValue<ept id=\"p1\">](http://msdn.microsoft.com/library/windows/desktop/dd375661.aspx)</ept> function returns the string <bpt id=\"p2\">**</bpt>MtpDuDeviceService<ept id=\"p2\">**</ept>, you have found the service object you need to retrieve version information from the phone.","pos":[12111,12365]},{"content":"Exit the loop and proceed to the next section.","pos":[12366,12412]},{"pos":[12422,12777],"content":"If the name of the service is not <bpt id=\"p1\">**</bpt>MtpDuDeviceService<ept id=\"p1\">**</ept>, call the <bpt id=\"p2\">[</bpt>IPortableDeviceService::Close<ept id=\"p2\">](http://msdn.microsoft.com/library/windows/desktop/dd319441.aspx)</ept> function, iterate to the next service ID returned by <bpt id=\"p3\">[</bpt>IPortableDeviceServiceManager::GetDeviceServices<ept id=\"p3\">](http://msdn.microsoft.com/library/windows/desktop/dd319408.aspx)</ept>, and return to step 2."},{"pos":[12972,13016],"content":"Retrieve version information from the device"},{"pos":[13018,13239],"content":"After you have opened an <bpt id=\"p1\">[</bpt>IPortableDeviceService<ept id=\"p1\">](http://msdn.microsoft.com/library/windows/desktop/dd319445.aspx)</ept> object for the MtpDuDeviceService, you can use this object to retrieve version information from the device"},{"pos":[13245,13630],"content":"Use the <bpt id=\"p1\">[</bpt>IPortableDeviceService::Content<ept id=\"p1\">](http://msdn.microsoft.com/library/windows/desktop/dd319445.aspx)</ept> and <bpt id=\"p2\">[</bpt>IPortableDeviceContent::Properties<ept id=\"p2\">](http://msdn.microsoft.com/library/windows/desktop/dd388540.aspx)</ept> functions to retrieve the collection of properties for the service (an <bpt id=\"p3\">[</bpt>IPortableDeviceProperties<ept id=\"p3\">](http://msdn.microsoft.com/library/windows/desktop/dd388696.aspx)</ept> object)."},{"content":"Create an <bpt id=\"p1\">[</bpt>IPortableDeviceKeyCollection<ept id=\"p1\">](http://msdn.microsoft.com/library/windows/desktop/dd388548.aspx)</ept> object and add a <bpt id=\"p2\">[</bpt>PROPERTYKEY<ept id=\"p2\">](http://msdn.microsoft.com/library/windows/desktop/bb773381.aspx)</ept> value to this collection that specifies the version data you want to retrieve from the device.","pos":[13636,13932]},{"content":"The <bpt id=\"p1\">[</bpt>PROPERTYKEY<ept id=\"p1\">](http://msdn.microsoft.com/library/windows/desktop/bb773381.aspx)</ept> value must have the following structure:","pos":[13933,14056]},{"pos":[14066,14119],"content":"The <bpt id=\"p1\">*</bpt>fmtid<ept id=\"p1\">*</ept> field must have the following GUID value:"},{"pos":[14250,14318],"content":"The <bpt id=\"p1\">*</bpt>pid<ept id=\"p1\">*</ept> field must have one of the values shown in the table below"},{"pos":[14324,16139],"content":"<table>\n<colgroup>\n<col width=\"50%\" />\n<col width=\"50%\" />\n</colgroup>\n<thead>\n<tr class=\"header\">\n<th align=\"left\">Device data to retrieve</th>\n<th align=\"left\">pid value</th>\n</tr>\n</thead>\n<tbody>\n<tr class=\"odd\">\n<td align=\"left\"><p>The build string for the image on the device</p></td>\n<td align=\"left\"><p>Use the data returned by the following pid values to construct the build string:</p>\n<ul>\n<li><p>4 (the name of the internal Microsoft branch the OS was built from)</p></li>\n<li><p>6 (the Windows build number)</p></li>\n<li><p>7 (the Windows 10 Mobile build number)</p></li>\n<li><p>8 (the time stamp for the build)</p></li>\n</ul>\n<p>An example build string is WPMAIN.9600.12186.20130906-1624.</p></td>\n</tr>\n<tr class=\"even\">\n<td align=\"left\"><p>The OS version</p></td>\n<td align=\"left\"><p>12</p></td>\n</tr>\n<tr class=\"odd\">\n<td align=\"left\"><p>The OEM device name</p></td>\n<td align=\"left\"><p>15</p></td>\n</tr>\n<tr class=\"even\">\n<td align=\"left\"><p>The firmware version</p></td>\n<td align=\"left\"><p>16</p></td>\n</tr>\n<tr class=\"odd\">\n<td align=\"left\"><p>The SoC version</p></td>\n<td align=\"left\"><p>17</p></td>\n</tr>\n<tr class=\"even\">\n<td align=\"left\"><p>The radio software version</p></td>\n<td align=\"left\"><p>18</p></td>\n</tr>\n<tr class=\"odd\">\n<td align=\"left\"><p>The radio hardware version</p></td>\n<td align=\"left\"><p>19</p></td>\n</tr>\n<tr class=\"even\">\n<td align=\"left\"><p>The bootloader version</p></td>\n<td align=\"left\"><p>20</p></td>\n</tr>\n<tr class=\"odd\">\n<td align=\"left\"><p>The platform ID (from SMBIOS).</p></td>\n<td align=\"left\"><p>29</p></td>\n</tr>\n</tbody>\n</table>","leadings":["","    ","    ","    ","    ","    ","    ","    ","    ","    ","    ","    ","    ","    ","    ","    ","    ","    ","    ","    ","    ","    ","    ","    ","    ","    ","    ","    ","    ","    ","    ","    ","    ","    ","    ","    ","    ","    ","    ","    ","    ","    ","    ","    ","    ","    ","    ","    ","    ","    ","    ","    ","    ","    ","    ","    ","    "],"nodes":[{"content":"Device data to retrieve","pos":[116,139]},{"content":"pid value","pos":[162,171]},{"content":"The build string for the image on the device","pos":[237,281]},{"content":"Use the data returned by the following pid values to construct the build string:","pos":[311,391]},{"content":"4 (the name of the internal Microsoft branch the OS was built from)","pos":[408,475]},{"content":"6 (the Windows build number)","pos":[492,520]},{"content":"7 (the Windows 10 Mobile build number)","pos":[537,575]},{"content":"8 (the time stamp for the build)","pos":[592,624]},{"content":"An example build string is WPMAIN.9600.12186.20130906-1624.","pos":[643,702]},{"content":"The OS version","pos":[756,770]},{"content":"12","pos":[800,802]},{"content":"The OEM device name","pos":[855,874]},{"content":"15","pos":[904,906]},{"content":"The firmware version","pos":[960,980]},{"content":"16","pos":[1010,1012]},{"content":"The SoC version","pos":[1065,1080]},{"content":"17","pos":[1110,1112]},{"content":"The radio software version","pos":[1166,1192]},{"content":"18","pos":[1222,1224]},{"content":"The radio hardware version","pos":[1277,1303]},{"content":"19","pos":[1333,1335]},{"content":"The bootloader version","pos":[1389,1411]},{"content":"20","pos":[1441,1443]},{"content":"The platform ID (from SMBIOS).","pos":[1496,1526]},{"content":"29","pos":[1556,1558]}]},{"content":"Call the <bpt id=\"p1\">[</bpt>IPortableDeviceProperties::GetValues<ept id=\"p1\">](http://msdn.microsoft.com/library/windows/desktop/dd388714.aspx)</ept> function to retrieve an <bpt id=\"p2\">[</bpt>IPortableDeviceValues<ept id=\"p2\">](http://msdn.microsoft.com/library/windows/desktop/dd319461.aspx)</ept> object that contains the requested version information.","pos":[16152,16433]},{"content":"Pass the service object ID to the <bpt id=\"p1\">*</bpt>pszObjectID<ept id=\"p1\">*</ept> parameter and the initialized <bpt id=\"p2\">[</bpt>IPortableDeviceKeyCollection<ept id=\"p2\">](http://msdn.microsoft.com/library/windows/desktop/dd388548.aspx)</ept> object to the <bpt id=\"p3\">*</bpt>pKeys<ept id=\"p3\">*</ept> parameter.","pos":[16434,16640]},{"content":"Call the <bpt id=\"p1\">[</bpt>IPortableDeviceValues::GetStringValue<ept id=\"p1\">](http://msdn.microsoft.com/library/windows/desktop/dd375661.aspx)</ept> function.","pos":[16646,16769]},{"content":"For the <bpt id=\"p1\">*</bpt>key<ept id=\"p1\">*</ept> parameter, pass the same <bpt id=\"p2\">[</bpt>PROPERTYKEY<ept id=\"p2\">](http://msdn.microsoft.com/library/windows/desktop/bb773381.aspx)</ept> value that you used earlier.","pos":[16770,16916]},{"content":"This function returns the requested version information in the <bpt id=\"p1\">*</bpt>pValue<ept id=\"p1\">*</ept> parameter.","pos":[16917,16999]},{"pos":[17161,17194],"content":"Examples and additional resources"},{"pos":[17196,17395],"content":"The following code examples in the <bpt id=\"p1\">[</bpt>Portable Devices Services COM API Sample<ept id=\"p1\">](http://code.msdn.microsoft.com/windowsdesktop/Portable-Devices-COM-API-b1e2db21)</ept> demonstrate the following related tasks:"},{"pos":[17401,17509],"content":"Enumerating through device services: see the <ph id=\"ph1\">`EnumerateContactsServices`</ph> function in ServiceEnumeration.cpp."},{"pos":[17515,17614],"content":"Reading properties of a service: see the <ph id=\"ph1\">`ReadContentProperties`</ph> function in ContentProperties.cpp."},{"pos":[17616,17960],"content":"For more info about working with device services, see <bpt id=\"p1\">[</bpt>Opening a service<ept id=\"p1\">](http://msdn.microsoft.com/library/windows/desktop/dd375706.aspx)</ept>, <bpt id=\"p2\">[</bpt>Accessing service object properties<ept id=\"p2\">](http://msdn.microsoft.com/library/windows/desktop/dd743198.aspx)</ept> and <bpt id=\"p3\">[</bpt>Retrieving Object Properities<ept id=\"p3\">](http://msdn.microsoft.com/library/windows/desktop/dd375722.aspx)</ept>."}],"content":"---\nauthor: kpacquer\nDescription: Using a host PC to reboot a device to flashing mode and get version information\nms.assetid: 19499cb0-b45d-4971-9934-778f17a87e52\nMSHAttr: 'PreferredLib:/library/windows/hardware'\ntitle: Using a host PC to reboot a device to flashing mode and get version information\n---\n\n# Using a host PC to reboot a device to flashing mode and get version information\n\n\nWhen a Windows 10 Mobile device is connected to a host PC via a USB cable, you can perform the following tasks in an application that is running on the host PC. These tasks are useful in certain manufacturing or customer care scenarios.\n\n-   Reboot the device into flashing mode.\n\n-   Retrieve version information from the device.\n\nThe host app uses the Windows Portable Devices API to accomplish these tasks.\n\n## <span id=\"Understanding_the_Windows_Portable_Devices_API\"></span><span id=\"understanding_the_windows_portable_devices_api\"></span><span id=\"UNDERSTANDING_THE_WINDOWS_PORTABLE_DEVICES_API\"></span>Understanding the Windows Portable Devices API\n\n\nThe Windows Portable Devices (WPD) API is a COM-based API that enables computers to communicate with attached devices. To learn more about this API, refer to the following resources:\n\n-   [Windows Portable Devices](http://msdn.microsoft.com/library/windows/desktop/dd388998.aspx): This section of the MSDN library provides architecture guidance and reference documentation for the Windows Portable Devices API.\n\n-   [Portable Devices COM API Sample](http://code.msdn.microsoft.com/windowsdesktop/Portable-Devices-COM-API-fd4a5f7d): This sample demonstrates how to use the Windows Portable Devices API to perform a variety of tasks, including enumerating connected devices, reading properties of content on a connected device, and sending MTP commands to a device.\n\n-   [Portable Devices Services COM API Sample](http://code.msdn.microsoft.com/windowsdesktop/Portable-Devices-COM-API-b1e2db21): This sample demonstrates how to use the Windows Portable Devices API to perform a variety of operations on device services, including enumerating services and service content.\n\n## <span id=\"Discovering_Windows_10_Mobile_devices_that_are_connected_to_the_host_computer\"></span><span id=\"discovering_windows_10_mobile_devices_that_are_connected_to_the_host_computer\"></span><span id=\"DISCOVERING_WINDOWS_10_MOBILE_DEVICES_THAT_ARE_CONNECTED_TO_THE_HOST_COMPUTER\"></span>Discovering Windows 10 Mobile devices that are connected to the host computer\n\n\nBefore the host app can reboot a device to flashing mode or retrieve version information from the device, the host apps must discover all devices that are connected to the computer.\n\n1.  Create an [IPortableDeviceManager](http://msdn.microsoft.com/library/windows/desktop/dd388688.aspx) object and use the [IPortableDeviceManager::GetDevices](http://msdn.microsoft.com/library/windows/desktop/dd388693.aspx) function to get the collection of device IDs for all connected devices.\n\n2.  Enumerate through the collection of device IDs to determine which connected device is a Windows 10 Mobile For each device ID, create an [IPortableDevice](http://msdn.microsoft.com/library/windows/desktop/dd319361.aspx) object and then use the [IPortableDevice::Content](http://msdn.microsoft.com/library/windows/desktop/dd375688.aspx) and [IPortableDeviceContent::Properties](http://msdn.microsoft.com/library/windows/desktop/dd388540.aspx) functions to retrieve the value of the WPD\\_DEVICE\\_MODEL\\_UNIQUE\\_ID device property for the device. If the device is a Windows 10 Mobile device, the value of the WPD\\_DEVICE\\_MODEL\\_UNIQUE\\_ID property is a GUID with the following value.\n\n    ``` syntax\n    0x59f12ea9, 0x53ce, 0x452d, 0x97, 0x11, 0xca, 0x4e, 0xea, 0xf1, 0x80, 0x89\n    ```\n\n### <span id=\"Examples_and_additional_resources\"></span><span id=\"examples_and_additional_resources\"></span><span id=\"EXAMPLES_AND_ADDITIONAL_RESOURCES\"></span>Examples and additional resources\n\nThe following code examples in the [Portable Devices COM API Sample](http://code.msdn.microsoft.com/windowsdesktop/Portable-Devices-COM-API-fd4a5f7d) demonstrate the following related tasks:\n\n-   Creating an [IPortableDeviceManager](http://msdn.microsoft.com/library/windows/desktop/dd388688.aspx) object: see the `ChooseDevice` function in DeviceEnumeration.cpp.\n\n-   Getting the device IDs of all connected devices: see the `EnumerateAllDevices` function in DeviceEnumeration.cpp.\n\n-   Retrieving device properties: see the `ReadContentProperties` function in ContentProperties.cpp.\n\nFor more info about enumerating devices and retrieving device properties, see the following articles:\n\n-   [Enumerating Devices](http://msdn.microsoft.com/library/windows/desktop/dd319331.aspx)\n\n-   [Device Properties](http://msdn.microsoft.com/library/windows/desktop/dd319322.aspx)\n\n-   [Retrieving Properties for a Single Object](http://msdn.microsoft.com/library/windows/desktop/dd375726.aspx)\n\n## <span id=\"Rebooting_a_Windows_10_Mobile_device_into_flashing_mode\"></span><span id=\"rebooting_a_windows_10_mobile_device_into_flashing_mode\"></span><span id=\"REBOOTING_A_WINDOWS_10_MOBILE_DEVICE_INTO_FLASHING_MODE\"></span>Rebooting a Windows 10 Mobile device into flashing mode\n\n\nAfter you have an [IPortableDevice](http://msdn.microsoft.com/library/windows/desktop/dd319361.aspx) object that represents a Windows 10 Mobile device, you can send an MTP command to reboot the phone into flashing mode.\n\n1.  Create an [IPortableDeviceValues](http://msdn.microsoft.com/library/windows/desktop/dd319461.aspx) object and configure it to set up the MTP command parameters:\n\n    1.  Call [IPortableDeviceValues::SetGuidValue](http://msdn.microsoft.com/library/windows/desktop/dd375671.aspx). Pass WPD\\_PROPERTY\\_COMMON\\_COMMAND\\_CATEGORY to the *key* parameter and pass WPD\\_COMMAND\\_MTP\\_EXT\\_EXECUTE\\_COMMAND\\_WITHOUT\\_DATA\\_PHASE.fmtid to the *Value* parameter.\n\n    2.  Call [IPortableDeviceValues::SetUnsignedIntegerValue](http://msdn.microsoft.com/library/windows/desktop/dd375681.aspx). Pass WPD\\_PROPERTY\\_COMMON\\_COMMAND\\_ID to the *key* parameter and pass WPD\\_COMMAND\\_MTP\\_EXT\\_EXECUTE\\_COMMAND\\_WITHOUT\\_DATA\\_PHASE.pid to the *Value* parameter.\n\n    3.  Call [IPortableDeviceValues::SetUnsignedIntegerValue](http://msdn.microsoft.com/library/windows/desktop/dd375681.aspx) again. Pass WPD\\_PROPERTY\\_MTP\\_EXT\\_OPERATION\\_CODE to the *key* parameter and pass the value **0x9401** to the *Value* parameter. This value represents the MTP command that reboots the phone into flashing mode.\n\n    4.  Create an [**IPortableDevicePropVariantCollection**](https://msdn.microsoft.com/library/windows/hardware/ff597589) object.\n\n    5.  Call [**IPortableDeviceValues::SetIPortableDevicePropVariantCollectionValue**](https://msdn.microsoft.com/library/windows/hardware/ff597632). Pass WPD\\_PROPERTY\\_MTP\\_EXT\\_OPERATION\\_PARAMS to the *key* parameter and pass the [**IPortableDevicePropVariantCollection**](https://msdn.microsoft.com/library/windows/hardware/ff597589) object to the *pValue* parameter.\n\n2.  Call [IPortableDevice::SendCommand](http://msdn.microsoft.com/library/windows/desktop/dd375691.aspx) to send the MTP command. Pass the initialized [IPortableDeviceValues](http://msdn.microsoft.com/library/windows/desktop/dd319461.aspx) object to the *pParameters* parameter. This operation sends the MTP command to reboot the phone into flashing mode.\n\n### <span id=\"Examples_and_additional_resources\"></span><span id=\"examples_and_additional_resources\"></span><span id=\"EXAMPLES_AND_ADDITIONAL_RESOURCES\"></span>Examples and additional resources\n\nThe following code examples demonstrate how to set up MTP command parameters and send an MTP command:\n\n-   [Issuing the GetNumObjects Command](http://msdn.microsoft.com/library/windows/desktop/ff384842.aspx): This topic in the MSDN library demonstrates how to send the standard GetNumObjects MTP command.\n\n-   The `SendhintsCommand` function in ContentEnumeration.cpp in the [Portable Devices COM API Sample](http://code.msdn.microsoft.com/windowsdesktop/Portable-Devices-COM-API-fd4a5f7d).\n\nFor more information about sending MTP commands using the Windows Portable Devices API, see [Supporting MTP Extensions](http://msdn.microsoft.com/library/windows/desktop/ff384848.aspx).\n\n## <span id=\"Retrieving_version_information_from_a_Windows_10_Mobile_device\"></span><span id=\"retrieving_version_information_from_a_windows_10_mobile_device\"></span><span id=\"RETRIEVING_VERSION_INFORMATION_FROM_A_WINDOWS_10_MOBILE_DEVICE\"></span>Retrieving version information from a Windows 10 Mobile device\n\n\nAfter you determine the device ID for a Windows 10 Mobile device that is connected to the host computer, you can use a Windows 10 Mobile-specific device service named MtpDuDeviceService to retrieve version information from the device.\n\n**Note**  \nIf the device is protected with a PIN, the MtpDuDeviceService is only available if the PIN has been entered and the device is unlocked.\n\n \n\n### <span id=\"Open_the_MtpDuDeviceService\"></span><span id=\"open_the_mtpdudeviceservice\"></span><span id=\"OPEN_THE_MTPDUDEVICESERVICE\"></span>Open the MtpDuDeviceService\n\nFirst, enumerate through the device services to open an [IPortableDeviceService](http://msdn.microsoft.com/library/windows/desktop/dd319445.aspx) object for the MtpDuDeviceService.\n\n1.  Get an array of IDs for all device services supported by the device. To do this, cast the existing [IPortableDeviceManager](http://msdn.microsoft.com/library/windows/desktop/dd388688.aspx) object to an [IPortableDeviceServiceManager](http://msdn.microsoft.com/library/windows/desktop/dd319402.aspx) and call the [IPortableDeviceServiceManager::GetDeviceServices](http://msdn.microsoft.com/library/windows/desktop/dd319408.aspx) method. Pass the device ID for the Windows 10 Mobile device to the *pszPnPDeviceID* parameter and the value [GUID\\_DEVINTERFACE\\_WPD\\_SERVICE](http://msdn.microsoft.com/library/windows/desktop/dd319319.aspx) to the *guidServiceCategory* parameter. The array of service IDs is returned in the *pServices* parameter.\n\n2.  Iterate through the array of service IDs, and perform the following tasks for each service ID:\n\n    1.  Create an [IPortableDeviceService](http://msdn.microsoft.com/library/windows/desktop/dd319445.aspx) object and call the [IPortableDeviceService::Open](http://msdn.microsoft.com/library/windows/desktop/dd319453.aspx) function to open the service. Pass the current service ID to the *pszPnPServiceID* parameter.\n\n    2.  Get the service object ID by calling the [IPortableDeviceService::GetServiceObjectID](http://msdn.microsoft.com/library/windows/desktop/dd319449.aspx) function. You need the service object ID to access properties of the service.\n\n    3.  Use the [IPortableDeviceService::Content](http://msdn.microsoft.com/library/windows/desktop/dd319445.aspx) and [IPortableDeviceContent::Properties](http://msdn.microsoft.com/library/windows/desktop/dd388540.aspx) functions to retrieve the collection of properties for the service (an [IPortableDeviceProperties](http://msdn.microsoft.com/library/windows/desktop/dd388696.aspx) object).\n\n    4.  Create an [IPortableDeviceKeyCollection](http://msdn.microsoft.com/library/windows/desktop/dd388548.aspx) object and add the WPD-defined WPD\\_OBJECT\\_NAME property key to this collection. This property key indicates that you are retrieving the display name for the service.\n\n    5.  Call the [IPortableDeviceProperties::GetValues](http://msdn.microsoft.com/library/windows/desktop/dd388714.aspx) function to retrieve an [IPortableDeviceValues](http://msdn.microsoft.com/library/windows/desktop/dd319461.aspx) object that contains the property values. Pass the service object ID to the *pszObjectID* parameter and the initialized [IPortableDeviceKeyCollection](http://msdn.microsoft.com/library/windows/desktop/dd388548.aspx) object to the *pKeys* parameter.\n\n    6.  Call the [IPortableDeviceValues::GetStringValue](http://msdn.microsoft.com/library/windows/desktop/dd375661.aspx) function, and pass the WPD-defined WPD\\_OBJECT\\_NAME property key to the *key* parameter.\n\n    7.  If the [IPortableDeviceValues::GetStringValue](http://msdn.microsoft.com/library/windows/desktop/dd375661.aspx) function returns the string **MtpDuDeviceService**, you have found the service object you need to retrieve version information from the phone. Exit the loop and proceed to the next section.\n\n        If the name of the service is not **MtpDuDeviceService**, call the [IPortableDeviceService::Close](http://msdn.microsoft.com/library/windows/desktop/dd319441.aspx) function, iterate to the next service ID returned by [IPortableDeviceServiceManager::GetDeviceServices](http://msdn.microsoft.com/library/windows/desktop/dd319408.aspx), and return to step 2.\n\n### <span id=\"Retrieve_version_information_from_the_device\"></span><span id=\"retrieve_version_information_from_the_device\"></span><span id=\"RETRIEVE_VERSION_INFORMATION_FROM_THE_DEVICE\"></span>Retrieve version information from the device\n\nAfter you have opened an [IPortableDeviceService](http://msdn.microsoft.com/library/windows/desktop/dd319445.aspx) object for the MtpDuDeviceService, you can use this object to retrieve version information from the device\n\n1.  Use the [IPortableDeviceService::Content](http://msdn.microsoft.com/library/windows/desktop/dd319445.aspx) and [IPortableDeviceContent::Properties](http://msdn.microsoft.com/library/windows/desktop/dd388540.aspx) functions to retrieve the collection of properties for the service (an [IPortableDeviceProperties](http://msdn.microsoft.com/library/windows/desktop/dd388696.aspx) object).\n\n2.  Create an [IPortableDeviceKeyCollection](http://msdn.microsoft.com/library/windows/desktop/dd388548.aspx) object and add a [PROPERTYKEY](http://msdn.microsoft.com/library/windows/desktop/bb773381.aspx) value to this collection that specifies the version data you want to retrieve from the device. The [PROPERTYKEY](http://msdn.microsoft.com/library/windows/desktop/bb773381.aspx) value must have the following structure:\n\n    -   The *fmtid* field must have the following GUID value:\n\n        ``` syntax\n        0x9BFC64C1, 0x19C9, 0x4F3D, 0xA1, 0x4D,  0xC8,  0xDB,  0xE0,  0x47,  0x5D,  0x13\n        ```\n\n    -   The *pid* field must have one of the values shown in the table below\n\n    <table>\n    <colgroup>\n    <col width=\"50%\" />\n    <col width=\"50%\" />\n    </colgroup>\n    <thead>\n    <tr class=\"header\">\n    <th align=\"left\">Device data to retrieve</th>\n    <th align=\"left\">pid value</th>\n    </tr>\n    </thead>\n    <tbody>\n    <tr class=\"odd\">\n    <td align=\"left\"><p>The build string for the image on the device</p></td>\n    <td align=\"left\"><p>Use the data returned by the following pid values to construct the build string:</p>\n    <ul>\n    <li><p>4 (the name of the internal Microsoft branch the OS was built from)</p></li>\n    <li><p>6 (the Windows build number)</p></li>\n    <li><p>7 (the Windows 10 Mobile build number)</p></li>\n    <li><p>8 (the time stamp for the build)</p></li>\n    </ul>\n    <p>An example build string is WPMAIN.9600.12186.20130906-1624.</p></td>\n    </tr>\n    <tr class=\"even\">\n    <td align=\"left\"><p>The OS version</p></td>\n    <td align=\"left\"><p>12</p></td>\n    </tr>\n    <tr class=\"odd\">\n    <td align=\"left\"><p>The OEM device name</p></td>\n    <td align=\"left\"><p>15</p></td>\n    </tr>\n    <tr class=\"even\">\n    <td align=\"left\"><p>The firmware version</p></td>\n    <td align=\"left\"><p>16</p></td>\n    </tr>\n    <tr class=\"odd\">\n    <td align=\"left\"><p>The SoC version</p></td>\n    <td align=\"left\"><p>17</p></td>\n    </tr>\n    <tr class=\"even\">\n    <td align=\"left\"><p>The radio software version</p></td>\n    <td align=\"left\"><p>18</p></td>\n    </tr>\n    <tr class=\"odd\">\n    <td align=\"left\"><p>The radio hardware version</p></td>\n    <td align=\"left\"><p>19</p></td>\n    </tr>\n    <tr class=\"even\">\n    <td align=\"left\"><p>The bootloader version</p></td>\n    <td align=\"left\"><p>20</p></td>\n    </tr>\n    <tr class=\"odd\">\n    <td align=\"left\"><p>The platform ID (from SMBIOS).</p></td>\n    <td align=\"left\"><p>29</p></td>\n    </tr>\n    </tbody>\n    </table>\n\n     \n\n3.  Call the [IPortableDeviceProperties::GetValues](http://msdn.microsoft.com/library/windows/desktop/dd388714.aspx) function to retrieve an [IPortableDeviceValues](http://msdn.microsoft.com/library/windows/desktop/dd319461.aspx) object that contains the requested version information. Pass the service object ID to the *pszObjectID* parameter and the initialized [IPortableDeviceKeyCollection](http://msdn.microsoft.com/library/windows/desktop/dd388548.aspx) object to the *pKeys* parameter.\n\n4.  Call the [IPortableDeviceValues::GetStringValue](http://msdn.microsoft.com/library/windows/desktop/dd375661.aspx) function. For the *key* parameter, pass the same [PROPERTYKEY](http://msdn.microsoft.com/library/windows/desktop/bb773381.aspx) value that you used earlier. This function returns the requested version information in the *pValue* parameter.\n\n### <span id=\"Examples_and_additional_resources\"></span><span id=\"examples_and_additional_resources\"></span><span id=\"EXAMPLES_AND_ADDITIONAL_RESOURCES\"></span>Examples and additional resources\n\nThe following code examples in the [Portable Devices Services COM API Sample](http://code.msdn.microsoft.com/windowsdesktop/Portable-Devices-COM-API-b1e2db21) demonstrate the following related tasks:\n\n-   Enumerating through device services: see the `EnumerateContactsServices` function in ServiceEnumeration.cpp.\n\n-   Reading properties of a service: see the `ReadContentProperties` function in ContentProperties.cpp.\n\nFor more info about working with device services, see [Opening a service](http://msdn.microsoft.com/library/windows/desktop/dd375706.aspx), [Accessing service object properties](http://msdn.microsoft.com/library/windows/desktop/dd743198.aspx) and [Retrieving Object Properities](http://msdn.microsoft.com/library/windows/desktop/dd375722.aspx).\n\n \n\n \n\n\n\n\n\n"}