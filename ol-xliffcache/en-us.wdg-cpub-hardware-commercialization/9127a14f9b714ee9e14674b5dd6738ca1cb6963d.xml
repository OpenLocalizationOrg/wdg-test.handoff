{"nodes":[{"content":"WinPE: Adding Windows PowerShell support to Windows PE","pos":[35,89]},{"content":"WinPE: Adding Windows PowerShell support to Windows PE","pos":[198,252]},{"content":"WinPE: Adding Windows PowerShell support to Windows PE","pos":[261,315]},{"content":"The following sample script creates a version of Windows PE with Windows PowerShell and its DISM and Storage cmdlets, which can be used to help automate Windows deployment.","pos":[318,490]},{"content":"Prepare a local copy of the Windows PE files","pos":[494,538]},{"pos":[546,714],"content":"Install the <bpt id=\"p1\">[</bpt>Windows Assessment and Deployment Kit (ADK)<ept id=\"p1\">](http://go.microsoft.com/fwlink/p/?LinkID=526803)</ept>, adding the <bpt id=\"p2\">**</bpt>Deployment Tools<ept id=\"p2\">**</ept> and <bpt id=\"p3\">**</bpt>Windows PE<ept id=\"p3\">**</ept> features."},{"pos":[720,799],"content":"Start the <bpt id=\"p1\">**</bpt>Deployment and Imaging Tools Environment<ept id=\"p1\">**</ept> as an <bpt id=\"p2\">**</bpt>administrator<ept id=\"p2\">**</ept>."},{"content":"Create a working copy of the Windows PE files.","pos":[805,851]},{"content":"Specify either x86, amd64, or arm:","pos":[852,886]},{"pos":[1043,1056],"content":"Sample script"},{"content":"Use the following script to mount the Windows image, add the Windows PE optional components for Windows PowerShell, and to unmount the image.","pos":[1059,1200]},{"pos":[4083,4130],"content":"Install this version of Windows PE to a USB key"},{"pos":[4364,4402],"content":"Start Windows PowerShell in Windows PE"},{"content":"After you boot a PC to Windows PE using this USB key, start Windows PowerShell:","pos":[4405,4484]},{"pos":[4592,4606],"content":"Related topics"},{"content":"WinPE for Windows 10","pos":[4610,4630]},{"content":"WinPE: Add packages (Optional Components Reference)","pos":[4650,4701]},{"content":"WinPE: Create USB Bootable drive","pos":[4759,4791]},{"content":"WinPE: Create a Boot CD, DVD, ISO, or VHD","pos":[4831,4872]},{"content":"WinPE: Mount and Customize","pos":[4918,4944]}],"content":"---\nauthor: Justinha\nDescription: 'WinPE: Adding Windows PowerShell support to Windows PE'\nms.assetid: 8b653cf6-3584-4c80-be84-ca32d60aeba2\nMSHAttr: 'PreferredLib:/library/windows/hardware'\ntitle: 'WinPE: Adding Windows PowerShell support to Windows PE'\n---\n\n# WinPE: Adding Windows PowerShell support to Windows PE\n\n\nThe following sample script creates a version of Windows PE with Windows PowerShell and its DISM and Storage cmdlets, which can be used to help automate Windows deployment.\n\n**Prepare a local copy of the Windows PE files**\n\n1.  Install the [Windows Assessment and Deployment Kit (ADK)](http://go.microsoft.com/fwlink/p/?LinkID=526803), adding the **Deployment Tools** and **Windows PE** features.\n\n2.  Start the **Deployment and Imaging Tools Environment** as an **administrator**.\n\n3.  Create a working copy of the Windows PE files. Specify either x86, amd64, or arm:\n\n    ``` syntax\n    copype amd64 C:\\WinPE_amd64_PS\n    ```\n\n## <span id=\"SampleScript\"></span><span id=\"samplescript\"></span><span id=\"SAMPLESCRIPT\"></span>Sample script\n\n\nUse the following script to mount the Windows image, add the Windows PE optional components for Windows PowerShell, and to unmount the image.\n\n``` syntax\nDism /Mount-Image /ImageFile:\"C:\\WinPE_amd64_PS\\media\\sources\\boot.wim\" /Index:1 /MountDir:\"C:\\WinPE_amd64_PS\\mount\"\n\nDism /Add-Package /Image:\"C:\\WinPE_amd64_PS\\mount\" /PackagePath:\"C:\\Program Files\\Windows Kits\\10\\Assessment and Deployment Kit\\Windows Preinstallation Environment\\amd64\\WinPE_OCs\\WinPE-WMI.cab\"\n\nDism /Add-Package /Image:\"C:\\WinPE_amd64_PS\\mount\" /PackagePath:\"C:\\Program Files\\Windows Kits\\10\\Assessment and Deployment Kit\\Windows Preinstallation Environment\\amd64\\WinPE_OCs\\en-us\\WinPE-WMI_en-us.cab\"\n\nDism /Add-Package /Image:\"C:\\WinPE_amd64_PS\\mount\" /PackagePath:\"C:\\Program Files\\Windows Kits\\10\\Assessment and Deployment Kit\\Windows Preinstallation Environment\\amd64\\WinPE_OCs\\WinPE-NetFX.cab\"\n\nDism /Add-Package /Image:\"C:\\WinPE_amd64_PS\\mount\" /PackagePath:\"C:\\Program Files\\Windows Kits\\10\\Assessment and Deployment Kit\\Windows Preinstallation Environment\\amd64\\WinPE_OCs\\en-us\\WinPE-NetFX_en-us.cab\"\n\nDism /Add-Package /Image:\"C:\\WinPE_amd64_PS\\mount\" /PackagePath:\"C:\\Program Files\\Windows Kits\\10\\Assessment and Deployment Kit\\Windows Preinstallation Environment\\amd64\\WinPE_OCs\\WinPE-Scripting.cab\"\n\nDism /Add-Package /Image:\"C:\\WinPE_amd64_PS\\mount\" /PackagePath:\"C:\\Program Files\\Windows Kits\\10\\Assessment and Deployment Kit\\Windows Preinstallation Environment\\amd64\\WinPE_OCs\\en-us\\WinPE-Scripting_en-us.cab\"\n\nDism /Add-Package /Image:\"C:\\WinPE_amd64_PS\\mount\" /PackagePath:\"C:\\Program Files\\Windows Kits\\10\\Assessment and Deployment Kit\\Windows Preinstallation Environment\\amd64\\WinPE_OCs\\WinPE-PowerShell.cab\"\n\nDism /Add-Package /Image:\"C:\\WinPE_amd64_PS\\mount\" /PackagePath:\"C:\\Program Files\\Windows Kits\\10\\Assessment and Deployment Kit\\Windows Preinstallation Environment\\amd64\\WinPE_OCs\\en-us\\WinPE-PowerShell_en-us.cab\"\n\nDism /Add-Package /Image:\"C:\\WinPE_amd64_PS\\mount\" /PackagePath:\"C:\\Program Files\\Windows Kits\\10\\Assessment and Deployment Kit\\Windows Preinstallation Environment\\amd64\\WinPE_OCs\\WinPE-StorageWMI.cab\"\n\nDism /Add-Package /Image:\"C:\\WinPE_amd64_PS\\mount\" /PackagePath:\"C:\\Program Files\\Windows Kits\\10\\Assessment and Deployment Kit\\Windows Preinstallation Environment\\amd64\\WinPE_OCs\\en-us\\WinPE-StorageWMI_en-us.cab\"\n\nDism /Add-Package /Image:\"C:\\WinPE_amd64_PS\\mount\" /PackagePath:\"C:\\Program Files\\Windows Kits\\10\\Assessment and Deployment Kit\\Windows Preinstallation Environment\\amd64\\WinPE_OCs\\WinPE-DismCmdlets.cab\"\n\nDism /Add-Package /Image:\"C:\\WinPE_amd64_PS\\mount\" /PackagePath:\"C:\\Program Files\\Windows Kits\\10\\Assessment and Deployment Kit\\Windows Preinstallation Environment\\amd64\\WinPE_OCs\\en-us\\WinPE-DismCmdlets_en-us.cab\"\n\nDism /Unmount-Image /MountDir:C:\\WinPE_amd64_PS\\mount /Commit\n```\n\n## <span id=\"Install_this_version_of_Windows_PE_to_a_USB_key\"></span><span id=\"install_this_version_of_windows_pe_to_a_usb_key\"></span><span id=\"INSTALL_THIS_VERSION_OF_WINDOWS_PE_TO_A_USB_KEY\"></span>Install this version of Windows PE to a USB key\n\n\n``` syntax\nMakeWinPEMedia /UFD C:\\WinPE_amd64_PS F:\n```\n\n## <span id=\"Start_Windows_PowerShell_in_Windows_PE\"></span><span id=\"start_windows_powershell_in_windows_pe\"></span><span id=\"START_WINDOWS_POWERSHELL_IN_WINDOWS_PE\"></span>Start Windows PowerShell in Windows PE\n\n\nAfter you boot a PC to Windows PE using this USB key, start Windows PowerShell:\n\n``` syntax\nX:\\Windows\\system32\\WindowsPowerShell\\v1.0\\powershell\n```\n\n## <span id=\"related_topics\"></span>Related topics\n\n\n[WinPE for Windows 10](winpe-intro.md)\n\n[WinPE: Add packages (Optional Components Reference)](winpe-add-packages--optional-components-reference.md)\n\n[WinPE: Create USB Bootable drive](winpe-create-usb-bootable-drive.md)\n\n[WinPE: Create a Boot CD, DVD, ISO, or VHD](winpe-create-a-boot-cd-dvd-iso-or-vhd.md)\n\n[WinPE: Mount and Customize](winpe-mount-and-customize.md)\n\n \n\n \n\n\n\n\n\n\n"}