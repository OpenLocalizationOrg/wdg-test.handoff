{"nodes":[{"content":"2. System and Event Provider Definitions","pos":[11,51]},{"content":"2. System and Event Provider Definitions","pos":[256,296]},{"content":"Windows Performance Recorder (WPR) recording profiles are stored in an XML file that has a .wprp extension.","pos":[299,406]},{"content":"A system provider definition specifies the system keywords, stacks, and memory pool tags in the .wprp file.","pos":[407,514]},{"content":"In this article:","pos":[516,532]},{"content":"Provider Definition","pos":[539,558]},{"content":"System Providers","pos":[576,592]},{"content":"Event Providers","pos":[606,621]},{"content":"Heap Event Providers","pos":[637,657]},{"content":"Capture-State Providers","pos":[672,695]},{"content":"Example","pos":[709,716]},{"pos":[755,774],"content":"Provider Definition"},{"content":"Items in the .wprp file must be defined in the following order:","pos":[777,840]},{"content":"All collectors","pos":[846,860]},{"content":"System providers","pos":[866,882]},{"content":"Event providers","pos":[888,903]},{"content":"Heap providers, if present","pos":[909,935]},{"content":"All profiles","pos":[941,953]},{"content":"In some cases, providers can be defined in, instead of before, the profile definition.","pos":[955,1041]},{"content":"For example:","pos":[1042,1054]},{"pos":[1782,1798],"content":"System Providers"},{"content":"The only mandatory attribute for a system provider definition is <bpt id=\"p1\">**</bpt>Id<ept id=\"p1\">**</ept>.","pos":[1801,1873]},{"content":"Inner XML tags specify the keywords, stacks, and pool tags to enable.","pos":[1874,1943]},{"content":"For lists of all supported keywords and stacks, see <bpt id=\"p1\">[</bpt>Stack<ept id=\"p1\">](stack-wpa.md)</ept> and <bpt id=\"p2\">[</bpt>Keyword (in SystemProvider)<ept id=\"p2\">](keyword--in-systemprovider-.md)</ept>.","pos":[1944,2084]},{"content":"The following code example shows a system provider definition.","pos":[2086,2148]},{"pos":[2688,2703],"content":"Event Providers"},{"content":"An event provider definition specifies the Event Tracing for Windows (ETW) provider to use and the keywords and levels to enable.","pos":[2706,2835]},{"content":"the, An event provider definition requires a mandatory <bpt id=\"p1\">**</bpt>Name<ept id=\"p1\">**</ept> attribute and a mandatory <bpt id=\"p2\">**</bpt>Id<ept id=\"p2\">**</ept> attribute.","pos":[2836,2943]},{"pos":[2945,3005],"content":"The <bpt id=\"p1\">**</bpt>Name<ept id=\"p1\">**</ept> attribute specifies one of the following names:"},{"content":"The name of a registered Crimson provider, such as \"Microsoft-Windows-Search-Core\".","pos":[3011,3094]},{"content":"The provider GUID, such as \"49c2c27c-fe2d-40bf-8c4e-c3fb518037e7\".","pos":[3100,3166]},{"content":"The name of an earlier provider, such as \"IE6\".","pos":[3172,3219]},{"content":"The special-case name, such as \"PerfTrack\" or \"DotNetProvider\".","pos":[3225,3288]},{"content":"You can use the following optional attributes to fine-tune provider parameters:","pos":[3290,3369]},{"content":"<bpt id=\"p1\">**</bpt>Stack<ept id=\"p1\">**</ept>: Indicates whether the provider captures stacks.","pos":[3375,3433]},{"content":"The default setting is \"false\".","pos":[3434,3465]},{"content":"<bpt id=\"p1\">**</bpt>Level<ept id=\"p1\">**</ept>: Specifies the ETW logging level.","pos":[3471,3514]},{"content":"The default setting is 0xFF.","pos":[3515,3543]},{"content":"<bpt id=\"p1\">**</bpt>NonPagedMemory<ept id=\"p1\">**</ept>: Indicates whether WPR uses non-paged memory for the buffer for this provider.","pos":[3549,3646]},{"content":"The default setting is \"false\".","pos":[3647,3678]},{"pos":[3684,3893],"content":"**Warning**  \nSome Windows event providers require the use of nonpaged memory during trace capture. An example of an event provider that requires NonPagedMemory is `EventProvider_Microsoft-Windows-Win32k`.","leadings":["","    "],"nodes":[{"content":"Warning","pos":[2,9]},{"content":"Some Windows event providers require the use of nonpaged memory during trace capture. An example of an event provider that requires NonPagedMemory is `EventProvider_Microsoft-Windows-Win32k`.","pos":[14,205],"nodes":[{"content":"Some Windows event providers require the use of nonpaged memory during trace capture.","pos":[0,85]},{"content":"An example of an event provider that requires NonPagedMemory is <ph id=\"ph1\">`EventProvider_Microsoft-Windows-Win32k`</ph>.","pos":[86,191]}]}]},{"pos":[3906,4023],"content":"<bpt id=\"p1\">**</bpt>CaptureStateOnly<ept id=\"p1\">**</ept>: If set to \"true\", indicates that WPR enables this provider at the specified capture state Only."},{"pos":[4029,4137],"content":"<bpt id=\"p1\">**</bpt>SID<ept id=\"p1\">**</ept>: Specifies whether the extended data of logged events includes the user's security identifier (SID)."},{"pos":[4143,4247],"content":"<bpt id=\"p1\">**</bpt>TSID<ept id=\"p1\">**</ept>: If set to \"true\", specifies the terminal session identifier to extended data of logged events."},{"content":"Optional inner XML tags specify the keywords to enable.","pos":[4249,4304]},{"content":"Unlike system providers, event providers do not have defined textual constants.","pos":[4305,4384]},{"content":"Therefore, event providers have hexadecimal values.","pos":[4385,4436]},{"content":"However, the syntax is the same as that of system providers.","pos":[4437,4497]},{"content":"If you do not specify keywords, the default value is 0xFFFFFFFFFFFFFFFF.","pos":[4498,4570]},{"pos":[4600,4620],"content":"Heap Event Providers"},{"content":"The heap provider definition specifies the process identifier of the process for which WPR captures heap events.","pos":[4623,4735]},{"content":"<bpt id=\"p1\">**</bpt>Id<ept id=\"p1\">**</ept> is the only mandatory attribute.","pos":[4736,4775]},{"content":"The <bpt id=\"p1\">**</bpt>HeapProcessId<ept id=\"p1\">**</ept> child element is not mandatory.","pos":[4776,4829]},{"content":"This element specifies the process <bpt id=\"p1\">**</bpt>Id<ept id=\"p1\">**</ept> attribute of the process that you want to analyze.","pos":[4830,4922]},{"content":"The following example shows how to do this.","pos":[4923,4966]},{"pos":[5265,5288],"content":"Capture-State Providers"},{"content":"Unlike regular providers that are enabled throughout the whole tracing session, capture-state providers are enabled only when you save or start a capture session.","pos":[5291,5453]},{"content":"The following example shows both regular and capture-state providers.","pos":[5454,5523]},{"pos":[6525,6532],"content":"Example"},{"content":"The following code example defines two event providers.","pos":[6535,6590]},{"content":"Related topics","pos":[6890,6904]},{"content":"Authoring Recording Profiles","pos":[6908,6936]},{"content":"1. Collector Definitions","pos":[6973,6997]},{"content":"3. Profile Definitions","pos":[7029,7051]},{"content":"SystemProvider","pos":[7081,7095]},{"content":"EventProvider","pos":[7118,7131]},{"content":"HeapEventProvider","pos":[7153,7170]},{"content":"Keyword (in SystemProvider)","pos":[7196,7223]},{"content":"Stack","pos":[7259,7264]},{"content":"PoolTag","pos":[7282,7289]}],"content":"---\ntitle: 2. System and Event Provider Definitions\ndescription: 2.\nMSHAttr:\n- 'PreferredSiteName:MSDN'\n- 'PreferredLib:/library/windows/hardware'\nms.assetid: 24358037-a8ad-41c8-b82c-b4c5111b17d3\nms.prod: W10\nms.mktglfcycl: operate\nms.sitesec: msdn\n---\n\n# 2. System and Event Provider Definitions\n\n\nWindows Performance Recorder (WPR) recording profiles are stored in an XML file that has a .wprp extension. A system provider definition specifies the system keywords, stacks, and memory pool tags in the .wprp file.\n\nIn this article:\n\n-   [Provider Definition](#provdef)\n\n-   [System Providers](#sys)\n\n-   [Event Providers](#event)\n\n-   [Heap Event Providers](#heap)\n\n-   [Capture-State Providers](#cap)\n\n-   [Example](#ex)\n\n## <a href=\"\" id=\"provdef\"></a>Provider Definition\n\n\nItems in the .wprp file must be defined in the following order:\n\n1.  All collectors\n\n2.  System providers\n\n3.  Event providers\n\n4.  Heap providers, if present\n\n5.  All profiles\n\nIn some cases, providers can be defined in, instead of before, the profile definition. For example:\n\n``` syntax\n<EventCollector Id=\"Collector1\" Name=\"Sample Event Collector\">\n   <BufferSize Value=\"128\"/>\n   <Buffers Value=\"64\"/>\n</EventCollector>\n\n<Profile Id=\"Sample.Verbose.File\" Name=\"Sample\" Description=\"Sample profile\" DetailLevel=\"Verbose\" LoggingMode=\"File\">\n   <Collectors>\n      <EventCollectorId Value=\"Collector1\">\n         <EventProviders>\n            <EventProvider Id=\"EventProvider_Microsoft-Windows-Kernel-Power\" Name=\"Microsoft-Windows-Kernel-Power\" NonPagedMemory=\"true\">\n               <Keywords>\n                  <Keyword Value=\"0x4\"/>\n               </Keywords>\n            </EventProvider>\n         </EventProviders>\n      </EventCollectorId>\n   </Collectors>\n</Profile>\n```\n\n## <a href=\"\" id=\"sys\"></a>System Providers\n\n\nThe only mandatory attribute for a system provider definition is **Id**. Inner XML tags specify the keywords, stacks, and pool tags to enable. For lists of all supported keywords and stacks, see [Stack](stack-wpa.md) and [Keyword (in SystemProvider)](keyword--in-systemprovider-.md).\n\nThe following code example shows a system provider definition.\n\n``` syntax\n<SystemProvider\n  Id=\"system-provider\">\n  <Keywords>\n    <Keyword\n      Value=\"ProcessThread\"/>\n    <Keyword\n      Value=\"Loader\"/>\n    <Keyword\n      Value=\"CSwitch\"/>\n  </Keywords>\n  <Stacks>\n    <Stack\n      Value=\"ThreadCreate\"/>\n    <Stack\n      Value=\"ReadyThread\"/>\n    <Stack\n      Value=\"CSwitch\"/>\n  </Stacks>\n  <PoolTags>\n    <PoolTag\n      Value=\"a*\"/>\n    <PoolTag\n      Value=\"b*\"/>\n    <PoolTag\n      Value=\"c*\"/>\n    <PoolTag\n      Value=\"d*\"/>\n  </PoolTags>\n</SystemProvider>\n```\n\n## <a href=\"\" id=\"event\"></a>Event Providers\n\n\nAn event provider definition specifies the Event Tracing for Windows (ETW) provider to use and the keywords and levels to enable. the, An event provider definition requires a mandatory **Name** attribute and a mandatory **Id** attribute.\n\nThe **Name** attribute specifies one of the following names:\n\n-   The name of a registered Crimson provider, such as \"Microsoft-Windows-Search-Core\".\n\n-   The provider GUID, such as \"49c2c27c-fe2d-40bf-8c4e-c3fb518037e7\".\n\n-   The name of an earlier provider, such as \"IE6\".\n\n-   The special-case name, such as \"PerfTrack\" or \"DotNetProvider\".\n\nYou can use the following optional attributes to fine-tune provider parameters:\n\n-   **Stack**: Indicates whether the provider captures stacks. The default setting is \"false\".\n\n-   **Level**: Specifies the ETW logging level. The default setting is 0xFF.\n\n-   **NonPagedMemory**: Indicates whether WPR uses non-paged memory for the buffer for this provider. The default setting is \"false\".\n\n    **Warning**  \n    Some Windows event providers require the use of nonpaged memory during trace capture. An example of an event provider that requires NonPagedMemory is `EventProvider_Microsoft-Windows-Win32k`.\n\n     \n\n-   **CaptureStateOnly**: If set to \"true\", indicates that WPR enables this provider at the specified capture state Only.\n\n-   **SID**: Specifies whether the extended data of logged events includes the user's security identifier (SID).\n\n-   **TSID**: If set to \"true\", specifies the terminal session identifier to extended data of logged events.\n\nOptional inner XML tags specify the keywords to enable. Unlike system providers, event providers do not have defined textual constants. Therefore, event providers have hexadecimal values. However, the syntax is the same as that of system providers. If you do not specify keywords, the default value is 0xFFFFFFFFFFFFFFFF.\n\n## <a href=\"\" id=\"heap\"></a>Heap Event Providers\n\n\nThe heap provider definition specifies the process identifier of the process for which WPR captures heap events. **Id** is the only mandatory attribute. The **HeapProcessId** child element is not mandatory. This element specifies the process **Id** attribute of the process that you want to analyze. The following example shows how to do this.\n\n``` syntax\n<HeapEventProvider\n  Id=\"Base_Heap_Provider\">\n</HeapEventProvider>\n<HeapEventProvider\n  Base=\"Base_Heap_Provider\"\n  Id=\"Derived_Heap_Provider\">\n  <HeapProcessIds Operation=\"Set\">\n    <HeapProcessId Value=\"2314\"/>\n  </HeapProcessIds>\n</HeapEventProvider>\n```\n\n## <a href=\"\" id=\"cap\"></a>Capture-State Providers\n\n\nUnlike regular providers that are enabled throughout the whole tracing session, capture-state providers are enabled only when you save or start a capture session. The following example shows both regular and capture-state providers.\n\n``` syntax\n<EventProvider Id=\"sample-provider\" Name=\"SampleProvider\" NonPagedMemory=\"true\" Level=\"5\">\n  <Keywords>\n    <Keyword Value=\"0x98\"/> <!-- Provider is enabled with these keywords throughout the tracing session. -->\n  </Keywords>\n  <CaptureStateOnStart>\n    <Keyword Value=\"0xff4\"/> <!-- Provider is enabled with these keywords when tracing is started. -->\n  </CaptureStateOnStart>\n  <CaptureStateOnSave>\n    <Keyword Value=\"0x118\"/> <!-- Provider is enabled with these keywords when tracing is saved. -->\n  </CaptureStateOnSave>\n</EventProvider>\n\n<EventProvider Id=\"EventProvider_DWMWin32k_CaptureState\" Name=\"e7ef96be-969f-414f-97d7-3ddb7b558ccc\" NonPagedMemory=\"true\" CaptureStateOnly=\"true\" >\n  <!-- CaptureStateOnly=\"true\" means provider is not enabled throughout the tracing session. -->\n  <CaptureStateOnSave>\n    <Keyword Value=\"0x80000\"/> <!-- Provider is enabled with these keywords when tracing is saved. -->\n  </CaptureStateOnSave>\n</EventProvider>\n```\n\n## <a href=\"\" id=\"ex\"></a>Example\n\n\nThe following code example defines two event providers.\n\n``` syntax\n<EventProvider\n  Id=\"Win32K-provider\"\n  Name=\"Microsoft-Windows-Win32K\"\n  NonPagedMemory=\"true\"\n  Stack=\"true\">\n  <Keywords>\n    <Keyword\n      Value=\"0x240000\"/>\n  </Keywords>\n</EventProvider>\n\n<EventProvider\n  Id=\"Search-Core-provider\"\n  Name=\"Microsoft-Windows-Search-Core\"/>\n```\n\n## Related topics\n\n\n[Authoring Recording Profiles](authoring-recording-profiles.md)\n\n[1. Collector Definitions](1-collector-definitions.md)\n\n[3. Profile Definitions](3-profile-definitions.md)\n\n[SystemProvider](systemprovider.md)\n\n[EventProvider](eventprovider.md)\n\n[HeapEventProvider](heapeventprovider.md)\n\n[Keyword (in SystemProvider)](keyword--in-systemprovider-.md)\n\n[Stack](stack-wpa.md)\n\n[PoolTag](pooltag.md)\n\n \n\n \n\n\n\n\n\n\n\n"}