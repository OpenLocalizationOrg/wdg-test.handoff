{"nodes":[{"content":"WinPE: Storage Area Network (SAN) Policy","pos":[35,75]},{"content":"WinPE: Storage Area Network (SAN) Policy","pos":[184,224]},{"content":"WinPE: Storage Area Network (SAN) Policy","pos":[233,273]},{"content":"Storage area network (SAN) functionality enables a computer to mount disks and other storage devices automatically from other computers.","pos":[276,412]},{"content":"By configuring the SAN policy on a Windows Preinstallation Environment (Windows PE) image, you can control whether or not disks are automatically mounted and which disks can be mounted.","pos":[413,598]},{"content":"You can also disable the policy to automatically mount disks.","pos":[599,660]},{"pos":[866,914],"content":"Configuring the SAN policy on a Windows PE image"},{"content":"For Windows PE images that are available in the Windows Assessment and Deployment Kit (Windows ADK), the default SAN policy is to mount available disks automatically.","pos":[917,1083]},{"content":"But if the SAN environment has many available disks, automatically mounting them might reduce the performance of Windows PE.","pos":[1084,1208]},{"content":"The container ID determines the external and internal disk status.","pos":[1209,1275]},{"content":"If the device container ID of a disk is the same as the root container ID, the disk is internal.","pos":[1276,1372]},{"content":"Otherwise, it's an external disk.","pos":[1373,1406]},{"content":"You can use the Setsanpolicy.cmd file in the Windows PE tools path to configure the SAN policy on a Windows PE image.","pos":[1407,1524]},{"content":"To configure the SAN policy on a Windows PE image","pos":[1528,1577]},{"content":"Mount the Windows PE image to an available mount point.","pos":[1585,1640]},{"content":"For example:","pos":[1641,1653]},{"pos":[1800,1882],"content":"where <bpt id=\"p1\">*</bpt><ph id=\"ph1\">&amp;lt;</ph>image<ph id=\"ph2\">\\_</ph>index<ph id=\"ph3\">&amp;gt;</ph><ept id=\"p1\">*</ept> is the number of the selected image in the .wim file."},{"content":"Run the <bpt id=\"p1\">**</bpt>setsanpolicy<ept id=\"p1\">**</ept> command.","pos":[1888,1921]},{"content":"For example:","pos":[1922,1934]},{"pos":[2014,2139],"content":"where <bpt id=\"p1\">*</bpt><ph id=\"ph1\">&amp;lt;</ph>image<ph id=\"ph2\">\\_</ph>path<ph id=\"ph3\">&amp;gt;</ph><ept id=\"p1\">*</ept> is the path of a mounted Windows PE image, and <bpt id=\"p2\">*</bpt><ph id=\"ph4\">&amp;lt;</ph>policy<ph id=\"ph5\">\\_</ph>number<ph id=\"ph6\">&amp;gt;</ph><ept id=\"p2\">*</ept> is the SAN policy number."},{"pos":[2145,2200],"content":"These values are valid <bpt id=\"p1\">*</bpt><ph id=\"ph1\">&amp;lt;</ph>policy<ph id=\"ph2\">\\_</ph>number<ph id=\"ph3\">&amp;gt;</ph><ept id=\"p1\">*</ept> values:"},{"pos":[2206,3174],"content":"<table>\n<colgroup>\n<col width=\"50%\" />\n<col width=\"50%\" />\n</colgroup>\n<thead>\n<tr class=\"header\">\n<th align=\"left\">SAN policy number</th>\n<th align=\"left\">Description</th>\n</tr>\n</thead>\n<tbody>\n<tr class=\"odd\">\n<td align=\"left\"><p>1</p></td>\n<td align=\"left\"><p>Mounts all available storage devices.</p>\n<p>This is the default value.</p></td>\n</tr>\n<tr class=\"even\">\n<td align=\"left\"><p>2</p></td>\n<td align=\"left\"><p>Mounts all storage devices except those on a shared bus.</p></td>\n</tr>\n<tr class=\"odd\">\n<td align=\"left\"><p>3</p></td>\n<td align=\"left\"><p>Doesn't mount storage devices.</p></td>\n</tr>\n<tr class=\"even\">\n<td align=\"left\"><p>4</p></td>\n<td align=\"left\"><p>New for Windows 8. Makes internal disks offline.</p>\n<div class=\"alert\">\n<strong>Note</strong>  \n<p>All external disks and the boot disk are online.</p>\n</div>\n<div>","leadings":["","    ","    ","    ","    ","    ","    ","    ","    ","    ","    ","    ","    ","    ","    ","    ","    ","    ","    ","    ","    ","    ","    ","    ","    ","    ","    ","    ","    ","    ","    ","    ","    "],"nodes":[{"content":"SAN policy number","pos":[116,133]},{"content":"Description","pos":[156,167]},{"content":"1","pos":[233,234]},{"content":"Mounts all available storage devices.","pos":[264,301]},{"content":"This is the default value.","pos":[309,335]},{"content":"2","pos":[389,390]},{"content":"Mounts all storage devices except those on a shared bus.","pos":[420,476]},{"content":"3","pos":[529,530]},{"content":"Doesn't mount storage devices.","pos":[560,590]},{"content":"4","pos":[644,645]},{"content":"New for Windows 8. Makes internal disks offline.","pos":[675,723],"nodes":[{"content":"New for Windows 8.","pos":[0,18]},{"content":"Makes internal disks offline.","pos":[19,48]}]},{"content":"Note","pos":[756,760]},{"content":"All external disks and the boot disk are online.","pos":[775,823]}]},{"pos":[3185,3232],"content":"</div></td>\n</tr>\n</tbody>\n</table>","leadings":["","    ","    ","    "],"nodes":[]},{"content":"This example shows how to configure the SAN policy on a Windows PE image to mount all disks except those disks on a shared bus:","pos":[3238,3365]},{"pos":[3416,3519],"content":"where <bpt id=\"p1\">*</bpt><ph id=\"ph1\">&amp;lt;</ph>2<ph id=\"ph2\">&amp;gt;</ph><ept id=\"p1\">*</ept> is the SAN policy number that mounts all storage device except those on a shared bus."},{"content":"Unmount the image and commit the changes.","pos":[3525,3566]},{"content":"For example:","pos":[3567,3579]},{"pos":[3861,3906],"content":"Configuring the SAN Policy on a Windows Image"},{"content":"You can change the default SAN policy of a Windows image by using Windows System Image Manager (Windows SIM) to customize the Microsoft-Windows-PartitionManager component.","pos":[3909,4080]},{"content":"You use the <ph id=\"ph1\">`SanPolicy`</ph> setting to configure the Windows image during an unattended installation.","pos":[4081,4178]},{"content":"To configure the SAN policy by using an answer file","pos":[4182,4233]},{"content":"On your technician computer, open Windows System Image Manager (Windows SIM).","pos":[4241,4318]},{"content":"Click <bpt id=\"p1\">**</bpt>Start<ept id=\"p1\">**</ept>, type <bpt id=\"p2\">**</bpt>Windows System Image Manager<ept id=\"p2\">**</ept>, and then select <bpt id=\"p3\">**</bpt>Windows System Image Manager<ept id=\"p3\">**</ept>.","pos":[4319,4424]},{"content":"Create a new answer file, or update an existing answer file.","pos":[4430,4490]},{"content":"For more information, see <bpt id=\"p1\">[</bpt>Create or Open an Answer File<ept id=\"p1\">](https://msdn.microsoft.com/library/windows/hardware/dn915085)</ept> and <bpt id=\"p2\">[</bpt>Best Practices for Authoring Answer Files<ept id=\"p2\">](https://msdn.microsoft.com/library/windows/hardware/dn915073)</ept>.","pos":[4491,4721]},{"pos":[4727,4776],"content":"On the <bpt id=\"p1\">**</bpt>Insert<ept id=\"p1\">**</ept> menu, click <bpt id=\"p2\">**</bpt>RunSynchronous<ept id=\"p2\">**</ept>."},{"content":"Select the configuration pass where you want to install the command.","pos":[4782,4850]},{"content":"This can be the <bpt id=\"p1\">[</bpt>auditUser<ept id=\"p1\">](audituser.md)</ept> or <bpt id=\"p2\">[</bpt>oobeSystem<ept id=\"p2\">](oobesystem.md)</ept> configuration pass.","pos":[4851,4943]},{"pos":[4949,5080],"content":"**Note**  \nDon't use the **RunSynchronousNetsh advfirewall** command during the [specialize](specialize.md) configuration pass.","leadings":["","    "],"nodes":[{"content":"Note","pos":[2,6]},{"content":"Don't use the <bpt id=\"p1\">**</bpt>RunSynchronousNetsh advfirewall<ept id=\"p1\">**</ept> command during the <bpt id=\"p2\">[</bpt>specialize<ept id=\"p2\">](specialize.md)</ept> configuration pass.","pos":[11,127]}]},{"pos":[5086,5140],"content":"The <bpt id=\"p1\">**</bpt>Create Synchronous Command<ept id=\"p1\">**</ept> dialog box appears."},{"pos":[5146,5250],"content":"Enter the <bpt id=\"p1\">**</bpt>Netsh advfirewall firewall<ept id=\"p1\">**</ept> commands to add them to the answer file, and then click <bpt id=\"p2\">**</bpt>OK<ept id=\"p2\">**</ept>."},{"content":"For more information, see the <bpt id=\"p1\">[</bpt>Network Shell (Netsh) Technical Reference<ept id=\"p1\">](http://go.microsoft.com/fwlink/?LinkId=234733)</ept>.","pos":[5256,5377]},{"content":"You can convert <bpt id=\"p1\">**</bpt>Netsh<ept id=\"p1\">**</ept> commands to Windows PowerShell® commands.","pos":[5378,5445]},{"content":"For more information, see the <bpt id=\"p1\">[</bpt>Netshell to Powershell Conversion Guide<ept id=\"p1\">](http://go.microsoft.com/fwlink/?LinkId=234734)</ept>.","pos":[5446,5565]},{"pos":[5571,5725],"content":"In the <bpt id=\"p1\">**</bpt>SynchronousCommand Properties<ept id=\"p1\">**</ept> pane, in the <bpt id=\"p2\">**</bpt>Settings<ept id=\"p2\">**</ept> section next to <bpt id=\"p3\">**</bpt>Description<ept id=\"p3\">**</ept>, enter a description like <bpt id=\"p4\">**</bpt>Enable Windows Messenger<ept id=\"p4\">**</ept>."},{"pos":[5763,5777],"content":"Related topics"},{"content":"WinPE for Windows 10","pos":[5781,5801]},{"content":"WinPE: Mount and Customize","pos":[5821,5847]},{"content":"WinPE Network Drivers: Initializing and adding drivers","pos":[5881,5935]},{"content":"DISM Image Management Command-Line Options","pos":[5997,6039]},{"content":"Configure Network Settings in an Unattended Installation","pos":[6094,6150]},{"content":"Windows Deployment Options","pos":[6215,6241]}],"content":"---\nauthor: Justinha\nDescription: 'WinPE: Storage Area Network (SAN) Policy'\nms.assetid: fb9b42b2-432e-4c88-9973-4d9d832645df\nMSHAttr: 'PreferredLib:/library/windows/hardware'\ntitle: 'WinPE: Storage Area Network (SAN) Policy'\n---\n\n# WinPE: Storage Area Network (SAN) Policy\n\n\nStorage area network (SAN) functionality enables a computer to mount disks and other storage devices automatically from other computers. By configuring the SAN policy on a Windows Preinstallation Environment (Windows PE) image, you can control whether or not disks are automatically mounted and which disks can be mounted. You can also disable the policy to automatically mount disks.\n\n## <span id=\"Configuring_the_SAN_policy_on_a_Windows_PE_image\"></span><span id=\"configuring_the_san_policy_on_a_windows_pe_image\"></span><span id=\"CONFIGURING_THE_SAN_POLICY_ON_A_WINDOWS_PE_IMAGE\"></span>Configuring the SAN policy on a Windows PE image\n\n\nFor Windows PE images that are available in the Windows Assessment and Deployment Kit (Windows ADK), the default SAN policy is to mount available disks automatically. But if the SAN environment has many available disks, automatically mounting them might reduce the performance of Windows PE. The container ID determines the external and internal disk status. If the device container ID of a disk is the same as the root container ID, the disk is internal. Otherwise, it's an external disk. You can use the Setsanpolicy.cmd file in the Windows PE tools path to configure the SAN policy on a Windows PE image.\n\n**To configure the SAN policy on a Windows PE image**\n\n1.  Mount the Windows PE image to an available mount point. For example:\n\n    ``` syntax\n    Dism /mount-image /imagefile:C:\\winpe_x86\\ISO\\sources\\boot.wim /index:<image_index> /mountdir:C:\\winpe_x86\\mount\n    ```\n\n    where *&lt;image\\_index&gt;* is the number of the selected image in the .wim file.\n\n2.  Run the **setsanpolicy** command. For example:\n\n    ``` syntax\n    Setsanpolicy.cmd <image_path> <policy_number>\n    ```\n\n    where *&lt;image\\_path&gt;* is the path of a mounted Windows PE image, and *&lt;policy\\_number&gt;* is the SAN policy number.\n\n    These values are valid *&lt;policy\\_number&gt;* values:\n\n    <table>\n    <colgroup>\n    <col width=\"50%\" />\n    <col width=\"50%\" />\n    </colgroup>\n    <thead>\n    <tr class=\"header\">\n    <th align=\"left\">SAN policy number</th>\n    <th align=\"left\">Description</th>\n    </tr>\n    </thead>\n    <tbody>\n    <tr class=\"odd\">\n    <td align=\"left\"><p>1</p></td>\n    <td align=\"left\"><p>Mounts all available storage devices.</p>\n    <p>This is the default value.</p></td>\n    </tr>\n    <tr class=\"even\">\n    <td align=\"left\"><p>2</p></td>\n    <td align=\"left\"><p>Mounts all storage devices except those on a shared bus.</p></td>\n    </tr>\n    <tr class=\"odd\">\n    <td align=\"left\"><p>3</p></td>\n    <td align=\"left\"><p>Doesn't mount storage devices.</p></td>\n    </tr>\n    <tr class=\"even\">\n    <td align=\"left\"><p>4</p></td>\n    <td align=\"left\"><p>New for Windows 8. Makes internal disks offline.</p>\n    <div class=\"alert\">\n    <strong>Note</strong>  \n    <p>All external disks and the boot disk are online.</p>\n    </div>\n    <div>\n     \n    </div></td>\n    </tr>\n    </tbody>\n    </table>\n\n    This example shows how to configure the SAN policy on a Windows PE image to mount all disks except those disks on a shared bus:\n\n        Setsanpolicy C:\\winpe_x86\\mount <2>\n\n    where *&lt;2&gt;* is the SAN policy number that mounts all storage device except those on a shared bus.\n\n3.  Unmount the image and commit the changes. For example:\n\n    ``` syntax\n    Dism /unmount-image /mountdir:C:\\winpe_x86\\mount /commit\n    ```\n\n## <span id=\"Configuring_the_SAN_Policy_on_a_Windows_Image\"></span><span id=\"configuring_the_san_policy_on_a_windows_image\"></span><span id=\"CONFIGURING_THE_SAN_POLICY_ON_A_WINDOWS_IMAGE\"></span>Configuring the SAN Policy on a Windows Image\n\n\nYou can change the default SAN policy of a Windows image by using Windows System Image Manager (Windows SIM) to customize the Microsoft-Windows-PartitionManager component. You use the `SanPolicy` setting to configure the Windows image during an unattended installation.\n\n**To configure the SAN policy by using an answer file**\n\n1.  On your technician computer, open Windows System Image Manager (Windows SIM). Click **Start**, type **Windows System Image Manager**, and then select **Windows System Image Manager**.\n\n2.  Create a new answer file, or update an existing answer file. For more information, see [Create or Open an Answer File](https://msdn.microsoft.com/library/windows/hardware/dn915085) and [Best Practices for Authoring Answer Files](https://msdn.microsoft.com/library/windows/hardware/dn915073).\n\n3.  On the **Insert** menu, click **RunSynchronous**.\n\n4.  Select the configuration pass where you want to install the command. This can be the [auditUser](audituser.md) or [oobeSystem](oobesystem.md) configuration pass.\n\n    **Note**  \n    Don't use the **RunSynchronousNetsh advfirewall** command during the [specialize](specialize.md) configuration pass.\n\n    The **Create Synchronous Command** dialog box appears.\n\n5.  Enter the **Netsh advfirewall firewall** commands to add them to the answer file, and then click **OK**.\n\n    For more information, see the [Network Shell (Netsh) Technical Reference](http://go.microsoft.com/fwlink/?LinkId=234733). You can convert **Netsh** commands to Windows PowerShell® commands. For more information, see the [Netshell to Powershell Conversion Guide](http://go.microsoft.com/fwlink/?LinkId=234734).\n\n6.  In the **SynchronousCommand Properties** pane, in the **Settings** section next to **Description**, enter a description like **Enable Windows Messenger**.\n\n## <span id=\"related_topics\"></span>Related topics\n\n\n[WinPE for Windows 10](winpe-intro.md)\n\n[WinPE: Mount and Customize](winpe-mount-and-customize.md)\n\n[WinPE Network Drivers: Initializing and adding drivers](winpe-network-drivers-initializing-and-adding-drivers.md)\n\n[DISM Image Management Command-Line Options](dism-image-management-command-line-options-s14.md)\n\n[Configure Network Settings in an Unattended Installation](configure-network-settings-in-an-unattended-installation.md)\n\n[Windows Deployment Options](windows-deployment-options.md)\n\n \n\n \n\n\n\n\n\n\n"}