{"nodes":[{"content":"WinPE: Debug Apps","pos":[35,52]},{"content":"WinPE: Debug Apps","pos":[161,178]},{"content":"WinPE: Debug Apps","pos":[187,204]},{"content":"You can use Windows Debuggers, such as Ntsd.exe, Cdb.exe, and Windbg.exe, and supporting tools to debug applications on Windows PE and to debug the Windows PE kernel.","pos":[207,373]},{"content":"Debugging tools are included in the <bpt id=\"p1\">[</bpt>Windows 10 SDK<ept id=\"p1\">]( http://go.microsoft.com/fwlink/?LinkId=526807)</ept>.","pos":[374,475]},{"content":"You must make the debugging tools available on the Windows PE computer by either copying them locally or using them from a share.","pos":[476,605]},{"content":"To debug Windows PE remotely, you may need to turn off the built-in firewall on the PC:","pos":[607,694]},{"pos":[853,872],"content":"User-mode debugging"},{"content":"The easiest user-mode debugging method is to run a process server on the Windows PE computer, and connect to it by using a debugger on another computer.","pos":[875,1027]},{"content":"The process server is included with the debugging tools in the <bpt id=\"p1\">[</bpt>Windows 10 SDK<ept id=\"p1\">]( http://go.microsoft.com/fwlink/?LinkId=526807)</ept>.","pos":[1028,1156]},{"content":"To run a process server in user-mode","pos":[1160,1196]},{"pos":[1204,1464],"content":"Copy the Windows Debugging Process Server tool: <bpt id=\"p1\">**</bpt>dbgsrv.exe<ept id=\"p1\">**</ept>, from the <bpt id=\"p2\">[</bpt>Windows 10 SDK<ept id=\"p2\">]( http://go.microsoft.com/fwlink/?LinkId=526807)</ept> debugging tools folder (example: C:<ph id=\"ph1\">\\\\</ph>Program Files (x86)<ph id=\"ph2\">\\\\</ph>Windows Kits<ph id=\"ph3\">\\\\</ph>10.0<ph id=\"ph4\">\\\\</ph>Debuggers<ph id=\"ph5\">\\\\</ph>x64), to the Windows PE computer."},{"content":"At the Windows PE command prompt, disable the firewall.","pos":[1470,1525]},{"content":"Start the Windows Debugging Process Server, specifying a connection method to the PC, for example, a TCP port:","pos":[1583,1693]},{"pos":[1755,1881],"content":"For more information, see <bpt id=\"p1\">[</bpt>Activating a Process Server (Windows Debuggers)<ept id=\"p1\">]( http://go.microsoft.com/fwlink/p/?LinkId=698645)</ept>."},{"content":"From the remote computer, use the process server to attach to or start processes on the Windows PE destination computer:","pos":[1887,2007]},{"pos":[2086,2209],"content":"For more information, see <bpt id=\"p1\">[</bpt>Activating a Smart Client (Windows Debuggers)<ept id=\"p1\">](http://go.microsoft.com/fwlink/p/?LinkId=698646)</ept>."},{"content":"It is also possible to run the debugger directly on the Windows PE computer.","pos":[2211,2287]},{"content":"However, doing so requires setting up symbol and source paths after every reboot of the Windows PE computer.","pos":[2288,2396]},{"content":"We recommend that you perform debugging from a computer running a full version of Windows, as described in this procedure.","pos":[2397,2519]},{"content":"The following debugging procedure is useful when you want to bypass startnet.cmd or setup.exe, and proceed directly to a command prompt for debugging purposes.","pos":[2521,2680]},{"content":"This procedure bypasses all initialization, including setup, and runs no commands, such as Wpeinit.exe.","pos":[2681,2784]},{"content":"This procedure must be performed online on an online operating system.","pos":[2785,2855]},{"content":"To enable user-mode debugging prior to any initialization","pos":[2859,2916]},{"content":"Delete the winpeshl.ini file, if it exists.","pos":[2924,2967]},{"content":"If the winpeshl.ini file does not exist, then user-mode debugging can be accessed by default.","pos":[2968,3061]},{"content":"Hold down the Ctrl key during boot before the command prompt is shown.","pos":[3067,3137]},{"content":"A command prompt appears.","pos":[3138,3163]},{"content":"Proceed with debugging.","pos":[3169,3192]},{"pos":[3317,3338],"content":"Kernel-mode debugging"},{"content":"To debug in kernel-mode, you must enable kernel-mode debugging before the system is booted.","pos":[3341,3432]},{"content":"The boot configuration file has a setting for kernel mode debugging, which is enabled by using the bcdedit.exe command-line tool to modify the Boot Configuration Data (BCD) store.","pos":[3433,3612]},{"content":"Kernel debugging can only be performed by using bcdedit.exe.","pos":[3613,3673]},{"content":"Bcdedit.exe is located in the <ph id=\"ph1\">\\\\</ph>Windows<ph id=\"ph2\">\\\\</ph>System32 directory of the Windows partition.","pos":[3674,3759]},{"content":"The default debugger settings are as follows:","pos":[3761,3806]},{"content":"For creating ISOs for VM environments, enable the kernel with BCD entries before creating the ISO.","pos":[3972,4070]},{"pos":[4072,4242],"content":"For information about how to modify the default BCD store (default.bcd), see <bpt id=\"p1\">[</bpt>How to Modify the BCD Store Using Bcdedit<ept id=\"p1\">](http://go.microsoft.com/fwlink/p/?LinkId=698647)</ept>."},{"content":"To enable kernel-mode debugging","pos":[4246,4277]},{"content":"Locate the BCD store, which is contained in a file named <bpt id=\"p1\">**</bpt>bcd<ept id=\"p1\">**</ept>.","pos":[4285,4350]},{"content":"This file is located within the boot directory in the root of the media containing the Windows PE image.","pos":[4351,4455]},{"pos":[4461,4595],"content":"At the command prompt, type the following bcdedit command to set the debug flag of the BCD store used to boot the image to <ph id=\"ph1\">`debug on`</ph>:"},{"pos":[4693,4800],"content":"The <ph id=\"ph1\">`{default}`</ph> might need to be replaced by the unique identifier (UID) of the boot option for Windows PE."},{"content":"Alternatively, you can also enable kernel debugging by pressing F8 during boot and selecting the debug option.","pos":[4806,4916]},{"pos":[4922,5050],"content":"**Note**  \nTo use a symbol server from within Windows PE, use the `net use` command on the server’s symbols and file shares.","leadings":["","    "],"nodes":[{"content":"Note","pos":[2,6]},{"content":"To use a symbol server from within Windows PE, use the <ph id=\"ph1\">`net use`</ph> command on the server’s symbols and file shares.","pos":[11,124]}]},{"pos":[5059,5215],"content":"For more information about command-line options that control debugging, see <bpt id=\"p1\">[</bpt>BCDEdit Command-Line Options<ept id=\"p1\">](http://go.microsoft.com/fwlink/p/?LinkId=526808)</ept>."},{"pos":[5253,5267],"content":"Related topics"},{"content":"WinPE for Windows 10","pos":[5271,5291]},{"content":"WinPE: Mount and Customize","pos":[5311,5337]},{"content":"Wpeutil Command-Line Options","pos":[5371,5399]},{"content":"Winpeshl.ini Reference: Launching an app when WinPE starts","pos":[5436,5494]},{"content":"BCDEdit Command-Line Options","pos":[5559,5587]}],"content":"---\nauthor: Justinha\nDescription: 'WinPE: Debug Apps'\nms.assetid: 30fe59bc-f169-4534-b5a5-dbe58a10cb83\nMSHAttr: 'PreferredLib:/library/windows/hardware'\ntitle: 'WinPE: Debug Apps'\n---\n\n# WinPE: Debug Apps\n\n\nYou can use Windows Debuggers, such as Ntsd.exe, Cdb.exe, and Windbg.exe, and supporting tools to debug applications on Windows PE and to debug the Windows PE kernel. Debugging tools are included in the [Windows 10 SDK]( http://go.microsoft.com/fwlink/?LinkId=526807). You must make the debugging tools available on the Windows PE computer by either copying them locally or using them from a share.\n\nTo debug Windows PE remotely, you may need to turn off the built-in firewall on the PC:\n\n``` syntax\nwpeutil disablefirewall\n```\n\n## <span id=\"User-mode_debugging\"></span><span id=\"user-mode_debugging\"></span><span id=\"USER-MODE_DEBUGGING\"></span>User-mode debugging\n\n\nThe easiest user-mode debugging method is to run a process server on the Windows PE computer, and connect to it by using a debugger on another computer. The process server is included with the debugging tools in the [Windows 10 SDK]( http://go.microsoft.com/fwlink/?LinkId=526807).\n\n**To run a process server in user-mode**\n\n1.  Copy the Windows Debugging Process Server tool: **dbgsrv.exe**, from the [Windows 10 SDK]( http://go.microsoft.com/fwlink/?LinkId=526807) debugging tools folder (example: C:\\\\Program Files (x86)\\\\Windows Kits\\\\10.0\\\\Debuggers\\\\x64), to the Windows PE computer.\n\n2.  At the Windows PE command prompt, disable the firewall.\n\n    ``` syntax\n    wpeutil disablefirewall\n    ```\n\n3.  Start the Windows Debugging Process Server, specifying a connection method to the PC, for example, a TCP port:\n\n    ``` syntax\n    dbgsrv.exe –t tcp:port=1234\n    ```\n\n    For more information, see [Activating a Process Server (Windows Debuggers)]( http://go.microsoft.com/fwlink/p/?LinkId=698645).\n\n4.  From the remote computer, use the process server to attach to or start processes on the Windows PE destination computer:\n\n    ``` syntax\n    windbg -premote tcp:server=Server, port=1234\n    ```\n\n    For more information, see [Activating a Smart Client (Windows Debuggers)](http://go.microsoft.com/fwlink/p/?LinkId=698646).\n\nIt is also possible to run the debugger directly on the Windows PE computer. However, doing so requires setting up symbol and source paths after every reboot of the Windows PE computer. We recommend that you perform debugging from a computer running a full version of Windows, as described in this procedure.\n\nThe following debugging procedure is useful when you want to bypass startnet.cmd or setup.exe, and proceed directly to a command prompt for debugging purposes. This procedure bypasses all initialization, including setup, and runs no commands, such as Wpeinit.exe. This procedure must be performed online on an online operating system.\n\n**To enable user-mode debugging prior to any initialization**\n\n1.  Delete the winpeshl.ini file, if it exists. If the winpeshl.ini file does not exist, then user-mode debugging can be accessed by default.\n\n2.  Hold down the Ctrl key during boot before the command prompt is shown. A command prompt appears.\n\n3.  Proceed with debugging.\n\n## <span id=\"Kernel-mode_debugging\"></span><span id=\"kernel-mode_debugging\"></span><span id=\"KERNEL-MODE_DEBUGGING\"></span>Kernel-mode debugging\n\n\nTo debug in kernel-mode, you must enable kernel-mode debugging before the system is booted. The boot configuration file has a setting for kernel mode debugging, which is enabled by using the bcdedit.exe command-line tool to modify the Boot Configuration Data (BCD) store. Kernel debugging can only be performed by using bcdedit.exe. Bcdedit.exe is located in the \\\\Windows\\\\System32 directory of the Windows partition.\n\nThe default debugger settings are as follows:\n\n``` syntax\n----------------- \nidentifier              {dbgsettings} \ndebugtype               Serial \ndebugport               1 \nbaudrate                115200\n```\n\nFor creating ISOs for VM environments, enable the kernel with BCD entries before creating the ISO.\n\nFor information about how to modify the default BCD store (default.bcd), see [How to Modify the BCD Store Using Bcdedit](http://go.microsoft.com/fwlink/p/?LinkId=698647).\n\n**To enable kernel-mode debugging**\n\n1.  Locate the BCD store, which is contained in a file named **bcd**. This file is located within the boot directory in the root of the media containing the Windows PE image.\n\n2.  At the command prompt, type the following bcdedit command to set the debug flag of the BCD store used to boot the image to `debug on`:\n\n    ``` syntax\n    bcdedit /store <path to winpe>/boot/bcd /set {default} debug on\n    ```\n\n    The `{default}` might need to be replaced by the unique identifier (UID) of the boot option for Windows PE.\n\n    Alternatively, you can also enable kernel debugging by pressing F8 during boot and selecting the debug option.\n\n    **Note**  \n    To use a symbol server from within Windows PE, use the `net use` command on the server’s symbols and file shares.\n\n     \n\nFor more information about command-line options that control debugging, see [BCDEdit Command-Line Options](http://go.microsoft.com/fwlink/p/?LinkId=526808).\n\n## <span id=\"related_topics\"></span>Related topics\n\n\n[WinPE for Windows 10](winpe-intro.md)\n\n[WinPE: Mount and Customize](winpe-mount-and-customize.md)\n\n[Wpeutil Command-Line Options](wpeutil-command-line-options.md)\n\n[Winpeshl.ini Reference: Launching an app when WinPE starts](winpeshlini-reference-launching-an-app-when-winpe-starts.md)\n\n[BCDEdit Command-Line Options](http://go.microsoft.com/fwlink/p/?LinkId=526808)\n\n \n\n \n\n\n\n\n\n\n"}