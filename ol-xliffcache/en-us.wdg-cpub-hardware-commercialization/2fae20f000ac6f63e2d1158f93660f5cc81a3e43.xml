{"nodes":[{"content":"Deployment Image Servicing and Management (DISM) Best Practices","pos":[35,98]},{"content":"Deployment Image Servicing and Management (DISM) Best Practices","pos":[207,270]},{"content":"Deployment Image Servicing and Management (DISM) Best Practices","pos":[279,342]},{"content":"This section describes some best practices related to servicing a Windows® image.","pos":[345,426]},{"content":"We recommend that you implement these practices wherever possible.","pos":[427,493]},{"content":"In this topic:","pos":[495,509]},{"content":"Elevate Permissions for Command-Line Tools","pos":[512,554]},{"content":"Disable Antivirus Tools","pos":[573,596]},{"content":"Servicing an Image","pos":[610,628]},{"content":"Changing International Settings","pos":[649,680]},{"content":"Use Log Files","pos":[696,709]},{"content":"Package Locations","pos":[724,741]},{"content":"Storing Files on a Network Share","pos":[756,788]},{"content":"Servicing a Windows Image from Windows PE","pos":[803,844]},{"content":"Scan for Corruption and Verify the Integrity of System Files","pos":[858,918]},{"content":"Improving Security for Windows Images","pos":[936,973]},{"pos":[1083,1125],"content":"Elevate Permissions for Command-Line Tools"},{"content":"Many deployment command-line tools, including Deployment Image Servicing and Management (DISM), require elevated permissions.","pos":[1128,1253]},{"content":"Make sure that you have elevated permissions.","pos":[1255,1300]},{"content":"Click <bpt id=\"p1\">**</bpt>Start<ept id=\"p1\">**</ept>, and type <bpt id=\"p2\">**</bpt>deployment<ept id=\"p2\">**</ept>.","pos":[1301,1342]},{"content":"Right-click <bpt id=\"p1\">**</bpt>Deployment and Imaging Tools Environment<ept id=\"p1\">**</ept> and then select <bpt id=\"p2\">**</bpt>Run as administrator<ept id=\"p2\">**</ept>.","pos":[1343,1441]},{"content":"This must be done even if you are logged on as an administrator.","pos":[1443,1507]},{"pos":[1590,1613],"content":"Disable Antivirus Tools"},{"content":"Some DISM commands may be blocked by antivirus or antimalware tools.","pos":[1616,1684]},{"content":"Before servicing an image, disable antivirus or antimalware tools on the technician computer.","pos":[1685,1778]},{"pos":[1882,1900],"content":"Servicing an Image"},{"content":"The best way to service a Windows image is offline with the DISM tool.","pos":[1903,1973]},{"content":"DISM can be used to install, uninstall, configure, and update drivers, features, and packages in Windows images and Windows Preinstallation Environment (WinPE) images without booting the image.","pos":[1974,2167]},{"content":"For more information, see <bpt id=\"p1\">[</bpt>DISM - Deployment Image Servicing and Management Technical Reference for Windows<ept id=\"p1\">](dism---deployment-image-servicing-and-management-technical-reference-for-windows.md)</ept>.","pos":[2168,2362]},{"content":"You can use the <bpt id=\"p1\">**</bpt>/Commit-Image<ept id=\"p1\">**</ept> option at any point during servicing to save the changes that you have made so far.","pos":[2364,2481]},{"content":"You can recover a corrupted image more easily with the <bpt id=\"p1\">**</bpt>/Cleanup-Image /RestoreHealth<ept id=\"p1\">**</ept> option if you have committed your changes often.","pos":[2482,2619]},{"content":"You can mount and modify multiple images on a single computer.","pos":[2621,2683]},{"content":"However, performance may slow down on some functions, such as <bpt id=\"p1\">**</bpt>/Unmount-Image<ept id=\"p1\">**</ept>, depending on the memory available on the computer.","pos":[2684,2816]},{"content":"As a best practice, you should not mount more than 20 images at the same time.","pos":[2817,2895]},{"content":"Note","pos":[2899,2903]},{"content":"If you have split a .wim file into smaller files for spanning across multiple media, you cannot mount the image for servicing.","pos":[2908,3034]},{"pos":[3126,3157],"content":"Changing International Settings"},{"content":"To change the international settings in Windows 10, Windows 8.1, Windows 8, Windows Server 2016 Technical Preview, Windows Server 2012 R2, Windows Server 2012, Windows 7, and Windows Server 2008 R2 images, you must use DISM.","pos":[3160,3384]},{"content":"For more information, see <bpt id=\"p1\">[</bpt>DISM Languages and International Servicing Command-Line Options<ept id=\"p1\">](dism-languages-and-international-servicing-command-line-options.md)</ept>.","pos":[3385,3545]},{"pos":[3631,3644],"content":"Use Log Files"},{"content":"DISM will log verbose information to %WINDIR%<ph id=\"ph1\">\\\\</ph>Logs<ph id=\"ph2\">\\\\</ph>Dism<ph id=\"ph3\">\\\\</ph>Dism.log by default.","pos":[3647,3726]},{"content":"You can also specify a name and location of your choice for the log file, and set the <bpt id=\"p1\">**</bpt>/loglevel<ept id=\"p1\">**</ept> parameters so that only the information you are interested in is logged.","pos":[3727,3899]},{"content":"When an error occurs, the console will display the error code, error message, and the location of the log file.","pos":[3900,4011]},{"content":"Important","pos":[4015,4024]},{"content":"If you specify a log path on a network share from a computer that is not joined to a domain, use net-use with domain credentials to set access permissions before you set the log path for the DISM log.","pos":[4029,4229]},{"content":"The log file will automatically be archived.","pos":[4234,4278]},{"content":"The archived log file will be saved with .bak appended to the file name, and a new log file will be generated.","pos":[4279,4389]},{"content":"Each time the log file is archived, the .bak file will be overwritten.","pos":[4390,4460]},{"content":"The log file gives you the history of the operations that have been performed, which can help you troubleshoot problems.","pos":[4462,4582]},{"pos":[4668,4685],"content":"Package Locations"},{"content":"Do not put a package that you intend to install directly at the root of a partition on a Windows installation.","pos":[4688,4798]},{"pos":[4884,4916],"content":"Storing Files on a Network Share"},{"content":"Although DISM supports network paths for images and packages, most operations will perform faster on files that are copied to the local hard-drive.","pos":[4919,5066]},{"pos":[5123,5159],"content":"Servicing a Windows Image from WinPE"},{"content":"You can service Windows images from WinPE.","pos":[5162,5204]},{"content":"However, you must consider certain factors while planning your servicing strategy.","pos":[5205,5287]},{"content":"Review the following requirements for servicing an image from WinPE.","pos":[5288,5356]},{"pos":[5512,5543],"content":"Booting WinPE from a Hard Drive"},{"content":"For better performance, you can allocate additional memory when you boot WinPE from a hard disk drive.","pos":[5545,5647]},{"content":"You can also create temporary folders to store update files to accommodate large updates.","pos":[5648,5737]},{"pos":[5923,5964],"content":"Add Page-File Support to Your WinPE Image"},{"content":"Make sure you have sufficient memory to load and run your custom WinPE image.","pos":[5966,6043]},{"content":"In addition to the image size, you should have at least 256 MB of available working memory.","pos":[6044,6135]},{"content":"If you have limited memory, define a page file (Pagefile.sys) to improve memory management.","pos":[6136,6227]},{"content":"For more information on implementing a page file, see <bpt id=\"p1\">[</bpt>Wpeutil Command-Line Options<ept id=\"p1\">](wpeutil-command-line-options.md)</ept>.","pos":[6228,6346]},{"pos":[6586,6645],"content":"Create a Temporary Directory in Which to Store Update Files"},{"content":"You should use the <bpt id=\"p1\">**</bpt>/ScratchDir<ept id=\"p1\">**</ept> option with DISM to create a temporary directory on a different drive when you create or service a Windows image.","pos":[6647,6795]},{"content":"A temporary directory is used for many DISM operations including capturing an image, installing language packs, installing updates, or installing or removing Windows features in a Windows image.","pos":[6796,6990]},{"content":"Some files are expanded to this temporary directory before they are applied to a Windows image.","pos":[6991,7086]},{"content":"There must be sufficient space in the partition to accommodate large updates.","pos":[7088,7165]},{"content":"The specific size of the free space that is required depends on the size of the updates that you intend to install.","pos":[7166,7281]},{"content":"When adding a language pack, the scratch directory must have at least 1 GB of space for temporary files.","pos":[7282,7386]},{"content":"If you do not set a temporary directory path using the <bpt id=\"p1\">**</bpt>/ScratchDir<ept id=\"p1\">**</ept> option, WinPE creates a 32-MB temporary directory by default.","pos":[7388,7520]},{"content":"You can allocate additional temporary storage to this default location using the DISM <bpt id=\"p1\">**</bpt>/Set-ScratchSpace<ept id=\"p1\">**</ept> option.","pos":[7521,7636]},{"content":"Valid sizes include 32, 64, 128, 256, and 512 MB.","pos":[7637,7686]},{"content":"This feature is available only offline and you cannot adjust this setting while a WinPE session is running.","pos":[7687,7794]},{"content":"As a best practice, you should use the <bpt id=\"p1\">**</bpt>/ScratchDir<ept id=\"p1\">**</ept> option to instead specify a directory on another partition that has sufficient space to support any image management and servicing operations you perform.","pos":[7795,8004]},{"content":"After installation is complete, the contents of this directory are no longer needed and can be deleted.","pos":[8006,8109]},{"content":"For more information, see <bpt id=\"p1\">[</bpt>DISM Image Management Command-Line Options<ept id=\"p1\">](dism-image-management-command-line-options-s14.md)</ept>.","pos":[8110,8232]},{"pos":[8388,8419],"content":"Booting WinPE from a CD-ROM/DVD"},{"content":"Servicing a Windows image requires additional temporary storage space.","pos":[8421,8491]},{"content":"For WinPE RAM disks, you might need additional RAM.","pos":[8492,8543]},{"content":"In addition to the RAM requirements of your WinPE image, additional RAM is required to process updates.","pos":[8544,8647]},{"content":"The amount of RAM that is required depends on the size of the updates that you intend to apply.","pos":[8648,8743]},{"content":"Ensure that your computer has sufficient RAM.","pos":[8744,8789]},{"pos":[8884,8944],"content":"Scan for Corruption and Verify the Integrity of System Files"},{"content":"Before you deliver a computer to an end user, you should verify the integrity of Windows system files.","pos":[8947,9049]},{"content":"You can use the <bpt id=\"p1\">**</bpt>/Cleanup-Image<ept id=\"p1\">**</ept> option to identify file corruption and perform repair operations on the image.","pos":[9050,9163]},{"content":"For more information about the <bpt id=\"p1\">**</bpt>/Cleanup-Image<ept id=\"p1\">**</ept> option in DISM, see <bpt id=\"p2\">[</bpt>DISM Operating System Package Servicing Command-Line Options<ept id=\"p2\">](dism-operating-system-package-servicing-command-line-options.md)</ept>.","pos":[9164,9362]},{"content":"You can also use System File Checker (Sfc.exe) on an online or offline reference image.","pos":[9364,9451]},{"content":"System File Checker is released with all versions of Windows.System File Checker requires elevated permissions, and you must be an Administrator to run it.","pos":[9452,9607]},{"content":"It scans all protected files to verify the file versions.","pos":[9608,9665]},{"content":"To verify only the integrity of the Windows system files, run the <bpt id=\"p1\">**</bpt>sfc.exe /verifyonly<ept id=\"p1\">**</ept> option.","pos":[9666,9763]},{"content":"For complete command-line syntax, at an elevated command prompt, type <bpt id=\"p1\">**</bpt>sfc.exe /?<ept id=\"p1\">**</ept>.","pos":[9764,9849]},{"content":"Running Sfc.exe can take a significant amount of time.","pos":[9851,9905]},{"content":"The expected result is that there are no system integrity violations.","pos":[9906,9975]},{"content":"However, if there are problems with Windows system files, you should investigate the issues.","pos":[9976,10068]},{"content":"We do not recommend that you use the Sfc.exe scan options to automatically fix Windows system files.","pos":[10069,10169]},{"pos":[10255,10292],"content":"Improving Security for Windows Images"},{"content":"Your Windows images contain custom configuration data, custom applications, and other intellectual property.","pos":[10295,10403]},{"content":"There are several ways to improve the security of your Windows images, both online and offline.","pos":[10404,10499]},{"content":"<bpt id=\"p1\">**</bpt>Restrict access to Windows images<ept id=\"p1\">**</ept>.","pos":[10505,10543]},{"content":"Depending on your environment, you can edit the access control lists (ACLs) or permissions on a file.","pos":[10544,10645]},{"content":"Only approved accounts can have access to Windows images.","pos":[10646,10703]},{"content":"<bpt id=\"p1\">**</bpt>Update your Windows images with the latest fixes and software updates<ept id=\"p1\">**</ept>.","pos":[10709,10783]},{"content":"There are many ways you can service a Windows image.","pos":[10784,10836]},{"content":"After servicing your Windows image, test the validity and stability of the computer.","pos":[10837,10921]},{"content":"<bpt id=\"p1\">**</bpt>During Windows installation, configure the computer to automatically download and install Windows updates<ept id=\"p1\">**</ept>.","pos":[10927,11037]},{"content":"This extends installation time, but ensures that the Windows image that you are installing contains the latest updates.","pos":[11038,11157]},{"content":"For more information, see the <ph id=\"ph1\">`DynamicUpdate`</ph> setting in the Microsoft-Windows-Setup component in the <bpt id=\"p1\">**</bpt>Unattended Windows Setup Reference<ept id=\"p1\">**</ept>.","pos":[11158,11299]},{"pos":[11337,11351],"content":"Related topics"},{"content":"DISM - Deployment Image Servicing and Management Technical Reference for Windows","pos":[11355,11435]},{"content":"Understanding Servicing Strategies","pos":[11524,11558]}],"content":"---\nauthor: Justinha\nDescription: 'Deployment Image Servicing and Management (DISM) Best Practices'\nms.assetid: b9629ef4-9b4f-47c4-8eca-d2469cfcbd9b\nMSHAttr: 'PreferredLib:/library/windows/hardware'\ntitle: 'Deployment Image Servicing and Management (DISM) Best Practices'\n---\n\n# Deployment Image Servicing and Management (DISM) Best Practices\n\n\nThis section describes some best practices related to servicing a Windows® image. We recommend that you implement these practices wherever possible.\n\nIn this topic:\n\n[Elevate Permissions for Command-Line Tools](#bkmk-elevate)\n\n[Disable Antivirus Tools](#bkmk-av)\n\n[Servicing an Image](#bkmk-servicing)\n\n[Changing International Settings](#bkmk-intl)\n\n[Use Log Files](#bkmk-log)\n\n[Package Locations](#bkmk-pkg)\n\n[Storing Files on a Network Share](#netshare)\n\n[Servicing a Windows Image from Windows PE](#bkmk-pe)\n\n[Scan for Corruption and Verify the Integrity of System Files](#bkmk-verify)\n\n[Improving Security for Windows Images](#security)\n\n## <span id=\"BKMK_elevate\"></span><span id=\"bkmk_elevate\"></span><span id=\"BKMK_ELEVATE\"></span>Elevate Permissions for Command-Line Tools\n\n\nMany deployment command-line tools, including Deployment Image Servicing and Management (DISM), require elevated permissions.\n\nMake sure that you have elevated permissions. Click **Start**, and type **deployment**. Right-click **Deployment and Imaging Tools Environment** and then select **Run as administrator**.\n\nThis must be done even if you are logged on as an administrator.\n\n## <span id=\"BKMK_av\"></span><span id=\"bkmk_av\"></span><span id=\"BKMK_AV\"></span>Disable Antivirus Tools\n\n\nSome DISM commands may be blocked by antivirus or antimalware tools. Before servicing an image, disable antivirus or antimalware tools on the technician computer.\n\n## <span id=\"BKMK_servicing\"></span><span id=\"bkmk_servicing\"></span><span id=\"BKMK_SERVICING\"></span>Servicing an Image\n\n\nThe best way to service a Windows image is offline with the DISM tool. DISM can be used to install, uninstall, configure, and update drivers, features, and packages in Windows images and Windows Preinstallation Environment (WinPE) images without booting the image. For more information, see [DISM - Deployment Image Servicing and Management Technical Reference for Windows](dism---deployment-image-servicing-and-management-technical-reference-for-windows.md).\n\nYou can use the **/Commit-Image** option at any point during servicing to save the changes that you have made so far. You can recover a corrupted image more easily with the **/Cleanup-Image /RestoreHealth** option if you have committed your changes often.\n\nYou can mount and modify multiple images on a single computer. However, performance may slow down on some functions, such as **/Unmount-Image**, depending on the memory available on the computer. As a best practice, you should not mount more than 20 images at the same time.\n\n**Note**  \nIf you have split a .wim file into smaller files for spanning across multiple media, you cannot mount the image for servicing.\n\n \n\n## <span id=\"BKMK_intl\"></span><span id=\"bkmk_intl\"></span><span id=\"BKMK_INTL\"></span>Changing International Settings\n\n\nTo change the international settings in Windows 10, Windows 8.1, Windows 8, Windows Server 2016 Technical Preview, Windows Server 2012 R2, Windows Server 2012, Windows 7, and Windows Server 2008 R2 images, you must use DISM. For more information, see [DISM Languages and International Servicing Command-Line Options](dism-languages-and-international-servicing-command-line-options.md).\n\n## <span id=\"BKMK_log\"></span><span id=\"bkmk_log\"></span><span id=\"BKMK_LOG\"></span>Use Log Files\n\n\nDISM will log verbose information to %WINDIR%\\\\Logs\\\\Dism\\\\Dism.log by default. You can also specify a name and location of your choice for the log file, and set the **/loglevel** parameters so that only the information you are interested in is logged. When an error occurs, the console will display the error code, error message, and the location of the log file.\n\n**Important**  \nIf you specify a log path on a network share from a computer that is not joined to a domain, use net-use with domain credentials to set access permissions before you set the log path for the DISM log.\n\n \n\nThe log file will automatically be archived. The archived log file will be saved with .bak appended to the file name, and a new log file will be generated. Each time the log file is archived, the .bak file will be overwritten.\n\nThe log file gives you the history of the operations that have been performed, which can help you troubleshoot problems.\n\n## <span id=\"BKMK_pkg\"></span><span id=\"bkmk_pkg\"></span><span id=\"BKMK_PKG\"></span>Package Locations\n\n\nDo not put a package that you intend to install directly at the root of a partition on a Windows installation.\n\n## <span id=\"NetShare\"></span><span id=\"netshare\"></span><span id=\"NETSHARE\"></span>Storing Files on a Network Share\n\n\nAlthough DISM supports network paths for images and packages, most operations will perform faster on files that are copied to the local hard-drive.\n\n## <span id=\"BKMK_PE\"></span><span id=\"bkmk_pe\"></span>Servicing a Windows Image from WinPE\n\n\nYou can service Windows images from WinPE. However, you must consider certain factors while planning your servicing strategy. Review the following requirements for servicing an image from WinPE.\n\n### <span id=\"Booting_WinPE_from_a_Hard_Drive\"></span><span id=\"booting_winpe_from_a_hard_drive\"></span><span id=\"BOOTING_WINPE_FROM_A_HARD_DRIVE\"></span>Booting WinPE from a Hard Drive\n\nFor better performance, you can allocate additional memory when you boot WinPE from a hard disk drive. You can also create temporary folders to store update files to accommodate large updates.\n\n### <span id=\"Add_Page-File_Support_to_Your_WinPE_Image\"></span><span id=\"add_page-file_support_to_your_winpe_image\"></span><span id=\"ADD_PAGE-FILE_SUPPORT_TO_YOUR_WINPE_IMAGE\"></span>Add Page-File Support to Your WinPE Image\n\nMake sure you have sufficient memory to load and run your custom WinPE image. In addition to the image size, you should have at least 256 MB of available working memory. If you have limited memory, define a page file (Pagefile.sys) to improve memory management. For more information on implementing a page file, see [Wpeutil Command-Line Options](wpeutil-command-line-options.md).\n\n### <span id=\"Create_a_Temporary_Directory_in_Which_to_Store_Update_Files\"></span><span id=\"create_a_temporary_directory_in_which_to_store_update_files\"></span><span id=\"CREATE_A_TEMPORARY_DIRECTORY_IN_WHICH_TO_STORE_UPDATE_FILES\"></span>Create a Temporary Directory in Which to Store Update Files\n\nYou should use the **/ScratchDir** option with DISM to create a temporary directory on a different drive when you create or service a Windows image. A temporary directory is used for many DISM operations including capturing an image, installing language packs, installing updates, or installing or removing Windows features in a Windows image. Some files are expanded to this temporary directory before they are applied to a Windows image.\n\nThere must be sufficient space in the partition to accommodate large updates. The specific size of the free space that is required depends on the size of the updates that you intend to install. When adding a language pack, the scratch directory must have at least 1 GB of space for temporary files.\n\nIf you do not set a temporary directory path using the **/ScratchDir** option, WinPE creates a 32-MB temporary directory by default. You can allocate additional temporary storage to this default location using the DISM **/Set-ScratchSpace** option. Valid sizes include 32, 64, 128, 256, and 512 MB. This feature is available only offline and you cannot adjust this setting while a WinPE session is running. As a best practice, you should use the **/ScratchDir** option to instead specify a directory on another partition that has sufficient space to support any image management and servicing operations you perform.\n\nAfter installation is complete, the contents of this directory are no longer needed and can be deleted. For more information, see [DISM Image Management Command-Line Options](dism-image-management-command-line-options-s14.md).\n\n### <span id=\"Booting_WinPE_from_a_CD-ROM_DVD\"></span><span id=\"booting_winpe_from_a_cd-rom_dvd\"></span><span id=\"BOOTING_WINPE_FROM_A_CD-ROM_DVD\"></span>Booting WinPE from a CD-ROM/DVD\n\nServicing a Windows image requires additional temporary storage space. For WinPE RAM disks, you might need additional RAM. In addition to the RAM requirements of your WinPE image, additional RAM is required to process updates. The amount of RAM that is required depends on the size of the updates that you intend to apply. Ensure that your computer has sufficient RAM.\n\n## <span id=\"BKMK_verify\"></span><span id=\"bkmk_verify\"></span><span id=\"BKMK_VERIFY\"></span>Scan for Corruption and Verify the Integrity of System Files\n\n\nBefore you deliver a computer to an end user, you should verify the integrity of Windows system files. You can use the **/Cleanup-Image** option to identify file corruption and perform repair operations on the image. For more information about the **/Cleanup-Image** option in DISM, see [DISM Operating System Package Servicing Command-Line Options](dism-operating-system-package-servicing-command-line-options.md).\n\nYou can also use System File Checker (Sfc.exe) on an online or offline reference image. System File Checker is released with all versions of Windows.System File Checker requires elevated permissions, and you must be an Administrator to run it. It scans all protected files to verify the file versions. To verify only the integrity of the Windows system files, run the **sfc.exe /verifyonly** option. For complete command-line syntax, at an elevated command prompt, type **sfc.exe /?**.\n\nRunning Sfc.exe can take a significant amount of time. The expected result is that there are no system integrity violations. However, if there are problems with Windows system files, you should investigate the issues. We do not recommend that you use the Sfc.exe scan options to automatically fix Windows system files.\n\n## <span id=\"Security\"></span><span id=\"security\"></span><span id=\"SECURITY\"></span>Improving Security for Windows Images\n\n\nYour Windows images contain custom configuration data, custom applications, and other intellectual property. There are several ways to improve the security of your Windows images, both online and offline.\n\n-   **Restrict access to Windows images**. Depending on your environment, you can edit the access control lists (ACLs) or permissions on a file. Only approved accounts can have access to Windows images.\n\n-   **Update your Windows images with the latest fixes and software updates**. There are many ways you can service a Windows image. After servicing your Windows image, test the validity and stability of the computer.\n\n-   **During Windows installation, configure the computer to automatically download and install Windows updates**. This extends installation time, but ensures that the Windows image that you are installing contains the latest updates. For more information, see the `DynamicUpdate` setting in the Microsoft-Windows-Setup component in the **Unattended Windows Setup Reference**.\n\n## <span id=\"related_topics\"></span>Related topics\n\n\n[DISM - Deployment Image Servicing and Management Technical Reference for Windows](dism---deployment-image-servicing-and-management-technical-reference-for-windows.md)\n\n[Understanding Servicing Strategies](understanding-servicing-strategies.md)\n\n \n\n \n\n\n\n\n\n\n"}