{"nodes":[{"content":"Creating a secure MMOS WIM image","pos":[34,66]},{"content":"Creating a secure MMOS WIM image","pos":[173,205]},{"content":"Creating a secure MMOS WIM image","pos":[213,245]},{"content":"You can use the SecWimTool to create a secure WIM image that can be used to service retail devices.","pos":[248,347]},{"content":"Before you can create a secure WIM, you must first create the WIM image itself.","pos":[349,428]},{"content":"For info about how to create a WIM image, see <bpt id=\"p1\">[</bpt>Working with WIM MMOS images<ept id=\"p1\">](working-with-wim-mmos-images.md)</ept>.","pos":[429,539]},{"content":"To use the MMOS WIM in retail, it will need to be signed using retail certificates.","pos":[541,624]},{"content":"More info will be provided in a later release of this documentation about how to work with the retail images.","pos":[625,734]},{"content":"For the secure WIM to run on the device, the signing certificates must match the certificates in the Platform Key (PK) that is provisioned on the device.","pos":[736,889]},{"pos":[1092,1139],"content":"Installing the needed certificates on the phone"},{"content":"Before you run the tools, you must first provision the appropriate certificates on the device.","pos":[1142,1236]},{"content":"To become familiar with SecWimTool, partners can use the secure boot <bpt id=\"p1\">*</bpt>test<ept id=\"p1\">*</ept> tool to provision test (non-retail) certificates on the device.","pos":[1237,1376]},{"content":"Use the secure boot <bpt id=\"p1\">*</bpt>retail<ept id=\"p1\">*</ept> tool for retail device.","pos":[1377,1429]},{"pos":[1587,1619],"content":"Creating a secure MMOS WIM image"},{"content":"To create a secure wim image, complete the following steps.","pos":[1622,1681]},{"content":"Open an elevated developer prompt in the directory that contains the output from the ImgToWim image generation process.","pos":[1687,1806]},{"content":"For info about how to create a WIM image, see <bpt id=\"p1\">[</bpt>Working with WIM MMOS images<ept id=\"p1\">](working-with-wim-mmos-images.md)</ept>.","pos":[1807,1917]},{"pos":[1923,2090],"content":"**Note**  \nThe image generation executables are located in %WPDKCONTENTROOT%\\\\Tools\\\\bin\\\\i386. You can use the `set` command to add that path to your environment.","leadings":["","    "],"nodes":[{"content":"Note","pos":[2,6]},{"content":"The image generation executables are located in %WPDKCONTENTROOT%\\\\Tools\\\\bin\\\\i386. You can use the `set` command to add that path to your environment.","pos":[11,163],"nodes":[{"content":"The image generation executables are located in %WPDKCONTENTROOT%<ph id=\"ph1\">\\\\</ph>Tools<ph id=\"ph2\">\\\\</ph>bin<ph id=\"ph3\">\\\\</ph>i386.","pos":[0,84]},{"content":"You can use the <ph id=\"ph1\">`set`</ph> command to add that path to your environment.","pos":[85,152]}]}]},{"content":"The platform ID must be used to create the WIM for a specific platform.","pos":[2103,2174]},{"content":"The platform ID is set in using a device platform XML file.","pos":[2175,2234]},{"pos":[2240,2324],"content":"You can display the platform ID using the ffutool command with the <bpt id=\"p1\">**</bpt>–list<ept id=\"p1\">**</ept> option."},{"content":"Build the unsigned secure WIM targeted for a specific platform using the <bpt id=\"p1\">*</bpt>–platform<ept id=\"p1\">*</ept> command option as shown here.","pos":[2470,2584]},{"content":"No output is returned if the command completes successfully.","pos":[2585,2645]},{"content":"Extract the catalog from the secure WIM image.","pos":[2772,2818]},{"content":"No output is returned if the command completes successfully.","pos":[2819,2879]},{"content":"You can sign the WIM with test certificates to test the WIM process.","pos":[2968,3036]},{"content":"For a retail secure WIM, the FFU must be signed by Microsoft.","pos":[3037,3098]},{"pos":[3104,3242],"content":"**Important**  \nInformation about signing with the final retail certificates will be provided in a later release of the documentation.","leadings":["","    "],"nodes":[{"content":"Important","pos":[2,11]},{"content":"Information about signing with the final retail certificates will be provided in a later release of the documentation.","pos":[16,134]}]},{"content":"To sign the catalog using the test image certificate, use this command.","pos":[3248,3319]},{"content":"This command will generate output that is similar to the following.","pos":[3379,3446]},{"content":"Replace the existing catalog with a signed catalog.","pos":[4137,4188]},{"content":"No output is returned if the command completes successfully.","pos":[4189,4249]},{"content":"Place the device in flashing mode.","pos":[4339,4373]},{"content":"Flash the WIM to the device to test it using the FFUTool.","pos":[4379,4436]},{"content":"The command will generate output that is similar to the following.","pos":[4503,4569]},{"pos":[4932,4959],"content":"Working with serial numbers"},{"content":"The serial number option can be used when including tools that should only be used for a specific device.","pos":[4962,5067]},{"content":"<bpt id=\"p1\">**</bpt>Serial Number<ept id=\"p1\">**</ept>- The serial number is a unique ID for the phone that is generated automatically.","pos":[5069,5167]},{"content":"You can display the serial number using the ffutool command with the <bpt id=\"p1\">*</bpt>–serial<ept id=\"p1\">*</ept> option.","pos":[5168,5254]},{"pos":[5339,5440],"content":"To build a secure WIM targeted for a specific device, use the <bpt id=\"p1\">*</bpt>–serial<ept id=\"p1\">*</ept> command option as shown here."},{"pos":[5655,5670],"content":"Troubleshooting"},{"content":"When you flash the image if the PK doesn’t match, you will receive this message.","pos":[5673,5753]},{"pos":[6010,6043],"content":"SecWimTool command line reference"},{"content":"The following summarizes the command syntax and the four command-line options for SecWimTool.","pos":[6046,6139]},{"pos":[6190,6306],"content":"<bpt id=\"p1\">**</bpt>-build<ept id=\"p1\">**</ept> - Packs the specified WIM into a secwim that is suitable for signing and transferring to a retail device."},{"content":"<bpt id=\"p1\">*</bpt>Platform<ept id=\"p1\">*</ept> - Includes targeting information for a specific platform type that the WIM is intended for.","pos":[6312,6414]},{"content":"This option must be used to target the WIM for a specific platform.","pos":[6415,6482]},{"content":"<bpt id=\"p1\">*</bpt>Serial<ept id=\"p1\">*</ept> - Includes the serial number of a specific device the WIM will be used on.","pos":[6488,6571]},{"content":"This option can be used when including tools that should only be used for a specific device.","pos":[6572,6664]},{"pos":[6763,6894],"content":"<bpt id=\"p1\">**</bpt>-extractcat<ept id=\"p1\">**</ept> - Retrieves the catalog from the secure WIM file, and writes it either to the output file (if specified) or stdout."},{"pos":[6965,7066],"content":"<bpt id=\"p1\">**</bpt>-replacecat<ept id=\"p1\">**</ept> - Replaces the catalog in the specified .secwim with the contents of the new catalog."},{"content":"-?","pos":[7141,7143]},{"content":"- Displays command line help.","pos":[7146,7175]},{"content":"Use <ph id=\"ph1\">`secwimtool -&lt;command&gt; -?`</ph> for command level help.","pos":[7176,7230]},{"pos":[7268,7282],"content":"Related topics"},{"content":"Working with WIM MMOS images","pos":[7286,7314]}],"content":"---\nauthor: kpacquer\nDescription: Creating a secure MMOS WIM image\nms.assetid: c3ab9a94-a0a6-4831-9ac9-09c2972bb074\nMSHAttr: 'PreferredLib:/library/windows/hardware'\ntitle: Creating a secure MMOS WIM image\n---\n\n# Creating a secure MMOS WIM image\n\n\nYou can use the SecWimTool to create a secure WIM image that can be used to service retail devices.\n\nBefore you can create a secure WIM, you must first create the WIM image itself. For info about how to create a WIM image, see [Working with WIM MMOS images](working-with-wim-mmos-images.md).\n\nTo use the MMOS WIM in retail, it will need to be signed using retail certificates. More info will be provided in a later release of this documentation about how to work with the retail images.\n\nFor the secure WIM to run on the device, the signing certificates must match the certificates in the Platform Key (PK) that is provisioned on the device.\n\n## <span id=\"Installing_the_needed_certificates_on_the_phone\"></span><span id=\"installing_the_needed_certificates_on_the_phone\"></span><span id=\"INSTALLING_THE_NEEDED_CERTIFICATES_ON_THE_PHONE\"></span>Installing the needed certificates on the phone\n\n\nBefore you run the tools, you must first provision the appropriate certificates on the device. To become familiar with SecWimTool, partners can use the secure boot *test* tool to provision test (non-retail) certificates on the device. Use the secure boot *retail* tool for retail device.\n\n## <span id=\"Creating_a_secure_MMOS_WIM_image\"></span><span id=\"creating_a_secure_mmos_wim_image\"></span><span id=\"CREATING_A_SECURE_MMOS_WIM_IMAGE\"></span>Creating a secure MMOS WIM image\n\n\nTo create a secure wim image, complete the following steps.\n\n1.  Open an elevated developer prompt in the directory that contains the output from the ImgToWim image generation process. For info about how to create a WIM image, see [Working with WIM MMOS images](working-with-wim-mmos-images.md).\n\n    **Note**  \n    The image generation executables are located in %WPDKCONTENTROOT%\\\\Tools\\\\bin\\\\i386. You can use the `set` command to add that path to your environment.\n\n     \n\n2.  The platform ID must be used to create the WIM for a specific platform. The platform ID is set in using a device platform XML file.\n\n    You can display the platform ID using the ffutool command with the **–list** option.\n\n    ``` syntax\n    C:\\> ffutool –list\n    Name:   Contoso.DCD9X0X.BD301_ATT.3.2.1\n    ID:     00000011-f151-a509-0000-FF0000000000\n    ```\n\n    Build the unsigned secure WIM targeted for a specific platform using the *–platform* command option as shown here. No output is returned if the command completes successfully.\n\n    ``` syntax\n    C:\\> SecWimTool -build MMOSwim.wim MMOS wim.secwim -platform Contoso.DCD9X0X.BD301_ATT.3.2.1\n    ```\n\n3.  Extract the catalog from the secure WIM image. No output is returned if the command completes successfully.\n\n    ``` syntax\n    C:\\> SecWimTool -extractcat MMOSwim.secwim MMOSwim.cat\n    ```\n\n4.  You can sign the WIM with test certificates to test the WIM process. For a retail secure WIM, the FFU must be signed by Microsoft.\n\n    **Important**  \n    Information about signing with the final retail certificates will be provided in a later release of the documentation.\n\n    To sign the catalog using the test image certificate, use this command.\n\n    ``` syntax\n    C:\\> sign /pk MMOSwim.cat\n    ```\n\n    This command will generate output that is similar to the following.\n\n    ``` syntax\n    signtool.exe sign /v /a /u 1.3.6.1.4.1.311.76.5.10 /r \"Microsoft Testing Root Certificate Authority 2010\" /fd SHA256 /s my /c \"1.3.6.1.4.1.311.21.8.7587021.7518\n    74.11030412.6202749.3702260.207.4167089.4524209\"    \"MMOSwim.cat\"\n    The following certificate was selected:\n        Issued to: User1\n        Issued by: MSIT Test CodeSign CA 3\n        Expires:   Sat Jun 21 15:05:01 2014\n        SHA1 hash: F571C183F768638B424A59772A1AFB1168164AFC\n\n    Done Adding Additional Store\n    Successfully signed: MMOSwim.cat\n\n    Number of files successfully Signed: 1\n    Number of warnings: 0\n    Number of errors: 0\n    signed:  \"MMOSwim.cat\"\n    Sign.Cmd RC=0\n    ```\n\n5.  Replace the existing catalog with a signed catalog. No output is returned if the command completes successfully.\n\n    ``` syntax\n    C:\\> SecWimTool -replacecat flashwim.cat MMOSwim.secwim\n    ```\n\n6.  Place the device in flashing mode.\n\n7.  Flash the WIM to the device to test it using the FFUTool.\n\n    ``` syntax\n    C:\\> ffutool -wim MMOSwim.secwim\n    ```\n\n    The command will generate output that is similar to the following.\n\n    ``` syntax\n    Found device:\n    Name:   Contoso.MSM8X0X.BD301_ATT.3.2.1\n    ID:     00000011-f151-a509-0000-FF0000000000\n    Booting WIM: MMOSwim.secwim\n    WIM transfer completed in 26.550073 seconds.\n   \n    ```\n\n## <span id=\"Working_with_serial_numbers\"></span><span id=\"working_with_serial_numbers\"></span><span id=\"WORKING_WITH_SERIAL_NUMBERS\"></span>Working with serial numbers\n\n\nThe serial number option can be used when including tools that should only be used for a specific device.\n\n**Serial Number**- The serial number is a unique ID for the phone that is generated automatically. You can display the serial number using the ffutool command with the *–serial* option.\n\n``` syntax\nC:\\> ffutool –serial\nSerial No. : 01000500000000000000000000001234\n```\n\nTo build a secure WIM targeted for a specific device, use the *–serial* command option as shown here.\n\n``` syntax\nC:\\> SecWimTool -build MMOSwim.wim MMOS wim.secwim -serial 01000500000000000000000000001234\n```\n\n## <span id=\"Troubleshooting\"></span><span id=\"troubleshooting\"></span><span id=\"TROUBLESHOOTING\"></span>Troubleshooting\n\n\nWhen you flash the image if the PK doesn’t match, you will receive this message.\n\n``` syntax\nAn FFU error occurred: Device returned WIM boot failure status code 0x80000004.\n```\n\n## <span id=\"SecWimTool_command_line_reference\"></span><span id=\"secwimtool_command_line_reference\"></span><span id=\"SECWIMTOOL_COMMAND_LINE_REFERENCE\"></span>SecWimTool command line reference\n\n\nThe following summarizes the command syntax and the four command-line options for SecWimTool.\n\n``` syntax\nSecWimTool <command> <arguments>\n```\n\n**-build** - Packs the specified WIM into a secwim that is suitable for signing and transferring to a retail device.\n\n-   *Platform* - Includes targeting information for a specific platform type that the WIM is intended for. This option must be used to target the WIM for a specific platform.\n\n-   *Serial* - Includes the serial number of a specific device the WIM will be used on. This option can be used when including tools that should only be used for a specific device.\n\n``` syntax\nSecWimTool -build <WIM> <output file> [-platform <ID>] [-serial <serial number>]\n```\n\n**-extractcat** - Retrieves the catalog from the secure WIM file, and writes it either to the output file (if specified) or stdout.\n\n``` syntax\nsecwim -extractcat <path to .secwim> [<output file>]\n```\n\n**-replacecat** - Replaces the catalog in the specified .secwim with the contents of the new catalog.\n\n``` syntax\nsecwim -replacecat <path to catalog> <path to .secwim>\n```\n\n**-?** - Displays command line help. Use `secwimtool -<command> -?` for command level help.\n\n## <span id=\"related_topics\"></span>Related topics\n\n\n[Working with WIM MMOS images](working-with-wim-mmos-images.md)\n\n \n\n \n\n\n\n\n\n\n"}