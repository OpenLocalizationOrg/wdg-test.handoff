{"nodes":[{"content":"Creating a Regions of Interest File","pos":[11,46]},{"content":"Creating a Regions of Interest File","pos":[60,95]},{"content":"Creating a Regions of Interest File","pos":[284,319]},{"content":"A Regions of Interest file is a valid XML file that contains the following nodes:","pos":[322,403]},{"content":"InstrumentationManifest","pos":[411,434]},{"content":"Instrumentation","pos":[444,459]},{"content":"Regions","pos":[469,476]},{"pos":[484,543],"content":"<bpt id=\"p1\">**</bpt>RegionsRoot<ept id=\"p1\">**</ept>, a container for all of the defined regions"},{"pos":[549,577],"content":"One or more <bpt id=\"p1\">**</bpt>Region<ept id=\"p1\">**</ept> nodes"},{"content":"Note","pos":[581,585]},{"content":"In a region's definition, the <bpt id=\"p1\">*</bpt>version<ept id=\"p1\">*</ept> attribute in the XML declaration, such as <ph id=\"ph1\">`version='1.0'`</ph>, is optional.","pos":[590,701]},{"content":"The following example is a complete Regions of Interest file that defines a simple region.","pos":[706,796]},{"content":"Explanations for the attributes and nodes within <bpt id=\"p1\">**</bpt>Region<ept id=\"p1\">**</ept> are described after the example.","pos":[797,889]},{"content":"This topic has the following contents:","pos":[1841,1879]},{"content":"Defining a region","pos":[1886,1903]},{"content":"Region types","pos":[1930,1942]},{"content":"Using payload fields to identify events","pos":[1964,2003]},{"content":"Matching events for regions","pos":[2052,2079]},{"content":"Filtering a region based on a condition","pos":[2116,2155]},{"content":"Parent-child relationships","pos":[2204,2230]},{"content":"Self-nesting regions","pos":[2266,2286]},{"content":"Instance names","pos":[2316,2330]},{"content":"Metadata","pos":[2354,2362]},{"content":"Defining a region","pos":[2380,2397]},{"pos":[2399,2476],"content":"A region definition contains the following attributes in the <bpt id=\"p1\">**</bpt>Region<ept id=\"p1\">**</ept> node:"},{"pos":[2482,2523],"content":"<bpt id=\"p1\">*</bpt>Guid<ept id=\"p1\">*</ept> (required), a GUID for the region."},{"content":"<bpt id=\"p1\">*</bpt>Name<ept id=\"p1\">*</ept> (required), a unique name for the region.","pos":[2529,2577]},{"content":"A suggested format for <bpt id=\"p1\">*</bpt>Name<ept id=\"p1\">*</ept> is <ph id=\"ph1\">`Root-GrandparentName-ParentName-RegionName`</ph>.","pos":[2578,2656]},{"pos":[2662,2722],"content":"<bpt id=\"p1\">*</bpt>FriendlyName<ept id=\"p1\">*</ept> (optional), an alternate name for the region."},{"content":"Region types","pos":[2728,2740]},{"content":"You can create the following types of regions based on how they start and stop:","pos":[2742,2821]},{"content":"Regions based on events","pos":[2828,2851]},{"content":"Regions based on duration","pos":[2884,2909]},{"content":"Regions based on other regions","pos":[2944,2974]},{"content":"Regions that are containers of other regions","pos":[3014,3058]},{"content":"Regions based on events","pos":[3090,3113]},{"content":"The most common type of region is one whose starting and stopping points are defined by events.","pos":[3115,3210]},{"content":"To specify an event as the starting or stopping point, you need to provide the following attributes:","pos":[3212,3312]},{"pos":[3318,3382],"content":"<bpt id=\"p1\">*</bpt>Provider<ept id=\"p1\">*</ept>, a GUID that specifies the provider ID for the event."},{"pos":[3388,3447],"content":"<bpt id=\"p1\">*</bpt>Id<ept id=\"p1\">*</ept>, an unsigned short that specifies the ID of the event."},{"pos":[3453,3514],"content":"<bpt id=\"p1\">*</bpt>Version<ept id=\"p1\">*</ept>, an unsigned char that specifies the event version."},{"content":"Additionally, you can further refine your definition by adding one or more <bpt id=\"p1\">**</bpt>PayloadIdentifier<ept id=\"p1\">**</ept> nodes.","pos":[3516,3619]},{"content":"These tags contain two string attributes, <bpt id=\"p1\">*</bpt>FieldName<ept id=\"p1\">*</ept> and <bpt id=\"p2\">*</bpt>FieldValue<ept id=\"p2\">*</ept>, that specify a field that the event must contain.","pos":[3620,3741]},{"content":"<bpt id=\"p1\">**</bpt>PayloadIdentifier<ept id=\"p1\">**</ept> tags are further described below in <bpt id=\"p2\">**</bpt>Using payload fields to identify events<ept id=\"p2\">**</ept>.","pos":[3742,3844]},{"content":"Examples","pos":[3850,3858]},{"content":"Following is a basic example for this type of region:","pos":[3860,3913]},{"pos":[4314,4446],"content":"In the following example, the region ends only when the specified event contains a field named <ph id=\"ph1\">`StartOrStop`</ph> with a value of <ph id=\"ph2\">`Stop`</ph>:"},{"content":"Regions based on duration","pos":[4921,4946]},{"content":"Many ETW events are defined as a single stop event with a duration payload field.","pos":[4948,5029]},{"content":"We can calculate the starting point by subtracting the duration from the stop event time.","pos":[5030,5119]},{"content":"The <bpt id=\"p1\">**</bpt>Duration<ept id=\"p1\">**</ept> tag can be used within a <bpt id=\"p2\">**</bpt>Start<ept id=\"p2\">**</ept> or <bpt id=\"p3\">**</bpt>Stop<ept id=\"p3\">**</ept> tag to specify a payload field from which to grab duration information.","pos":[5121,5256]},{"content":"If you define a duration for the starting point, the duration is subtracted from the stopping point.","pos":[5257,5357]},{"content":"Similarly, if you define a duration for the stopping point, the duration is added to the starting point.","pos":[5358,5462]},{"pos":[5464,5520],"content":"The <bpt id=\"p1\">**</bpt>Duration<ept id=\"p1\">**</ept> node can have the following attributes:"},{"pos":[5526,5622],"content":"<bpt id=\"p1\">*</bpt>Provider<ept id=\"p1\">*</ept>, a GUID that specifies the provider ID for the event that contains the payload field."},{"pos":[5628,5719],"content":"<bpt id=\"p1\">*</bpt>Id<ept id=\"p1\">*</ept>, an unsigned short that specifies the ID of the event that contains the payload field."},{"pos":[5725,5825],"content":"<bpt id=\"p1\">*</bpt>Version<ept id=\"p1\">*</ept>, an unsigned char that specifies the version of the event that contains the payload field."},{"pos":[5831,5897],"content":"<bpt id=\"p1\">*</bpt>Duration<ept id=\"p1\">*</ept>, a string that specifies the name of the payload field."},{"content":"<bpt id=\"p1\">*</bpt>Multiplier<ept id=\"p1\">*</ept>.","pos":[5903,5916]},{"content":"WPA requires the duration to be in nanoseconds.","pos":[5917,5964]},{"content":"Use this attribute to convert the duration to nanoseconds, if necessary.","pos":[5965,6037]},{"content":"For example, use 1000000 (one million) to convert milliseconds to nanoseconds.","pos":[6038,6116]},{"content":"If you define a duration for the starting point, the duration is subtracted from the stopping point.","pos":[6118,6218]},{"content":"Similarly, if you define a duration for the stopping point, the duration is added to the starting point.","pos":[6219,6323]},{"content":"Example","pos":[6329,6336]},{"content":"The following example defines a region that stops when another region starts.","pos":[6338,6415]},{"content":"To calculate the starting point, we subtract a duration from our stopping point.","pos":[6416,6496]},{"content":"The duration is found in the HiberHiberFileTime payload field.","pos":[6497,6559]},{"content":"We then multiply the duration by 1,000,000 to convert it to nanoseconds and subtract it from the stopping point.","pos":[6560,6672]},{"content":"Regions based on other regions","pos":[7390,7420]},{"content":"You can define a region whose starting and stopping points are defined by other regions by using a <bpt id=\"p1\">**</bpt>Region<ept id=\"p1\">**</ept> node within the <bpt id=\"p2\">**</bpt>Start<ept id=\"p2\">**</ept> or <bpt id=\"p3\">**</bpt>Stop<ept id=\"p3\">**</ept> node.","pos":[7422,7575]},{"content":"This Region node has one mandatory attribute, <bpt id=\"p1\">*</bpt>RegionGuid<ept id=\"p1\">*</ept>, that specifies the GUID of the target region.","pos":[7576,7681]},{"content":"By default, a region whose starting point is based on another region will start when the starting point region stops.","pos":[7683,7800]},{"content":"Similarly, a region whose stopping point is based on another region will stop when the stopping point region starts.","pos":[7801,7917]},{"content":"You can override this default behavior by adding an optional attribute, <bpt id=\"p1\">*</bpt>Endpoint<ept id=\"p1\">*</ept>, to the Region node.","pos":[7918,8021]},{"content":"<bpt id=\"p1\">*</bpt>Endpoint<ept id=\"p1\">*</ept> can have a value of <ph id=\"ph1\">`Start`</ph> or <ph id=\"ph2\">`Stop`</ph> and specifies which endpoint of the region to use for the starting or stopping event.","pos":[8022,8156]},{"content":"Example","pos":[8162,8169]},{"content":"The following region definition contains starting and stopping points that are defined by other regions:","pos":[8171,8275]},{"pos":[8684,8728],"content":"Regions that are containers of other regions"},{"content":"Regions that contain other regions are called <bpt id=\"p1\">*</bpt>containers<ept id=\"p1\">*</ept>.","pos":[8730,8789]},{"content":"Containers start when the first instance of a contained region starts, and they stop when the last instance stops.","pos":[8790,8904]},{"content":"These regions do not have any other attributes.","pos":[8905,8952]},{"content":"<bpt id=\"p1\">**</bpt>RegionRoot<ept id=\"p1\">**</ept> is a container for all of the regions that you define.","pos":[8954,9023]},{"content":"Thus, <bpt id=\"p1\">**</bpt>RegionRoot<ept id=\"p1\">**</ept> starts when the first instance of a region starts, and it stops when the last instance of a region stops.","pos":[9024,9150]},{"content":"To define a container region, simply define a region without a starting point or a stopping point.","pos":[9152,9250]},{"content":"Example","pos":[9256,9263]},{"content":"In the example below, <bpt id=\"p1\">*</bpt>Subscribers for Create Session<ept id=\"p1\">*</ept> is a container for <bpt id=\"p2\">*</bpt>Child of Subscribers of Create Session<ept id=\"p2\">*</ept>.","pos":[9265,9380]},{"content":"Notice that <bpt id=\"p1\">*</bpt>Subscribers for Create Session<ept id=\"p1\">*</ept> does not have a starting point or a stopping point.","pos":[9381,9477]},{"content":"It will start when the first instance of a child region starts and stop when the last instance of a child region stops.","pos":[9478,9597]},{"content":"Using payload fields to identify events","pos":[10248,10287]},{"content":"Often the event ID properties (process ID, thread ID, and activity ID) are not enough to identify specific scenarios.","pos":[10289,10406]},{"content":"For example, when a service starts, a generic event is fired that might not identify which service started.","pos":[10407,10514]},{"content":"When this occurs, you must rely on <bpt id=\"p1\">*</bpt>payload fields<ept id=\"p1\">*</ept> for additional information.","pos":[10515,10594]},{"content":"In this case, one of the additional fields should include the service name.","pos":[10595,10670]},{"content":"You can use this information to further specify region starting and stopping points.","pos":[10671,10755]},{"pos":[10757,10888],"content":"To use payload fields as additional event identifiers, add one or more <bpt id=\"p1\">**</bpt>PayloadIdentifier<ept id=\"p1\">**</ept> nodes to a <bpt id=\"p2\">**</bpt>Start<ept id=\"p2\">**</ept> or <bpt id=\"p3\">**</bpt>Stop<ept id=\"p3\">**</ept> node."},{"pos":[10890,10950],"content":"The <bpt id=\"p1\">**</bpt>PayloadIdentifier<ept id=\"p1\">**</ept> node has the following attributes:"},{"pos":[10956,11010],"content":"<bpt id=\"p1\">*</bpt>FieldName<ept id=\"p1\">*</ept> (required), the name of the payload field."},{"pos":[11016,11059],"content":"<bpt id=\"p1\">*</bpt>FieldValue<ept id=\"p1\">*</ept> (required), the payload value."},{"content":"<bpt id=\"p1\">*</bpt>FieldValueRelationship<ept id=\"p1\">*</ept> (optional).","pos":[11065,11101]},{"content":"Use <bpt id=\"p1\">**</bpt>IsEqual<ept id=\"p1\">**</ept> to specify that the event must contain the payload value.","pos":[11102,11175]},{"content":"Use <bpt id=\"p1\">**</bpt>DoesNotContain<ept id=\"p1\">**</ept> to specify that the event must not contain the payload value.","pos":[11176,11260]},{"content":"If this attribute is not specified, the default value is <bpt id=\"p1\">**</bpt>IsEqual<ept id=\"p1\">**</ept>.","pos":[11261,11330]},{"content":"Note","pos":[11334,11338]},{"content":"Payload fields are case-sensitive, and the XML definition must fully match the payload value.","pos":[11343,11436]},{"content":"For example, if a payload field has a value of <ph id=\"ph1\">`00000`</ph>, the region definition must also specify <ph id=\"ph2\">`00000`</ph> as the payload value.","pos":[11437,11562]},{"content":"Example","pos":[11571,11578]},{"pos":[11580,11690],"content":"The following example contains <bpt id=\"p1\">**</bpt>PayloadIdentifier<ept id=\"p1\">**</ept> nodes for both the starting point and the stopping point:"},{"content":"Matching events for regions","pos":[12373,12400]},{"content":"WPA matches starting events with stopping events to form regions in a process called <bpt id=\"p1\">*</bpt>event matching<ept id=\"p1\">*</ept>.","pos":[12402,12504]},{"content":"At the event level, WPA attempts to match a single starting or stopping event based on its provider ID, event ID, event version, and any additional specified payload fields.","pos":[12505,12678]},{"content":"Matching can also be extended to the region level, where criteria can be specified that must be met by both the starting and stopping points.","pos":[12680,12821]},{"content":"At the region level, you can require that both points have matching thread IDs, process IDs, and activity IDs.","pos":[12822,12932]},{"content":"Additionally, you can also define payload criteria at the region level.","pos":[12933,13004]},{"content":"You can use region-level matching by including a <bpt id=\"p1\">**</bpt>Match<ept id=\"p1\">**</ept> node inside of the <bpt id=\"p2\">**</bpt>Region<ept id=\"p2\">**</ept> node.","pos":[13006,13100]},{"content":"The <bpt id=\"p1\">**</bpt>Match<ept id=\"p1\">**</ept> node contains a child node, <bpt id=\"p2\">**</bpt>Event<ept id=\"p2\">**</ept>, that can have any combination of the following attributes:","pos":[13101,13212]},{"pos":[13231,13260],"content":"– require matching thread IDs"},{"pos":[13279,13309],"content":"– require matching process IDs"},{"pos":[13328,13359],"content":"– require matching activity IDs"},{"content":"The <bpt id=\"p1\">**</bpt>Event<ept id=\"p1\">**</ept> node can have an optional <bpt id=\"p2\">**</bpt>Payload<ept id=\"p2\">**</ept> child node that contains a <bpt id=\"p3\">*</bpt>FieldName<ept id=\"p3\">*</ept> attribute.","pos":[13361,13462]},{"content":"This node requires that both the starting and stopping nodes contain matching payload values for the specified <bpt id=\"p1\">*</bpt>FieldName<ept id=\"p1\">*</ept>.","pos":[13463,13586]},{"content":"Alternatively, the <bpt id=\"p1\">**</bpt>Payload<ept id=\"p1\">**</ept> node can also contain an optional attribute, <bpt id=\"p2\">*</bpt>TargetFieldName<ept id=\"p2\">*</ept>.","pos":[13588,13682]},{"content":"If this attribute is specified, then <bpt id=\"p1\">*</bpt>FieldName<ept id=\"p1\">*</ept> corresponds to a payload field only in the starting node, while <bpt id=\"p2\">*</bpt>TargetFieldName<ept id=\"p2\">*</ept> corresponds to a payload field in the stopping node.","pos":[13683,13866]},{"content":"Example","pos":[13872,13879]},{"content":"The following example forms a region when the starting event contains a payload field, <bpt id=\"p1\">*</bpt>SubscriberName<ept id=\"p1\">*</ept>, whose value matches that of a payload field, <bpt id=\"p2\">*</bpt>Client<ept id=\"p2\">*</ept>, in the stopping node.","pos":[13881,14062]},{"content":"The starting and stopping events must also have matching thread IDs.","pos":[14063,14131]},{"content":"Filtering a region based on a condition","pos":[14819,14858]},{"content":"WPA can include or exclude a region based on a condition, or <bpt id=\"p1\">*</bpt>trigger<ept id=\"p1\">*</ept>, which can be an event or another region.","pos":[14860,14972]},{"content":"The trigger is specified in a <bpt id=\"p1\">**</bpt>Filter<ept id=\"p1\">**</ept> node, and the region that contains <bpt id=\"p2\">**</bpt>Filter<ept id=\"p2\">**</ept> is called the <bpt id=\"p3\">*</bpt>target<ept id=\"p3\">*</ept>.","pos":[14973,15083]},{"pos":[15085,15302],"content":"Each <bpt id=\"p1\">**</bpt>Filter<ept id=\"p1\">**</ept> node contains one <bpt id=\"p2\">**</bpt>Event<ept id=\"p2\">**</ept> node with the attributes described earlier in <bpt id=\"p3\">[</bpt>Region types<ept id=\"p3\">](#region-types)</ept> (<bpt id=\"p4\">*</bpt>Provider<ept id=\"p4\">*</ept>, <bpt id=\"p5\">*</bpt>Id<ept id=\"p5\">*</ept>, and <bpt id=\"p6\">*</bpt>Version<ept id=\"p6\">*</ept>), plus the following additional attributes: <bpt id=\"p7\">*</bpt>OpCode<ept id=\"p7\">*</ept> and <bpt id=\"p8\">*</bpt>Type<ept id=\"p8\">*</ept>."},{"pos":[15304,15318],"content":"<bpt id=\"p1\">*</bpt>OpCode<ept id=\"p1\">*</ept> is..."},{"pos":[15320,15463],"content":"<bpt id=\"p1\">*</bpt>Type<ept id=\"p1\">*</ept> specifies the mode of filtering the targeted region, including or excluding it based on the conditions described in the following table."},{"content":"Type of filter","pos":[15467,15481]},{"content":"Description","pos":[15484,15495]},{"content":"Out","pos":[15711,15714]},{"content":"Exclude the target region when the triggering event or region is found.","pos":[15728,15799]},{"content":"OutPost","pos":[15833,15840]},{"content":"Exclude the target region when the target occurred after the most recent triggering event or region.","pos":[15850,15950]},{"content":"OutPrev","pos":[15955,15962]},{"content":"Exclude the target region when the target occurred prior to the first triggering event or region.","pos":[15972,16069]},{"content":"In","pos":[16077,16079]},{"content":"Include the target region only when the triggering event or region is found.","pos":[16094,16170]},{"content":"InPost","pos":[16199,16205]},{"content":"Include the target region only when it occurred after the most recent triggering event or region.","pos":[16216,16313]},{"content":"InPrev","pos":[16321,16327]},{"content":"Include the target region only when it occurred prior to the first triggering event or region.","pos":[16338,16432]},{"content":"Parent-child relationships","pos":[16449,16475]},{"content":"You can define a region within another to create a parent-child relationship.","pos":[16477,16554]},{"content":"For a region to be a parent, it must have a start time that is earlier than or equal to the start time of the child region.","pos":[16555,16678]},{"content":"It must also have a stopping time that is later than or equal to the stopping time of the child region.","pos":[16679,16782]},{"content":"If these conditions are not met, a parent-child relationship cannot be formed.","pos":[16783,16861]},{"content":"To specify additional criteria for a parent region, use the <bpt id=\"p1\">**</bpt>Parent<ept id=\"p1\">**</ept> node within a <bpt id=\"p2\">**</bpt>Match<ept id=\"p2\">**</ept> node.","pos":[16863,16963]},{"content":"The <bpt id=\"p1\">**</bpt>Parent<ept id=\"p1\">**</ept> node has the same attributes and child nodes as the <bpt id=\"p2\">**</bpt>Event<ept id=\"p2\">**</ept> node used in region-level matching.","pos":[16964,17076]},{"content":"You can specify that the parent and child regions must have the same thread ID, process ID, activity ID, and any number of matching payload fields.","pos":[17077,17224]},{"content":"When using payload fields, if you specify only the <bpt id=\"p1\">*</bpt>FieldName<ept id=\"p1\">*</ept> attribute, then both the parent and child regions must have matching payload values for that field.","pos":[17226,17388]},{"content":"If you also specify the <bpt id=\"p1\">*</bpt>TargetFieldName<ept id=\"p1\">*</ept> attribute, then the <bpt id=\"p2\">*</bpt>TargetFieldName<ept id=\"p2\">*</ept> attribute applies to the parent as well as the child, meaning that the child region must have a payload value for the <bpt id=\"p3\">*</bpt>FieldName<ept id=\"p3\">*</ept> field that matches the payload value for the <bpt id=\"p4\">*</bpt>TargetFieldName<ept id=\"p4\">*</ept> field in the parent.","pos":[17389,17682]},{"content":"If a child has more than one potential parent, the parent with the earliest starting time is chosen.","pos":[17684,17784]},{"content":"Example","pos":[17790,17797]},{"content":"The example below defines criteria for a parent.","pos":[17799,17847]},{"content":"The parent must have a matching thread ID, and a payload value for the <ph id=\"ph1\">`SubscriberName`</ph> field in the child must match a value for the <ph id=\"ph2\">`Client`</ph> field in the parent.","pos":[17848,18011]},{"content":"Self-nesting regions","pos":[18813,18833]},{"pos":[18835,18915],"content":"<bpt id=\"p1\">*</bpt>Self-nesting<ept id=\"p1\">*</ept> is an optional feature that optimizes parent-child relationships."},{"content":"A <bpt id=\"p1\">*</bpt>self-nesting region<ept id=\"p1\">*</ept> is one whose duration is contained wholly within the duration of a sibling region.","pos":[18917,19023]},{"content":"This region effectively becomes a child of its longer-lasting sibling.","pos":[19024,19094]},{"content":"For example, assume that self-nesting is enabled for the following regions:","pos":[19096,19171]},{"content":"Parent region A","pos":[19177,19192]},{"content":"Child region B1, which starts at time 0 and stops at time 6","pos":[19198,19257]},{"content":"Child region B2, which starts at time 2 and stops at time 5","pos":[19263,19322]},{"content":"Child region B3, which starts at time 3 and stops at time 4","pos":[19328,19387]},{"content":"In this example, B2 becomes a child region of B1, and B3 becomes a child region of B2.","pos":[19389,19475]},{"content":"When creating this type of parent-child relationship, the parent with the starting time closest to the child starting time is chosen.","pos":[19476,19609]},{"pos":[19611,19690],"content":"To activate self-nesting, add a <bpt id=\"p1\">**</bpt>SelfNest<ept id=\"p1\">**</ept> node inside of the <bpt id=\"p2\">**</bpt>Match<ept id=\"p2\">**</ept> node."},{"content":"The <bpt id=\"p1\">**</bpt>SelfNest<ept id=\"p1\">**</ept> node has no required parameters.","pos":[19692,19741]},{"content":"You can, however, use the same matching parameters that are used to create ordinary parent-child relationships.","pos":[19742,19853]},{"content":"For more information, see <bpt id=\"p1\">**</bpt>Parent-child relationships<ept id=\"p1\">**</ept> earlier in this topic.","pos":[19854,19933]},{"content":"Examples","pos":[19939,19947]},{"pos":[19949,20028],"content":"The following example defines a <bpt id=\"p1\">**</bpt>Match<ept id=\"p1\">**</ept> tag that simply invokes self-nesting:"},{"content":"The following example defines a more complex self-nesting scenario that requires matching thread IDs and payload fields:","pos":[20079,20199]},{"content":"Instance names","pos":[20323,20337]},{"content":"You can assign a unique name to each instance of a matched region by using the <bpt id=\"p1\">**</bpt>Naming<ept id=\"p1\">**</ept> node.","pos":[20339,20434]},{"content":"Naming is useful when you have a large number of instances of the same region or when you need to categorize regions based on other criteria.","pos":[20435,20576]},{"content":"Instance names can be based on either payload fields or on relationships with other regions.","pos":[20577,20669]},{"content":"Instances can be named based on payload values by using the <bpt id=\"p1\">**</bpt>PayloadBased<ept id=\"p1\">**</ept> node within a <bpt id=\"p2\">**</bpt>Naming<ept id=\"p2\">**</ept> node.","pos":[20671,20778]},{"content":"The <bpt id=\"p1\">**</bpt>PayloadBased<ept id=\"p1\">**</ept> node has one required attribute, <bpt id=\"p2\">*</bpt>NameField<ept id=\"p2\">*</ept>, that specifies the payload field whose values you want to use as instance names.","pos":[20779,20926]},{"content":"These payload fields can be in either the starting or stopping point for the region.","pos":[20927,21011]},{"pos":[21013,21086],"content":"Following is an example of a region with a payload-based <bpt id=\"p1\">**</bpt>Naming<ept id=\"p1\">**</ept> node:"},{"content":"In the preceding example, the <bpt id=\"p1\">**</bpt>Naming<ept id=\"p1\">**</ept> node indicates that either the starting or the stopping event contains a payload field named <ph id=\"ph1\">`SubscriberName`</ph>.","pos":[21785,21936]},{"content":"For each instance of the region that is created, the instance name is the associated payload value.","pos":[21937,22036]},{"content":"Note","pos":[22040,22044]},{"content":"When naming region instances, WPA first checks the starting event for the matching payload field.","pos":[22049,22146]},{"content":"If one is not found, WPA will then search the stopping event for the payload field.","pos":[22147,22230]},{"content":"If a match is not found in either event, an error is printed to the console.","pos":[22231,22307]},{"content":"Sometimes, the information in the payload is not the only information we want.","pos":[22312,22390]},{"content":"For example, if the information in the payload contained is a device ID, we may wish to map this information back to a device description and name.","pos":[22391,22538]},{"content":"Supported <bpt id=\"p1\">*</bpt>Type<ept id=\"p1\">*</ept> attributes are:","pos":[22539,22571]},{"pos":[22585,22620],"content":", associates a name and description"},{"pos":[22632,22669],"content":", associates the GUID with the region"},{"pos":[22682,22723],"content":", associates a class name to the class ID"},{"pos":[22734,22779],"content":", associates the process name with the region"},{"content":"If it is possible for the payload value to be found in both the starting and stopping points, you can use the optional <bpt id=\"p1\">*</bpt>InstanceEndpoint<ept id=\"p1\">*</ept> attribute to specify which point to use.","pos":[22877,23055]},{"content":"Possible values for <bpt id=\"p1\">*</bpt>InstanceEndpoint<ept id=\"p1\">*</ept> are <ph id=\"ph1\">`Start`</ph> and <ph id=\"ph2\">`Stop`</ph>.","pos":[23056,23118]},{"content":"You can also name a region based on relationships with other regions.","pos":[23227,23296]},{"content":"To associate with another region, add a <bpt id=\"p1\">**</bpt>RegionBased<ept id=\"p1\">**</ept> node to a <bpt id=\"p2\">**</bpt>Naming<ept id=\"p2\">**</ept> node.","pos":[23297,23379]},{"content":"The <bpt id=\"p1\">**</bpt>RegionBased<ept id=\"p1\">**</ept> node has four required attributes:","pos":[23380,23434]},{"pos":[23440,23488],"content":"<bpt id=\"p1\">*</bpt>RegionGuid<ept id=\"p1\">*</ept>, the GUID of the associated region."},{"content":"<bpt id=\"p1\">*</bpt>Relation<ept id=\"p1\">*</ept>, a conditional value that describes the relationship between the region you are defining and the region with which you are associating.","pos":[23494,23640]},{"content":"Currently, the only supported relationship is <ph id=\"ph1\">`IsPresent`</ph>, meaning that the conditional is true if the associated region is found somewhere in the trace.","pos":[23641,23794]},{"pos":[23800,23917],"content":"<bpt id=\"p1\">*</bpt>IfRelationTrue<ept id=\"p1\">*</ept>, string value that is used as the instance name if the relationship described by <bpt id=\"p2\">*</bpt>Relation<ept id=\"p2\">*</ept> is true."},{"pos":[23923,24042],"content":"<bpt id=\"p1\">*</bpt>IfRelationFalse<ept id=\"p1\">*</ept>, string value that is used as the instance name if the relationship described by <bpt id=\"p2\">*</bpt>Relation<ept id=\"p2\">*</ept> is false."},{"content":"The following example defines a region that has region-based naming.","pos":[24044,24112]},{"content":"If a region with a matching GUID is found somewhere in the trace, then each instance of <ph id=\"ph1\">`Launch`</ph> is named <ph id=\"ph2\">`Warm`</ph>.","pos":[24113,24226]},{"content":"Otherwise, each instance is named <ph id=\"ph1\">`Cold`</ph>.","pos":[24227,24268]},{"content":"Note","pos":[25035,25039]},{"content":"You can see instance names in WPA by hovering the mouse over a region instance in the Regions of Interest graph.","pos":[25044,25156]},{"content":"Metadata","pos":[25165,25173]},{"content":"You can add additional information to a region definition in the form of <bpt id=\"p1\">*</bpt>metadata<ept id=\"p1\">*</ept>, contained within a <bpt id=\"p2\">**</bpt>Metadata<ept id=\"p2\">**</ept> node.","pos":[25175,25297]},{"content":"For example, you might include information in metadata that explains the region criteria so that another user can more easily understand the purpose of the region.","pos":[25298,25461]},{"content":"Metadata is simply additional data—it does not affect the processing of regions.","pos":[25462,25542]},{"content":"WPA adds this metadata to each region instance in the chart view of the Regions of Interest graph.","pos":[25544,25642]},{"content":"To view metadata for matched events in WPA, simply expand the region in the chart view, and scroll to the desired metadata.","pos":[25643,25766]},{"content":"WPA assigns a unique number to the metadata, and the name of the node is displayed as the column information.","pos":[25767,25876]},{"content":"Example","pos":[25882,25889]},{"pos":[25891,25967],"content":"The following example includes a <bpt id=\"p1\">**</bpt>Metadata<ept id=\"p1\">**</ept> node in the region definition:"},{"content":"Related topics","pos":[26736,26750]},{"content":"Regions of Interest","pos":[26754,26773]},{"content":"WPA Features","pos":[26801,26813]}],"content":"---\ntitle: Creating a Regions of Interest File\ndescription: Creating a Regions of Interest File\nMSHAttr:\n- 'PreferredSiteName:MSDN'\n- 'PreferredLib:/library/windows/hardware'\nms.assetid: e8818fd2-3536-4b02-840d-f7d2eb4fbd91\nms.prod: W10\nms.mktglfcycl: operate\nms.sitesec: msdn\n---\n\n# Creating a Regions of Interest File\n\n\nA Regions of Interest file is a valid XML file that contains the following nodes:\n\n-   **InstrumentationManifest**\n\n-   **Instrumentation**\n\n-   **Regions**\n\n-   **RegionsRoot**, a container for all of the defined regions\n\n-   One or more **Region** nodes\n\n**Note**  \nIn a region's definition, the *version* attribute in the XML declaration, such as `version='1.0'`, is optional.\n\n \n\nThe following example is a complete Regions of Interest file that defines a simple region. Explanations for the attributes and nodes within **Region** are described after the example.\n\n``` syntax\n<?xml version='1.0' encoding='utf-8' standalone='yes'?>\n<?Copyright (c) Microsoft Corporation. All rights reserved.?>\n<InstrumentationManifest>\n   <Instrumentation>\n      <Regions>\n         <RegionRoot Guid=\"{EFA7A927-BAE3-48F6-92E1-000000000000}\"\n                     Name=\"Sample Region File Root\"\n                     FriendlyName=\"Root\">\n            <Region Guid=\"{d8d639a0-cf4c-45fb-976a-000111000100}\"\n                    Name=\"FastStartup-Suspend-UserSession-Shutdown\"\n                    FriendlyName=\"User Session Shutdown\">\n               <Start>\n                  <Event Provider=\"{dbe9b383-7cf3-4331-91cc-a3cb16a3b538}\" Id=\"301\" Version=\"0\" />\n               </Start>\n               <Stop>\n                  <Event Provider=\"{331c3b3a-2005-44c2-ac5e-77220c37d6b4}\" Id=\"22\" Version=\"0\" />\n               </Stop>\n            </Region>\n         </RegionRoot>\n      </Regions>\n   </Instrumentation>\n</InstrumentationManifest>\n```\n\nThis topic has the following contents:\n\n-   [Defining a region](#defining-a-region)\n-   [Region types](#region-types)\n-   [Using payload fields to identify events](#using-payload-fields-to-identify-events)\n-   [Matching events for regions](#matching-events-for-regions)\n-   [Filtering a region based on a condition](#filtering-a-region-based-on-a-condition)\n-   [Parent-child relationships](#parent-child-relationships)\n-   [Self-nesting regions](#self-nesting-regions)\n-   [Instance names](#instance-names)\n-   [Metadata](#metadata)\n\n### Defining a region\n\nA region definition contains the following attributes in the **Region** node:\n\n-   *Guid* (required), a GUID for the region.\n\n-   *Name* (required), a unique name for the region. A suggested format for *Name* is `Root-GrandparentName-ParentName-RegionName`.\n\n-   *FriendlyName* (optional), an alternate name for the region.\n\n### Region types\n\nYou can create the following types of regions based on how they start and stop:\n\n-   [Regions based on events](#regions-based-on-events)\n-   [Regions based on duration](#regions-based-on-duration)\n-   [Regions based on other regions](#regions-based-on-other-regions)\n-   [Regions that are containers of other regions](#regions-within-regions)\n\n### Regions based on events\n\nThe most common type of region is one whose starting and stopping points are defined by events.\n\nTo specify an event as the starting or stopping point, you need to provide the following attributes:\n\n-   *Provider*, a GUID that specifies the provider ID for the event.\n\n-   *Id*, an unsigned short that specifies the ID of the event.\n\n-   *Version*, an unsigned char that specifies the event version.\n\nAdditionally, you can further refine your definition by adding one or more **PayloadIdentifier** nodes. These tags contain two string attributes, *FieldName* and *FieldValue*, that specify a field that the event must contain. **PayloadIdentifier** tags are further described below in **Using payload fields to identify events**.\n\n### Examples\n\nFollowing is a basic example for this type of region:\n\n``` syntax\n<Region Guid=\"{d8d639a0-cf4c-45fb-976a-000111000100}\"\n        Name=\"FastStartup-Suspend-UserSession-Shutdown\"\n        FriendlyName=\"User Session Shutdown\">\n   <Start>\n      <Event Provider=\"{dbe9b383-7cf3-4331-91cc-a3cb16a3b538}\" Id=\"301\" Version=\"0\" />\n   </Start>\n   <Stop>\n      <Event Provider=\"{331c3b3a-2005-44c2-ac5e-77220c37d6b4}\" Id=\"22\" Version=\"0\" />\n   </Stop>\n</Region>\n```\n\nIn the following example, the region ends only when the specified event contains a field named `StartOrStop` with a value of `Stop`:\n\n``` syntax\n<Region Guid=\"{d8d639a0-cf4c-45fb-976a-000111000100}\"\n        Name=\"FastStartup-Suspend-UserSession-Shutdown\"\n        FriendlyName=\"User Session Shutdown\">\n   <Start>\n      <Event Provider=\"{dbe9b383-7cf3-4331-91cc-a3cb16a3b538}\" Id=\"301\" Version=\"0\" />\n   </Start>\n   <Stop>\n      <Event Provider=\"{331c3b3a-2005-44c2-ac5e-77220c37d6b4}\" Id=\"22\" Version=\"0\" />\n      <PayloadIdentifier FieldName=\"StartOrStop\" FieldValue=\"Stop\" />\n   </Stop>\n</Region>\n```\n\n### Regions based on duration\n\nMany ETW events are defined as a single stop event with a duration payload field. We can calculate the starting point by subtracting the duration from the stop event time.\n\nThe **Duration** tag can be used within a **Start** or **Stop** tag to specify a payload field from which to grab duration information. If you define a duration for the starting point, the duration is subtracted from the stopping point. Similarly, if you define a duration for the stopping point, the duration is added to the starting point.\n\nThe **Duration** node can have the following attributes:\n\n-   *Provider*, a GUID that specifies the provider ID for the event that contains the payload field.\n\n-   *Id*, an unsigned short that specifies the ID of the event that contains the payload field.\n\n-   *Version*, an unsigned char that specifies the version of the event that contains the payload field.\n\n-   *Duration*, a string that specifies the name of the payload field.\n\n-   *Multiplier*. WPA requires the duration to be in nanoseconds. Use this attribute to convert the duration to nanoseconds, if necessary. For example, use 1000000 (one million) to convert milliseconds to nanoseconds.\n\nIf you define a duration for the starting point, the duration is subtracted from the stopping point. Similarly, if you define a duration for the stopping point, the duration is added to the starting point.\n\n### Example\n\nThe following example defines a region that stops when another region starts. To calculate the starting point, we subtract a duration from our stopping point. The duration is found in the HiberHiberFileTime payload field. We then multiply the duration by 1,000,000 to convert it to nanoseconds and subtract it from the stopping point.\n\n``` syntax\n<Region Guid=\"{7D6BA3F6-BC04-4776-8A7F-93CF7F4E2B6D}\"\n   Name=\"FastStartup-Suspend-WriteHiberFile\"\n   FriendlyName=\"Subscribers for Create Session\">\n   <Region Guid=\"{93783B2C-A67F-49cb-89BC-BF305D7E2CEA}\"\n         Name=\"FastStartup-Suspend-Winlogon-CreateSession-Subscribers-Child\"\n         FriendlyName=\"Hiberfile Write\">\n      <Start>\n         <Duration Provider=\"{331c3b3a-2005-44c2-ac53-77220c37d6b4}\" \n                   Id=\"117\"\n                   Version=\"0\"\n                   Duration=\"HiberHiberFileTime\"\n                   Multiplier=\"1000000\" />\n      </Start>\n      <Stop>\n         <Region RegionGuid=\"{EC1BB2D9-4AA8-4d82-84AA-6042FF4CFBE3}\" />\n      </Stop>\n   </Region>\n</Region>\n```\n\n### Regions based on other regions\n\nYou can define a region whose starting and stopping points are defined by other regions by using a **Region** node within the **Start** or **Stop** node. This Region node has one mandatory attribute, *RegionGuid*, that specifies the GUID of the target region.\n\nBy default, a region whose starting point is based on another region will start when the starting point region stops. Similarly, a region whose stopping point is based on another region will stop when the stopping point region starts. You can override this default behavior by adding an optional attribute, *Endpoint*, to the Region node. *Endpoint* can have a value of `Start` or `Stop` and specifies which endpoint of the region to use for the starting or stopping event.\n\n### Example\n\nThe following region definition contains starting and stopping points that are defined by other regions:\n\n``` syntax\n<Region Guid=\"{93783B2C-A67F-49cb-89BC-BF305D7E2CEA}\"\n        Name=\"FastStartup-Suspend-HiberInitTime\"\n        FriendlyName=\"Hiberfile Initialization\">\n   <Start>\n      <Region RegionGuid=\"{5E81D74C-0CCC-43f9-8119-953F827BCD12}\" />\n   </Start>\n   <Stop>\n      <Region RegionGuid=\"{7D6BA3F6-BC04-4776-8A7F-93CF7F4E2B6D}\" />\n   </Stop>\n</Region>\n```\n\n### <a href=\"\" id=\"regions-within-regions\"></a>Regions that are containers of other regions\n\nRegions that contain other regions are called *containers*. Containers start when the first instance of a contained region starts, and they stop when the last instance stops. These regions do not have any other attributes.\n\n**RegionRoot** is a container for all of the regions that you define. Thus, **RegionRoot** starts when the first instance of a region starts, and it stops when the last instance of a region stops.\n\nTo define a container region, simply define a region without a starting point or a stopping point.\n\n### Example\n\nIn the example below, *Subscribers for Create Session* is a container for *Child of Subscribers of Create Session*. Notice that *Subscribers for Create Session* does not have a starting point or a stopping point. It will start when the first instance of a child region starts and stop when the last instance of a child region stops.\n\n``` syntax\n<Region Guid=\"{A75D8F5D-E8F8-40b8-B453-5CC70DEAC06F}\"\n   Name=\"FastStartup-Suspend-Winlogon-CreateSession-Subscribers\"\n   FriendlyName=\"Subscribers for Create Session\">\n   <Region Guid=\"{93783B2C-A67F-49cb-89BC-BF305D7E2CEA}\"\n           Name=\"FastStartup-Suspend-Winlogon-CreateSession-Subscribers-Child\"\n           FriendlyName=\"Child of Subscribers for Create Session\">\n      <Start>\n         <Region RegionGuid=\"{5E81D74C-0CCC-43f9-8119-953F827BCD12}\" />\n      </Start>\n      <Stop>\n         <Region RegionGuid=\"{7D6BA3F6-BC04-4776-8A7F-93CF7F4E2B6D}\" \n                 Endpoint=\"Stop\" />\n      </Stop>\n   </Region>\n</Region>\n```\n\n### Using payload fields to identify events\n\nOften the event ID properties (process ID, thread ID, and activity ID) are not enough to identify specific scenarios. For example, when a service starts, a generic event is fired that might not identify which service started. When this occurs, you must rely on *payload fields* for additional information. In this case, one of the additional fields should include the service name. You can use this information to further specify region starting and stopping points.\n\nTo use payload fields as additional event identifiers, add one or more **PayloadIdentifier** nodes to a **Start** or **Stop** node.\n\nThe **PayloadIdentifier** node has the following attributes:\n\n-   *FieldName* (required), the name of the payload field.\n\n-   *FieldValue* (required), the payload value.\n\n-   *FieldValueRelationship* (optional). Use **IsEqual** to specify that the event must contain the payload value. Use **DoesNotContain** to specify that the event must not contain the payload value. If this attribute is not specified, the default value is **IsEqual**.\n\n**Note**  \nPayload fields are case-sensitive, and the XML definition must fully match the payload value. For example, if a payload field has a value of `00000`, the region definition must also specify `00000` as the payload value.\n\n \n\n### Example\n\nThe following example contains **PayloadIdentifier** nodes for both the starting point and the stopping point:\n\n``` syntax\n<Region Guid=\"{AB719FB1-D863-4305-AE8E-F21281899A85}\"\n        Name=\"FastStartup-ConsoleSessionDisconnect\"\n        FriendlyName=\"Console Session Disconnect\">\n   <Start>\n      <Event Provider=\"{dbe9b383-7cf3-4331-91cc-a3cb16a3b538}\" Id=\"801\" Version=\"0\" />\n      <PayloadIdentifier FieldName=\"Event\" FieldValue=\"8\" />\n      <PayloadIdentifier FieldName=\"Key\" FieldValue=\"00000\" />\n   </Start>\n   <Stop>\n      <Event Provider=\"{dbe9b383-7cf3-4331-91cc-a3cb16a3b538}\" Id=\"802\" Version=\"0\" />\n      <PayloadIdentifier FieldName=\"Event\"\n                         FieldValue=\"20\"\n                         FieldValueRelationship=\"DoesNotContain\" />\n   </Stop>\n</Region>\n```\n\n### Matching events for regions\n\nWPA matches starting events with stopping events to form regions in a process called *event matching*. At the event level, WPA attempts to match a single starting or stopping event based on its provider ID, event ID, event version, and any additional specified payload fields.\n\nMatching can also be extended to the region level, where criteria can be specified that must be met by both the starting and stopping points. At the region level, you can require that both points have matching thread IDs, process IDs, and activity IDs. Additionally, you can also define payload criteria at the region level.\n\nYou can use region-level matching by including a **Match** node inside of the **Region** node. The **Match** node contains a child node, **Event**, that can have any combination of the following attributes:\n\n-   `TID=\"true\"` – require matching thread IDs\n\n-   `PID=\"true\"` – require matching process IDs\n\n-   `AID=\"true\"` – require matching activity IDs\n\nThe **Event** node can have an optional **Payload** child node that contains a *FieldName* attribute. This node requires that both the starting and stopping nodes contain matching payload values for the specified *FieldName*.\n\nAlternatively, the **Payload** node can also contain an optional attribute, *TargetFieldName*. If this attribute is specified, then *FieldName* corresponds to a payload field only in the starting node, while *TargetFieldName* corresponds to a payload field in the stopping node.\n\n### Example\n\nThe following example forms a region when the starting event contains a payload field, *SubscriberName*, whose value matches that of a payload field, *Client*, in the stopping node. The starting and stopping events must also have matching thread IDs.\n\n``` syntax\n<Region Guid=\"{A75D8F5D-E8F8-40b8-B453-5CCC70DEAC06F}\"\n        Name=\"FastStartup-Suspend-Winlogon-CreateSession-Subscribers\"\n        FriendlyName=\"Subscribers for Create Session\">\n   <Start>\n      <Event Provider=\"{dbe9b383-7cf3-4331-91cc-a3cb16a3b538}\" Id=\"805\" Version=\"0\" />\n      <PayloadIdentifier FieldName=\"Event\" FieldValue=\"0\" />\n   </Start>\n   <Stop>\n      <Event Provider=\"{dbe9b383-7cf3-4331-91cc-a3cb16a3b538}\" Id=\"806\" Version=\"0\" />\n      <PayloadIdentifier FieldName=\"Event\" FieldValue=\"0\" />\n   </Stop>\n   <Match>\n      <Event TID=\"true\">\n         <Payload FieldName=\"SubscriberName\" TargetFieldName=\"Client\" />\n      </Event>\n   </Match>\n</Region>\n```\n\n### Filtering a region based on a condition\n\nWPA can include or exclude a region based on a condition, or *trigger*, which can be an event or another region. The trigger is specified in a **Filter** node, and the region that contains **Filter** is called the *target*.\n\nEach **Filter** node contains one **Event** node with the attributes described earlier in [Region types](#region-types) (*Provider*, *Id*, and *Version*), plus the following additional attributes: *OpCode* and *Type*.\n\n*OpCode* is...\n\n*Type* specifies the mode of filtering the targeted region, including or excluding it based on the conditions described in the following table.\n\n| Type of filter | Description                                                                                          |\n|----------------|------------------------------------------------------------------------------------------------------|\n| Out            | Exclude the target region when the triggering event or region is found.                              |\n| OutPost        | Exclude the target region when the target occurred after the most recent triggering event or region. |\n| OutPrev        | Exclude the target region when the target occurred prior to the first triggering event or region.    |\n| In             | Include the target region only when the triggering event or region is found.                         |\n| InPost         | Include the target region only when it occurred after the most recent triggering event or region.    |\n| InPrev         | Include the target region only when it occurred prior to the first triggering event or region.       |\n\n \n\n### Parent-child relationships\n\nYou can define a region within another to create a parent-child relationship. For a region to be a parent, it must have a start time that is earlier than or equal to the start time of the child region. It must also have a stopping time that is later than or equal to the stopping time of the child region. If these conditions are not met, a parent-child relationship cannot be formed.\n\nTo specify additional criteria for a parent region, use the **Parent** node within a **Match** node. The **Parent** node has the same attributes and child nodes as the **Event** node used in region-level matching. You can specify that the parent and child regions must have the same thread ID, process ID, activity ID, and any number of matching payload fields.\n\nWhen using payload fields, if you specify only the *FieldName* attribute, then both the parent and child regions must have matching payload values for that field. If you also specify the *TargetFieldName* attribute, then the *TargetFieldName* attribute applies to the parent as well as the child, meaning that the child region must have a payload value for the *FieldName* field that matches the payload value for the *TargetFieldName* field in the parent.\n\nIf a child has more than one potential parent, the parent with the earliest starting time is chosen.\n\n### Example\n\nThe example below defines criteria for a parent. The parent must have a matching thread ID, and a payload value for the `SubscriberName` field in the child must match a value for the `Client` field in the parent.\n\n``` syntax\n<Region Guid=\"{A75D8F5D-E8F8-40b8-B453-5CC70DEAC06F}\"\n        Name=\"FastStartup-Suspend-Winlogon-CreateSession-Subscribers\"\n        FriendlyName=\"Subscribers for Create Session\">\n   <Start>\n      <Event Provider=\"{dbe9b383-7cf3-4331-91cc-a3cb16a3b538}\" Id=\"805\" Version=\"0\" />\n      <PayloadIdentifier FieldName=\"Event\" FieldValue=\"0\" />\n   </Start>\n   <Stop>\n      <Event Provider=\"{dbe9b383-7cf3-4331-91cc-a3cb16a3b538}\" Id=\"806\" Version=\"0\" />\n      <PayloadIdentifier FieldName=\"Event\" FieldValue=\"0\" />\n   </Stop>\n   <Match>\n      <Event TID=\"true\">\n         <Payload FieldName=\"SubscriberName\" TargetFieldName=\"Client\" />\n      </Event>\n      <Parent TID=\"true\">\n         <Payload FieldName=\"SubscriberName\" TargetFieldName=\"Client\" />\n      </Parent>\n   </Match>\n</Region>\n```\n\n### Self-nesting regions\n\n*Self-nesting* is an optional feature that optimizes parent-child relationships.\n\nA *self-nesting region* is one whose duration is contained wholly within the duration of a sibling region. This region effectively becomes a child of its longer-lasting sibling.\n\nFor example, assume that self-nesting is enabled for the following regions:\n\n-   Parent region A\n\n-   Child region B1, which starts at time 0 and stops at time 6\n\n-   Child region B2, which starts at time 2 and stops at time 5\n\n-   Child region B3, which starts at time 3 and stops at time 4\n\nIn this example, B2 becomes a child region of B1, and B3 becomes a child region of B2. When creating this type of parent-child relationship, the parent with the starting time closest to the child starting time is chosen.\n\nTo activate self-nesting, add a **SelfNest** node inside of the **Match** node.\n\nThe **SelfNest** node has no required parameters. You can, however, use the same matching parameters that are used to create ordinary parent-child relationships. For more information, see **Parent-child relationships** earlier in this topic.\n\n### Examples\n\nThe following example defines a **Match** tag that simply invokes self-nesting:\n\n``` syntax\n<Match>\n   <SelfNest />\n</Match>\n```\n\nThe following example defines a more complex self-nesting scenario that requires matching thread IDs and payload fields:\n\n``` syntax\n<Match>\n   <SelfNest TID=\"true\">\n      <Payload FieldName=\"SubscriberName\" />\n   </SelfNest>\n</Match>\n```\n\n### Instance names\n\nYou can assign a unique name to each instance of a matched region by using the **Naming** node. Naming is useful when you have a large number of instances of the same region or when you need to categorize regions based on other criteria. Instance names can be based on either payload fields or on relationships with other regions.\n\nInstances can be named based on payload values by using the **PayloadBased** node within a **Naming** node. The **PayloadBased** node has one required attribute, *NameField*, that specifies the payload field whose values you want to use as instance names. These payload fields can be in either the starting or stopping point for the region.\n\nFollowing is an example of a region with a payload-based **Naming** node:\n\n``` syntax\n<Region Guid=\"{9261872F-D3A7-4d80-BDE3-8479CC920639}\"\n        Name=\"FastStartup-Suspend-Winlogon-EndShell-CallSubscriber\"\n        FriendlyName=\"Call Subscriber for End Shell\">\n   <Start>\n      <Event Provider=\"{dbe9b383-7cf3-4331-91cc-a3cb16a3b538}\" Id=\"811\" Version=\"0\" />\n      <PayloadIdentifier FieldName=\"Event\" FieldValue=\"13\" />\n   </Start>\n   <Stop>\n      <Event Provider=\"{dbe9b383-7cf3-4331-91cc-a3cb16a3b538}\" Id=\"812\" Version=\"0\" />\n      <PayloadIdentifier FieldName=\"Event\" FieldValue=\"13\" />\n   </Stop>\n   <Match>\n      <Event PID=\"true\" />\n      <Parent PID=\"true\" />\n   </Match>\n   <Naming>\n      <PayloadBased NameField=\"SubscriberName\" />\n   </Naming>\n</Region>\n```\n\nIn the preceding example, the **Naming** node indicates that either the starting or the stopping event contains a payload field named `SubscriberName`. For each instance of the region that is created, the instance name is the associated payload value.\n\n**Note**  \nWhen naming region instances, WPA first checks the starting event for the matching payload field. If one is not found, WPA will then search the stopping event for the payload field. If a match is not found in either event, an error is printed to the console.\n\n \n\nSometimes, the information in the payload is not the only information we want. For example, if the information in the payload contained is a device ID, we may wish to map this information back to a device description and name. Supported *Type* attributes are:\n\n-   `Device`, associates a name and description\n\n-   `GUID`, associates the GUID with the region\n\n-   `CLSID`, associates a class name to the class ID\n\n-   `PID`, associates the process name with the region\n\n``` syntax\n<Naming>\n   <PayloadBased NameField=\"SubscriberName\" Type=\"Device\" />\n</Naming>\n```\n\nIf it is possible for the payload value to be found in both the starting and stopping points, you can use the optional *InstanceEndpoint* attribute to specify which point to use. Possible values for *InstanceEndpoint* are `Start` and `Stop`.\n\n``` syntax\n<Naming>\n   <PayloadBased NameField=\"SubscriberName\" InstanceEndpoint=\"Start\" />\n</Naming>\n```\n\nYou can also name a region based on relationships with other regions. To associate with another region, add a **RegionBased** node to a **Naming** node. The **RegionBased** node has four required attributes:\n\n-   *RegionGuid*, the GUID of the associated region.\n\n-   *Relation*, a conditional value that describes the relationship between the region you are defining and the region with which you are associating. Currently, the only supported relationship is `IsPresent`, meaning that the conditional is true if the associated region is found somewhere in the trace.\n\n-   *IfRelationTrue*, string value that is used as the instance name if the relationship described by *Relation* is true.\n\n-   *IfRelationFalse*, string value that is used as the instance name if the relationship described by *Relation* is false.\n\nThe following example defines a region that has region-based naming. If a region with a matching GUID is found somewhere in the trace, then each instance of `Launch` is named `Warm`. Otherwise, each instance is named `Cold`.\n\n``` syntax\n<Region Guid=\"{C99EFA90-F645-4A24-9576-740351171BD0}\"\n        Name=\"WinStoreAppActivationDuration\"\n        FriendlyName=\"Launch\">\n   <Start>\n      <Event Provider=\"{315a8872-923e-4ea2-9889-33cd4754bf64}\" Id=\"5901\" Version=\"0\" />\n      <PayloadIdentifier FieldName=\"SqmableContractID\" FieldValue=\"Windows.Launch\" />\n   </Start>\n   <Stop>\n      <Event Provider=\"{315a8872-923e-43a2-9889-33cd4754bf64}\" Id=\"5902\" Version=\"0\" />\n      <PayloadIdentifier FieldName=\"SqmableContractID\" FieldValue=\"Windows.Launch\" />\n   </Stop>\n   <Match>\n      <Event PID=\"true\" />\n   </Match>\n   <Naming>\n      <RegionBased RegionGuid=\"{1539A93E-129C-4602-A011-431E7F73A353}\" Relation=\"IsPresent\" IfRelationTrue=\"Warm\" IfRelationFalse=\"Cold\" />\n   </Naming>\n</Region>\n```\n\n**Note**  \nYou can see instance names in WPA by hovering the mouse over a region instance in the Regions of Interest graph.\n\n \n\n### Metadata\n\nYou can add additional information to a region definition in the form of *metadata*, contained within a **Metadata** node. For example, you might include information in metadata that explains the region criteria so that another user can more easily understand the purpose of the region. Metadata is simply additional data—it does not affect the processing of regions.\n\nWPA adds this metadata to each region instance in the chart view of the Regions of Interest graph. To view metadata for matched events in WPA, simply expand the region in the chart view, and scroll to the desired metadata. WPA assigns a unique number to the metadata, and the name of the node is displayed as the column information.\n\n### Example\n\nThe following example includes a **Metadata** node in the region definition:\n\n``` syntax\n<Region Guid=\"{F466EE67-192C-4772-B13D-052CCD2D70B3}\"\n        Name=\"FastStartup-Suspend-Winlogon-Logoff-Subscribers\"\n        FriendlyName=\"Subscribers for Logoff\">\n   <Start>\n      <Event Provider=\"{dbe9b383-7cf3-4331-91cc-a3cb16a3b538}\" Id=\"805\" Version=\"0\" />\n      <PayloadIdentifier FieldName=\"Event\" FieldValue=\"3\" />\n   </Start>\n   <Stop>\n      <Event Provider=\"{db39b383-7cf3-4331-91cc-a3cb16a3b538}\" Id=\"806\" Version=\"0\" />\n      <PayloadIdentifier FieldName=\"Event\" FieldValue=\"3\" />\n   </Stop>\n   <Match>\n      <Event>\n         <Payload FieldName=\"Event\" />\n      </Event>\n   </Match>\n   <Naming>\n      <PayloadBased NameField=\"SubscriberName\" />\n   </Naming>\n   <Metadata>\n      <FAS.TestNode>yes</FAS.TestNode>\n   </Metadata>\n</Region>\n```\n\n## Related topics\n\n\n[Regions of Interest](regions-of-interest.md)\n\n[WPA Features](wpa-features.md)\n\n \n\n \n\n\n\n\n\n\n\n"}