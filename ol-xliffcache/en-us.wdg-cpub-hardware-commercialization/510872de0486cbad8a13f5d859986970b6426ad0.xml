{"nodes":[{"content":"Add a Driver Online in Audit Mode","pos":[34,67]},{"content":"Add a Driver Online in Audit Mode","pos":[174,207]},{"content":"Add a Driver Online in Audit Mode","pos":[215,248]},{"content":"You can use an answer file to automate the installation of device drivers when the computer is booted in audit mode.","pos":[251,367]},{"pos":[422,444],"content":"Adding a Device Driver"},{"content":"The <bpt id=\"p1\">[</bpt>auditSystem<ept id=\"p1\">](auditsystem.md)</ept> configuration pass processes unattended Setup settings while Windows is running in system context, before a user logs on to the computer in audit mode.","pos":[447,632]},{"content":"The <bpt id=\"p1\">**</bpt>auditSystem<ept id=\"p1\">**</ept> configuration pass runs only if the computer is booted in audit mode.","pos":[633,722]},{"content":"To add device drivers during the <bpt id=\"p1\">**</bpt>auditSystem<ept id=\"p1\">**</ept> configuration pass, add the <bpt id=\"p2\">[</bpt>Microsoft-Windows-PnpCustomizationsNonWinPE<ept id=\"p2\">](https://msdn.microsoft.com/library/windows/hardware/dn923009)</ept> component to your answer file in the <bpt id=\"p3\">**</bpt>auditSystem<ept id=\"p3\">**</ept> configuration pass, and specify the path for each device driver.","pos":[723,1025]},{"content":"After you run Setup, boot Windows in audit mode.","pos":[1026,1074]},{"content":"You can run the <bpt id=\"p1\">**</bpt>Sysprep<ept id=\"p1\">**</ept> command with the <bpt id=\"p2\">**</bpt>/audit<ept id=\"p2\">**</ept> option to configure the computer to start in audit mode the next time that it boots.","pos":[1075,1215]},{"content":"Or, in the answer file, you can configure the Microsoft-Windows-Deployment<ph id=\"ph1\">\\\\</ph>Reseal<ph id=\"ph2\">\\\\`Mode`</ph> setting to <bpt id=\"p1\">**</bpt>audit<ept id=\"p1\">**</ept>.","pos":[1216,1328]},{"content":"For more information, see <bpt id=\"p1\">[</bpt>Unattended Windows Setup Reference<ept id=\"p1\">](https://msdn.microsoft.com/library/windows/hardware/dn923277)</ept>.","pos":[1329,1454]},{"pos":[1709,1773],"content":"To add a device driver during the auditSystem configuration pass"},{"content":"Locate the .inf files that you want to install during audit mode for the device driver.","pos":[1779,1866]},{"content":"On your technician computer, open Windows System Image Manager (Windows SIM).","pos":[1872,1949]},{"content":"Click <bpt id=\"p1\">**</bpt>Start<ept id=\"p1\">**</ept>, type <bpt id=\"p2\">**</bpt>Windows System Image Manager<ept id=\"p2\">**</ept>, and then select <bpt id=\"p3\">**</bpt>Windows System Image Manager<ept id=\"p3\">**</ept>.","pos":[1950,2055]},{"pos":[2061,2148],"content":"Open your answer file and expand the <bpt id=\"p1\">**</bpt>Components<ept id=\"p1\">**</ept> node to display available settings."},{"pos":[2154,2278],"content":"Add the Microsoft-Windows-PnpCustomizationsNonWinPE component to your answer file in the <bpt id=\"p1\">**</bpt>auditSystem<ept id=\"p1\">**</ept> configuration pass."},{"content":"Expand the <bpt id=\"p1\">**</bpt>Microsoft-Windows-PnpCustomizationsNonWinPE<ept id=\"p1\">**</ept> node in the answer file.","pos":[2284,2367]},{"content":"Right-click <bpt id=\"p1\">**</bpt>DevicePaths<ept id=\"p1\">**</ept>, and then click <bpt id=\"p2\">**</bpt>Insert New PathAndCredentials<ept id=\"p2\">**</ept>.","pos":[2368,2446]},{"pos":[2452,2499],"content":"A new <bpt id=\"p1\">**</bpt>PathAndCredentials<ept id=\"p1\">**</ept> list item appears."},{"pos":[2505,2588],"content":"For each location that you access, add a separate <bpt id=\"p1\">**</bpt>PathAndCredentials<ept id=\"p1\">**</ept> list item."},{"content":"In the Microsoft-Windows-PnpCustomizationsNonWinPE component, specify the path of the device driver and the credentials that are used to access the file if the file is on a network share.","pos":[2594,2781]},{"pos":[2787,3133],"content":"**Note**  \nYou can include multiple device-driver paths by adding multiple **PathAndCredentials** list items. If you add multiple list items, you must increment the value of `Key` for each path. For example, if you add two separate driver paths, the first path uses the `Key` value of **1**, and the second path uses the `Key` value of **2**.","leadings":["","    "],"nodes":[{"content":"Note","pos":[2,6]},{"content":"You can include multiple device-driver paths by adding multiple **PathAndCredentials** list items. If you add multiple list items, you must increment the value of `Key` for each path. For example, if you add two separate driver paths, the first path uses the `Key` value of **1**, and the second path uses the `Key` value of **2**.","pos":[11,342],"nodes":[{"content":"You can include multiple device-driver paths by adding multiple <bpt id=\"p1\">**</bpt>PathAndCredentials<ept id=\"p1\">**</ept> list items.","pos":[0,98]},{"content":"If you add multiple list items, you must increment the value of <ph id=\"ph1\">`Key`</ph> for each path.","pos":[99,183]},{"content":"For example, if you add two separate driver paths, the first path uses the <ph id=\"ph1\">`Key`</ph> value of <bpt id=\"p1\">**</bpt>1<ept id=\"p1\">**</ept>, and the second path uses the <ph id=\"ph2\">`Key`</ph> value of <bpt id=\"p2\">**</bpt>2<ept id=\"p2\">**</ept>.","pos":[184,331]}]}]},{"content":"Save the answer file and close Windows SIM.","pos":[3146,3189]},{"content":"The answer file must resemble this example:","pos":[3190,3233]},{"content":"Boot in Windows Preinstallation Environment (Windows PE), run Windows Setup, and specify the name of the answer file.","pos":[4205,4322]},{"content":"For example:","pos":[4323,4335]},{"content":"The specified answer file is cached to the system so that when you run audit mode, the computer applies settings in the answer file.","pos":[4401,4533]},{"content":"Setup finishes.","pos":[4539,4554]},{"content":"Run the <bpt id=\"p1\">**</bpt>Sysprep<ept id=\"p1\">**</ept> command with the <bpt id=\"p2\">**</bpt>/audit<ept id=\"p2\">**</ept> option to configure the computer to start in audit mode the next time that it boots.","pos":[4560,4692]},{"content":"For example:","pos":[4693,4705]},{"content":"When Windows reboots in audit mode, device drivers that you specified in the answer file are added.","pos":[4762,4861]},{"content":"You can use the PNPUtil tool to add, remove, and enumerate drivers on a running operating system.","pos":[4863,4960]},{"content":"For more information about how to use PNPUtil to add or remove Plug and Play drivers, see <bpt id=\"p1\">[</bpt>Install a Plug and Play Device<ept id=\"p1\">](http://go.microsoft.com/fwlink/?LinkId=139151)</ept>.","pos":[4961,5131]},{"pos":[5169,5183],"content":"Related topics"},{"content":"Device Drivers and Deployment Overview","pos":[5187,5225]},{"content":"Add Device Drivers to Windows During Windows Setup","pos":[5272,5322]},{"content":"DISM Driver Servicing Command-Line Options","pos":[5381,5423]},{"content":"Add and Remove Drivers to an Offline Windows Image","pos":[5478,5528]},{"content":"Audit Mode Overview","pos":[5587,5606]},{"content":"Boot Windows to Audit Mode or OOBE","pos":[5634,5668]}],"content":"---\nauthor: Justinha\nDescription: Add a Driver Online in Audit Mode\nms.assetid: 3b7e2d24-4bd4-4ca3-8e6f-2bd771ebab3b\nMSHAttr: 'PreferredLib:/library/windows/hardware'\ntitle: Add a Driver Online in Audit Mode\n---\n\n# Add a Driver Online in Audit Mode\n\n\nYou can use an answer file to automate the installation of device drivers when the computer is booted in audit mode.\n\n## <span id=\"bkmk_2\"></span><span id=\"BKMK_2\"></span>Adding a Device Driver\n\n\nThe [auditSystem](auditsystem.md) configuration pass processes unattended Setup settings while Windows is running in system context, before a user logs on to the computer in audit mode. The **auditSystem** configuration pass runs only if the computer is booted in audit mode. To add device drivers during the **auditSystem** configuration pass, add the [Microsoft-Windows-PnpCustomizationsNonWinPE](https://msdn.microsoft.com/library/windows/hardware/dn923009) component to your answer file in the **auditSystem** configuration pass, and specify the path for each device driver. After you run Setup, boot Windows in audit mode. You can run the **Sysprep** command with the **/audit** option to configure the computer to start in audit mode the next time that it boots. Or, in the answer file, you can configure the Microsoft-Windows-Deployment\\\\Reseal\\\\`Mode` setting to **audit**. For more information, see [Unattended Windows Setup Reference](https://msdn.microsoft.com/library/windows/hardware/dn923277).\n\n### <span id=\"To_add_a_device_driver_during_the_auditSystem_configuration_pass\"></span><span id=\"to_add_a_device_driver_during_the_auditsystem_configuration_pass\"></span><span id=\"TO_ADD_A_DEVICE_DRIVER_DURING_THE_AUDITSYSTEM_CONFIGURATION_PASS\"></span>To add a device driver during the auditSystem configuration pass\n\n1.  Locate the .inf files that you want to install during audit mode for the device driver.\n\n2.  On your technician computer, open Windows System Image Manager (Windows SIM). Click **Start**, type **Windows System Image Manager**, and then select **Windows System Image Manager**.\n\n3.  Open your answer file and expand the **Components** node to display available settings.\n\n4.  Add the Microsoft-Windows-PnpCustomizationsNonWinPE component to your answer file in the **auditSystem** configuration pass.\n\n5.  Expand the **Microsoft-Windows-PnpCustomizationsNonWinPE** node in the answer file. Right-click **DevicePaths**, and then click **Insert New PathAndCredentials**.\n\n    A new **PathAndCredentials** list item appears.\n\n6.  For each location that you access, add a separate **PathAndCredentials** list item.\n\n7.  In the Microsoft-Windows-PnpCustomizationsNonWinPE component, specify the path of the device driver and the credentials that are used to access the file if the file is on a network share.\n\n    **Note**  \n    You can include multiple device-driver paths by adding multiple **PathAndCredentials** list items. If you add multiple list items, you must increment the value of `Key` for each path. For example, if you add two separate driver paths, the first path uses the `Key` value of **1**, and the second path uses the `Key` value of **2**.\n\n     \n\n8.  Save the answer file and close Windows SIM. The answer file must resemble this example:\n\n    ``` syntax\n    <?xml version=\"1.0\" encoding=\"utf-8\" ?> \n    <unattend xmlns=\"urn:schemas-microsoft-com:unattend\">\n       <settings pass=\"auditSystem\">\n          <component name=\"Microsoft-Windows-PnpCustomizationsNonWinPE\" processorArchitecture=\"x86\" publicKeyToken=\"31bf3856ad364e35\" language=\"neutral\" versionScope=\"nonSxS\" xmlns:wcm=\"http://schemas.microsoft.com/WMIConfig/2002/State\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\">\n             <DriverPaths>\n                <PathAndCredentials wcm:keyValue=\"1\" wcm:action=\"add\">\n                   <Credentials>\n                      <Domain>Fabrikam</Domain> \n                      <Password>MyPassword</Password> \n                      <Username>MyUserName</Username> \n                   </Credentials>\n                   <Path>\\\\networkshare\\share\\drivers</Path> \n                </PathAndCredentials>\n             </DriverPaths>\n          </component>\n       </settings>\n    </unattend>\n    ```\n\n9.  Boot in Windows Preinstallation Environment (Windows PE), run Windows Setup, and specify the name of the answer file. For example:\n\n    ``` syntax\n    Setup /unattend:C:\\unattend.xml\n    ```\n\n    The specified answer file is cached to the system so that when you run audit mode, the computer applies settings in the answer file.\n\n    Setup finishes.\n\n10. Run the **Sysprep** command with the **/audit** option to configure the computer to start in audit mode the next time that it boots. For example:\n\n    ``` syntax\n    Sysprep /audit /reboot\n    ```\n\n    When Windows reboots in audit mode, device drivers that you specified in the answer file are added.\n\nYou can use the PNPUtil tool to add, remove, and enumerate drivers on a running operating system. For more information about how to use PNPUtil to add or remove Plug and Play drivers, see [Install a Plug and Play Device](http://go.microsoft.com/fwlink/?LinkId=139151).\n\n## <span id=\"related_topics\"></span>Related topics\n\n\n[Device Drivers and Deployment Overview](device-drivers-and-deployment-overview.md)\n\n[Add Device Drivers to Windows During Windows Setup](add-device-drivers-to-windows-during-windows-setup.md)\n\n[DISM Driver Servicing Command-Line Options](dism-driver-servicing-command-line-options-s14.md)\n\n[Add and Remove Drivers to an Offline Windows Image](add-and-remove-drivers-to-an-offline-windows-image.md)\n\n[Audit Mode Overview](audit-mode-overview.md)\n\n[Boot Windows to Audit Mode or OOBE](boot-windows-to-audit-mode-or-oobe.md)\n\n \n\n \n\n\n\n\n\n\n"}