{"nodes":[{"content":"Deploy push-button reset features","pos":[357,390]},{"content":"Deploy push-button reset features","pos":[399,432]},{"content":"Push-button reset features are included with Windows 10 for desktop editions (Home, Pro, Enterprise, and Education), though you'll need to perform additional steps to deploy PCs with the following customizations.","pos":[435,647]},{"content":"Classic Windows applications","pos":[653,681]},{"content":"Windows settings, such as customized OOBE screens or Start Menus.","pos":[686,751]},{"content":"Customized partition layouts.","pos":[756,785]},{"content":"These steps also show you how to add your own scripts during a reset to capture logs or perform other cleanup tasks.","pos":[787,903]},{"pos":[1004,1017],"content":"Prerequisites"},{"content":"To complete these procedures, you'll need a technician PC which has Windows 10 and the following Windows Assessment and Deployment Kit (ADK) for Windows 10 components installed:","pos":[1020,1197]},{"content":"Deployment Tools","pos":[1203,1219]},{"content":"Windows Preinstallation Environment (Windows PE)","pos":[1224,1272]},{"content":"Imaging and Configuration Designer (ICD)","pos":[1277,1317]},{"content":"User State Migration Tool (USMT)","pos":[1322,1354]},{"content":"You'll also need:","pos":[1356,1373]},{"content":"A destination PC with drive size of 100 GB or larger","pos":[1379,1431]},{"content":"A Windows 10 for desktop editions image (install.wim)","pos":[1436,1489]},{"content":"A Windows RE boot image (Winre.wim) (You'll extract this from a Windows 10 image).","pos":[1494,1576]},{"pos":[1578,1715],"content":"For an overview of the entire deployment process, see the <bpt id=\"p1\">[</bpt>Desktop manufacturing guide<ept id=\"p1\">](http://go.microsoft.com/fwlink/p/?LinkId=526101)</ept>."},{"content":"Use the follow steps to prepare the ScanState tool to capture Classic Windows applications after they have been installed:","pos":[1717,1839]},{"content":"Step 1: Prepare the ScanState tool","pos":[1843,1877]},{"content":"On the technician PC, copy the Windows ADK files from Windows User State Migration Tool (USMT) and Windows Setup to a working folder.","pos":[1885,2018]},{"content":"You'll need to match the architecture of the destination device.","pos":[2019,2083]},{"content":"You don't need to copy the subfolders.","pos":[2084,2122]},{"content":"In some instances, Windows Defender settings and detection history might be captured into the customizations package by the ScanState tool.","pos":[2447,2586]},{"content":"This can lead to failures during recovery due to file conflicts, and causes the PC to reboot and enter the \"Installing Windows\" phase repeatedly.","pos":[2587,2732]},{"content":"These next steps will prevent the capture of Windows Defender settings.","pos":[2733,2804]},{"content":"Using the ScanState tool on a PC running Windows 10, generate a configuration file:","pos":[2814,2897]},{"content":"Open the configuration file in notepad","pos":[2997,3035]},{"content":"Search for the following lines in the configuration file:","pos":[3044,3101]},{"content":"Modify the \"migrate\" value from \"yes\" to \"no\" for each line.","pos":[3376,3436]},{"content":"For example:","pos":[3437,3449]},{"content":"In step 10 later in this topic, you will specify the configuration file when you use ScanState to capture the customizations into a .ppkg file.","pos":[3721,3864]},{"content":"Save and close the configuration file.","pos":[3874,3912]},{"content":"Copy the contents of the working folder to a network location or USB flash drive.","pos":[3918,3999]},{"content":"Use the following steps to customize your Windows RE boot image if additional drivers and language packs are needed.","pos":[4001,4117]},{"content":"Step 2: Extract and customize the Windows RE boot image (optional)","pos":[4121,4187]},{"content":"On the technician PC, click <bpt id=\"p1\">**</bpt>Start<ept id=\"p1\">**</ept>, and type deployment.","pos":[4195,4254]},{"content":"Right-click <bpt id=\"p1\">**</bpt>Deployment and Imaging Tools Environment<ept id=\"p1\">**</ept> and then select <bpt id=\"p2\">**</bpt>Run as administrator<ept id=\"p2\">**</ept>.","pos":[4255,4353]},{"pos":[4358,4482],"content":"In <bpt id=\"p1\">**</bpt>Deployment and Imaging Tools Environment<ept id=\"p1\">**</ept>, create the folder structure to store the Windows image and its mount point."},{"content":"Create the folder structure to store the Windows RE boot image and its mount point.","pos":[4540,4623]},{"content":"Mount the Windows image (install.wim) to the folder <ph id=\"ph1\">\\\\</ph>OS<ph id=\"ph2\">\\_</ph>image<ph id=\"ph3\">\\\\</ph>mount by using DISM.","pos":[4684,4769]},{"pos":[4893,4968],"content":"where <ph id=\"ph1\">`Index:1`</ph> is the index of the selected image in the Install.wim file."},{"content":"Copy the Windows RE image from the mounted Windows image to the new folder.","pos":[4974,5049]},{"content":"Unmount the Windows image.","pos":[5162,5188]},{"content":"Tip: If you haven't made any other changes in the Windows image, you can unmount the image faster by using the <ph id=\"ph1\">`/discard`</ph> option.","pos":[5189,5318]},{"content":"Mount the Windows RE boot image for editing.","pos":[5409,5453]},{"pos":[5581,5655],"content":"where <ph id=\"ph1\">`Index:1`</ph> is the number of the selected image in the Winre.wim file."},{"content":"Once the Winre.wim file is extracted from the Install.wim file, you can customize the Windows RE boot image.","pos":[5661,5769]},{"content":"Add language packs, boot-critical device drivers, and input device drivers to the Windows RE boot image.","pos":[5775,5879]},{"content":"To learn more, see <bpt id=\"p1\">[</bpt>Customize Windows RE<ept id=\"p1\">](customize-windows-re.md)</ept>.","pos":[5880,5947]},{"content":"Commit your customizations and unmount the image.","pos":[5952,6001]},{"content":"If you are planning to customize only the settings common to all editions of Windows 10 (including Windows 10 Mobile), use the following steps to create a provisioning package which specifies settings to be restored during recovery:","pos":[6091,6323]},{"content":"Step 3: Create a provisioning package with settings to be restored (optional)","pos":[6327,6404]},{"content":"On the technician PC, start Windows Imaging and Configuration Designer (ICD).","pos":[6412,6489]},{"pos":[6494,6530],"content":"Click <bpt id=\"p1\">**</bpt>File<ept id=\"p1\">**</ept> <ph id=\"ph1\">&amp;gt;</ph> <bpt id=\"p2\">**</bpt>New Project<ept id=\"p2\">**</ept>."},{"pos":[6535,6596],"content":"Enter a project name and description, and then click <bpt id=\"p1\">**</bpt>Next<ept id=\"p1\">**</ept>"},{"pos":[6601,6710],"content":"In the <bpt id=\"p1\">**</bpt>Select project workflow<ept id=\"p1\">**</ept> step, select the <bpt id=\"p2\">**</bpt>Provisioning Package<ept id=\"p2\">**</ept> option, and then click <bpt id=\"p3\">**</bpt>Next<ept id=\"p3\">**</ept>."},{"pos":[6715,6854],"content":"In the <bpt id=\"p1\">**</bpt>Choose which settings to view and configure<ept id=\"p1\">**</ept> step, select the <bpt id=\"p2\">**</bpt>Common to all Windows editions<ept id=\"p2\">**</ept> option, and then click <bpt id=\"p3\">**</bpt>Next<ept id=\"p3\">**</ept>."},{"pos":[6859,6960],"content":"In the <bpt id=\"p1\">**</bpt>Import a provisioning package (optional)<ept id=\"p1\">**</ept> step, click <bpt id=\"p2\">**</bpt>Finish<ept id=\"p2\">**</ept> to create the new project."},{"content":"Use the <bpt id=\"p1\">**</bpt>Available customizations<ept id=\"p1\">**</ept> pane to add settings and specify the defaults which should be restored during recovery.","pos":[6965,7089]},{"content":"The settings will appear in the <bpt id=\"p1\">**</bpt>Selected customizations<ept id=\"p1\">**</ept> pane.","pos":[7090,7155]},{"pos":[7160,7207],"content":"Click <bpt id=\"p1\">**</bpt>Export<ept id=\"p1\">**</ept> <ph id=\"ph1\">&amp;gt;</ph> <bpt id=\"p2\">**</bpt>Provisioning package<ept id=\"p2\">**</ept>."},{"pos":[7212,7278],"content":"In the <bpt id=\"p1\">**</bpt>Describe the provisioning package<ept id=\"p1\">**</ept> step, click <bpt id=\"p2\">**</bpt>Next<ept id=\"p2\">**</ept>."},{"pos":[7283,7372],"content":"In the <bpt id=\"p1\">**</bpt>Select the security details for the provisioning package<ept id=\"p1\">**</ept> step, click <bpt id=\"p2\">**</bpt>Next<ept id=\"p2\">**</ept>."},{"pos":[7377,7527],"content":"In the <bpt id=\"p1\">**</bpt>Select where to save the provisioning package<ept id=\"p1\">**</ept> step, enter a location to save the package (such as a network share) and then click <bpt id=\"p2\">**</bpt>Next<ept id=\"p2\">**</ept>."},{"pos":[7532,7583],"content":"Click <bpt id=\"p1\">**</bpt>Build<ept id=\"p1\">**</ept> to create the provisioning package."},{"pos":[7588,7648],"content":"After the provisioning package is created, click <bpt id=\"p1\">**</bpt>Finish<ept id=\"p1\">**</ept>."},{"content":"If your customizations include settings specific to editions of Windows 10 for desktop editions, use the following steps to create an unattend.xml which specifies the settings to be restored during recovery:","pos":[7650,7857]},{"content":"Step 4: Create an unattend file to restore settings (optional)","pos":[7861,7923]},{"pos":[7931,7992],"content":"On the technician PC, start <bpt id=\"p1\">**</bpt>Windows System Image Manager<ept id=\"p1\">**</ept>."},{"pos":[7997,8042],"content":"Click <bpt id=\"p1\">**</bpt>File<ept id=\"p1\">**</ept> <ph id=\"ph1\">&amp;gt;</ph> <bpt id=\"p2\">**</bpt>Select Windows image<ept id=\"p2\">**</ept>."},{"pos":[8047,8101],"content":"When prompted to create a catalog file, click <bpt id=\"p1\">**</bpt>Yes<ept id=\"p1\">**</ept>."},{"pos":[8106,8289],"content":"Use the <bpt id=\"p1\">**</bpt>Windows Image<ept id=\"p1\">**</ept> and <bpt id=\"p2\">**</bpt>Answer File<ept id=\"p2\">**</ept> panes to add settings to the Specialize or oobeSystem phase (or both), and specify the defaults which should be restored during recovery."},{"content":"Click <bpt id=\"p1\">**</bpt>Tool<ept id=\"p1\">**</ept> <ph id=\"ph1\">&amp;gt;</ph> <bpt id=\"p2\">**</bpt>Validate Answer File<ept id=\"p2\">**</ept> to check for errors.","pos":[8294,8359]},{"content":"Correct any problem identified.","pos":[8360,8391]},{"content":"Click <bpt id=\"p1\">**</bpt>File<ept id=\"p1\">**</ept> <ph id=\"ph1\">&amp;gt;</ph> <bpt id=\"p2\">**</bpt>Save Answer File<ept id=\"p2\">**</ept>.","pos":[8396,8437]},{"content":"Enter a location to save the answer file (such as a network share) and then click <bpt id=\"p1\">**</bpt>Save<ept id=\"p1\">**</ept>.","pos":[8438,8529]},{"content":"If you plan to use Push-button reset’s extensibility points, use the following steps to prepare your extensibility scripts and register them using a Push-button reset configuration file.","pos":[8531,8717]},{"pos":[8719,8909],"content":"<bpt id=\"p1\">**</bpt>Important<ept id=\"p1\">**</ept>  If you have created an unattend file, you must also create a script to reapply it using the BasicReset<ph id=\"ph1\">\\_</ph>AfterImageApply and FactoryReset<ph id=\"ph2\">\\_</ph>AfterImageApply extensibility points."},{"content":"Step 5: Prepare push-button reset extensibility scripts (optional)","pos":[8916,8982]},{"content":"Create scripts (.cmd) or executables (.exe) to run at the available extensibility points when the Refresh your PC feature runs:","pos":[8990,9117]},{"content":"A: At BasicReset<ph id=\"ph1\">\\_</ph>BeforeImageApply","pos":[9123,9157]},{"content":"B: At BasicReset<ph id=\"ph1\">\\_</ph>AfterImageApply","pos":[9163,9196]},{"content":"Create scripts (.cmd) or executables (.exe) to run at the available extensibility points when the Reset your PC feature runs:","pos":[9202,9327]},{"content":"C: At FactoryReset<ph id=\"ph1\">\\_</ph>AfterDiskFormat","pos":[9333,9368]},{"content":"D: At FactoryReset<ph id=\"ph1\">\\_</ph>AfterImageApply","pos":[9374,9409]},{"content":"Save the scripts to a network location, or USB flash drive.","pos":[9415,9474]},{"content":"Create a ResetConfig.xml file that specifies the location of the scripts that you created for the four extensibility points.","pos":[9479,9603]},{"content":"For example:","pos":[9604,9616]},{"content":"<bpt id=\"p1\">**</bpt>Important<ept id=\"p1\">**</ept>  If you use a text editor to author the ResetConfig.xml file, save the document with an .xml file name extension and use <bpt id=\"p2\">**</bpt>UTF-8 encoding<ept id=\"p2\">**</ept>.","pos":[10383,10537]},{"content":"Do not use Unicode or ANSI.","pos":[10538,10565]},{"content":"Save the ResetConfig.xml file together with the extensibility scripts that you created.","pos":[10578,10665]},{"content":"Step 6: Create bare-metal recovery configuration (optional)","pos":[10669,10728]},{"content":"To specify the partition layout to be used when users perform bare metal recovery using recovery media created from their PCs, modify resetconfig.xml to include the following elements:","pos":[10736,10920]},{"content":"<bpt id=\"p1\">**</bpt>MinSize<ept id=\"p1\">**</ept> - Specifies the minimum size of the system disk in megabytes (MB).","pos":[11378,11456]},{"content":"Recovery process will not proceed if the system disk does not meet this minimum size.","pos":[11457,11542]},{"content":"<bpt id=\"p1\">**</bpt>DiskpartScriptPath<ept id=\"p1\">**</ept> - Path to Diskpart script relative to install.wim location.","pos":[11551,11633]},{"content":"The script should assume that all existing partitions have been deleted, and the system disk has focus in Diskpart.","pos":[11634,11749]},{"content":"<bpt id=\"p1\">**</bpt>OSPartition<ept id=\"p1\">**</ept> - The partition to which the recovery image should be applied must be specified.","pos":[11758,11854]},{"content":"The ESP or active partition must be on the same disk as the OS.","pos":[11855,11918]},{"content":"<bpt id=\"p1\">**</bpt>WindowsREPartition<ept id=\"p1\">**</ept>; <bpt id=\"p2\">**</bpt>WindowsREPath –<ept id=\"p2\">**</ept> (Optional) The location in which WinRE should be staged.","pos":[11927,12027]},{"content":"The WinRE boot image on the media will be copied and registered with the OS.","pos":[12028,12104]},{"content":"(Same as running “reagentc.exe /setreimage”)","pos":[12105,12149]},{"content":"If partitioning information is not specified in resetconfig.xml, users can still perform bare metal recovery using media they have created.","pos":[12155,12294]},{"content":"However, the default/recommended partition layout for Windows 10 will be used instead.","pos":[12295,12381]},{"content":"Step 7: Create a diskpart script for initial deployment","pos":[12385,12440]},{"content":"Create a disk partitioning script for initial deployment.","pos":[12448,12505]},{"pos":[12511,12528],"content":"<bpt id=\"p1\">**</bpt>UEFI example<ept id=\"p1\">**</ept>:"},{"pos":[13611,13628],"content":"<bpt id=\"p1\">**</bpt>BIOS example<ept id=\"p1\">**</ept>:"},{"content":"Name the script CreatePartitions-UEFI or CreatePartitions-BIOS.txt, and save it to a network location, or USB flash drive.","pos":[14571,14693]},{"content":"Note: In these Diskpart examples, the partitions are assigned the letters S:<ph id=\"ph1\">\\\\</ph>, W:<ph id=\"ph2\">\\\\</ph>, and T:<ph id=\"ph3\">\\\\</ph> to simplify partition identification.","pos":[14694,14826]},{"content":"After the PC reboots, Windows PE automatically assigns the letter C:<ph id=\"ph1\">\\\\</ph> to the Windows partition.","pos":[14827,14923]},{"content":"The other partitions do not receive drive letters.","pos":[14924,14974]},{"content":"Step 8: Create a diskpart script for bare-metal recovery (optional)","pos":[14978,15045]},{"content":"Step 8: Create a diskpart script for bare-metal recovery (optional)","pos":[15051,15118]},{"content":"Create a diskpart script for bare-metal recovery.","pos":[15126,15175]},{"content":"<bpt id=\"p1\">**</bpt>Important<ept id=\"p1\">**</ept> The diskpart script used for bare metal recovery should not include a <ph id=\"ph1\">`select disk`</ph> or <ph id=\"ph2\">`clean`</ph> command.","pos":[15181,15298]},{"content":"The system disk will be selected automatically before the diskpart script is processed.","pos":[15299,15386]},{"pos":[15392,15409],"content":"<bpt id=\"p1\">**</bpt>UEFI example<ept id=\"p1\">**</ept>:"},{"pos":[16468,16485],"content":"<bpt id=\"p1\">**</bpt>BIOS example<ept id=\"p1\">**</ept>:"},{"content":"Name the script RecreatePartitions-UEFI.txt or RecreatePartitions-BIOS.txt, and save it to the same network location, or USB flash drive as create partitions.","pos":[17400,17558]},{"content":"Step 9: Deploy and customize Windows","pos":[17562,17598]},{"content":"On the destination PC, boot to Windows PE.","pos":[17606,17648]},{"content":"At the Windows PE command prompt, run the script to create the recommended hard drive partitions.","pos":[17653,17750]},{"content":"where N:<ph id=\"ph1\">\\\\</ph>CreatePartition is the location of the file.","pos":[17820,17874]},{"content":"Apply the Windows reference image to the Windows partition.","pos":[17880,17939]},{"content":"Optional: You can also specify the /compact option so that the files written to disk are compressed.","pos":[18040,18140]},{"content":"For example:","pos":[18141,18153]},{"content":"This is useful if you are deploying Windows onto PCs with limited storage capacity, but is not recommended on PCs with rotational storage devices.","pos":[18266,18412]},{"content":"Configure the system partition by using BCDboot.","pos":[18418,18466]},{"content":"Create a folder in the Windows RE tools partition, and copy your custom Windows RE boot image to it.","pos":[18539,18639]},{"content":"where T:<ph id=\"ph1\">\\\\</ph> is the Windows RE tools partition.","pos":[18749,18794]},{"pos":[18800,18865],"content":"<bpt id=\"p1\">**</bpt>Important<ept id=\"p1\">**</ept>  You must store Winre.wim in <ph id=\"ph1\">\\\\</ph>Recovery<ph id=\"ph2\">\\\\</ph>WindowsRE."},{"content":"Register the Windows RE boot image together with the Windows image.","pos":[18878,18945]},{"content":"Use Diskpart to conceal the Windows RE tools (T:<ph id=\"ph1\">\\\\</ph>) partition from Windows Explorer.","pos":[19067,19151]},{"content":"For UEFI-based PCs:","pos":[19159,19178]},{"content":"For BIOS-based PCs:","pos":[19359,19378]},{"content":"Customize the Windows image on the destination PC:","pos":[19485,19535]},{"content":"Perform offline customizations to the Windows image, such as installing INF-based driver packages specific to the destination PC, installing OS updates and language packs, or provisioning additional Windows apps.","pos":[19544,19756]},{"content":"Boot the destination PC to audit mode.","pos":[19765,19803]},{"content":"This can be accomplished by using an answer file with the Microsoft-Windows-Deployment | Reseal | Mode = audit setting, or by first booting the PC to OOBE, and then pressing CTRL+SHIFT+F3.","pos":[19804,19992]},{"content":"Perform any remaining customizations such as installing applications and device software packages that are specific to the destination PC.","pos":[20001,20139]},{"content":"If you have installed OS updates, clean up the superseded components and mark the updates as permanent so that they will be restored during recovery:","pos":[20145,20294]},{"content":"Step 10: Capture and deploy customizations for recovery","pos":[20384,20439]},{"content":"Use the ScanState tool to capture the installed customizations into a provisioning package.","pos":[20447,20538]},{"content":"Use the /config option to specify the configuration file you modified in Step 1 earlier in this topic, and save the .ppkg file in the folder C:<ph id=\"ph1\">\\\\</ph>Recovery<ph id=\"ph2\">\\\\</ph>Customizations.","pos":[20539,20709]},{"content":"where N:<ph id=\"ph1\">\\\\</ph> is the location of the ScanState tool installed in Step 1.","pos":[20887,20956]},{"content":"If you have used Windows ICD to create additional provisioning packages with customizations which should be restored during recovery, copy the packages to the destination PC.","pos":[20962,21136]},{"content":"For example:","pos":[21137,21149]},{"content":"where N:<ph id=\"ph1\">\\\\</ph> is the location where the additional provisioning packages are located.","pos":[21239,21321]},{"content":"Copy any Push-button reset configuration file (resetconfig.xml) and extensibility scripts to the destination PC, and then configure permissions to write/modify them.","pos":[21327,21492]},{"content":"For example:","pos":[21493,21505]},{"content":"where N:<ph id=\"ph1\">\\\\</ph> is the location where the configuration file and scripts are located.","pos":[21611,21691]},{"content":"Restrict the Write/Modify permissions of the customizations, and hide the root folder.","pos":[21697,21783]},{"content":"For example:","pos":[21784,21796]},{"content":"Use the Sysprep tool to reseal the Windows image without using the /generalize option.","pos":[22191,22277]},{"pos":[22331,22435],"content":"<bpt id=\"p1\">**</bpt>Note<ept id=\"p1\">**</ept>  Important: You must configure the image that you are shipping to the customer to boot to OOBE."},{"content":"(Optional) To save space, you can also convert your installed Classic Windows applications into file pointers referencing the customizations package.","pos":[22448,22597]},{"content":"To do so, boot the destination PC to Windows PE and run the following:","pos":[22598,22668]},{"content":"Shut down the destination PC for packaging and shipment.","pos":[22815,22871]},{"content":"When the user starts the PC for the first time, it will boot to OOBE.","pos":[22872,22941]},{"content":"Step 11: Verify your customizations","pos":[22945,22980]},{"content":"Verify that your customizations are restored after recovery, and that they continue to function by running the Refresh your PC and Reset your PC features from the following entry points:","pos":[22988,23174]},{"content":"<bpt id=\"p1\">**</bpt>Settings :<ept id=\"p1\">**</ept> From the Start Menu, click <bpt id=\"p2\">**</bpt>Settings <ph id=\"ph1\">&amp;gt;</ph> Update &amp; security <ph id=\"ph2\">&amp;gt;</ph> Recovery<ept id=\"p2\">**</ept>.","pos":[23180,23272]},{"content":"Click the <bpt id=\"p1\">**</bpt>Get Started<ept id=\"p1\">**</ept> button under <bpt id=\"p2\">**</bpt>Reset this PC<ept id=\"p2\">**</ept> and follow the on-screen instructions.","pos":[23273,23368]},{"pos":[23374,23522],"content":"<bpt id=\"p1\">**</bpt>Windows RE<ept id=\"p1\">**</ept>: From the Choose an option screen in Windows RE, click <bpt id=\"p2\">**</bpt>Troubleshoot <ph id=\"ph1\">&amp;gt;</ph> Reset this PC<ept id=\"p2\">**</ept> and then follow the on-screen instructions"},{"content":"Verify that recovery media can be created, and verify its functionality by running the bare metal recovery feature:","pos":[23530,23645]},{"content":"Launch Create a recovery drive from Control Panel.","pos":[23657,23707]},{"content":"Follow the on-screen instructions to create the USB recovery drive.","pos":[23716,23783]},{"content":"Boot the PC from the USB recovery drive","pos":[23792,23831]},{"pos":[23840,23896],"content":"From the Choose an option screen, click <bpt id=\"p1\">**</bpt>Troubleshoot<ept id=\"p1\">**</ept>"},{"pos":[23905,23978],"content":"Click <bpt id=\"p1\">**</bpt>Recover from a drive<ept id=\"p1\">**</ept> and then follow the on-screen instructions"},{"content":"<bpt id=\"p1\">**</bpt>Note<ept id=\"p1\">**</ept>  The Push-button reset UI has been redesigned in Windows 10.","pos":[23984,24053]},{"content":"The <bpt id=\"p1\">**</bpt>Keep my files<ept id=\"p1\">**</ept> option in the UI now corresponds to the <bpt id=\"p2\">**</bpt>Refresh your PC<ept id=\"p2\">**</ept> feature, whereas the <bpt id=\"p3\">**</bpt>Remove everything<ept id=\"p3\">**</ept> option corresponds to the <bpt id=\"p4\">**</bpt>Reset your PC<ept id=\"p4\">**</ept> feature.","pos":[24054,24231]},{"pos":[24276,24290],"content":"Related topics"},{"content":"ScanState Syntax","pos":[24294,24310]},{"content":"Bare metal reset/recovery: Create recovery media while deploying new devices","pos":[24363,24439]},{"content":"Deploy push-button reset features using ScanState","pos":[24498,24547]}],"content":"---\nauthor: Justinha\nDescription: 'Push-button reset features are included with Windows 10 for desktop editions (Home, Pro, Enterprise, and Education), though you''ll need to perform additional steps to deploy PCs with the following customizations.'\nms.assetid: f23d7e3f-0254-4fe8-9d61-5a58856c74be\nMSHAttr: 'PreferredLib:/library/windows/hardware'\ntitle: 'Deploy push-button reset features'\n---\n\n# Deploy push-button reset features\n\n\nPush-button reset features are included with Windows 10 for desktop editions (Home, Pro, Enterprise, and Education), though you'll need to perform additional steps to deploy PCs with the following customizations.\n\n-   Classic Windows applications\n-   Windows settings, such as customized OOBE screens or Start Menus.\n-   Customized partition layouts.\n\nThese steps also show you how to add your own scripts during a reset to capture logs or perform other cleanup tasks.\n\n## <span id=\"Prerequisites\"></span><span id=\"prerequisites\"></span><span id=\"PREREQUISITES\"></span>Prerequisites\n\n\nTo complete these procedures, you'll need a technician PC which has Windows 10 and the following Windows Assessment and Deployment Kit (ADK) for Windows 10 components installed:\n\n-   Deployment Tools\n-   Windows Preinstallation Environment (Windows PE)\n-   Imaging and Configuration Designer (ICD)\n-   User State Migration Tool (USMT)\n\nYou'll also need:\n\n-   A destination PC with drive size of 100 GB or larger\n-   A Windows 10 for desktop editions image (install.wim)\n-   A Windows RE boot image (Winre.wim) (You'll extract this from a Windows 10 image).\n\nFor an overview of the entire deployment process, see the [Desktop manufacturing guide](http://go.microsoft.com/fwlink/p/?LinkId=526101).\n\nUse the follow steps to prepare the ScanState tool to capture Classic Windows applications after they have been installed:\n\n**Step 1: Prepare the ScanState tool**\n\n1.  On the technician PC, copy the Windows ADK files from Windows User State Migration Tool (USMT) and Windows Setup to a working folder. You'll need to match the architecture of the destination device. You don't need to copy the subfolders.\n\n    ``` syntax\n    md C:\\ScanState_amd64\n    xcopy /E \"C:\\Program Files (x86)\\Windows Kits\\10\\Assessment and Deployment Kit\\User State Migration Tool\\amd64\" C:\\ScanState_amd64\n    xcopy /E /Y \"C:\\Program Files (x86)\\Windows Kits\\10\\Assessment and Deployment Kit\\Windows Setup\\amd64\\Sources\" C:\\ScanState_amd64\n    ```\n\n2.  In some instances, Windows Defender settings and detection history might be captured into the customizations package by the ScanState tool. This can lead to failures during recovery due to file conflicts, and causes the PC to reboot and enter the \"Installing Windows\" phase repeatedly. These next steps will prevent the capture of Windows Defender settings.\n\n    1.  Using the ScanState tool on a PC running Windows 10, generate a configuration file:\n\n        ``` syntax\n        ScanState.exe /apps /genconfig:C:\\pbr_config.xml \n        ```\n\n    2.  Open the configuration file in notepad\n    3.  Search for the following lines in the configuration file:\n\n        ``` syntax\n        <component displayname=\"Windows-Defender-AM-Sigs\" migrate=\"yes\"… \n        <component displayname=\"Windows-Defender-AM-Engine\" migrate=\"yes\"… \n        <component displayname=\"Security-Malware-Windows-Defender\" migrate=\"yes\"… \n        ```\n\n    4.  Modify the \"migrate\" value from \"yes\" to \"no\" for each line. For example:\n\n        ``` syntax\n        <component displayname=\"Windows-Defender-AM-Sigs\" migrate=\"no\"… \n        <component displayname=\"Windows-Defender-AM-Engine\" migrate=\"no\"… \n        <component displayname=\"Security-Malware-Windows-Defender\" migrate=\"no\"… \n        ```\n\n        In step 10 later in this topic, you will specify the configuration file when you use ScanState to capture the customizations into a .ppkg file.\n\n    5.  Save and close the configuration file.\n\n3.  Copy the contents of the working folder to a network location or USB flash drive.\n\nUse the following steps to customize your Windows RE boot image if additional drivers and language packs are needed.\n\n**Step 2: Extract and customize the Windows RE boot image (optional)**\n\n1.  On the technician PC, click **Start**, and type deployment. Right-click **Deployment and Imaging Tools Environment** and then select **Run as administrator**.\n2.  In **Deployment and Imaging Tools Environment**, create the folder structure to store the Windows image and its mount point.\n\n    ``` syntax\n    Mkdir C:\\OS_image\\mount\n    ```\n\n3.  Create the folder structure to store the Windows RE boot image and its mount point.\n\n    ``` syntax\n    Mkdir C:\\winre_amd64\\mount\n    ```\n\n4.  Mount the Windows image (install.wim) to the folder \\\\OS\\_image\\\\mount by using DISM.\n\n    ``` syntax\n    Dism /mount-image /imagefile:C:\\OS_image\\install.wim /index:1 /mountdir:C:\\OS_image\\mount\n    ```\n\n    where `Index:1` is the index of the selected image in the Install.wim file.\n\n5.  Copy the Windows RE image from the mounted Windows image to the new folder.\n\n    ``` syntax\n    xcopy /H C:\\OS_image\\mount\\windows\\system32\\recovery\\winre.wim C:\\winre_amd64 \n    ```\n\n6.  Unmount the Windows image. Tip: If you haven't made any other changes in the Windows image, you can unmount the image faster by using the `/discard` option.\n\n    ``` syntax\n    Dism /unmount-image /mountdir:C:\\OS_image\\mount /discard\n    ```\n\n7.  Mount the Windows RE boot image for editing.\n\n    ``` syntax\n    Dism /mount-image /imagefile:C:\\winre_amd64\\winre.wim /index:1 /mountdir:C:\\winre_amd64\\mount\n    ```\n\n    where `Index:1` is the number of the selected image in the Winre.wim file.\n\n    Once the Winre.wim file is extracted from the Install.wim file, you can customize the Windows RE boot image.\n\n8.  Add language packs, boot-critical device drivers, and input device drivers to the Windows RE boot image. To learn more, see [Customize Windows RE](customize-windows-re.md).\n9.  Commit your customizations and unmount the image.\n\n    ``` syntax\n    Dism /unmount-image /mountdir:C:\\winre_amd64\\mount /commit \n    ```\n\nIf you are planning to customize only the settings common to all editions of Windows 10 (including Windows 10 Mobile), use the following steps to create a provisioning package which specifies settings to be restored during recovery:\n\n**Step 3: Create a provisioning package with settings to be restored (optional)**\n\n1.  On the technician PC, start Windows Imaging and Configuration Designer (ICD).\n2.  Click **File** &gt; **New Project**.\n3.  Enter a project name and description, and then click **Next**\n4.  In the **Select project workflow** step, select the **Provisioning Package** option, and then click **Next**.\n5.  In the **Choose which settings to view and configure** step, select the **Common to all Windows editions** option, and then click **Next**.\n6.  In the **Import a provisioning package (optional)** step, click **Finish** to create the new project.\n7.  Use the **Available customizations** pane to add settings and specify the defaults which should be restored during recovery. The settings will appear in the **Selected customizations** pane.\n8.  Click **Export** &gt; **Provisioning package**.\n9.  In the **Describe the provisioning package** step, click **Next**.\n10. In the **Select the security details for the provisioning package** step, click **Next**.\n11. In the **Select where to save the provisioning package** step, enter a location to save the package (such as a network share) and then click **Next**.\n12. Click **Build** to create the provisioning package.\n13. After the provisioning package is created, click **Finish**.\n\nIf your customizations include settings specific to editions of Windows 10 for desktop editions, use the following steps to create an unattend.xml which specifies the settings to be restored during recovery:\n\n**Step 4: Create an unattend file to restore settings (optional)**\n\n1.  On the technician PC, start **Windows System Image Manager**.\n2.  Click **File** &gt; **Select Windows image**.\n3.  When prompted to create a catalog file, click **Yes**.\n4.  Use the **Windows Image** and **Answer File** panes to add settings to the Specialize or oobeSystem phase (or both), and specify the defaults which should be restored during recovery.\n5.  Click **Tool** &gt; **Validate Answer File** to check for errors. Correct any problem identified.\n6.  Click **File** &gt; **Save Answer File**. Enter a location to save the answer file (such as a network share) and then click **Save**.\n\nIf you plan to use Push-button reset’s extensibility points, use the following steps to prepare your extensibility scripts and register them using a Push-button reset configuration file.\n\n**Important**  If you have created an unattend file, you must also create a script to reapply it using the BasicReset\\_AfterImageApply and FactoryReset\\_AfterImageApply extensibility points.\n\n \n\n**Step 5: Prepare push-button reset extensibility scripts (optional)**\n\n1.  Create scripts (.cmd) or executables (.exe) to run at the available extensibility points when the Refresh your PC feature runs:\n\n    A: At BasicReset\\_BeforeImageApply\n\n    B: At BasicReset\\_AfterImageApply\n\n2.  Create scripts (.cmd) or executables (.exe) to run at the available extensibility points when the Reset your PC feature runs:\n\n    C: At FactoryReset\\_AfterDiskFormat\n\n    D: At FactoryReset\\_AfterImageApply\n\n3.  Save the scripts to a network location, or USB flash drive.\n4.  Create a ResetConfig.xml file that specifies the location of the scripts that you created for the four extensibility points. For example:\n\n    ``` syntax\n    <?xml version=\"1.0\" encoding=\"utf-8\"?>\n    <Reset>\n        <Run Phase=\"BasicReset_BeforeImageApply\">\n            <Path>Fabrikam\\SampleScript_A.cmd</Path>\n            <Duration>2</Duration>\n        </Run>\n        <Run Phase=\"BasicReset_AfterImageApply\">\n            <Path>Fabrikam\\SampleScript_B.cmd</Path>\n            <Param></Param>\n            <Duration>2</Duration>\n        </Run>\n        <Run Phase=\"FactoryReset_AfterDiskFormat\">\n            <Path>Fabrikam\\SampleScript_C.cmd</Path>\n            <Duration>2</Duration>\n        </Run>\n        <Run Phase=\"FactoryReset_AfterImageApply\">\n            <Path>Fabrikam\\SampleScript_D.cmd</Path>\n            <Param></Param>\n            <Duration>2</Duration>\n        </Run>\n    </Reset>\n    ```\n\n    **Important**  If you use a text editor to author the ResetConfig.xml file, save the document with an .xml file name extension and use **UTF-8 encoding**. Do not use Unicode or ANSI.\n\n     \n\n5.  Save the ResetConfig.xml file together with the extensibility scripts that you created.\n\n**Step 6: Create bare-metal recovery configuration (optional)**\n\n-   To specify the partition layout to be used when users perform bare metal recovery using recovery media created from their PCs, modify resetconfig.xml to include the following elements:\n\n    ``` syntax\n    <?xml version=\"1.0\" encoding=\"utf-8\"?>\n    <Reset>\n                <SystemDisk>\n            <MinSize>160000</MinSize>\n            <DiskpartScriptPath>ReCreatePartitions.txt</DiskpartScriptPath>\n            <OSPartition>3</OSPartition>\n            <WindowsREPartition>4</WindowsREPartition>\n            <WindowsREPath>Recovery\\WindowsRE</WindowsREPath>\n            <Compact>False</Compact>\n    </SystemDisk>\n    </Reset>\n    ```\n\n    -   **MinSize** - Specifies the minimum size of the system disk in megabytes (MB). Recovery process will not proceed if the system disk does not meet this minimum size.\n    -   **DiskpartScriptPath** - Path to Diskpart script relative to install.wim location. The script should assume that all existing partitions have been deleted, and the system disk has focus in Diskpart.\n    -   **OSPartition** - The partition to which the recovery image should be applied must be specified. The ESP or active partition must be on the same disk as the OS.\n    -   **WindowsREPartition**; **WindowsREPath –** (Optional) The location in which WinRE should be staged. The WinRE boot image on the media will be copied and registered with the OS. (Same as running “reagentc.exe /setreimage”)\n\n    If partitioning information is not specified in resetconfig.xml, users can still perform bare metal recovery using media they have created. However, the default/recommended partition layout for Windows 10 will be used instead.\n\n**Step 7: Create a diskpart script for initial deployment**\n\n1.  Create a disk partitioning script for initial deployment.\n\n    **UEFI example**:\n\n    ``` syntax\n    rem These commands are used with DiskPart tool.\n    rem Erase the drive and create four partitions\n    rem for a UEFI/GPT-based PC.\n    select disk 0\n    clean\n    convert gpt\n    rem == 1. System Partition =======================\n    create partition efi size=100\n    rem ***NOTE: For 4KB-per-sector drives, change \n    rem this value to size=260.***\n    format quick fs=fat32 label=\"System\"\n    assign letter=\"S\"\n    rem == 2. Microsoft Reserved (MSR) Partition =====\n    create partition msr size=16\n    rem == 3. Windows Partition ======================\n    rem ==    a. Create Windows Partition ============\n    create partition primary\n    rem ==    b. Create space for Windows RE tools partition\n    shrink minimum=450\n    rem ==    c. Prepare the Windows partition\n    format quick fs=ntfs label=\"Windows\"\n    assign letter=\"W\"\n    rem == 4. Windows RE Tools Partition =============\n    create partition primary\n    format quick fs=ntfs label=\"Windows RE tools\"\n    set id=de94bba4-06d1-4d40-a16a-bfd50179d6ac\n    assign letter=\"T\"\n    exit\n    ```\n\n    **BIOS example**:\n\n    ``` syntax\n    rem These commands are used with DiskPart to \n    rem erase the drive and create three partitions \n    rem for a BIOS/MBR-based PC. \n    rem Adjust the partition sizes to fill the drive.\n    select disk 0\n    clean\n    rem === 1. System Partition =====================\n    create partition primary size=100\n    format quick fs=ntfs label=\"System\"\n    assign letter=\"S\" \n    active \n    rem === 2. Windows Partition ====================\n    rem ==    a. Create Windows partition ===========\n    create partition primary \n    rem ==    b. Create space for Windows RE tools partition ====\n    shrink minimum=450\n    rem ==    c. Prepare the Windows partition ======\n    format quick fs=ntfs label=\"Windows\" \n    assign letter=\"W\" \n    rem === 3. Windows RE Tools Partition =============\n    create partition primary\n    format quick fs=ntfs label=\"Windows RE tools\"\n    set id=27\n    assign letter=\"R\" \n    exit\n    ```\n\n2.  Name the script CreatePartitions-UEFI or CreatePartitions-BIOS.txt, and save it to a network location, or USB flash drive. Note: In these Diskpart examples, the partitions are assigned the letters S:\\\\, W:\\\\, and T:\\\\ to simplify partition identification. After the PC reboots, Windows PE automatically assigns the letter C:\\\\ to the Windows partition. The other partitions do not receive drive letters.\n\n**Step 8: Create a diskpart script for bare-metal recovery (optional)**\n\n**Step 8: Create a diskpart script for bare-metal recovery (optional)**\n\n1.  Create a diskpart script for bare-metal recovery.\n\n    **Important** The diskpart script used for bare metal recovery should not include a `select disk` or `clean` command. The system disk will be selected automatically before the diskpart script is processed.\n\n    **UEFI example**:\n\n    ``` syntax\n    rem These commands are used with DiskPart tool.\n    rem Erase the drive and create five partitions\n    rem for a UEFI/GPT-based PC.\n    convert gpt\n    rem == 1. System Partition =======================\n    create partition efi size=100\n    rem ***NOTE: For 4KB-per-sector drives, change \n    rem this value to size=260.***\n    format quick fs=fat32 label=\"System\"\n    assign letter=\"S\"\n    rem == 2. Microsoft Reserved (MSR) Partition =====\n    create partition msr size=16\n    rem == 3. Windows Partition ======================\n    rem ==    a. Create Windows Partition ============\n    create partition primary\n    rem ==    b. Create space for Windows RE tools partition\n    shrink minimum=450\n    rem ==    c. Prepare the Windows partition\n    format quick fs=ntfs label=\"Windows\"\n    assign letter=\"W\"\n    rem == 4. Windows RE Tools Partition =============\n    create partition primary\n    format quick fs=ntfs label=\"Windows RE tools\"\n    set id=de94bba4-06d1-4d40-a16a-bfd50179d6ac\n    assign letter=\"T\"\n    exit\n    ```\n    \n    **BIOS example**:\n\n    ``` syntax\n    rem These commands are used with DiskPart to \n    rem erase the drive and create three partitions \n    rem for a BIOS/MBR-based PC. \n    rem Adjust the partition sizes to fill the drive.\n    rem === 1. System Partition =====================\n    create partition primary size=100\n    format quick fs=ntfs label=\"System\"\n    assign letter=\"S\" \n    active \n    rem === 2. Windows Partition ====================\n    rem ==    a. Create Windows partition ===========\n    create partition primary \n    rem ==    b. Create space for Windows RE tools partition ====\n    shrink minimum=450\n    rem ==    c. Prepare the Windows partition ======\n    format quick fs=ntfs label=\"Windows\" \n    assign letter=\"W\" \n    rem === 3. Windows RE Tools Partition =============\n    create partition primary\n    format quick fs=ntfs label=\"Windows RE tools\"\n    set id=27\n    assign letter=\"R\" \n    exit\n    ```\n\n2.  Name the script RecreatePartitions-UEFI.txt or RecreatePartitions-BIOS.txt, and save it to the same network location, or USB flash drive as create partitions.\n\n**Step 9: Deploy and customize Windows**\n\n1.  On the destination PC, boot to Windows PE.\n2.  At the Windows PE command prompt, run the script to create the recommended hard drive partitions.\n\n    ``` syntax\n    Diskpart /s N:\\CreatePartitions.txt\n    ```\n\n    where N:\\\\CreatePartition is the location of the file.\n\n3.  Apply the Windows reference image to the Windows partition.\n\n    ``` syntax\n    Dism /Apply-Image /ImageFile:N:\\Install.wim /Index:1 /ApplyDir:W:\\\n    ```\n\n    Optional: You can also specify the /compact option so that the files written to disk are compressed. For example:\n\n    ``` syntax\n    Dism /Apply-Image /ImageFile:N:\\Install.wim /Index:1 /ApplyDir:W:\\ /Compact:on\n    ```\n\n    This is useful if you are deploying Windows onto PCs with limited storage capacity, but is not recommended on PCs with rotational storage devices.\n\n4.  Configure the system partition by using BCDboot.\n\n    ``` syntax\n    W:\\Windows\\System32\\Bcdboot W:\\Windows\n    ```\n\n5.  Create a folder in the Windows RE tools partition, and copy your custom Windows RE boot image to it.\n\n    ``` syntax\n    Mkdir T:\\Recovery\\WindowsRE\n    xcopy /H N:\\Winre.wim T:\\Recovery\\WindowsRE\n    ```\n\n    where T:\\\\ is the Windows RE tools partition.\n\n    **Important**  You must store Winre.wim in \\\\Recovery\\\\WindowsRE.\n\n     \n\n6.  Register the Windows RE boot image together with the Windows image.\n\n    ``` syntax\n    W:\\Windows\\System32\\Reagentc /setreimage /path T:\\Recovery\\WindowsRE /target W:\\Windows\n    ```\n\n7.  Use Diskpart to conceal the Windows RE tools (T:\\\\) partition from Windows Explorer.\n\n    **For UEFI-based PCs:**\n\n    ``` syntax\n    select disk 0\n    select partition 4\n    remove\n    set id=de94bba4-06d1-4d40-a16a-bfd50179d6ac\n    gpt attributes=0x8000000000000001\n    exit\n    ```\n\n    **For BIOS-based PCs:**\n\n    ``` syntax\n    select disk 0\n    select partition 3\n    remove\n    set id=27\n    exit\n    ```\n\n8.  Customize the Windows image on the destination PC:\n    1.  Perform offline customizations to the Windows image, such as installing INF-based driver packages specific to the destination PC, installing OS updates and language packs, or provisioning additional Windows apps.\n    2.  Boot the destination PC to audit mode. This can be accomplished by using an answer file with the Microsoft-Windows-Deployment | Reseal | Mode = audit setting, or by first booting the PC to OOBE, and then pressing CTRL+SHIFT+F3.\n    3.  Perform any remaining customizations such as installing applications and device software packages that are specific to the destination PC.\n\n9.  If you have installed OS updates, clean up the superseded components and mark the updates as permanent so that they will be restored during recovery:\n\n    ``` syntax\n    DISM.exe /Cleanup-Image /StartComponentCleanup /ResetBase\n    ```\n\n**Step 10: Capture and deploy customizations for recovery**\n\n1.  Use the ScanState tool to capture the installed customizations into a provisioning package. Use the /config option to specify the configuration file you modified in Step 1 earlier in this topic, and save the .ppkg file in the folder C:\\\\Recovery\\\\Customizations.\n\n    ``` syntax\n    D:\\ScanState_amd64\\scanstate.exe /apps /config:<path_to_config_file> /ppkg C:\\Recovery\\Customizations\\apps.ppkg /o /c /v:13 /l:C:\\ScanState.log\n    ```\n\n    where N:\\\\ is the location of the ScanState tool installed in Step 1.\n\n2.  If you have used Windows ICD to create additional provisioning packages with customizations which should be restored during recovery, copy the packages to the destination PC. For example:\n\n    ``` syntax\n    xcopy N:\\RecoveryPPKG\\*.ppkg C:\\Recovery\\Customizations\n    ```\n\n    where N:\\\\ is the location where the additional provisioning packages are located.\n\n3.  Copy any Push-button reset configuration file (resetconfig.xml) and extensibility scripts to the destination PC, and then configure permissions to write/modify them. For example:\n\n    ``` syntax\n    mkdir C:\\Recovery\\OEM\n    xcopy /E N:\\RecoveryScripts\\* C:\\Recovery\\OEM\n    ```\n\n    where N:\\\\ is the location where the configuration file and scripts are located.\n\n4.  Restrict the Write/Modify permissions of the customizations, and hide the root folder. For example:\n\n    ``` syntax\n    icacls C:\\Recovery\\Customizations /inheritance:r /T\n    icacls C:\\Recovery\\Customizations /grant:r SYSTEM:(F) /T\n    icacls C:\\Recovery\\Customizations / grant:r *S-1-5-32-544:(F) /T\n    icacls C:\\Recovery\\OEM /inheritance:r /T\n    icacls C:\\Recovery\\OEM /grant:r SYSTEM:(F) /T\n    icacls C:\\Recovery\\OEM / grant:r *S-1-5-32-544:(F) /T\n    attrib +H C:\\Recovery\n    ```\n\n5.  Use the Sysprep tool to reseal the Windows image without using the /generalize option.\n\n    ``` syntax\n    Sysprep /oobe /exit\n    ```\n\n    **Note**  Important: You must configure the image that you are shipping to the customer to boot to OOBE.\n\n     \n\n6.  (Optional) To save space, you can also convert your installed Classic Windows applications into file pointers referencing the customizations package. To do so, boot the destination PC to Windows PE and run the following:\n\n    ``` syntax\n    DISM /Apply-CustomDataImage /CustomDataImage:C:\\Recovery\\Customizations\\USMT.ppkg /ImagePath:C:\\ /SingleInstance\n    ```\n\n7.  Shut down the destination PC for packaging and shipment. When the user starts the PC for the first time, it will boot to OOBE.\n\n**Step 11: Verify your customizations**\n\n1.  Verify that your customizations are restored after recovery, and that they continue to function by running the Refresh your PC and Reset your PC features from the following entry points:\n\n    **Settings :** From the Start Menu, click **Settings &gt; Update & security &gt; Recovery**. Click the **Get Started** button under **Reset this PC** and follow the on-screen instructions.\n\n    **Windows RE**: From the Choose an option screen in Windows RE, click **Troubleshoot &gt; Reset this PC** and then follow the on-screen instructions\n\n2.  **Verify that recovery media can be created, and verify its functionality by running the bare metal recovery feature:**\n\n    1.  Launch Create a recovery drive from Control Panel.\n    2.  Follow the on-screen instructions to create the USB recovery drive.\n    3.  Boot the PC from the USB recovery drive\n    4.  From the Choose an option screen, click **Troubleshoot**\n    5.  Click **Recover from a drive** and then follow the on-screen instructions\n\n    **Note**  The Push-button reset UI has been redesigned in Windows 10. The **Keep my files** option in the UI now corresponds to the **Refresh your PC** feature, whereas the **Remove everything** option corresponds to the **Reset your PC** feature.\n\n     \n\n## <span id=\"related_topics\"></span>Related topics\n\n\n[ScanState Syntax](http://go.microsoft.com/fwlink/p/?linkid=615076)\n\n[Bare metal reset/recovery: Create recovery media while deploying new devices](create-media-to-run-push-button-reset-features-s14.md)\n\n[Deploy push-button reset features using ScanState](http://go.microsoft.com/fwlink/?LinkId=615126)\n\n \n\n \n\n\n\n\n\n\n"}