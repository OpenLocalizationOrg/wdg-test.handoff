{"nodes":[{"content":"1. Collector Definitions","pos":[11,35]},{"content":"1. Collector Definitions","pos":[240,264]},{"content":"Windows Performance Recorder (WPR) currently supports three kinds of collectors: the system collector, event collectors, and a heap event collector.","pos":[267,415]},{"content":"The system collector definition specifies buffer sizes and other attributes for Event Tracing for Windows (ETW) system logger sessions that work together with the NT Kernel Logger.","pos":[416,596]},{"content":"Event and heap collector definitions specify buffer sizes and other attributes for ETW user sessions.","pos":[597,698]},{"content":"Collector definition order is restricted by the WPR schema.","pos":[700,759]},{"content":"In the .wprp file, system collector definitions must precede event collector definitions.","pos":[760,849]},{"content":"These definitions must both precede the heap collector definition (if a heap collector definition is present).","pos":[850,960]},{"content":"The WPR schema is defined in <bpt id=\"p1\">[</bpt>WPRControlProfiles Schema<ept id=\"p1\">](wprcontrolprofiles-schema.md)</ept>.","pos":[961,1048]},{"content":"Collector Attributes","pos":[1053,1073]},{"content":"Collectors have the following mandatory attributes:","pos":[1076,1127]},{"pos":[1133,1224],"content":"<bpt id=\"p1\">**</bpt>Id<ept id=\"p1\">**</ept>: Unique string identifier that refers to the collector definition in the .wprp file."},{"content":"<bpt id=\"p1\">**</bpt>Name<ept id=\"p1\">**</ept>: Name of the collector; for example, \"WPR Collector\".","pos":[1230,1292]},{"content":"The system collector name must be \"NT Kernel Logger\".","pos":[1293,1346]},{"content":"Collector definitions must contain the following buffer size definitions:","pos":[1348,1421]},{"pos":[1427,1500],"content":"<bpt id=\"p1\">**</bpt>BufferSize<ept id=\"p1\">**</ept>: Specifies the size of a single buffer, in kilobytes (KB)."},{"pos":[1506,1670],"content":"<bpt id=\"p1\">**</bpt>Buffers<ept id=\"p1\">**</ept>: Specifies the number of buffers or, if the <bpt id=\"p2\">**</bpt>PercentageOfTotalMemory<ept id=\"p2\">**</ept> attribute is set to \"true\", the percentage of total memory to use for buffering."},{"pos":[1672,1744],"content":"For more information about buffers, see <bpt id=\"p1\">[</bpt>Logging Mode<ept id=\"p1\">](logging-mode.md)</ept>."},{"content":"Collector Definition Examples","pos":[1749,1778]},{"content":"The following code example shows a system collector definition and an event collector definition.","pos":[1781,1878]},{"content":"Inheritance Examples","pos":[2412,2432]},{"content":"Windows Performance Recorder supports inheritance of its objects by using the <ph id=\"ph1\">`Base=\"\"`</ph> attribute in the WPR profile XML schema.","pos":[2435,2563]},{"content":"This allows additions or specializations of objects to be built progressively while adding re-use of common definitions.","pos":[2564,2684]},{"content":"Unintended complexity and side effects can occur in certain scenarios; this section describes examples and recommended best practices.","pos":[2686,2820]},{"content":"Example 1","pos":[2826,2835]},{"content":"inheritance example","pos":[2839,2858]},{"content":"If a profile <bpt id=\"p1\">**</bpt>Profile A<ept id=\"p1\">**</ept> wants to use the event collector <bpt id=\"p2\">**</bpt>Collector A<ept id=\"p2\">**</ept> with some modifications, it can define a collector <bpt id=\"p3\">**</bpt>Collector A2<ept id=\"p3\">**</ept> that derives from <bpt id=\"p4\">**</bpt>Collector A<ept id=\"p4\">**</ept> (Base=\"Collector A\"), and then references that collector <bpt id=\"p5\">**</bpt>Collector A2<ept id=\"p5\">**</ept>.","pos":[2908,3160]},{"content":"This is recommended because only the collector object derives from another collector object and it is referenced directly.","pos":[3161,3283]},{"content":"Example 2","pos":[3289,3298]},{"content":"inheritance example 2","pos":[3302,3323]},{"content":"A profile <bpt id=\"p1\">**</bpt>Profile A<ept id=\"p1\">**</ept> references a collector <bpt id=\"p2\">**</bpt>Collector A<ept id=\"p2\">**</ept>. Another profile <bpt id=\"p3\">**</bpt>Profile B<ept id=\"p3\">**</ept> requires changes to <bpt id=\"p4\">**</bpt>Profile A<ept id=\"p4\">**</ept> so it derives from it, and specifies its changes directly in its definition.","pos":[3373,3577]},{"content":"This is recommended because only the profile object derives from another profile object.","pos":[3578,3666]},{"content":"Example 3","pos":[3672,3681]},{"content":"inheritance example 3","pos":[3685,3706]},{"pos":[3756,4048],"content":"A profile <bpt id=\"p1\">**</bpt>Profile A<ept id=\"p1\">**</ept> references a collector <bpt id=\"p2\">**</bpt>Collector A<ept id=\"p2\">**</ept>. A collector <bpt id=\"p3\">**</bpt>Collector A2<ept id=\"p3\">**</ept> derives from <bpt id=\"p4\">**</bpt>Collector A<ept id=\"p4\">**</ept>. Finally, the profile <bpt id=\"p5\">**</bpt>Profile B<ept id=\"p5\">**</ept> derives both from <bpt id=\"p6\">**</bpt>Profile A<ept id=\"p6\">**</ept> and also references <bpt id=\"p7\">**</bpt>Collector A<ept id=\"p7\">**</ept> that is already referenced in the parent profile of <bpt id=\"p8\">**</bpt>Profile B<ept id=\"p8\">**</ept>."},{"content":"In this case it’s ambiguous how the definition for <bpt id=\"p1\">**</bpt>Collector A2<ept id=\"p1\">**</ept> should be evaluated.","pos":[4050,4138]},{"content":"In one case, the profile derivation take precedence, and in another the collector derivation takes precedence.","pos":[4139,4249]},{"content":"This is not recommended practice because the ordering is undefined and may lead to different outcomes based on ordering of operations.","pos":[4250,4384]},{"content":"Based on this, you should never combine derivations across multiple types of objects.","pos":[4386,4471]},{"content":"Related topics","pos":[4476,4490]},{"content":"Authoring Recording Profiles","pos":[4494,4522]},{"content":"2. System and Event Provider Definitions","pos":[4559,4599]},{"content":"Recording Profile XML Reference","pos":[4647,4678]}],"content":"---\ntitle: 1. Collector Definitions\ndescription: 1.\nMSHAttr:\n- 'PreferredSiteName:MSDN'\n- 'PreferredLib:/library/windows/hardware'\nms.assetid: 40712815-d517-49aa-b208-76a2115ed9fd\nms.prod: W10\nms.mktglfcycl: operate\nms.sitesec: msdn\n---\n\n# 1. Collector Definitions\n\n\nWindows Performance Recorder (WPR) currently supports three kinds of collectors: the system collector, event collectors, and a heap event collector. The system collector definition specifies buffer sizes and other attributes for Event Tracing for Windows (ETW) system logger sessions that work together with the NT Kernel Logger. Event and heap collector definitions specify buffer sizes and other attributes for ETW user sessions.\n\nCollector definition order is restricted by the WPR schema. In the .wprp file, system collector definitions must precede event collector definitions. These definitions must both precede the heap collector definition (if a heap collector definition is present). The WPR schema is defined in [WPRControlProfiles Schema](wprcontrolprofiles-schema.md).\n\n## Collector Attributes\n\n\nCollectors have the following mandatory attributes:\n\n-   **Id**: Unique string identifier that refers to the collector definition in the .wprp file.\n\n-   **Name**: Name of the collector; for example, \"WPR Collector\". The system collector name must be \"NT Kernel Logger\".\n\nCollector definitions must contain the following buffer size definitions:\n\n-   **BufferSize**: Specifies the size of a single buffer, in kilobytes (KB).\n\n-   **Buffers**: Specifies the number of buffers or, if the **PercentageOfTotalMemory** attribute is set to \"true\", the percentage of total memory to use for buffering.\n\nFor more information about buffers, see [Logging Mode](logging-mode.md).\n\n## Collector Definition Examples\n\n\nThe following code example shows a system collector definition and an event collector definition.\n\n``` syntax\n<SystemCollector\n  Id=\"WPRSystemCollector\"\n  Name=\"NT Kernel Logger\"\n  FileName=\"WPRKernel.etl\">\n  <BufferSize\n    Value=\"512\"/>\n  <Buffers\n    Value=\"3\"\n    PercentageOfTotalMemory=\"true\"/>\n</SystemCollector>\n\n<EventCollector\n  Id=\"WPREventCollector\"\n  Name=\"WPR Event Collector\"\n  FileName=\"somefilename.etl\">\n  <BufferSize\n    Value=\"128\"/> \n  <Buffers\n    Value=\"64\"/>\n</EventCollector>\n\n<HeapEventCollector\n  Id=\"Base_Heap_Collector\"\n  Name=\"Base Heap Collector\"\n  FileName=\"heap.etl\">\n</HeapEventCollector>\n```\n\n## Inheritance Examples\n\n\nWindows Performance Recorder supports inheritance of its objects by using the `Base=\"\"` attribute in the WPR profile XML schema. This allows additions or specializations of objects to be built progressively while adding re-use of common definitions.\n\nUnintended complexity and side effects can occur in certain scenarios; this section describes examples and recommended best practices.\n\n### Example 1\n\n![inheritance example](images/wpr-collector-definitions-example1.jpg)\n\nIf a profile **Profile A** wants to use the event collector **Collector A** with some modifications, it can define a collector **Collector A2** that derives from **Collector A** (Base=\"Collector A\"), and then references that collector **Collector A2**. This is recommended because only the collector object derives from another collector object and it is referenced directly.\n\n### Example 2\n\n![inheritance example 2](images/wpr-collector-definitions-example2.jpg)\n\nA profile **Profile A** references a collector **Collector A**. Another profile **Profile B** requires changes to **Profile A** so it derives from it, and specifies its changes directly in its definition. This is recommended because only the profile object derives from another profile object.\n\n### Example 3\n\n![inheritance example 3](images/wpr-collector-definitions-example3.jpg)\n\nA profile **Profile A** references a collector **Collector A**. A collector **Collector A2** derives from **Collector A**. Finally, the profile **Profile B** derives both from **Profile A** and also references **Collector A** that is already referenced in the parent profile of **Profile B**.\n\nIn this case it’s ambiguous how the definition for **Collector A2** should be evaluated. In one case, the profile derivation take precedence, and in another the collector derivation takes precedence. This is not recommended practice because the ordering is undefined and may lead to different outcomes based on ordering of operations.\n\nBased on this, you should never combine derivations across multiple types of objects.\n\n## Related topics\n\n\n[Authoring Recording Profiles](authoring-recording-profiles.md)\n\n[2. System and Event Provider Definitions](2-system-and-event-provider-definitions.md)\n\n[Recording Profile XML Reference](recording-profile-xml-reference.md)\n\n \n\n \n\n\n\n\n\n\n\n"}