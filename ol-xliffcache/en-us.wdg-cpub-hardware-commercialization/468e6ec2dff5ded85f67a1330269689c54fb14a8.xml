{"nodes":[{"content":"Lab 1c: Add a file and a registry setting to an image","pos":[274,327]},{"content":"Lab 1c: Add a file and a registry setting to an image","pos":[336,389]},{"content":"This content has been tested on Windows 10 IoT Core Build 10586.","pos":[394,458]},{"content":"Some of these procedures do not yet work on newer preview builds, including Windows 10, version 1607.","pos":[459,560]},{"content":"Many files and registry keys, and other customizations that you add to your image won't be specific to an architecture.","pos":[564,683]},{"content":"For these, we recommend creating a common package that you can use for all of your builds.","pos":[684,774]},{"content":"We'll create some test files and registry keys to the image, and again package them up so that they can be serviced after they reach your customers.","pos":[777,925]},{"content":"We'll add these to a common feature manifest (OEMCommonFM.xml), which is used in both your x86 and ARM builds.","pos":[927,1037]},{"content":"Give it a new feature ID, OEM<ph id=\"ph1\">\\_</ph>FileAndRegKey.","pos":[1038,1083]},{"content":"To add the features to the image, we'll go to our Product A, add our Feature Manifest and Feature ID.","pos":[1085,1186]},{"content":"We're also going to add a helper app, which is listed in feature manifest: OEMCommonFM.xml, with the ID: OEM<ph id=\"ph1\">\\_</ph>CustomCmd.","pos":[1187,1307]},{"content":"We'll add these FMs and Feature IDs to the test image configuration file (TestOEMInput.xml).","pos":[1309,1401]},{"content":"Finally, we'll rebuild the project and make sure it works.","pos":[1403,1461]},{"pos":[1463,1628],"content":"<bpt id=\"p1\">**</bpt>Note<ept id=\"p1\">**</ept>  As we go through this manufacturing guide, ProjectA will start to resemble the SampleA image that's in C:<ph id=\"ph1\">\\\\</ph>IoT-ADK-AddonKit<ph id=\"ph2\">\\\\</ph>Source-arm<ph id=\"ph3\">\\\\</ph>Products<ph id=\"ph4\">\\\\</ph>SampleA."},{"pos":[1732,1745],"content":"Prerequisites"},{"pos":[1748,1949],"content":"We'll start with the ProjectA image we created from <bpt id=\"p1\">[</bpt>Lab 1a: Create a basic image<ept id=\"p1\">](create-a-basic-image.md)</ept>, and updated in <bpt id=\"p2\">[</bpt>Lab 1b: Add an app to your image<ept id=\"p2\">](deploy-your-app-with-a-standard-board.md)</ept>."},{"pos":[2077,2099],"content":"Create your test files"},{"content":"Create a few sample text files using Notepad, title them TestFile1.txt and TestFile2.txt.","pos":[2106,2195]},{"pos":[2362,2397],"content":"Build a package for your test files"},{"pos":[2404,2474],"content":"Run <bpt id=\"p1\">**</bpt>C:<ph id=\"ph1\">\\\\</ph>IoT-ADK-AddonKit<ph id=\"ph2\">\\\\</ph>Tools<ph id=\"ph3\">\\\\</ph>IoTCoreShell<ept id=\"p1\">**</ept> as an administrator."},{"content":"Create a working folder for the registry key and test files, for example:","pos":[2480,2553]},{"pos":[2624,2712],"content":"The new folder at <bpt id=\"p1\">**</bpt>C:<ph id=\"ph1\">\\\\</ph>IoT-ADK-AddonKit<ph id=\"ph2\">\\\\</ph>Common<ph id=\"ph3\">\\\\</ph>Packages<ph id=\"ph4\">\\\\</ph>Registry.ConfigSettings<ph id=\"ph5\">\\\\</ph><ept id=\"p1\">**</ept>."},{"content":"Add sample files to the package","pos":[2716,2747]},{"pos":[2755,2906],"content":"Copy your sample files (TestFile1.txt and TestFile2.txt), into the new folder at <bpt id=\"p1\">**</bpt>C:<ph id=\"ph1\">\\\\</ph>IoT-ADK-AddonKit<ph id=\"ph2\">\\\\</ph>Common<ph id=\"ph3\">\\\\</ph>Packages<ph id=\"ph4\">\\\\</ph>Registry.ConfigSettings<ph id=\"ph5\">\\\\</ph><ept id=\"p1\">**</ept>."},{"pos":[2912,3049],"content":"Update the package definition file, <bpt id=\"p1\">**</bpt>C:<ph id=\"ph1\">\\\\</ph>IoT-ADK-AddonKit<ph id=\"ph2\">\\\\</ph>Common<ph id=\"ph3\">\\\\</ph>Packages<ph id=\"ph4\">\\\\</ph>Registry.ConfigSettings<ph id=\"ph5\">\\\\</ph>Registry.ConfigSettings.pkg.xml<ept id=\"p1\">**</ept>:"},{"content":"The default package definition file includes sample XML that has been commented out.","pos":[3058,3142]},{"content":"Remove the comment marks and instructions, then modify the sample to add your own registry keys and files.","pos":[3143,3249]},{"content":"Update the values of RegKey to include a new KeyName, Name, and Value.","pos":[3258,3328]},{"content":"Optional: update the DestinationDir and Name.","pos":[3337,3382]},{"content":"If you don't include the DestinationDir option, the files will land in C:<ph id=\"ph1\">\\\\</ph>Windows<ph id=\"ph2\">\\\\</ph>system32<ph id=\"ph3\">\\\\</ph>.","pos":[3383,3478]},{"content":"Variables like (runtime.root) are defined in C:<ph id=\"ph1\">\\\\</ph>Program Files (x86)<ph id=\"ph2\">\\\\</ph>Windows Kits<ph id=\"ph3\">\\\\</ph>10<ph id=\"ph4\">\\\\</ph>Tools<ph id=\"ph5\">\\\\</ph>bin<ph id=\"ph6\">\\\\</ph>i386<ph id=\"ph7\">\\\\</ph>pkggen.cfg.xml.","pos":[3488,3609]},{"content":"From the IoT Core Shell, build the package.","pos":[4336,4379]},{"content":"(The BuildAllPackages tool builds everything in the source folders.)","pos":[4380,4448]},{"pos":[4516,4654],"content":"The package is built, appearing as <bpt id=\"p1\">**</bpt>C:<ph id=\"ph1\">\\\\</ph>IoT-ADK-AddonKit<ph id=\"ph2\">\\\\</ph>Build<ph id=\"ph3\">\\\\&amp;lt;</ph>arch<ph id=\"ph4\">&amp;gt;\\\\</ph>pkgs<ph id=\"ph5\">\\\\&amp;lt;</ph>your OEM name<ph id=\"ph6\">&amp;gt;</ph>.Registry.ConfigSettings.cab<ept id=\"p1\">**</ept>."},{"content":"All packages that you build appear in your architecture-specific folder.","pos":[4660,4732]},{"content":"Tip: to quickly rebuild for another architecture, use <bpt id=\"p1\">**</bpt>setenv <ph id=\"ph1\">&amp;lt;</ph>arch<ph id=\"ph2\">&amp;gt;</ph><ept id=\"p1\">**</ept>, then <bpt id=\"p2\">**</bpt>BuildAllPackages<ept id=\"p2\">**</ept> to rebuild everything for your other architecture.","pos":[4733,4888]},{"pos":[5034,5062],"content":"Update your feature manifest"},{"content":"Add your file package to the feature manifest","pos":[5066,5111]},{"pos":[5119,5217],"content":"Open the common feature manifest file, <bpt id=\"p1\">**</bpt>C:<ph id=\"ph1\">\\\\</ph>IoT-ADK-AddonKit<ph id=\"ph2\">\\\\</ph>Common<ph id=\"ph3\">\\\\</ph>Packages<ph id=\"ph4\">\\\\</ph>OEMCommonFM.xml<ept id=\"p1\">**</ept>"},{"content":"Create a new PackageFile section in the XML, with your package file listed, and give it a new FeatureID, such as \"OEM<ph id=\"ph1\">\\_</ph>ConfigSettings\".","pos":[5222,5357]},{"content":"You'll now be able to add your test files and reg keys to any of your products by adding a reference to this feature manifest and Feature ID.","pos":[6119,6260]},{"pos":[6442,6482],"content":"Update the project's configuration files"},{"content":"Add your file package","pos":[6487,6508]},{"pos":[6516,6636],"content":"Open your product's test configuration file: <bpt id=\"p1\">**</bpt>C:<ph id=\"ph1\">\\\\</ph>IoT-ADK-AddonKit<ph id=\"ph2\">\\\\</ph>Source-arm<ph id=\"ph3\">\\\\</ph>Products<ph id=\"ph4\">\\\\</ph>ProductA<ph id=\"ph5\">\\\\</ph>TestOEMInput.xml<ept id=\"p1\">**</ept>."},{"content":"Make sure your feature manifest, OEMCommonFM.xml, is in the list of AdditionalFMs.","pos":[6641,6723]},{"content":"Add it if it isn't there already there:","pos":[6724,6763]},{"content":"Add the FeatureID for your file and reg key:","pos":[7219,7263]},{"pos":[7689,7713],"content":"Build and test the image"},{"content":"Build the image","pos":[7718,7733]},{"content":"From the IoT Core Shell, create the image:","pos":[7741,7783]},{"content":"This creates the product binaries at C:<ph id=\"ph1\">\\\\</ph>IoT-ADK-AddonKit<ph id=\"ph2\">\\\\</ph>Build<ph id=\"ph3\">\\\\&amp;lt;</ph>arch<ph id=\"ph4\">&amp;gt;\\\\</ph>ProductA<ph id=\"ph5\">\\\\</ph>Flash.FFU.","pos":[7843,7943]},{"content":"Start <bpt id=\"p1\">**</bpt>Windows IoT Core Dashboard<ept id=\"p1\">**</ept> <ph id=\"ph1\">&amp;gt;</ph> <bpt id=\"p2\">**</bpt>Setup a new device<ept id=\"p2\">**</ept> <ph id=\"ph2\">&amp;gt;</ph> <bpt id=\"p3\">**</bpt>Custom<ept id=\"p3\">**</ept>, and browse to your image.","pos":[7949,8056]},{"content":"Put the Micro SD card in the device, select it, accept the license terms, and click <bpt id=\"p1\">**</bpt>Install<ept id=\"p1\">**</ept>.","pos":[8057,8153]},{"content":"This replaces the previous image with our new image.","pos":[8154,8206]},{"content":"Put the card into the IoT device and start it up.","pos":[8211,8260]},{"content":"After a short while, the device should start automatically, and you should see your app.","pos":[8266,8354]},{"content":"Check to see if your files made it","pos":[8358,8392]},{"content":"On your technician PC, open File Explorer, and type in the IP address of the device with a <ph id=\"ph1\">\\\\\\\\</ph> prefix and <ph id=\"ph2\">\\\\</ph>c$ suffix:","pos":[8400,8519]},{"content":"When prompted, type in the username.","pos":[8571,8607]},{"content":"The default username is: minwinpc<ph id=\"ph1\">\\\\</ph>administrator and the default password is p@ssw0rd.","pos":[8608,8694]},{"content":"Check to see if the files exist.","pos":[8700,8732]},{"content":"Look for:","pos":[8733,8742]},{"content":"10.100.0.100\\c$<ph id=\"ph1\">\\\\</ph>Windows<ph id=\"ph2\">\\\\</ph>system32<ph id=\"ph3\">\\\\</ph>TestFile1.txt","pos":[8752,8801]},{"content":"10.100.0.100\\c$<ph id=\"ph1\">\\\\</ph>OEMInstall<ph id=\"ph2\">\\\\</ph>TestFile2.txt","pos":[8811,8853]},{"content":"Check to see if your reg key exists","pos":[8857,8892]},{"content":"On your technician PC, connect to your device using an SSH client, such as <bpt id=\"p1\">[</bpt>PuTTY<ept id=\"p1\">](http://the.earth.li/~sgtatham/putty/latest/x86/putty.exe)</ept>.","pos":[8900,9041]},{"content":"For example, use the IP address and port 22 to connect to the device, then log in using the Administrator account and password.","pos":[9042,9169]},{"content":"(To learn more, see <bpt id=\"p1\">[</bpt>Using SSH to connect and configure a device running Windows IoT Core<ept id=\"p1\">](http://ms-iot.github.io/content/en-US/win10/samples/SSH.md)</ept>.)","pos":[9170,9322]},{"content":"From the command line in the SSH client, query the system for the reg key.","pos":[9327,9401]},{"content":"The registry tool should return your test values.","pos":[9473,9522]},{"pos":[9614,9624],"content":"Next steps"},{"content":"Lab 1d: Add a provisioning package to an image","pos":[9627,9673]}],"content":"---\nauthor: kpacquer\nDescription: 'We''ll create some test files and registry keys to the image, again packaging them up so that they can be serviced after they reach your customers.'\nms.assetid: 7ca2b835-4d36-43d9-b46f-d5d5d8410335\nMSHAttr: 'PreferredLib:/library'\ntitle: 'Lab 1c: Add a file and a registry setting to an image'\n---\n\n# Lab 1c: Add a file and a registry setting to an image\n\n\n\\[This content has been tested on Windows 10 IoT Core Build 10586. Some of these procedures do not yet work on newer preview builds, including Windows 10, version 1607.\\]\n\nMany files and registry keys, and other customizations that you add to your image won't be specific to an architecture. For these, we recommend creating a common package that you can use for all of your builds.\n \nWe'll create some test files and registry keys to the image, and again package them up so that they can be serviced after they reach your customers.\n\nWe'll add these to a common feature manifest (OEMCommonFM.xml), which is used in both your x86 and ARM builds. Give it a new feature ID, OEM\\_FileAndRegKey.\n\nTo add the features to the image, we'll go to our Product A, add our Feature Manifest and Feature ID. We're also going to add a helper app, which is listed in feature manifest: OEMCommonFM.xml, with the ID: OEM\\_CustomCmd.\n\nWe'll add these FMs and Feature IDs to the test image configuration file (TestOEMInput.xml).\n\nFinally, we'll rebuild the project and make sure it works.\n\n**Note**  As we go through this manufacturing guide, ProjectA will start to resemble the SampleA image that's in C:\\\\IoT-ADK-AddonKit\\\\Source-arm\\\\Products\\\\SampleA.\n\n \n\n## <span id=\"Prerequisites\"></span><span id=\"prerequisites\"></span><span id=\"PREREQUISITES\"></span>Prerequisites\n\n\nWe'll start with the ProjectA image we created from [Lab 1a: Create a basic image](create-a-basic-image.md), and updated in [Lab 1b: Add an app to your image](deploy-your-app-with-a-standard-board.md).\n\n## <span id=\"Create_your_test_files\"></span><span id=\"create_your_test_files\"></span><span id=\"CREATE_YOUR_TEST_FILES\"></span>Create your test files\n\n\n-   Create a few sample text files using Notepad, title them TestFile1.txt and TestFile2.txt.\n\n## <span id=\"Build_a_package_for_your_test_files\"></span><span id=\"build_a_package_for_your_test_files\"></span><span id=\"BUILD_A_PACKAGE_FOR_YOUR_TEST_FILES\"></span>Build a package for your test files\n\n\n1.  Run **C:\\\\IoT-ADK-AddonKit\\\\Tools\\\\IoTCoreShell** as an administrator.\n\n2.  Create a working folder for the registry key and test files, for example:\n\n    ``` syntax\n    newcommonpkg Registry.ConfigSettings\n    ```\n\n    The new folder at **C:\\\\IoT-ADK-AddonKit\\\\Common\\\\Packages\\\\Registry.ConfigSettings\\\\**.\n\n**Add sample files to the package**\n\n1.  Copy your sample files (TestFile1.txt and TestFile2.txt), into the new folder at **C:\\\\IoT-ADK-AddonKit\\\\Common\\\\Packages\\\\Registry.ConfigSettings\\\\**.\n\n2.  Update the package definition file, **C:\\\\IoT-ADK-AddonKit\\\\Common\\\\Packages\\\\Registry.ConfigSettings\\\\Registry.ConfigSettings.pkg.xml**:\n\n    -  The default package definition file includes sample XML that has been commented out. Remove the comment marks and instructions, then modify the sample to add your own registry keys and files.\n\n    -  Update the values of RegKey to include a new KeyName, Name, and Value.\n\n    -  Optional: update the DestinationDir and Name. If you don't include the DestinationDir option, the files will land in C:\\\\Windows\\\\system32\\\\.\n    \n    Variables like (runtime.root) are defined in C:\\\\Program Files (x86)\\\\Windows Kits\\\\10\\\\Tools\\\\bin\\\\i386\\\\pkggen.cfg.xml.\n\n    ``` syntax\n      <OSComponent> \n         <RegKeys> \n             <RegKey KeyName=\"$(hklm.software)\\$(OEMNAME)\\Test\">\n                <RegValue Name=\"StringValue\" Value=\"Test string\" Type=\"REG_SZ\"/>\n                <RegValue Name=\"DWordValue\" Value=\"12AB34CD\" Type=\"REG_DWORD\"/>\n                <RegValue Name=\"BinaryValue\" Value=\"12,AB,CD,EF\" Type=\"REG_BINARY\"/>\n             </RegKey>\n             <RegKey KeyName=\"$(hklm.software)\\$(OEMNAME)\\EmptyKey\"/> \n         </RegKeys> \n         <Files> \n            <File Source=\"TestFile1.txt\" /> \n            <File Source=\"TestFile2.txt\"\n                DestinationDir=\"$(runtime.root)\\OEMInstall\" Name=\"TestFile2.txt\"/>  \n         </Files> \n      </OSComponent> \n    ```\n\n2.  From the IoT Core Shell, build the package. (The BuildAllPackages tool builds everything in the source folders.)\n\n    ``` syntax\n    createpkg Registry.ConfigSettings\n    ```\n\n    The package is built, appearing as **C:\\\\IoT-ADK-AddonKit\\\\Build\\\\&lt;arch&gt;\\\\pkgs\\\\&lt;your OEM name&gt;.Registry.ConfigSettings.cab**.\n\n    All packages that you build appear in your architecture-specific folder. Tip: to quickly rebuild for another architecture, use **setenv &lt;arch&gt;**, then **BuildAllPackages** to rebuild everything for your other architecture.\n\n## <span id=\"Update_your_feature_manifest\"></span><span id=\"update_your_feature_manifest\"></span><span id=\"UPDATE_YOUR_FEATURE_MANIFEST\"></span>Update your feature manifest\n\n**Add your file package to the feature manifest**\n\n1.  Open the common feature manifest file, **C:\\\\IoT-ADK-AddonKit\\\\Common\\\\Packages\\\\OEMCommonFM.xml**\n2.  Create a new PackageFile section in the XML, with your package file listed, and give it a new FeatureID, such as \"OEM\\_ConfigSettings\".\n\n    ``` syntax\n         <!-- Feature definitions below -->\n     \n          <PackageFile Path=\"%PKGBLD_DIR%\" Name=\"%OEM_NAME%.Provisioning.Manual.cab\">\n            <FeatureIDs>\n              <FeatureID>OEM_ProvManual</FeatureID>\n            </FeatureIDs>\n          </PackageFile>\n          \n          <PackageFile Path=\"%PKGBLD_DIR%\" Name=\"%OEM_NAME%.Registry.CrashSettings.cab\">\n            <FeatureIDs>\n              <FeatureID>OEM_CrashSettings</FeatureID>\n            </FeatureIDs>\n          </PackageFile>    \n          \n          <PackageFile Path=\"%PKGBLD_DIR%\" Name=\"%OEM_NAME%.Registry.ConfigSettings.cab\">\n            <FeatureIDs>\n              <FeatureID>OEM_ConfigSettings</FeatureID>\n            </FeatureIDs>\n          </PackageFile>\n    ```\n\n    You'll now be able to add your test files and reg keys to any of your products by adding a reference to this feature manifest and Feature ID.\n\n## <span id=\"Update_the_project_s_configuration_files\"></span><span id=\"update_the_project_s_configuration_files\"></span><span id=\"UPDATE_THE_PROJECT_S_CONFIGURATION_FILES\"></span>Update the project's configuration files\n\n\n**Add your file package**\n\n1.  Open your product's test configuration file: **C:\\\\IoT-ADK-AddonKit\\\\Source-arm\\\\Products\\\\ProductA\\\\TestOEMInput.xml**.\n2.  Make sure your feature manifest, OEMCommonFM.xml, is in the list of AdditionalFMs. Add it if it isn't there already there:\n\n    ``` syntax\n      <AdditionalFMs>\n        <AdditionalFM>%AKROOT%\\FMFiles\\arm\\IoTUAPNonProductionPartnerShareFM.xml</AdditionalFM>\n        <AdditionalFM>%AKROOT%\\FMFiles\\arm\\IoTUAPRPi2FM.xml</AdditionalFM>\n        <AdditionalFM>%AKROOT%\\FMFiles\\arm\\RPi2FM.xml</AdditionalFM>\n        <AdditionalFM>%SRC_DIR%\\Packages\\OEMFM.xml</AdditionalFM>\n        <AdditionalFM>%COMMON_DIR%\\Packages\\OEMCommonFM.xml</AdditionalFM>\n      </AdditionalFMs>\n    ```\n\n3.  Add the FeatureID for your file and reg key:\n\n    ``` syntax\n    <OEM> \n    <Feature>RPI2_DRIVERS</Feature> \n    <Feature>RPI2_DEVICE_TARGETINGINFO</Feature> \n    <Feature>PRODUCTION</Feature> \n    <Feature>OEM_CustomCmd</Feature> \n    <Feature>OEM_AppxHelloWorld</Feature> \n    <Feature>OEM_ConfigSettings</Feature> \n    </OEM>\n    ```\n\n## <span id=\"Build_and_test_the_image\"></span><span id=\"build_and_test_the_image\"></span><span id=\"BUILD_AND_TEST_THE_IMAGE\"></span>Build and test the image\n\n\n**Build the image**\n\n1.  From the IoT Core Shell, create the image:\n\n    ``` syntax\n    createimage ProductA Test\n    ```\n\n    This creates the product binaries at C:\\\\IoT-ADK-AddonKit\\\\Build\\\\&lt;arch&gt;\\\\ProductA\\\\Flash.FFU.\n\n2.  Start **Windows IoT Core Dashboard** &gt; **Setup a new device** &gt; **Custom**, and browse to your image. Put the Micro SD card in the device, select it, accept the license terms, and click **Install**. This replaces the previous image with our new image.\n3.  Put the card into the IoT device and start it up.\n\n    After a short while, the device should start automatically, and you should see your app.\n\n**Check to see if your files made it**\n\n1.  On your technician PC, open File Explorer, and type in the IP address of the device with a \\\\\\\\ prefix and \\\\c$ suffix:\n\n    ``` syntax\n    \\\\10.100.0.100\\c$\n    ```\n\n    When prompted, type in the username. The default username is: minwinpc\\\\administrator and the default password is p@ssw0rd.\n\n2.  Check to see if the files exist. Look for:\n\n    \\\\\\\\10.100.0.100\\c$\\\\Windows\\\\system32\\\\TestFile1.txt\n\n    \\\\\\\\10.100.0.100\\c$\\\\OEMInstall\\\\TestFile2.txt\n\n**Check to see if your reg key exists**\n\n1.  On your technician PC, connect to your device using an SSH client, such as [PuTTY](http://the.earth.li/~sgtatham/putty/latest/x86/putty.exe). For example, use the IP address and port 22 to connect to the device, then log in using the Administrator account and password. (To learn more, see [Using SSH to connect and configure a device running Windows IoT Core](http://ms-iot.github.io/content/en-US/win10/samples/SSH.md).)\n2.  From the command line in the SSH client, query the system for the reg key.\n\n    ``` syntax\n    reg query HKLM\\Software\\Contoso\\Test2\n    ```\n\n    The registry tool should return your test values.\n\n## <span id=\"Next_steps\"></span><span id=\"next_steps\"></span><span id=\"NEXT_STEPS\"></span>Next steps\n\n[Lab 1d: Add a provisioning package to an image](add-a-provisioning-package-to-an-image.md)\n"}