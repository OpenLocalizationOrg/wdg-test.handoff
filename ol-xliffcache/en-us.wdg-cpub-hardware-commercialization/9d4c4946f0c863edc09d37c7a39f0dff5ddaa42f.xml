{"nodes":[{"content":"Use Answer Files with Sysprep","pos":[34,63]},{"content":"Use Answer Files with Sysprep","pos":[170,199]},{"content":"Use Answer Files with Sysprep","pos":[207,236]},{"content":"You can use an answer file together with the System Preparation (<bpt id=\"p1\">**</bpt>Sysprep<ept id=\"p1\">**</ept>) tool to configure unattended WindowsÂ® Setup settings.","pos":[239,370]},{"content":"This topic describes some considerations and processes for using answer files together with <bpt id=\"p1\">**</bpt>Sysprep<ept id=\"p1\">**</ept>.","pos":[371,475]},{"content":"For more information about Windows components and settings that you can add to an answer file, see the <bpt id=\"p1\">[</bpt>Unattended Windows Setup Reference<ept id=\"p1\">](http://go.microsoft.com/fwlink/?LinkId=206281)</ept>.","pos":[476,663]},{"content":"In this topic:","pos":[665,679]},{"content":"Running Sysprep an Unlimited Number of Times","pos":[686,730]},{"content":"Applying Settings in the generalize, auditSystem, and auditUser Configuration Passes","pos":[755,839]},{"content":"Caching Answer Files to the Computer","pos":[856,892]},{"content":"Persisting Plug and Play Device Drivers During the generalize Configuration Pass","pos":[909,989]},{"content":"Displaying RunSynchronous Actions in an Answer File","pos":[1006,1057]},{"pos":[1171,1215],"content":"Running Sysprep an Unlimited Number of Times"},{"content":"If you specify a product key, Windows is automatically activated, and you can run the <bpt id=\"p1\">**</bpt>Sysprep<ept id=\"p1\">**</ept> command an unlimited number of times.","pos":[1218,1353]},{"content":"To automatically activate Windows by supplying a product key, specify a valid product key in the Microsoft-Windows-Shell-Setup<ph id=\"ph1\">\\\\`ProductKey`</ph> unattend setting during the <bpt id=\"p1\">[</bpt>specialize<ept id=\"p1\">](specialize.md)</ept> configuration pass.","pos":[1354,1570]},{"content":"If you don't automatically activate Windows by providing a product key, Windows prompts the end user for a product key.","pos":[1571,1690]},{"content":"If the end user skips this step during OOBE, Windows reminds the end user to enter a valid product key later.","pos":[1691,1800]},{"pos":[1855,1939],"content":"Applying Settings in the generalize, auditSystem, and auditUser Configuration Passes"},{"content":"Not all configuration passes run during Windows Setup.","pos":[1942,1996]},{"content":"The <bpt id=\"p1\">[</bpt>generalize<ept id=\"p1\">](generalize.md)</ept>, <bpt id=\"p2\">[</bpt>auditSystem<ept id=\"p2\">](auditsystem.md)</ept>, and <bpt id=\"p3\">[</bpt>auditUser<ept id=\"p3\">](audituser.md)</ept> configuration passes are available only when you run <bpt id=\"p4\">**</bpt>Sysprep<ept id=\"p4\">**</ept>.","pos":[1997,2156]},{"pos":[2158,2289],"content":"If you add settings to your answer file in these configuration passes, you must run <bpt id=\"p1\">**</bpt>Sysprep<ept id=\"p1\">**</ept> to apply these settings as follows:"},{"pos":[2295,2473],"content":"To apply the settings in the <bpt id=\"p1\">[</bpt>auditSystem<ept id=\"p1\">](auditsystem.md)</ept> and <bpt id=\"p2\">[</bpt>auditUser<ept id=\"p2\">](audituser.md)</ept> configuration passes, you must boot in audit mode by using the <bpt id=\"p3\">**</bpt>Sysprep/audit<ept id=\"p3\">**</ept> command."},{"content":"To apply the settings in the <bpt id=\"p1\">[</bpt>generalize<ept id=\"p1\">](generalize.md)</ept> configuration pass, you must use the <bpt id=\"p2\">**</bpt>Sysprep/generalize<ept id=\"p2\">**</ept> command.","pos":[2479,2604]},{"content":"The generalize configuration pass removes the system-specific settings so that you can deploy the same image on multiple computers.","pos":[2605,2736]},{"pos":[2738,2830],"content":"For more information, see <bpt id=\"p1\">[</bpt>How Configuration Passes Work<ept id=\"p1\">](how-configuration-passes-work.md)</ept>."},{"pos":[2885,2921],"content":"Caching Answer Files to the Computer"},{"content":"If you install Windows by using an answer file, that answer file is cached to the system.","pos":[2924,3013]},{"content":"When later configuration passes run, the computer applies settings in that answer file to the system.","pos":[3014,3115]},{"content":"Because this answer file is cached, when you run the <bpt id=\"p1\">**</bpt>Sysprep<ept id=\"p1\">**</ept> command, the system applies settings in the cached answer file.","pos":[3116,3244]},{"content":"If you use the settings in a different answer file, you can specify a separate Unattend.xml file by using the <bpt id=\"p1\">**</bpt>Sysprep /unattend:<ept id=\"p1\">**</ept><bpt id=\"p2\">*</bpt><ph id=\"ph1\">&amp;lt;</ph>file<ph id=\"ph2\">\\_</ph>name<ph id=\"ph3\">&amp;gt;</ph><ept id=\"p2\">*</ept> option.","pos":[3245,3405]},{"content":"For more information, see <bpt id=\"p1\">[</bpt>Sysprep Command-Line Options<ept id=\"p1\">](sysprep-command-line-options.md)</ept>.","pos":[3406,3496]},{"content":"For more information about how to use an implicit answer-file search, see<bpt id=\"p1\">[</bpt>Windows Setup Automation Overview<ept id=\"p1\">](windows-setup-automation-overview.md)</ept>.","pos":[3497,3644]},{"pos":[3699,3779],"content":"Persisting Plug and Play Device Drivers During the generalize Configuration Pass"},{"content":"You can persist device drivers when you run the <bpt id=\"p1\">**</bpt>Sysprep<ept id=\"p1\">**</ept> command together with the <bpt id=\"p2\">**</bpt>/generalize<ept id=\"p2\">**</ept> option.","pos":[3782,3891]},{"content":"To do this, specify the <ph id=\"ph1\">`PersistAllDeviceInstalls`</ph> setting in the Microsoft-Windows-PnPSysprep component.","pos":[3892,3997]},{"content":"During the <bpt id=\"p1\">[</bpt>specialize<ept id=\"p1\">](specialize.md)</ept> configuration pass, Plug and Play scans the computer for devices, and then installs device drivers for the detected devices.","pos":[3998,4161]},{"content":"By default, the computer removes these device drivers from the system when you generalize the system.","pos":[4162,4263]},{"content":"If you set the Microsoft-Windows-PnPSysprep<ph id=\"ph1\">\\\\`PersistAllDeviceInstalls`</ph> setting to <bpt id=\"p1\">**</bpt>true<ept id=\"p1\">**</ept> in an answer file, Sysprep doesn't remove the detected device drivers.","pos":[4264,4426]},{"pos":[4481,4532],"content":"Displaying RunSynchronous Actions in an Answer File"},{"content":"In audit mode, you can view the status for Microsoft-Windows-Deployment<ph id=\"ph1\">\\\\`RunSynchronous`</ph> commands that run during the <bpt id=\"p1\">[</bpt>auditUser<ept id=\"p1\">](audituser.md)</ept> configuration pass.","pos":[4535,4699]},{"content":"The <bpt id=\"p1\">**</bpt>AuditUI<ept id=\"p1\">**</ept> window displays the status for commands and provides these:","pos":[4700,4775]},{"content":"Visual progress to indicate that an installation is continuing and not suspended.","pos":[4781,4862]},{"content":"Visual indication of when and where failures occur.","pos":[4868,4919]},{"content":"This provides a quick diagnosis if the command doesn't create log files.","pos":[4920,4992]},{"content":"If the answer file contains Microsoft-Windows-Deployment<ph id=\"ph1\">\\\\`RunSynchronous`</ph> commands in the <bpt id=\"p1\">[</bpt>auditUser<ept id=\"p1\">](audituser.md)</ept> configuration pass, a list of the commands appears in the <bpt id=\"p2\">**</bpt>AuditUI<ept id=\"p2\">**</ept> window.","pos":[4994,5188]},{"content":"The commands appear in the order that the Microsoft-Windows-Deployment<ph id=\"ph1\">\\\\`RunSynchronous`\\\\`RunSynchronousCommand`\\\\`Order`</ph> setting specifies.","pos":[5189,5330]},{"content":"Each list item in the user interface is the string from one of these:","pos":[5331,5400]},{"pos":[5406,5505],"content":"Microsoft-Windows-Deployment<ph id=\"ph1\">\\\\`RunSynchronous`\\\\`RunSynchronousCommand`\\\\`Description`</ph> (if present)"},{"pos":[5511,5539],"content":"Microsoft-Windows-Deployment"},{"content":"<bpt id=\"p1\">**</bpt>Sysprep<ept id=\"p1\">**</ept> processes all <ph id=\"ph1\">`RunSynchronous`</ph> commands in order.","pos":[5592,5653]},{"content":"If the command succeeds, its related list item receives a green check-mark annotation.","pos":[5654,5740]},{"content":"If the command fails, its related list item receives a red X annotation.","pos":[5741,5813]},{"content":"If the command requests a reboot, the <bpt id=\"p1\">**</bpt>AuditUI<ept id=\"p1\">**</ept> window appears after the boot, but only unprocessed list items appear.","pos":[5814,5934]},{"content":"Previously processed items no longer appear in the <bpt id=\"p1\">**</bpt>AuditUI<ept id=\"p1\">**</ept> window.","pos":[5935,6005]},{"content":"If the list of items in the <bpt id=\"p1\">**</bpt>AuditUI<ept id=\"p1\">**</ept> window exceeds the height of the display, the list is truncated to the display and doesn't scroll.","pos":[6006,6144]},{"content":"As a result, you may not be able to see some items.","pos":[6145,6196]},{"content":"Windows Setup interprets the return codes as status values in the <bpt id=\"p1\">**</bpt>AuditUI<ept id=\"p1\">**</ept> window.","pos":[6198,6283]},{"content":"A zero value indicates a success.","pos":[6284,6317]},{"content":"A nonzero value indicates a failure.","pos":[6318,6354]},{"content":"The return value of the command might affect the behavior of Windows Setup, depending on the value of the Microsoft-Windows-Deployment<ph id=\"ph1\">\\\\`RunSynchronous`\\\\`RunSynchronousCommand`\\\\</ph><bpt id=\"p1\">**</bpt>WillReboot<ept id=\"p1\">**</ept> setting.","pos":[6355,6557]},{"pos":[6559,6608],"content":"If the <ph id=\"ph1\">`WillReboot`</ph> command is set to <bpt id=\"p1\">**</bpt>Always<ept id=\"p1\">**</ept>:"},{"content":"If the command returns 0, its related list item receives a green check-mark annotation.","pos":[6614,6701]},{"content":"A reboot immediately occurs.","pos":[6702,6730]},{"content":"If the command returns a nonzero number, its related list item receives a red X annotation.","pos":[6736,6827]},{"content":"A reboot immediately occurs.","pos":[6828,6856]},{"content":"A nonzero return value isn't treated as a fatal error when <ph id=\"ph1\">`WillReboot`</ph> is set to either <bpt id=\"p1\">**</bpt>Always<ept id=\"p1\">**</ept> or <bpt id=\"p2\">**</bpt>Never<ept id=\"p2\">**</ept>.","pos":[6857,6970]},{"pos":[6972,7020],"content":"If the <ph id=\"ph1\">`WillReboot`</ph> command is set to <bpt id=\"p1\">**</bpt>Never<ept id=\"p1\">**</ept>:"},{"content":"If the command returns 0, its related list item receives a green check-mark annotation.","pos":[7026,7113]},{"content":"If the command returns a nonzero number, its related list item receives a red X annotation.","pos":[7119,7210]},{"content":"A nonzero return value isn't treated as a fatal error when <ph id=\"ph1\">`WillReboot`</ph> is set to either <bpt id=\"p1\">**</bpt>Always<ept id=\"p1\">**</ept> or <bpt id=\"p2\">**</bpt>Never<ept id=\"p2\">**</ept>.","pos":[7211,7324]},{"pos":[7326,7378],"content":"If the <ph id=\"ph1\">`WillReboot`</ph> command is set to <bpt id=\"p1\">**</bpt>OnRequest<ept id=\"p1\">**</ept>:"},{"content":"If the command returns 0, its related list item receives a green check-mark annotation.","pos":[7384,7471]},{"content":"If the command returns 1, its related list item receives a green check-mark annotation.","pos":[7477,7564]},{"content":"A reboot immediately occurs.","pos":[7565,7593]},{"content":"If the command returns 2, its related list item temporarily receives a green check-mark annotation.","pos":[7599,7698]},{"content":"A reboot immediately occurs.","pos":[7699,7727]},{"content":"After the reboot, the related list item appears again in the <bpt id=\"p1\">**</bpt>AuditUI<ept id=\"p1\">**</ept> window without annotation because the command is still in process.","pos":[7728,7867]},{"content":"If the command returns other values, a fatal error occurs and a blocking dialog box appears.","pos":[7873,7965]},{"content":"If the Errorhandler.cmd file is present, no dialog box appears.","pos":[7966,8029]},{"content":"For more information about the Errorhandler.cmd file, see <bpt id=\"p1\">[</bpt>Add a Custom Script to Windows Setup<ept id=\"p1\">](add-a-custom-script-to-windows-setup.md)</ept>.","pos":[8030,8168]},{"pos":[8206,8220],"content":"Related topics"},{"content":"Sysprep (System Preparation) Overview","pos":[8224,8261]},{"content":"Sysprep Command-Line Options","pos":[8307,8335]},{"content":"Sysprep Support for Server Roles","pos":[8372,8404]},{"content":"Sysprep Process Overview","pos":[8445,8469]},{"content":"Deployment Troubleshooting and Log Files","pos":[8502,8542]}],"content":"---\nauthor: Justinha\nDescription: Use Answer Files with Sysprep\nms.assetid: baa66548-b1f8-42f4-8027-3d515441ac0c\nMSHAttr: 'PreferredLib:/library/windows/hardware'\ntitle: Use Answer Files with Sysprep\n---\n\n# Use Answer Files with Sysprep\n\n\nYou can use an answer file together with the System Preparation (**Sysprep**) tool to configure unattended WindowsÂ® Setup settings. This topic describes some considerations and processes for using answer files together with **Sysprep**. For more information about Windows components and settings that you can add to an answer file, see the [Unattended Windows Setup Reference](http://go.microsoft.com/fwlink/?LinkId=206281).\n\nIn this topic:\n\n-   [Running Sysprep an Unlimited Number of Times](#bkmk-skiprearm)\n\n-   [Applying Settings in the generalize, auditSystem, and auditUser Configuration Passes](#bkmk-1)\n\n-   [Caching Answer Files to the Computer](#bkmk-2)\n\n-   [Persisting Plug and Play Device Drivers During the generalize Configuration Pass](#bkmk-3)\n\n-   [Displaying RunSynchronous Actions in an Answer File](#bkmk-4)\n\n## <span id=\"bkmk_skipRearm\"></span><span id=\"bkmk_skiprearm\"></span><span id=\"BKMK_SKIPREARM\"></span>Running Sysprep an Unlimited Number of Times\n\n\nIf you specify a product key, Windows is automatically activated, and you can run the **Sysprep** command an unlimited number of times. To automatically activate Windows by supplying a product key, specify a valid product key in the Microsoft-Windows-Shell-Setup\\\\`ProductKey` unattend setting during the [specialize](specialize.md) configuration pass. If you don't automatically activate Windows by providing a product key, Windows prompts the end user for a product key. If the end user skips this step during OOBE, Windows reminds the end user to enter a valid product key later.\n\n## <span id=\"bkmk_1\"></span><span id=\"BKMK_1\"></span>Applying Settings in the generalize, auditSystem, and auditUser Configuration Passes\n\n\nNot all configuration passes run during Windows Setup. The [generalize](generalize.md), [auditSystem](auditsystem.md), and [auditUser](audituser.md) configuration passes are available only when you run **Sysprep**.\n\nIf you add settings to your answer file in these configuration passes, you must run **Sysprep** to apply these settings as follows:\n\n-   To apply the settings in the [auditSystem](auditsystem.md) and [auditUser](audituser.md) configuration passes, you must boot in audit mode by using the **Sysprep/audit** command.\n\n-   To apply the settings in the [generalize](generalize.md) configuration pass, you must use the **Sysprep/generalize** command. The generalize configuration pass removes the system-specific settings so that you can deploy the same image on multiple computers.\n\nFor more information, see [How Configuration Passes Work](how-configuration-passes-work.md).\n\n## <span id=\"bkmk_2\"></span><span id=\"BKMK_2\"></span>Caching Answer Files to the Computer\n\n\nIf you install Windows by using an answer file, that answer file is cached to the system. When later configuration passes run, the computer applies settings in that answer file to the system. Because this answer file is cached, when you run the **Sysprep** command, the system applies settings in the cached answer file. If you use the settings in a different answer file, you can specify a separate Unattend.xml file by using the **Sysprep /unattend:***&lt;file\\_name&gt;* option. For more information, see [Sysprep Command-Line Options](sysprep-command-line-options.md). For more information about how to use an implicit answer-file search, see[Windows Setup Automation Overview](windows-setup-automation-overview.md).\n\n## <span id=\"bkmk_3\"></span><span id=\"BKMK_3\"></span>Persisting Plug and Play Device Drivers During the generalize Configuration Pass\n\n\nYou can persist device drivers when you run the **Sysprep** command together with the **/generalize** option. To do this, specify the `PersistAllDeviceInstalls` setting in the Microsoft-Windows-PnPSysprep component. During the [specialize](specialize.md) configuration pass, Plug and Play scans the computer for devices, and then installs device drivers for the detected devices. By default, the computer removes these device drivers from the system when you generalize the system. If you set the Microsoft-Windows-PnPSysprep\\\\`PersistAllDeviceInstalls` setting to **true** in an answer file, Sysprep doesn't remove the detected device drivers.\n\n## <span id=\"bkmk_4\"></span><span id=\"BKMK_4\"></span>Displaying RunSynchronous Actions in an Answer File\n\n\nIn audit mode, you can view the status for Microsoft-Windows-Deployment\\\\`RunSynchronous` commands that run during the [auditUser](audituser.md) configuration pass. The **AuditUI** window displays the status for commands and provides these:\n\n-   Visual progress to indicate that an installation is continuing and not suspended.\n\n-   Visual indication of when and where failures occur. This provides a quick diagnosis if the command doesn't create log files.\n\nIf the answer file contains Microsoft-Windows-Deployment\\\\`RunSynchronous` commands in the [auditUser](audituser.md) configuration pass, a list of the commands appears in the **AuditUI** window. The commands appear in the order that the Microsoft-Windows-Deployment\\\\`RunSynchronous`\\\\`RunSynchronousCommand`\\\\`Order` setting specifies. Each list item in the user interface is the string from one of these:\n\n-   Microsoft-Windows-Deployment\\\\`RunSynchronous`\\\\`RunSynchronousCommand`\\\\`Description` (if present)\n\n-   Microsoft-Windows-Deployment\\\\`RunSynchronous`\\\\`RunSynchronousCommand`\\\\`Path`\n\n**Sysprep** processes all `RunSynchronous` commands in order. If the command succeeds, its related list item receives a green check-mark annotation. If the command fails, its related list item receives a red X annotation. If the command requests a reboot, the **AuditUI** window appears after the boot, but only unprocessed list items appear. Previously processed items no longer appear in the **AuditUI** window. If the list of items in the **AuditUI** window exceeds the height of the display, the list is truncated to the display and doesn't scroll. As a result, you may not be able to see some items.\n\nWindows Setup interprets the return codes as status values in the **AuditUI** window. A zero value indicates a success. A nonzero value indicates a failure. The return value of the command might affect the behavior of Windows Setup, depending on the value of the Microsoft-Windows-Deployment\\\\`RunSynchronous`\\\\`RunSynchronousCommand`\\\\**WillReboot** setting.\n\nIf the `WillReboot` command is set to **Always**:\n\n-   If the command returns 0, its related list item receives a green check-mark annotation. A reboot immediately occurs.\n\n-   If the command returns a nonzero number, its related list item receives a red X annotation. A reboot immediately occurs. A nonzero return value isn't treated as a fatal error when `WillReboot` is set to either **Always** or **Never**.\n\nIf the `WillReboot` command is set to **Never**:\n\n-   If the command returns 0, its related list item receives a green check-mark annotation.\n\n-   If the command returns a nonzero number, its related list item receives a red X annotation. A nonzero return value isn't treated as a fatal error when `WillReboot` is set to either **Always** or **Never**.\n\nIf the `WillReboot` command is set to **OnRequest**:\n\n-   If the command returns 0, its related list item receives a green check-mark annotation.\n\n-   If the command returns 1, its related list item receives a green check-mark annotation. A reboot immediately occurs.\n\n-   If the command returns 2, its related list item temporarily receives a green check-mark annotation. A reboot immediately occurs. After the reboot, the related list item appears again in the **AuditUI** window without annotation because the command is still in process.\n\n-   If the command returns other values, a fatal error occurs and a blocking dialog box appears. If the Errorhandler.cmd file is present, no dialog box appears. For more information about the Errorhandler.cmd file, see [Add a Custom Script to Windows Setup](add-a-custom-script-to-windows-setup.md).\n\n## <span id=\"related_topics\"></span>Related topics\n\n\n[Sysprep (System Preparation) Overview](sysprep--system-preparation--overview.md)\n\n[Sysprep Command-Line Options](sysprep-command-line-options.md)\n\n[Sysprep Support for Server Roles](sysprep-support-for-server-roles.md)\n\n[Sysprep Process Overview](sysprep-process-overview.md)\n\n[Deployment Troubleshooting and Log Files](deployment-troubleshooting-and-log-files.md)\n\n \n\n \n\n\n\n\n\n\n"}