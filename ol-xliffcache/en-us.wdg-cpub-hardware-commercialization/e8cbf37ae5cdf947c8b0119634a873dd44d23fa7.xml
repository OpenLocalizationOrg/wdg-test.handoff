{"nodes":[{"content":"Sessions","pos":[11,19]},{"content":"Sessions","pos":[33,41]},{"content":"Sessions","pos":[230,238]},{"content":"Windows Performance Recorder (WPR) extends Event Tracing for Windows (ETW).","pos":[241,316]},{"content":"An ETW logging session is a collection of in-memory buffers that accepts events through the ETW Provider application programming interface (API).","pos":[317,462]},{"content":"These buffers are typically non-paged and are managed by the kernel.","pos":[463,531]},{"content":"ETW assigns a buffer to each processor.","pos":[532,571]},{"content":"ETW event generation and buffering is lock-free to enable ETW to log all kinds of events.","pos":[572,661]},{"content":"Every time that ETW calls the <bpt id=\"p1\">**</bpt>EventWrite<ept id=\"p1\">**</ept> method, ETW reserves space in the current buffer that ETW has allocated to the processor that is running the calling thread.","pos":[663,832]},{"content":"Then, ETW copies the event header and user data into that space.","pos":[833,897]},{"content":"When the buffer is full, ETW flushes the buffer to the logging session’s log file or the real-time streaming consumer.","pos":[898,1016]},{"content":"ETW then assigns a free buffer to that processor.","pos":[1017,1066]},{"content":"If the logging throughput exceeds the ability of the flusher to free buffers, all available buffer space in the logging session might become unavailable.","pos":[1068,1221]},{"content":"For example, this might occur because the disk write throughput is lower than the incoming event throughput.","pos":[1222,1330]},{"content":"This causes <bpt id=\"p1\">**</bpt>EventWrite<ept id=\"p1\">**</ept> to raise an ERROR<ph id=\"ph1\">\\_</ph>NOT<ph id=\"ph2\">\\_</ph>ENOUGH<ph id=\"ph3\">\\_</ph>MEMORY error and lose the event data.","pos":[1331,1427]},{"content":"In such cases, ETW increments the <bpt id=\"p1\">**</bpt>EventsLost<ept id=\"p1\">**</ept> property of the logging session so that consumers can see the data loss.","pos":[1428,1549]},{"pos":[1551,1667],"content":"For more information about how to avoid losing events in a recording, see <bpt id=\"p1\">[</bpt>Avoid Lost Events<ept id=\"p1\">](avoid-lost-events.md)</ept>."},{"content":"Logging to Memory or to a File","pos":[1672,1702]},{"content":"You can configure profiles to record the event data to buffers in memory or to a file.","pos":[1705,1791]},{"content":"Buffering mode is an in-memory circular session.","pos":[1792,1840]},{"content":"You can save the content of this session as a snapshot to an event trace log (ETL) file on request.","pos":[1841,1940]},{"content":"WPR does not flush the content of the in-memory buffer space when you save the content.","pos":[1941,2028]},{"content":"You can leave buffering mode sessions on constantly.","pos":[2030,2082]},{"content":"This is especially useful if you do not know when the behavior of interest will occur.","pos":[2083,2169]},{"content":"Choose buffering mode when the required circular buffer space is small enough to be kept in memory.","pos":[2170,2269]},{"content":"Sequential log files are best for controlled scenarios.","pos":[2270,2325]},{"content":"For example, you can use sequential log files for regression testing or when the occurrence of the behavior of interest is easier to predict.","pos":[2326,2467]},{"pos":[2469,2549],"content":"For more information about logging options, see <bpt id=\"p1\">[</bpt>Logging Mode<ept id=\"p1\">](logging-mode.md)</ept>."},{"content":"Recording Profiles","pos":[2554,2572]},{"content":"A recording profile controls each session.","pos":[2575,2617]},{"content":"The profile can be either a built-in profile or a user-defined profile.","pos":[2618,2689]},{"content":"For more information, see <bpt id=\"p1\">[</bpt>Recording Profiles<ept id=\"p1\">](recording-profiles.md)</ept>.","pos":[2690,2760]},{"content":"Buffer Size","pos":[2765,2776]},{"content":"Buffer size is important for controlling I/O efficiency and ensuring that WPR does not skip large events.","pos":[2779,2884]},{"content":"Very small buffers can reduce I/O write efficiency.","pos":[2885,2936]},{"content":"We recommend a minimum buffer size of 64 KB or 128 KB to promote good write performance and to reduce disk overhead and lost events.","pos":[2937,3069]},{"content":"Buffer size determines the maximum duration of a recording.","pos":[3070,3129]},{"content":"ETW limits the largest event size to approximately 64 KB.","pos":[3130,3187]},{"content":"Collectors","pos":[3192,3202]},{"content":"You must define a system collector and one or more event collectors for a session in the recording profile.","pos":[3205,3312]},{"content":"The collector name must be unique to the system and the system must have exclusive write access to the log file.","pos":[3313,3425]},{"content":"The name of the log file must also be unique among the file names of all collectors.","pos":[3426,3510]},{"content":"WPR does not expand environment variables, so the path to the log file must be specified without environment variables.","pos":[3511,3630]},{"content":"For more information, see <bpt id=\"p1\">[</bpt>1. Collector Definitions<ept id=\"p1\">](1-collector-definitions.md)</ept>.","pos":[3631,3712]},{"content":"Providers","pos":[3717,3726]},{"content":"Logging sessions collect from a defined set of system and event providers.","pos":[3729,3803]},{"content":"This is an important item to configure on a per-session basis.","pos":[3804,3866]},{"content":"Most providers can have a many-to-many relationship with sessions.","pos":[3867,3933]},{"content":"Special providers are necessary for some events, such as kernel or heap events.","pos":[3934,4013]},{"content":"For more information, see <bpt id=\"p1\">[</bpt>Providers<ept id=\"p1\">](providers.md)</ept>.","pos":[4014,4066]},{"content":"Related topics","pos":[4071,4085]},{"content":"WPR Features","pos":[4089,4101]},{"content":"WPR Common Scenarios","pos":[4122,4142]},{"content":"Recording Profiles","pos":[4196,4214]},{"content":"Buffers","pos":[4241,4248]},{"content":"BufferSize","pos":[4264,4274]}],"content":"---\ntitle: Sessions\ndescription: Sessions\nMSHAttr:\n- 'PreferredSiteName:MSDN'\n- 'PreferredLib:/library/windows/hardware'\nms.assetid: cb2a15ea-3519-4efb-8031-93b19fac10d4\nms.prod: W10\nms.mktglfcycl: operate\nms.sitesec: msdn\n---\n\n# Sessions\n\n\nWindows Performance Recorder (WPR) extends Event Tracing for Windows (ETW). An ETW logging session is a collection of in-memory buffers that accepts events through the ETW Provider application programming interface (API). These buffers are typically non-paged and are managed by the kernel. ETW assigns a buffer to each processor. ETW event generation and buffering is lock-free to enable ETW to log all kinds of events.\n\nEvery time that ETW calls the **EventWrite** method, ETW reserves space in the current buffer that ETW has allocated to the processor that is running the calling thread. Then, ETW copies the event header and user data into that space. When the buffer is full, ETW flushes the buffer to the logging session’s log file or the real-time streaming consumer. ETW then assigns a free buffer to that processor.\n\nIf the logging throughput exceeds the ability of the flusher to free buffers, all available buffer space in the logging session might become unavailable. For example, this might occur because the disk write throughput is lower than the incoming event throughput. This causes **EventWrite** to raise an ERROR\\_NOT\\_ENOUGH\\_MEMORY error and lose the event data. In such cases, ETW increments the **EventsLost** property of the logging session so that consumers can see the data loss.\n\nFor more information about how to avoid losing events in a recording, see [Avoid Lost Events](avoid-lost-events.md).\n\n## Logging to Memory or to a File\n\n\nYou can configure profiles to record the event data to buffers in memory or to a file. Buffering mode is an in-memory circular session. You can save the content of this session as a snapshot to an event trace log (ETL) file on request. WPR does not flush the content of the in-memory buffer space when you save the content.\n\nYou can leave buffering mode sessions on constantly. This is especially useful if you do not know when the behavior of interest will occur. Choose buffering mode when the required circular buffer space is small enough to be kept in memory. Sequential log files are best for controlled scenarios. For example, you can use sequential log files for regression testing or when the occurrence of the behavior of interest is easier to predict.\n\nFor more information about logging options, see [Logging Mode](logging-mode.md).\n\n## Recording Profiles\n\n\nA recording profile controls each session. The profile can be either a built-in profile or a user-defined profile. For more information, see [Recording Profiles](recording-profiles.md).\n\n## Buffer Size\n\n\nBuffer size is important for controlling I/O efficiency and ensuring that WPR does not skip large events. Very small buffers can reduce I/O write efficiency. We recommend a minimum buffer size of 64 KB or 128 KB to promote good write performance and to reduce disk overhead and lost events. Buffer size determines the maximum duration of a recording. ETW limits the largest event size to approximately 64 KB.\n\n## Collectors\n\n\nYou must define a system collector and one or more event collectors for a session in the recording profile. The collector name must be unique to the system and the system must have exclusive write access to the log file. The name of the log file must also be unique among the file names of all collectors. WPR does not expand environment variables, so the path to the log file must be specified without environment variables. For more information, see [1. Collector Definitions](1-collector-definitions.md).\n\n## Providers\n\n\nLogging sessions collect from a defined set of system and event providers. This is an important item to configure on a per-session basis. Most providers can have a many-to-many relationship with sessions. Special providers are necessary for some events, such as kernel or heap events. For more information, see [Providers](providers.md).\n\n## Related topics\n\n\n[WPR Features](wpr-features.md)\n\n[WPR Common Scenarios](windows-performance-recorder-common-scenarios.md)\n\n[Recording Profiles](recording-profiles.md)\n\n[Buffers](buffers.md)\n\n[BufferSize](buffersize.md)\n\n \n\n \n\n\n\n\n\n\n\n"}