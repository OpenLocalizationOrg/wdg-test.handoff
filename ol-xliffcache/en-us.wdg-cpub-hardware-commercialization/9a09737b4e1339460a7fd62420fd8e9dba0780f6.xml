{"nodes":[{"content":"Symbol Support","pos":[11,25]},{"content":"Symbol Support","pos":[39,53]},{"content":"Symbol Support","pos":[242,256]},{"content":"When Windows Performance Analyzer (WPA) is correctly configured, WPA shows symbolic names from the symbol files for addresses that are found in the recording.","pos":[259,417]},{"content":"To decode symbols, the tools must locate the program database files, known as program database (PDB) files or symbol files, to build complete call stacks.","pos":[419,573]},{"content":"The compiler and linker generate PDB files when the system builds a component.","pos":[574,652]},{"content":"Microsoft provides the program database files for many Microsoft products in an online symbol server.","pos":[653,754]},{"content":"The Microsoft Debugging Tools for Windows and WPA use the online symbol server to look up symbol information.","pos":[755,864]},{"content":"Therefore, the computer must be connected to the Internet if the symbol files are not copied locally.","pos":[865,966]},{"content":"The Windows Performance Toolkit uses the same symbol decoding infrastructure as the Windows debugger, <bpt id=\"p1\">**</bpt>Windbg.exe<ept id=\"p1\">**</ept>.","pos":[967,1084]},{"content":"For more information, see <bpt id=\"p1\">[</bpt>WinDbg<ept id=\"p1\">](http://go.microsoft.com/fwlink/p/?linkid=212249)</ept>.","pos":[1085,1169]},{"content":"To configure symbol support, you must define the <bpt id=\"p1\">**</bpt><ph id=\"ph1\">\\_</ph>NT<ph id=\"ph2\">\\_</ph>SYMBOL<ph id=\"ph3\">\\_</ph>PATH<ept id=\"p1\">**</ept> environment variable.","pos":[1171,1264]},{"content":"The following example sets the symbol path to use the Microsoft public symbol server together with a downstream store in C:<ph id=\"ph1\">\\\\</ph>symbols:","pos":[1265,1398]},{"content":"Note that this example is a single command line.","pos":[1496,1544]},{"content":"The URL in this symbol path specifies the online Microsoft symbol server.","pos":[1546,1619]},{"content":"The path between the asterisks (C:<ph id=\"ph1\">\\\\</ph>symbols) specifies the downstream store.","pos":[1620,1696]},{"content":"This is a local cache in which the symbol resolution system keeps symbol files.","pos":[1697,1776]},{"content":"WPA Tools also decode symbols from components that you develop.","pos":[1777,1840]},{"content":"Add one or more paths to <bpt id=\"p1\">**</bpt><ph id=\"ph1\">\\_</ph>NT<ph id=\"ph2\">\\_</ph>SYMBOL<ph id=\"ph3\">\\_</ph>PATH<ept id=\"p1\">**</ept> that contain the PDB files for the components that you want to record.","pos":[1841,1959]},{"content":"For example, the following example shows how the path was set up for the previous example:","pos":[1960,2050]},{"content":"When Xperf or WPA decodes symbols, Xperf or WPA caches a condensed version of the original symbol files, or PDBs, on disk in the <bpt id=\"p1\">**</bpt><ph id=\"ph1\">\\\\</ph>symcache<ept id=\"p1\">**</ept> directory.","pos":[2125,2279]},{"content":"To do this, Xperf or WPA uses the symbols that are available at the time.","pos":[2280,2353]},{"content":"The operating system symbols that are available outside Microsoft are public symbols.","pos":[2354,2439]},{"content":"These symbols contain less information than internal private symbols.","pos":[2440,2509]},{"content":"In black-box testing, public symbols can also include incorrect information.","pos":[2510,2586]},{"content":"Private symbols, which are more reliable, can be obtained under non-disclosure agreements.","pos":[2587,2677]},{"content":"If a user has decoded a recording by using public symbols, and the user then obtains private symbols, the user must clear the <bpt id=\"p1\">**</bpt><ph id=\"ph1\">\\\\</ph>symcache<ept id=\"p1\">**</ept> directory before Xperf or WPA can discover the new private symbols.","pos":[2678,2886]},{"content":"Troubleshooting Symbol Decoding","pos":[2891,2922]},{"content":"Symbol decoding support is complex.","pos":[2925,2960]},{"content":"The following requirements must be met:","pos":[2961,3000]},{"pos":[3006,3143],"content":"You must specify <ph id=\"ph1\">`-symbols`</ph> on the Xperf command line or select <bpt id=\"p1\">**</bpt>Load Symbols<ept id=\"p1\">**</ept> on the <bpt id=\"p2\">**</bpt>Trace<ept id=\"p2\">**</ept> menu in WPA after you open a recording."},{"content":"The environment variables must be configured correctly.","pos":[3149,3204]},{"content":"For more information for Xperf, see <bpt id=\"p1\">[</bpt>symbols<ept id=\"p1\">](symbols.md)</ept>.","pos":[3205,3263]},{"content":"The ETW kernel recording file must have been stopped and merged correctly.","pos":[3269,3343]},{"content":"For more information, see <bpt id=\"p1\">[</bpt>Stopping a Recording<ept id=\"p1\">](stop-a-recording.md)</ept>.","pos":[3344,3414]},{"content":"Windows Performance Recorder (WPR) or WPA merges the ETW user recording file together with a kernel recording file that is taken at the same time on the same computer.","pos":[3420,3587]},{"content":"You must have access to the binary and symbol sources that <bpt id=\"p1\">**</bpt><ph id=\"ph1\">\\_</ph>NT<ph id=\"ph2\">\\_</ph>SYMBOL<ph id=\"ph3\">\\_</ph>PATH<ept id=\"p1\">**</ept> specifies.","pos":[3593,3685]},{"content":"If you use a symbol server, the symbol server is often just a redirector.","pos":[3686,3759]},{"content":"In this case, you must have access to both the symbol server and the sites that the symbol server points to that host the binaries and symbols.","pos":[3760,3903]},{"content":"<bpt id=\"p1\">**</bpt><ph id=\"ph1\">\\_</ph>NT<ph id=\"ph2\">\\_</ph>SYMBOL<ph id=\"ph3\">\\_</ph>PATH<ept id=\"p1\">**</ept> must point to the correct files.","pos":[3909,3964]},{"content":"If the files exist from a different build or architecture, the files will not work.","pos":[3965,4048]},{"content":"If the version of the application binary files is not the same version as the symbols that <bpt id=\"p1\">**</bpt><ph id=\"ph1\">\\_</ph>NT<ph id=\"ph2\">\\_</ph>SYMBOL<ph id=\"ph3\">\\_</ph>PATH<ept id=\"p1\">**</ept> points to, you cannot view call stacks.","pos":[4049,4202]},{"content":"To rule out a symbol mismatch, use <bpt id=\"p1\">**</bpt>Symchk.exe<ept id=\"p1\">**</ept> from the <bpt id=\"p2\">**</bpt>Debugging Tools for Windows<ept id=\"p2\">**</ept> distribution to ensure that the symbols match the symbol files on the computer on which the recording was taken.","pos":[4208,4411]},{"content":"For example:","pos":[4412,4424]},{"content":"To rule out a binary mismatch, use the <ph id=\"ph1\">`fc /b`</ph> command to ensure that the binaries on the computer on which the recording was taken match the binaries on the drop share.","pos":[4506,4675]},{"content":"For example:","pos":[4676,4688]},{"content":"In Xperf, you must capture the ETW kernel recording by using at least the <ph id=\"ph1\">`PROC_THREAD+LOADER`</ph> flags.","pos":[4759,4860]},{"content":"These flags provide basic information about process lifetime and image virtual address ranges in process memory.","pos":[4861,4973]},{"content":"This information helps XPerf to decode virtual addresses to images and symbols.","pos":[4974,5053]},{"pos":[5059,5385],"content":"To verify that these flags have been enabled in the ETW kernel recording, check that Xperf <bpt id=\"p1\">**</bpt>-process<ept id=\"p1\">**</ept> events (<bpt id=\"p2\">**</bpt>Create<ept id=\"p2\">**</ept>, <bpt id=\"p3\">**</bpt>Delete<ept id=\"p3\">**</ept>, <bpt id=\"p4\">**</bpt>Start Rundown<ept id=\"p4\">**</ept>, <bpt id=\"p5\">**</bpt>End Rundown<ept id=\"p5\">**</ept>) and <bpt id=\"p6\">**</bpt>Image<ept id=\"p6\">**</ept> events (<bpt id=\"p7\">**</bpt>Load<ept id=\"p7\">**</ept>, <bpt id=\"p8\">**</bpt>Unload<ept id=\"p8\">**</ept>, <bpt id=\"p9\">**</bpt>Start Rundown<ept id=\"p9\">**</ept>, <bpt id=\"p10\">**</bpt>End Rundown<ept id=\"p10\">**</ept>) are present in the table that is generated by using the following command:"},{"pos":[5461,5573],"content":"**Note**  \nAll of these events might not be listed in the table, depending on whether these events occurred.","leadings":["","    "],"nodes":[{"content":"Note","pos":[2,6]},{"content":"All of these events might not be listed in the table, depending on whether these events occurred.","pos":[11,108]}]},{"content":"Limitation in Xperf Symbol Decoding","pos":[5586,5621]},{"content":"Xperf defaults to the system drive if a drive is not specified for an executable image (such as <bpt id=\"p1\">**</bpt><ph id=\"ph1\">\\\\</ph>Path<ph id=\"ph2\">\\\\</ph>Library.dll<ept id=\"p1\">**</ept>).","pos":[5623,5744]},{"content":"When you run the <ph id=\"ph1\">`-d/-merge`</ph> command, if Xperf cannot find an executable image that existed in a running process during the recording, Xperf cannot retrieve the corresponding image and symbol file identity information and add the information to the merged recording.","pos":[5745,6011]},{"content":"Without that information, Xperf cannot perform symbol decoding for that image in that recording.","pos":[6012,6108]},{"content":"This issue does not affect other file paths, such as the paths in disk I/O or file I/O.","pos":[6110,6197]},{"content":"To enable symbol decoding and to help enable correct image load and unload paths in Xperf ETW recordings, you should store all executable images for which you might require symbol decoding or image load and unload paths on the system drive.","pos":[6199,6439]},{"content":"Then, run the images from that drive.","pos":[6440,6477]},{"content":"If that is not possible, create a mirror of the images on the system drive, even if you run the images from another drive.","pos":[6478,6600]},{"content":"For example, if C: is your system drive, create an identical copy of <bpt id=\"p1\">**</bpt>D:<ph id=\"ph1\">\\\\</ph>game<ph id=\"ph2\">\\\\</ph>bin<ph id=\"ph3\">\\\\</ph>binkw32.dll<ept id=\"p1\">**</ept> at <bpt id=\"p2\">**</bpt>C:<ph id=\"ph4\">\\\\</ph>game<ph id=\"ph5\">\\\\</ph>bin<ph id=\"ph6\">\\\\</ph>binkw32.dll<ept id=\"p2\">**</ept>.","pos":[6601,6735]},{"content":"Related topics","pos":[6740,6754]},{"content":"Windows Performance Toolkit","pos":[6758,6785]},{"content":"symbols","pos":[6799,6806]},{"content":"Using CLR 4.0 NGEN PDB Support","pos":[6822,6852]},{"content":"Common In-Depth Analysis Issues","pos":[6890,6921]}],"content":"---\ntitle: Symbol Support\ndescription: Symbol Support\nMSHAttr:\n- 'PreferredSiteName:MSDN'\n- 'PreferredLib:/library/windows/hardware'\nms.assetid: 3f4fcf1c-9d81-4842-82e5-a443f47f5255\nms.prod: W10\nms.mktglfcycl: operate\nms.sitesec: msdn\n---\n\n# Symbol Support\n\n\nWhen Windows Performance Analyzer (WPA) is correctly configured, WPA shows symbolic names from the symbol files for addresses that are found in the recording.\n\nTo decode symbols, the tools must locate the program database files, known as program database (PDB) files or symbol files, to build complete call stacks. The compiler and linker generate PDB files when the system builds a component. Microsoft provides the program database files for many Microsoft products in an online symbol server. The Microsoft Debugging Tools for Windows and WPA use the online symbol server to look up symbol information. Therefore, the computer must be connected to the Internet if the symbol files are not copied locally. The Windows Performance Toolkit uses the same symbol decoding infrastructure as the Windows debugger, **Windbg.exe**. For more information, see [WinDbg](http://go.microsoft.com/fwlink/p/?linkid=212249).\n\nTo configure symbol support, you must define the **\\_NT\\_SYMBOL\\_PATH** environment variable. The following example sets the symbol path to use the Microsoft public symbol server together with a downstream store in C:\\\\symbols:\n\n``` syntax\nset _NT_SYMBOL_PATH= srv*C:\\symbols*http://msdl.microsoft.com/downloads/symbols\n```\n\nNote that this example is a single command line.\n\nThe URL in this symbol path specifies the online Microsoft symbol server. The path between the asterisks (C:\\\\symbols) specifies the downstream store. This is a local cache in which the symbol resolution system keeps symbol files. WPA Tools also decode symbols from components that you develop. Add one or more paths to **\\_NT\\_SYMBOL\\_PATH** that contain the PDB files for the components that you want to record. For example, the following example shows how the path was set up for the previous example:\n\n``` syntax\nset _NT_SYMBOL_PATH=c:\\coding\\fs\\release;srv*C:\\symbols*\n```\n\nWhen Xperf or WPA decodes symbols, Xperf or WPA caches a condensed version of the original symbol files, or PDBs, on disk in the **\\\\symcache** directory. To do this, Xperf or WPA uses the symbols that are available at the time. The operating system symbols that are available outside Microsoft are public symbols. These symbols contain less information than internal private symbols. In black-box testing, public symbols can also include incorrect information. Private symbols, which are more reliable, can be obtained under non-disclosure agreements. If a user has decoded a recording by using public symbols, and the user then obtains private symbols, the user must clear the **\\\\symcache** directory before Xperf or WPA can discover the new private symbols.\n\n## Troubleshooting Symbol Decoding\n\n\nSymbol decoding support is complex. The following requirements must be met:\n\n-   You must specify `-symbols` on the Xperf command line or select **Load Symbols** on the **Trace** menu in WPA after you open a recording.\n\n-   The environment variables must be configured correctly. For more information for Xperf, see [symbols](symbols.md).\n\n-   The ETW kernel recording file must have been stopped and merged correctly. For more information, see [Stopping a Recording](stop-a-recording.md).\n\n-   Windows Performance Recorder (WPR) or WPA merges the ETW user recording file together with a kernel recording file that is taken at the same time on the same computer.\n\n-   You must have access to the binary and symbol sources that **\\_NT\\_SYMBOL\\_PATH** specifies. If you use a symbol server, the symbol server is often just a redirector. In this case, you must have access to both the symbol server and the sites that the symbol server points to that host the binaries and symbols.\n\n-   **\\_NT\\_SYMBOL\\_PATH** must point to the correct files. If the files exist from a different build or architecture, the files will not work. If the version of the application binary files is not the same version as the symbols that **\\_NT\\_SYMBOL\\_PATH** points to, you cannot view call stacks.\n\n    To rule out a symbol mismatch, use **Symchk.exe** from the **Debugging Tools for Windows** distribution to ensure that the symbols match the symbol files on the computer on which the recording was taken. For example:\n\n    ``` syntax\n    symchk /v <local_file> /s <sympath_to_name.pdb>\n    ```\n\n    To rule out a binary mismatch, use the `fc /b` command to ensure that the binaries on the computer on which the recording was taken match the binaries on the drop share. For example:\n\n    ``` syntax\n    fc /b <local_file> <drop_share_file>\n    ```\n\n-   In Xperf, you must capture the ETW kernel recording by using at least the `PROC_THREAD+LOADER` flags. These flags provide basic information about process lifetime and image virtual address ranges in process memory. This information helps XPerf to decode virtual addresses to images and symbols.\n\n    To verify that these flags have been enabled in the ETW kernel recording, check that Xperf **-process** events (**Create**, **Delete**, **Start Rundown**, **End Rundown**) and **Image** events (**Load**, **Unload**, **Start Rundown**, **End Rundown**) are present in the table that is generated by using the following command:\n\n    ``` syntax\n    xperf -i kernel.etl -a tracestats -detail\n    ```\n\n    **Note**  \n    All of these events might not be listed in the table, depending on whether these events occurred.\n\n     \n\n### Limitation in Xperf Symbol Decoding\n\nXperf defaults to the system drive if a drive is not specified for an executable image (such as **\\\\Path\\\\Library.dll**). When you run the `-d/-merge` command, if Xperf cannot find an executable image that existed in a running process during the recording, Xperf cannot retrieve the corresponding image and symbol file identity information and add the information to the merged recording. Without that information, Xperf cannot perform symbol decoding for that image in that recording.\n\nThis issue does not affect other file paths, such as the paths in disk I/O or file I/O.\n\nTo enable symbol decoding and to help enable correct image load and unload paths in Xperf ETW recordings, you should store all executable images for which you might require symbol decoding or image load and unload paths on the system drive. Then, run the images from that drive. If that is not possible, create a mirror of the images on the system drive, even if you run the images from another drive. For example, if C: is your system drive, create an identical copy of **D:\\\\game\\\\bin\\\\binkw32.dll** at **C:\\\\game\\\\bin\\\\binkw32.dll**.\n\n## Related topics\n\n\n[Windows Performance Toolkit](index.md)\n\n[symbols](symbols.md)\n\n[Using CLR 4.0 NGEN PDB Support](using-clr-40-ngen-pdb-support.md)\n\n[Common In-Depth Analysis Issues](../assessments/common-in-depth-analysis-issues.md)\n\n \n\n \n\n\n\n\n\n\n\n"}