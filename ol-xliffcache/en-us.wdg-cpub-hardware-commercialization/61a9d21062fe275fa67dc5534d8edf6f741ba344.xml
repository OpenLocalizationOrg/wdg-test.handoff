{"nodes":[{"content":"FFU Catalog Signing","pos":[34,53]},{"content":"FFU Catalog Signing","pos":[160,179]},{"content":"FFU Catalog Signing","pos":[187,206]},{"content":"The tools that have been created to simplify the engineering and manufacturing processes provision a Microsoft certificate to the PK (Platform Key) store in UEFI.","pos":[209,371]},{"content":"This enables Microsoft to sign the image.","pos":[372,413]},{"content":"OEM partners provision their own certificates to the PK cert store to enable the OEM to sign the FFU.","pos":[414,515]},{"content":"An OEM can also sign FFUs if the OEM writes their own UEFI tool to provision the signing root/intermediate to the PK store.","pos":[517,640]},{"content":"However, this is not recommended because it introduces complexity and security risk for both you and Microsoft in part because building and maintaining UEFI tools and the maintenance of code signing certificates and infrastructure is complex.","pos":[641,883]},{"content":"This is especially true for small or new OEMs, as a leaked private key would allow arbitrary entities to sign FFUs that can be loaded onto the QRD OEM's device and you would still have to communicate with Microsoft for all other signing.","pos":[884,1121]},{"content":"Therefore, to reduce the complexity and simplify the FFU catalog signing process, the ingestion client has been updated with new functionality to support retail signing of FFU catalogs.","pos":[1123,1308]},{"pos":[1418,1434],"content":"OEM Verification"},{"content":"An FFU catalog signed for OEM.","pos":[1437,1467]},{"content":"A would be a valid FFU catalog for OEM B’s devices because the intermediate certificate Microsoft provisions to the PK store is a single intermediate certificate.","pos":[1468,1630]},{"content":"This is referred to as a cross-pollination risk.","pos":[1631,1679]},{"content":"Therefore, to prevent images created by one OEM from being flash-able onto another OEM's devices intentionally or by accident, the mechanism used to sign FFU catalogs in the latest release of the ingestion client will be handled differently than the mechanism used to sign other packages.","pos":[1680,1968]},{"content":"OEM validation will occur during signing by inspecting the metadata associated with the FFU catalog in the submission.","pos":[1969,2087]},{"content":"The OEM ID contained in the catalog will be verified against OEM ID of the submission.","pos":[2088,2174]},{"content":"If the values do not match, the FFU catalog signing request will be rejected.","pos":[2175,2252]},{"content":"Furthermore, the Ingestion Client will verify the integrity of the catalog by checking hash values passed in with the FFU catalog metadata.","pos":[2253,2392]},{"content":"The diagram below depicts the FFU catalog and the associated metadata that will be used for this verification:","pos":[2393,2503]},{"content":"ffu catalog signing","pos":[2507,2526]},{"content":"For example, after you have completed initial testing on a new image, the image must be tested on a retail device.","pos":[2559,2673]},{"content":"You create an FFU image for flashing, and the FFU catalog must be retail signed by Microsoft before the image can be flashed to a retail device.","pos":[2674,2818]},{"content":"Use the ingestion client's <ph id=\"ph1\">`Initialize-FirmwareSubmission`</ph> cmdlet with <ph id=\"ph2\">`-TypeOfSubmission FfuCatalog`</ph>, specifying the location of the FFU image.","pos":[2819,2963]},{"content":"The ingestion client will extract the FFU catalog and associated metadata from the FFU image and pass that to Microsoft to be retail signed.","pos":[2964,3104]},{"content":"Code signing validates the integrity of the FFU catalog and checks the OEM ID of the catalog against the OEM ID of the account that you submitted the signing request through.","pos":[3105,3279]},{"content":"As long as the OEM ID of the FFU catalog matches the OEM ID of the account of the signing request Microsoft will process and sign the FFU catalog.","pos":[3280,3426]},{"content":"Once complete, you can use the <ph id=\"ph1\">`Get-SignedFirmwareSubmission`</ph> cmdlet to obtain the retail signed FFU catalog before re-integrating the signed catalog back into the FFU image so it can be flashed to a device for testing.","pos":[3427,3646]},{"pos":[3789,3816],"content":"FFU Catalog Signing Example"},{"content":"To prepare an FFU catalog to be signed:","pos":[3819,3858]}],"content":"---\nauthor: kpacquer\nDescription: FFU Catalog Signing\nms.assetid: 31956395-2253-430e-a578-fc0218952a90\nMSHAttr: 'PreferredLib:/library/windows/hardware'\ntitle: FFU Catalog Signing\n---\n\n# FFU Catalog Signing\n\n\nThe tools that have been created to simplify the engineering and manufacturing processes provision a Microsoft certificate to the PK (Platform Key) store in UEFI. This enables Microsoft to sign the image. OEM partners provision their own certificates to the PK cert store to enable the OEM to sign the FFU.\n\nAn OEM can also sign FFUs if the OEM writes their own UEFI tool to provision the signing root/intermediate to the PK store. However, this is not recommended because it introduces complexity and security risk for both you and Microsoft in part because building and maintaining UEFI tools and the maintenance of code signing certificates and infrastructure is complex. This is especially true for small or new OEMs, as a leaked private key would allow arbitrary entities to sign FFUs that can be loaded onto the QRD OEM's device and you would still have to communicate with Microsoft for all other signing.\n\nTherefore, to reduce the complexity and simplify the FFU catalog signing process, the ingestion client has been updated with new functionality to support retail signing of FFU catalogs.\n\n## <span id=\"OEM_Verification\"></span><span id=\"oem_verification\"></span><span id=\"OEM_VERIFICATION\"></span>OEM Verification\n\n\nAn FFU catalog signed for OEM. A would be a valid FFU catalog for OEM B’s devices because the intermediate certificate Microsoft provisions to the PK store is a single intermediate certificate. This is referred to as a cross-pollination risk. Therefore, to prevent images created by one OEM from being flash-able onto another OEM's devices intentionally or by accident, the mechanism used to sign FFU catalogs in the latest release of the ingestion client will be handled differently than the mechanism used to sign other packages. OEM validation will occur during signing by inspecting the metadata associated with the FFU catalog in the submission. The OEM ID contained in the catalog will be verified against OEM ID of the submission. If the values do not match, the FFU catalog signing request will be rejected. Furthermore, the Ingestion Client will verify the integrity of the catalog by checking hash values passed in with the FFU catalog metadata. The diagram below depicts the FFU catalog and the associated metadata that will be used for this verification:\n\n![ffu catalog signing](images/ffucatalogsigning.jpg)\n\nFor example, after you have completed initial testing on a new image, the image must be tested on a retail device. You create an FFU image for flashing, and the FFU catalog must be retail signed by Microsoft before the image can be flashed to a retail device. Use the ingestion client's `Initialize-FirmwareSubmission` cmdlet with `-TypeOfSubmission FfuCatalog`, specifying the location of the FFU image. The ingestion client will extract the FFU catalog and associated metadata from the FFU image and pass that to Microsoft to be retail signed. Code signing validates the integrity of the FFU catalog and checks the OEM ID of the catalog against the OEM ID of the account that you submitted the signing request through. As long as the OEM ID of the FFU catalog matches the OEM ID of the account of the signing request Microsoft will process and sign the FFU catalog. Once complete, you can use the `Get-SignedFirmwareSubmission` cmdlet to obtain the retail signed FFU catalog before re-integrating the signed catalog back into the FFU image so it can be flashed to a device for testing.\n\n## <span id=\"FFU_Catalog_Signing_Example\"></span><span id=\"ffu_catalog_signing_example\"></span><span id=\"FFU_CATALOG_SIGNING_EXAMPLE\"></span>FFU Catalog Signing Example\n\n\nTo prepare an FFU catalog to be signed:\n\n``` syntax\nPS> Initialize-FirmwareSubmission -TypeOfProduct WindowsPhoneBlue -TypeOfSubmission FfuCatalog -UpdateHistoryPath c:\\input\\UpdateHistory.xml -OemInputPath c:\\input -OutputFilePath c:\\output -FfuPath c:\\input\\flash.ffu\n```\n\n \n\n \n\n\n\n\n\n"}