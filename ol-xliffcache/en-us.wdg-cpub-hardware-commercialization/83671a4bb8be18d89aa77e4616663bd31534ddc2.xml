{"nodes":[{"content":"Capture power management events on Windows 10 Mobile","pos":[11,63]},{"content":"Capture power management events on Windows 10 Mobile","pos":[77,129]},{"content":"Capture power management events on Windows 10 Mobile","pos":[265,317]},{"content":"Tracelog and Xperf are used to capture power-management event trace logs on Windows 10 Mobile.","pos":[320,414]},{"content":"Important","pos":[418,427]},{"content":"To capture trace logs, the phone image must be built with the appropriate type and packages.","pos":[432,524]},{"content":"This is done by modifying the OEMInput file to set the <bpt id=\"p1\">**</bpt>ReleaseType<ept id=\"p1\">**</ept> element to <bpt id=\"p2\">**</bpt>Test<ept id=\"p2\">**</ept>, and adding <bpt id=\"p3\">**</bpt>TESTINFRASTRUCTURE<ept id=\"p3\">**</ept> to the <bpt id=\"p4\">**</bpt>Features<ept id=\"p4\">**</ept> element.","pos":[525,679]},{"content":"Step 1: Install the Windows Performance Toolkit","pos":[687,734]},{"content":"The Windows Performance Toolkit (WPT) is required to process event trace logs with Xperf.","pos":[737,826]},{"content":"The WPT is part of the <bpt id=\"p1\">[</bpt>Windows Assessment and Deployment Kit (Windows ADK)<ept id=\"p1\">](http://go.microsoft.com/fwlink/p/?LinkId=526803)</ept>.","pos":[827,953]},{"content":"Step 2: Install and configure TShell","pos":[958,994]},{"content":"TShell is required to run Tracelog.","pos":[997,1032]},{"content":"Step 3: Verify device is connected","pos":[1037,1071]},{"content":"Verify the device is connected to TShell by running the command dird in the TShell command window.","pos":[1074,1172]},{"content":"Ensure a directory listing from the phone is displayed.","pos":[1173,1228]},{"content":"If an error message is seen, ensure that TShell is configured correctly,, and a device command prompt is shown above the regular command prompt in the TShell window similar to the following:","pos":[1229,1419]},{"content":"Step 4: Run Tracelog to start power management event trace logging","pos":[1459,1525]},{"content":"Using the TShell command window, run Tracelog with the recommended power management providers and settings below.","pos":[1528,1641]},{"content":"Important","pos":[1645,1654]},{"content":"On Windows 10 Mobile, Tracelog must place its logs within the C:<ph id=\"ph1\">\\\\</ph>data directory due to partition size restrictions.","pos":[1659,1775]},{"content":"Be sure to use the -f flag to configure Tracelog to use C:<ph id=\"ph1\">\\\\</ph>data.","pos":[1776,1841]},{"content":"For detailed Tracelog command line syntax, see <bpt id=\"p1\">[</bpt>Tracelog Command Syntax<ept id=\"p1\">](http://msdn.microsoft.com/library/windows/hardware/ff553012.aspx)</ept>.","pos":[1846,1985]},{"content":"For additional examples, see <bpt id=\"p1\">[</bpt>Tracelog Examples<ept id=\"p1\">](https://msdn.microsoft.com/library/windows/hardware/ff553026)</ept>.","pos":[1986,2097]},{"content":"Use the following commands to create a session called \"MyPowerTrace\" and enable the Microsoft-Windows-Kernel-Power provider.","pos":[2099,2223]},{"content":"Enable additional power management related providers if desired.","pos":[4322,4386]},{"content":"Provider","pos":[4491,4499]},{"content":"Command line","pos":[4509,4521]},{"content":"Microsoft.Windows.Kernel.Processor.Power","pos":[4574,4614]},{"content":"cmdd 'tracelog -enable MyPowerTrace -guid #0F67E49F-FE51-4E9F-B490-6F2948CC6027'","pos":[4631,4711]},{"content":"Microsoft.Windows.PDC","pos":[4752,4773]},{"content":"cmdd 'tracelog -enable MyPowerTrace -guid #A6BF0DEB-3659-40AD-9F81-E25AF62CE3C7'","pos":[4790,4870]},{"content":"Microsoft.Windows.Kernel.ACPI","pos":[4910,4939]},{"content":"cmdd 'tracelog -enable MyPowerTrace -guid #C514638F-7723-485B-BCFC-96565D735D4A'","pos":[4956,5036]},{"content":"The following command requests the provider to log state information.","pos":[5074,5143]},{"content":"The capture of state information is initiated at the beginning or end of a trace.","pos":[5144,5225]},{"content":"This ensures that the information necessary to determine the state at a specific point in the trace is logged.","pos":[5226,5336]},{"content":"Step 5: Run scenarios or tests","pos":[5444,5474]},{"content":"Event trace logging is now enabled.","pos":[5477,5512]},{"content":"Run the scenarios or tests you want to analyze.","pos":[5513,5560]},{"content":"Step 6: Run Tracelog to flush the buffers and stop event trace logging","pos":[5565,5635]},{"content":"After the scenarios or tests are complete, use Tracelog to flush the buffers and stop event trace logging.","pos":[5638,5744]},{"content":"Step 7: Run Xperf on the device","pos":[5836,5867]},{"content":"Run Xperf on the device to process the log.","pos":[5870,5913]},{"content":"Step 8: Copy trace log from device","pos":[6095,6129]},{"pos":[6132,6232],"content":"Copy the merged trace log from the phone by using the <bpt id=\"p1\">**</bpt>getd<ept id=\"p1\">**</ept> command in the TShell command window."},{"content":"You can also rename the file at copy time.","pos":[6403,6445]},{"content":"Step 9: Run Xperf on the PC","pos":[6631,6658]},{"content":"Run Xperf on the PC for additional processing.","pos":[6661,6707]},{"content":"On 32-bit operating systems, Xperf is installed in C:<ph id=\"ph1\">\\\\</ph>Program Files<ph id=\"ph2\">\\\\</ph>Windows Kits<ph id=\"ph3\">\\\\</ph>10<ph id=\"ph4\">\\\\</ph>Windows Performance Toolkit.","pos":[6708,6824]},{"content":"On 64-bit operating systems, it is installed in C:<ph id=\"ph1\">\\\\</ph>Program Files (x86)<ph id=\"ph2\">\\\\</ph>Windows Kits<ph id=\"ph3\">\\\\</ph>10<ph id=\"ph4\">\\\\</ph>Windows Performance Toolkit.","pos":[6825,6944]}],"content":"---\ntitle: Capture power management events on Windows 10 Mobile\ndescription: Capture power management events on Windows 10 Mobile\nMSHAttr:\n- 'PreferredSiteName:MSDN'\n- 'PreferredLib:/library/windows/hardware'\nms.assetid: 23f40b02-33ec-4a67-8a1c-f036e720c5bf\n---\n\n# Capture power management events on Windows 10 Mobile\n\n\nTracelog and Xperf are used to capture power-management event trace logs on Windows 10 Mobile.\n\n**Important**  \nTo capture trace logs, the phone image must be built with the appropriate type and packages. This is done by modifying the OEMInput file to set the **ReleaseType** element to **Test**, and adding **TESTINFRASTRUCTURE** to the **Features** element.\n\n \n\n## Step 1: Install the Windows Performance Toolkit\n\n\nThe Windows Performance Toolkit (WPT) is required to process event trace logs with Xperf. The WPT is part of the [Windows Assessment and Deployment Kit (Windows ADK)](http://go.microsoft.com/fwlink/p/?LinkId=526803).\n\n## Step 2: Install and configure TShell\n\n\nTShell is required to run Tracelog.\n\n## Step 3: Verify device is connected\n\n\nVerify the device is connected to TShell by running the command dird in the TShell command window. Ensure a directory listing from the phone is displayed. If an error message is seen, ensure that TShell is configured correctly,, and a device command prompt is shown above the regular command prompt in the TShell window similar to the following:\n\n``` syntax\nDEVICE C:\\\nPS C:\\>\n```\n\n## Step 4: Run Tracelog to start power management event trace logging\n\n\nUsing the TShell command window, run Tracelog with the recommended power management providers and settings below.\n\n**Important**  \nOn Windows 10 Mobile, Tracelog must place its logs within the C:\\\\data directory due to partition size restrictions. Be sure to use the -f flag to configure Tracelog to use C:\\\\data.\n\n \n\nFor detailed Tracelog command line syntax, see [Tracelog Command Syntax](http://msdn.microsoft.com/library/windows/hardware/ff553012.aspx). For additional examples, see [Tracelog Examples](https://msdn.microsoft.com/library/windows/hardware/ff553026).\n\nUse the following commands to create a session called \"MyPowerTrace\" and enable the Microsoft-Windows-Kernel-Power provider.\n\n``` syntax\nDEVICE C:\\\nPS C:\\> cdd data\nDEVICE C:\\data\nPS C:\\> cmdd 'tracelog -start MyPowerTrace -b 1024 -f C:\\data\\MyPowerLog.etl -eflags Process'\nTurning On group: PROCESS\nAdding GroupMask ExtItem\nLogger Started...\nOperation Status:       0L      The operation completed successfully.\n\nLogger Name:            MyPowerTrace\nLogger Id:              0x1d\nLogger Thread Id:       00000C38\nGuid:                   52dd9cee-926c-11e1-bc7e-0011beb0dbf4\nSession Security:       D:(A;;0x800;;;WD)\nBuffer Size:            1024 Kb\nMaximum Buffers:        26\nMinimum Buffers:        4\nNumber of Buffers:      4\nFree Buffers:           3\nBuffers Written:        1\nEvents Lost:            0\nLog Buffers Lost:       0\nReal Time Buffers Lost: 0\nAgeLimit:               0\nReal Time Consumers:    0\nClockType:              PerfCounter\nLog Mode:               Sequential\nHybrid Shutdown:        Persist\nMaximum File Size:      not set\nBuffer Flush Timer:     not set\nEnabled tracing:        Process\nLog Filename:           C:\\data\\MyPowerLog.etl\n\nExit Code : 0\n\nDEVICE C:\\data\nPS C:\\> cmdd 'tracelog -enable MyPowerTrace -guid #331C3B3A-2005-44C2-AC5E-77220C37D6B4'\nEnabling 331c3b3a-2005-44c2-ac5e-77220c37d6b4 (Flags = 0x00000000 Level = 0  ) to logger 29\nOperation Status:       0L      The operation completed successfully.\n\nLogger Name:            MyPowerTrace\nLogger Id:              0x1d\nLogger Thread Id:       00000C38\nGuid:                   52dd9cee-926c-11e1-bc7e-0011beb0dbf4\nSession Security:       D:(A;;0x800;;;WD)\nBuffer Size:            1024 Kb\nMaximum Buffers:        26\nMinimum Buffers:        4\nNumber of Buffers:      4\nFree Buffers:           2\nBuffers Written:        1\nEvents Lost:            0\nLog Buffers Lost:       0\nReal Time Buffers Lost: 0\nAgeLimit:               0\nReal Time Consumers:    0\nClockType:              PerfCounter\nLog Mode:               Sequential\nHybrid Shutdown:        Persist\nMaximum File Size:      not set\nBuffer Flush Timer:     not set\nEnabled tracing:        Process\nLog Filename:           C:\\data\\MyPowerLog.etl\n\nExit Code : 0\n\nDEVICE C:\\data\nPS C:\\>\n```\n\nEnable additional power management related providers if desired.\n\n<table>\n<colgroup>\n<col width=\"50%\" />\n<col width=\"50%\" />\n</colgroup>\n<thead>\n<tr class=\"header\">\n<th>Provider</th>\n<th>Command line</th>\n</tr>\n</thead>\n<tbody>\n<tr class=\"odd\">\n<td><p>Microsoft.Windows.Kernel.Processor.Power</p></td>\n<td><p>cmdd 'tracelog -enable MyPowerTrace -guid #0F67E49F-FE51-4E9F-B490-6F2948CC6027'</p></td>\n</tr>\n<tr class=\"even\">\n<td><p>Microsoft.Windows.PDC</p></td>\n<td><p>cmdd 'tracelog -enable MyPowerTrace -guid #A6BF0DEB-3659-40AD-9F81-E25AF62CE3C7'</p></td>\n</tr>\n<tr class=\"odd\">\n<td><p>Microsoft.Windows.Kernel.ACPI</p></td>\n<td><p>cmdd 'tracelog -enable MyPowerTrace -guid #C514638F-7723-485B-BCFC-96565D735D4A'</p></td>\n</tr>\n</tbody>\n</table>\n\n \n\nThe following command requests the provider to log state information. The capture of state information is initiated at the beginning or end of a trace. This ensures that the information necessary to determine the state at a specific point in the trace is logged.\n\n``` syntax\ncmdd 'tracelog -capturestate MyPowerTrace -guid #331C3B3A-2005-44C2-AC5E-77220C37D6B4'\n```\n\n## Step 5: Run scenarios or tests\n\n\nEvent trace logging is now enabled. Run the scenarios or tests you want to analyze.\n\n## Step 6: Run Tracelog to flush the buffers and stop event trace logging\n\n\nAfter the scenarios or tests are complete, use Tracelog to flush the buffers and stop event trace logging.\n\n``` syntax\ncmdd 'tracelog -flush MyPowerTrace'\ncmdd 'tracelog -stop MyPowerTrace'\n```\n\n## Step 7: Run Xperf on the device\n\n\nRun Xperf on the device to process the log.\n\n``` syntax\nDEVICE C:\\data\nPS C:\\> cmdd 'xperf -merge MyPowerLog.etl c:\\data\\MyPowerLogOut.etl'\nMerged Etl: c:\\data\\MyPowerLogOut.etl\n\nExit Code : 0\n\nDEVICE C:\\data\nPS C:\\>\n```\n\n## Step 8: Copy trace log from device\n\n\nCopy the merged trace log from the phone by using the **getd** command in the TShell command window.\n\n``` syntax\nDEVICE C:\\data\nPS C:\\> getd MyPowerLogOut.etl C:\\Users\\username\\Documents\nC:\\data\\MyPowerLogOut.etl\n1 file(s) copied from device.\nDEVICE C:\\data\nPS C:\\>\n```\n\nYou can also rename the file at copy time.\n\n``` syntax\nDEVICE C:\\\nPS C:\\> getd C:\\data\\MyPowerLogOut.etl C:\\Users\\username\\Documents\\NewName.etl\nC:\\data\\MyPowerLogOut.etl\n1 file(s) copied from device.\nDEVICE C:\\\nPS C:\\>\n```\n\n## Step 9: Run Xperf on the PC\n\n\nRun Xperf on the PC for additional processing. On 32-bit operating systems, Xperf is installed in C:\\\\Program Files\\\\Windows Kits\\\\10\\\\Windows Performance Toolkit. On 64-bit operating systems, it is installed in C:\\\\Program Files (x86)\\\\Windows Kits\\\\10\\\\Windows Performance Toolkit.\n\n``` syntax\nC:\\>cd Users\\username\\Documents\nC:\\Users\\username\\Documents>xperf -i MyPowerLogOut.etl -o MyPowerLogCSV.csv -tle\n[1/2]    100.0%\n[2/2]    100.0%\n\nC:\\Users\\username\\Documents>\n```\n\n \n\n \n\n\n\n\n\n\n"}