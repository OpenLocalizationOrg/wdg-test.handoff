{"nodes":[{"content":"Boot to VHD (Native Boot): Add a Virtual Hard Disk to the Boot Menu","pos":[35,102]},{"content":"Boot to VHD (Native Boot): Add a Virtual Hard Disk to the Boot Menu","pos":[211,278]},{"content":"Boot to VHD (Native Boot): Add a Virtual Hard Disk to the Boot Menu","pos":[287,354]},{"content":"Native Boot allows you to create a virtual hard disk (VHD), install Windows to it, and then boot it up, either on your PC side-by-side with your existing installation, or on a new device.","pos":[357,544]},{"content":"A native-boot VHD can be used as the running operating system on designated hardware without any other parent operating system.","pos":[546,673]},{"content":"This differs from a scenario where a VHD is connected to a virtual machine on a computer that has a parent operating system.","pos":[674,798]},{"content":"VHDs can be applied to PCs or devices that have no other installations of Windows, without a virtual machine or hypervisor.","pos":[800,923]},{"content":"(A hypervisor is a layer of software under the operating system that runs virtual computers.) This enables greater flexibility in workload distribution because a single set of tools can be used to manage images for virtual machines and designated hardware.","pos":[924,1180]},{"content":"You can also deploy the VHD to a PC that already has Windows installed on it, and use a boot menu to select between the existing version of Windows, or the version on the VHD.","pos":[1182,1357]},{"pos":[1359,1530],"content":"To learn more about using VHDs in an enterprise environment, see <bpt id=\"p1\">[</bpt>Understanding Virtual Hard Disks with Native Boot<ept id=\"p1\">](understanding-virtual-hard-disks-with-native-boot.md)</ept>."},{"pos":[1631,1644],"content":"Prerequisites"},{"content":"A technician PC with the Windows Assessment and Deployment Kit (Windows ADK) tools installed on it.","pos":[1651,1750]},{"content":"A generalized Windows image (.WIM file).","pos":[1756,1796]},{"content":"To learn more, see <bpt id=\"p1\">[</bpt>Sysprep (Generalize) a Windows installation<ept id=\"p1\">](sysprep--generalize--a-windows-installation.md)</ept>.","pos":[1797,1910]},{"content":"A bootable Windows PE drive.","pos":[1916,1944]},{"content":"To learn more, see <bpt id=\"p1\">[</bpt>WinPE: Create USB Bootable drive<ept id=\"p1\">](winpe-create-usb-bootable-drive.md)</ept>.","pos":[1945,2035]},{"content":"A destination PC or device on which to install the VHD.","pos":[2041,2096]},{"content":"This device requires 30 gigabytes (GB) or more of free disk space.","pos":[2097,2163]},{"content":"You can install the VHD to a device already running other operating system installations, or as the only operating system on a device.","pos":[2164,2298]},{"pos":[2462,2496],"content":"Step 1: Create a VHD from diskpart"},{"content":"On the technician PC, open Diskpart.","pos":[2503,2539]},{"content":"Create and prepare a new VHD.","pos":[2582,2611]},{"content":"In this example, we create a 25 GB fixed-type VHD.","pos":[2612,2662]},{"content":"Attach the VHD.","pos":[2754,2769]},{"content":"This adds the VHD as a disk to the storage controller on the host.","pos":[2770,2836]},{"content":"Create a partition for the Windows files, format it, and assign it a drive letter.","pos":[2883,2965]},{"content":"This drive letter will appear in File Explorer.","pos":[2966,3013]},{"content":"Exit Diskpart","pos":[3119,3132]},{"pos":[3347,3387],"content":"Step 2: Apply a Windows image to the VHD"},{"content":"Apply a generalized Windows image to the primary partition of the VHD.","pos":[3394,3464]},{"pos":[3837,3910],"content":"Step 3: Detach the VHD, copy it to a new device, and attach it (optional)"},{"content":"You can deploy the VHD to a device that already has a copy of Windows installed on it, or you can clean and prepare the drive to just use the VHD.","pos":[3913,4059]},{"content":"Detach the VHD and save it to a network share or storage drive","pos":[4063,4125]},{"content":"Detach the virtual disk.","pos":[4133,4157]},{"content":"Copy the VHD to a network share or removable storage drive.","pos":[4263,4322]},{"content":"Clean and prepare a new device for native boot","pos":[4429,4475]},{"content":"Boot the destination device to Windows Preinstallation Environment (WinPE).","pos":[4483,4558]},{"content":"Clean and prepare the drive.","pos":[4563,4591]},{"content":"Create a system partition (S), and a main partition (M) where the VHD will be stored.","pos":[4592,4677]},{"content":"BIOS:","pos":[4683,4688]},{"content":"UEFI:","pos":[5076,5081]},{"content":"Connect to a network drive or storage location, and note the drive letter.","pos":[5569,5643]},{"content":"Copy the VHD to the main partition.","pos":[5703,5738]},{"content":"Attach the VHD","pos":[5798,5812]},{"content":"Attach the VHD.","pos":[5820,5835]},{"content":"Identify the volume letter.","pos":[5932,5959]},{"content":"(Optional: Change it to another letter that makes more sense, for example V, and leave the diskpart command line open for the next step).","pos":[5960,6097]},{"pos":[6311,6335],"content":"Step 4: Add a boot entry"},{"content":"Open Diskpart (if necessary) and identify the drive letters of the VHD and the system partition, for example, V and S.","pos":[6342,6460]},{"content":"Add a boot entry to the device.","pos":[6528,6559]},{"content":"You can add multiple VHD files using this method.","pos":[6560,6609]},{"content":"BIOS:","pos":[6615,6620]},{"content":"UEFI:","pos":[6721,6726]},{"content":"Remove the Windows PE USB key.","pos":[6828,6858]},{"content":"Restart the device.","pos":[6864,6883]},{"content":"If there's only one boot entry, the device immediately boots to Windows.","pos":[6889,6961]},{"content":"If there's more than one boot entry, you'll see a boot menu where you can choose between the available versions of Windows on the device.","pos":[6962,7099]},{"pos":[7137,7151],"content":"Related topics"},{"content":"Understanding Virtual Hard Disks with Native Boot","pos":[7155,7204]},{"content":"BCDboot Command-Line Options","pos":[7262,7290]}],"content":"---\nauthor: Justinha\nDescription: 'Boot to VHD (Native Boot): Add a Virtual Hard Disk to the Boot Menu'\nms.assetid: e00d7f8f-502c-40e5-904c-8cc653c1899e\nMSHAttr: 'PreferredLib:/library/windows/hardware'\ntitle: 'Boot to VHD (Native Boot): Add a Virtual Hard Disk to the Boot Menu'\n---\n\n# Boot to VHD (Native Boot): Add a Virtual Hard Disk to the Boot Menu\n\n\nNative Boot allows you to create a virtual hard disk (VHD), install Windows to it, and then boot it up, either on your PC side-by-side with your existing installation, or on a new device.\n\nA native-boot VHD can be used as the running operating system on designated hardware without any other parent operating system. This differs from a scenario where a VHD is connected to a virtual machine on a computer that has a parent operating system.\n\nVHDs can be applied to PCs or devices that have no other installations of Windows, without a virtual machine or hypervisor. (A hypervisor is a layer of software under the operating system that runs virtual computers.) This enables greater flexibility in workload distribution because a single set of tools can be used to manage images for virtual machines and designated hardware.\n\nYou can also deploy the VHD to a PC that already has Windows installed on it, and use a boot menu to select between the existing version of Windows, or the version on the VHD.\n\nTo learn more about using VHDs in an enterprise environment, see [Understanding Virtual Hard Disks with Native Boot](understanding-virtual-hard-disks-with-native-boot.md).\n\n## <span id=\"Prerequisites\"></span><span id=\"prerequisites\"></span><span id=\"PREREQUISITES\"></span>Prerequisites\n\n\n-   A technician PC with the Windows Assessment and Deployment Kit (Windows ADK) tools installed on it.\n\n-   A generalized Windows image (.WIM file). To learn more, see [Sysprep (Generalize) a Windows installation](sysprep--generalize--a-windows-installation.md).\n\n-   A bootable Windows PE drive. To learn more, see [WinPE: Create USB Bootable drive](winpe-create-usb-bootable-drive.md).\n\n-   A destination PC or device on which to install the VHD. This device requires 30 gigabytes (GB) or more of free disk space. You can install the VHD to a device already running other operating system installations, or as the only operating system on a device.\n\n## <span id=\"Step_1__Create_a_VHD_from_diskpart\"></span><span id=\"step_1__create_a_vhd_from_diskpart\"></span><span id=\"STEP_1__CREATE_A_VHD_FROM_DISKPART\"></span>Step 1: Create a VHD from diskpart\n\n\n1.  On the technician PC, open Diskpart.\n\n    ``` syntax\n    diskpart\n    ```\n\n2.  Create and prepare a new VHD. In this example, we create a 25 GB fixed-type VHD.\n\n    ``` syntax\n    create vdisk file=C:\\windows.vhd maximum=25600 type=fixed\n    ```\n\n3.  Attach the VHD. This adds the VHD as a disk to the storage controller on the host.\n\n    ``` syntax\n    attach vdisk\n    ```\n\n4.  Create a partition for the Windows files, format it, and assign it a drive letter. This drive letter will appear in File Explorer.\n\n    ``` syntax\n    create partition primary\n    format quick label=vhd\n    assign letter=v\n    ```\n\n5.  Exit Diskpart\n\n    ``` syntax\n    exit\n    ```\n\n## <span id=\"Step_2__Apply_a_Windows_image_to_the_VHD\"></span><span id=\"step_2__apply_a_windows_image_to_the_vhd\"></span><span id=\"STEP_2__APPLY_A_WINDOWS_IMAGE_TO_THE_VHD\"></span>Step 2: Apply a Windows image to the VHD\n\n\n-   Apply a generalized Windows image to the primary partition of the VHD.\n\n    ``` syntax\n    Dism /Apply-Image /ImageFile:install.wim /index:1 /ApplyDir:V:\\\n    ```\n\n## <span id=\"Step_3__Detach_the_VHD__copy_it_to_a_new_device__and_attach_it__optional_\"></span><span id=\"step_3__detach_the_vhd__copy_it_to_a_new_device__and_attach_it__optional_\"></span><span id=\"STEP_3__DETACH_THE_VHD__COPY_IT_TO_A_NEW_DEVICE__AND_ATTACH_IT__OPTIONAL_\"></span>Step 3: Detach the VHD, copy it to a new device, and attach it (optional)\n\n\nYou can deploy the VHD to a device that already has a copy of Windows installed on it, or you can clean and prepare the drive to just use the VHD.\n\n**Detach the VHD and save it to a network share or storage drive**\n\n1.  Detach the virtual disk.\n\n    ``` syntax\n    diskpart\n    select vdisk file=C:\\windows.vhd\n    detach vdisk\n    exit\n    ```\n\n2.  Copy the VHD to a network share or removable storage drive.\n\n    ``` syntax\n    net use n: \\\\server\\share\\\n    md N:\\VHDs\n    copy C:\\windows.vhd n:\\VHDs\\\n    ```\n\n**Clean and prepare a new device for native boot**\n\n1.  Boot the destination device to Windows Preinstallation Environment (WinPE).\n2.  Clean and prepare the drive. Create a system partition (S), and a main partition (M) where the VHD will be stored.\n\n    BIOS:\n\n    ``` syntax\n    diskpart\n    select disk 0\n    clean\n    rem == 1. System partition ======================\n    create partition primary size=100\n    format quick fs=ntfs label=\"System\"\n    assign letter=\"S\"\n    active\n    rem == 2. Main partition ========================\n    create partition primary\n    format quick fs=ntfs label=\"Main\"\n    assign letter=\"M\"\n    exit\n    ```\n\n    UEFI:\n\n    ``` syntax\n    diskpart\n    select disk 0\n    clean\n    convert gpt\n    rem == 1. System partition =========================\n    create partition efi size=100\n    format quick fs=fat32 label=\"System\"\n    assign letter=\"S\"\n    rem == 2. Microsoft Reserved (MSR) partition =======\n    create partition msr size=128\n    rem == 3. Main partition ===========================\n    create partition primary \n    format quick fs=ntfs label=\"Main\"\n    assign letter=\"M\"\n    exit\n    ```\n\n3.  Connect to a network drive or storage location, and note the drive letter.\n\n    ``` syntax\n    net use N: \\\\server\\share\n    ```\n\n4.  Copy the VHD to the main partition.\n\n    ``` syntax\n    copy N:\\VHDs\\Windows.vhd M:\n    ```\n\n**Attach the VHD**\n\n1.  Attach the VHD.\n\n    ``` syntax\n    diskpart\n    select vdisk file=M:\\windows.vhd\n    attach vdisk\n    ```\n\n2.  Identify the volume letter. (Optional: Change it to another letter that makes more sense, for example V, and leave the diskpart command line open for the next step).\n\n    ``` syntax\n    list volume\n    select volume 3\n    assign letter=v\n    ```\n\n## <span id=\"Step_4__Add_a_boot_entry\"></span><span id=\"step_4__add_a_boot_entry\"></span><span id=\"STEP_4__ADD_A_BOOT_ENTRY\"></span>Step 4: Add a boot entry\n\n\n1.  Open Diskpart (if necessary) and identify the drive letters of the VHD and the system partition, for example, V and S.\n\n    ``` syntax\n    diskpart\n    list volume\n    exit\n    ```\n\n2.  Add a boot entry to the device. You can add multiple VHD files using this method.\n\n    BIOS:\n\n    ``` syntax\n    V:\n    cd v:\\windows\\system32\n    bcdboot v:\\windows /s S: /f BIOS\n    ```\n\n    UEFI:\n\n    ``` syntax\n    V:\\\n    cd v:\\windows\\system32\n    bcdboot v:\\windows /s S: /f UEFI\n    ```\n\n3.  Remove the Windows PE USB key.\n\n4.  Restart the device.\n\n    If there's only one boot entry, the device immediately boots to Windows. If there's more than one boot entry, you'll see a boot menu where you can choose between the available versions of Windows on the device.\n\n## <span id=\"related_topics\"></span>Related topics\n\n\n[Understanding Virtual Hard Disks with Native Boot](understanding-virtual-hard-disks-with-native-boot.md)\n\n[BCDboot Command-Line Options](bcdboot-command-line-options-techref-di.md)\n\n \n\n \n\n\n\n\n\n\n"}