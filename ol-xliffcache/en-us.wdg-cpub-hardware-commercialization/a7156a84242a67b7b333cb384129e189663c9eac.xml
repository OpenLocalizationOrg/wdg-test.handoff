{"nodes":[{"content":"Reset Protection helps you secure a device in case it is stolen.","pos":[35,99]},{"content":"It must be enabled on the device during manufacturing time.","pos":[100,159]},{"content":"Reset protection","pos":[267,283]},{"content":"Reset protection","pos":[291,307]},{"content":"Reset Protection helps you secure a device in case it is stolen.","pos":[310,374]},{"content":"It must be enabled on the device during manufacturing time.","pos":[375,434]},{"content":"Reset Protection consists of the following parts:","pos":[436,485]},{"content":"<bpt id=\"p1\">**</bpt>Reset and reactivation protection<ept id=\"p1\">**</ept> – The stolen device cannot be reused by resetting or flashing the device.","pos":[491,602]},{"content":"When a user performs a factory reset on the device, they will be asked to enter the Microsoft Account credentials that are associated with that device.","pos":[603,754]},{"content":"Additionally, if the device is flashed with a new image and Reset Protection is turned on, the Microsoft Account credentials that were associated with that device is required to finish OOBE and use the device.","pos":[755,964]},{"pos":[969,1152],"content":"<bpt id=\"p1\">**</bpt>Anti-rollback protection<ept id=\"p1\">**</ept> – If Reset Protection is enabled, the stolen device cannot be flashed to an earlier version of the operating system that did not support Reset Protection."},{"content":"To turn on Reset Protection, you must configure two secure UEFI variables:","pos":[1154,1228]},{"content":"<bpt id=\"p1\">**</bpt>ANTI<ph id=\"ph1\">\\_</ph>THEFT<ph id=\"ph2\">\\_</ph>ENABLED<ept id=\"p1\">**</ept> –This variable needs to be set with a value that will be provided by Microsoft and indicates that the device can support Reset Protection.","pos":[1234,1397]},{"content":"The operating system enables Reset Protection on the device based on this setting.","pos":[1398,1480]},{"content":"This variable is in the 1A597235-6378-4910-9F8B-720FEE9357A3 namespace.","pos":[1481,1552]},{"content":"<bpt id=\"p1\">**</bpt>DBX<ept id=\"p1\">**</ept> - This variable must contain the image hashes of the builds to which the device cannot be rolled back.","pos":[1557,1667]},{"content":"These image hashes are provided by Microsoft.","pos":[1668,1713]},{"content":"This variable is in the EFI<ph id=\"ph1\">\\_</ph>IMAGE<ph id=\"ph2\">\\_</ph>SECURITY<ph id=\"ph3\">\\_</ph>DATABASE<ph id=\"ph4\">\\_</ph>GUID namespace.","pos":[1714,1785]},{"pos":[1964,2003],"content":"Turn on Reset Protection in your images"},{"content":"There are two ways to turn on reset protection in your images:","pos":[2006,2068]},{"content":"Option 1: Enable it by using oeminput.xml","pos":[2072,2113]},{"content":"On retail devices, you enable Reset Protection by adding the RESET<ph id=\"ph1\">\\_</ph>PROTECTION feature to the OEMInput.xml file.","pos":[2117,2229]},{"content":"When you include this feature, the device’s UEFI secure boot keys for Reset Protection are provisioned as a scheduled task that will run once at first boot into main operating system and will not run again.","pos":[2230,2436]},{"content":"For more info on the optional features that are available, see O<bpt id=\"p1\">[</bpt>Optional features for building images<ept id=\"p1\">](https://msdn.microsoft.com/library/windows/hardware/dn756780)</ept>.","pos":[2437,2603]},{"pos":[2605,2688],"content":"<bpt id=\"p1\">**</bpt>Note<ept id=\"p1\">**</ept>  If you’re building a test image, use RESET<ph id=\"ph1\">\\_</ph>PROTECTION<ph id=\"ph2\">\\_</ph>INTERNAL instead."},{"content":"Option 2: Enable when provisioning secure boot keys","pos":[2695,2746]},{"content":"Reset Protection is enabled on a device by provisioning UEFI secure boot keys and is a two-step process:","pos":[2750,2854]},{"content":"<bpt id=\"p1\">**</bpt>Anti-Rollback provisioning<ept id=\"p1\">**</ept> -- The DBX variable must be updated to contain the hashes for the builds that did not support Reset Protection.","pos":[2860,3002]},{"content":"Specifically, the sample scripts that create PK, KEK, DB and DBX variables will be modified to add in the DBX variable the list of hashes provided by Microsoft.","pos":[3003,3163]},{"content":"The list of hashes will be supplied by Microsoft in a file called <bpt id=\"p1\">**</bpt>OEM<ph id=\"ph1\">\\_</ph>RollbackHashes.bin<ept id=\"p1\">**</ept>.","pos":[3164,3258]},{"content":"The DBX variable must be signed with the OEM certificate.","pos":[3259,3316]},{"content":"The following excerpt includes the changes to the script that creates the DBX variable:","pos":[3322,3409]},{"content":"<bpt id=\"p1\">**</bpt>Reset and Reactivation Protection provisioning<ept id=\"p1\">**</ept> -- After setting the DBX variable, you must also set the ANTI<ph id=\"ph1\">\\_</ph>THEFT<ph id=\"ph2\">\\_</ph>ENABLED authenticated variable.","pos":[3682,3834]},{"content":"The content of this variable will be provided by Microsoft in the <bpt id=\"p1\">**</bpt>OEM<ph id=\"ph1\">\\_</ph>ResetProtection<ph id=\"ph2\">\\_</ph>Enable<ph id=\"ph3\">\\_</ph>Resource.bin<ept id=\"p1\">**</ept> file.","pos":[3835,3953]},{"content":"The name of the variable is ANTI<ph id=\"ph1\">\\_</ph>THEFT<ph id=\"ph2\">\\_</ph>ENABLED and the namespace GUID is 1A597235-6378-4910-9F8B-720FEE9357A3.","pos":[3954,4066]},{"content":"You can set this in the same way as the secure boot keys.","pos":[4067,4124]},{"pos":[4345,4398],"content":"How do I update a retail image with Reset Protection?"},{"content":"When you submit an update, Reset Protection should not be included as part of the update.","pos":[4401,4490]},{"content":"However, when you build image, Reset Protection should be included in the oeminput.xml file.","pos":[4491,4583]},{"content":"We recommend the following steps to update a retail image with Reset Protection enabled:","pos":[4584,4672]},{"content":"When you’re developing an image, the RESET<ph id=\"ph1\">\\_</ph>PROTECTION optional feature should be included in the oeminput.xml file.","pos":[4678,4794]},{"content":"Before you submit the packages for signing, you should remove the RESET<ph id=\"ph1\">\\_</ph>PROTECTION optional feature from the oeminput.xml file.","pos":[4799,4927]},{"content":"After you receive the packages signed by Microsoft, you must add the RESET<ph id=\"ph1\">\\_</ph>PROTECTION optional feature back to your oeminput.xml file.","pos":[4932,5067]},{"pos":[5210,5237],"content":"Bootable WIM files and MMOS"},{"content":"When using Reset Protection on a device, the MMOS or bootable WIM files that support this device must be built on a version of the tools that support Reset Protection.","pos":[5240,5407]},{"content":"We recommend that the version of the device image and the version of MMOS match.","pos":[5408,5488]},{"pos":[5601,5618],"content":"Reverse logistics"},{"content":"With reverse logistics, you can get information about the status of Reset Protection on a device, such as the device IMEI, or check if Reset Protection is currently enabled on the device.","pos":[5621,5808]},{"content":"You can also use this to remove Reset Protection if you have the appropriate recovery key for that device.","pos":[5809,5915]},{"content":"Reverse logistics can help you in refurbishment scenarios where Reset Protection is turned on, but you don’t have the Microsoft Account credentials that are required to turn it off.","pos":[5916,6097]},{"content":"We’ve provided sample code on how to use reverse logistics in the <bpt id=\"p1\">[</bpt>Portable Devices COM API Sample<ept id=\"p1\">](https://code.msdn.microsoft.com/windowsdesktop/Portable-Devices-COM-API-fd4a5f7d)</ept>.","pos":[6098,6280]},{"pos":[6469,6511],"content":"How to get started using reverse logistics"},{"pos":[6513,6717],"content":"In order to use Microsoft's automated reverse logistics program, organizations need to sign up for an account with the <bpt id=\"p1\">[</bpt>Microsoft Dashboard<ept id=\"p1\">](https://sysdev.microsoft.com/)</ept> and perform the following tasks:"},{"content":"Purchase an Authenticode signing certificate.","pos":[6723,6768]},{"content":"Install the certificate on all machines that will be used to submit requests.","pos":[6773,6850]},{"content":"Assign an administrator(s) to manage the program.","pos":[6855,6904]},{"content":"For each user in your company who will contribute submissions to the Dashboard, add the Microsoft account for the user and grant each user the <bpt id=\"p1\">**</bpt>Reverse Logistics<ept id=\"p1\">**</ept> permission.","pos":[6909,7085]},{"content":"To grant permissions, click <bpt id=\"p1\">**</bpt>Your Profile<ept id=\"p1\">**</ept> and then click <bpt id=\"p2\">**</bpt>Permissions.<ept id=\"p2\">**</ept>","pos":[7086,7162]},{"pos":[7288,7309],"content":"Register your company"},{"content":"Your company may already have an account with the Microsoft Dashboard.","pos":[7311,7381]},{"content":"In that case, you will need to find the administrator of your account with the Dashboard.","pos":[7382,7471]},{"content":"To find the administrator, click <bpt id=\"p1\">**</bpt>Administration<ept id=\"p1\">**</ept> and then click <bpt id=\"p2\">**</bpt>My Administrators<ept id=\"p2\">**</ept>.","pos":[7472,7561]},{"content":"We recommend adding a reverse logistics manager as an additional administrator so it's easier to approve users' reverse logistics requests.","pos":[7562,7701]},{"content":"The administrators responsibilities include approving requests to join the company, approving request for permissions, and removing users after they leave the company.For more information, see <bpt id=\"p1\">[</bpt>Manage users and permissions<ept id=\"p1\">](https://msdn.microsoft.com/library/windows/hardware/br230781.aspx)</ept>.","pos":[7702,7993]},{"content":"If your company does not yet have an account with then Dashboard, here is how to get started:","pos":[7995,8088]},{"content":"Get a code signing certificate","pos":[8095,8125]},{"pos":[8202,8312],"content":"In order to use revers logistics, you <bpt id=\"p1\">**</bpt>must<ept id=\"p1\">**</ept> purchase a standard class 3 certificate, NOT an EV certificate."},{"content":"Make sure you establish your company with the same name that you used to purchase the certificate.","pos":[8321,8419]},{"content":"This is the name that will be exposed to users.","pos":[8420,8467]},{"content":"Establish a company","pos":[8473,8492]},{"content":"Make sure you save this certificate and that it is accessible.","pos":[8562,8624]},{"content":"You will need to install it on multiple computers later in this section.","pos":[8625,8697]},{"content":"We recommend that you save a copy of the certificate on a thumb drive, or something easily accessible.","pos":[8698,8800]},{"pos":[8941,8967],"content":"Add users for your company"},{"content":"After you register your company, add other users who need reverse logistics permission:","pos":[8969,9056]},{"content":"The first person to register a company becomes an administrator for that company account.","pos":[9062,9151]},{"content":"Subsequent users need to register by using a Microsoft account.","pos":[9156,9219]},{"content":"On the top right-hand corner of the <bpt id=\"p1\">[</bpt>Dashboard<ept id=\"p1\">](https://sysdev.microsoft.com/)</ept>, click <bpt id=\"p2\">**</bpt>Register<ept id=\"p2\">**</ept> to add yourself to your company and request the <bpt id=\"p3\">**</bpt>Reverse Logistics<ept id=\"p3\">**</ept> permission under <bpt id=\"p4\">**</bpt>Additional Permissions Request<ept id=\"p4\">**</ept>.","pos":[9220,9441]},{"content":"The administrator receives notification and approves the request.","pos":[9446,9511]},{"pos":[9513,9661],"content":"For more information about signing in to the Dashboard, see <bpt id=\"p1\">[</bpt>Before you sign in<ept id=\"p1\">](https://msdn.microsoft.com/library/windows/hardware/br230782.aspx)</ept>."},{"pos":[9859,9904],"content":"Set up your workstation for reverse logistics"},{"pos":[10003,10015],"content":"Prerequistes"},{"content":"You need a workstation that runs Windows 7 or later and has browser access to the internet.","pos":[10021,10112]},{"content":"Each reverse logistics submitter must have his or her own Microsoft account; account credentials should not be shared amongst multiple people.","pos":[10117,10259]},{"content":"Only computers that have the certificate installed locally will be able to perform reverse logistics.","pos":[10264,10365]},{"pos":[10449,10456],"content":"Process"},{"content":"Plug in the thumb drive that contains the certificate you purchased.","pos":[10462,10530]},{"content":"On each computer where you plan to submit reverse logistics requests, sign in as a local Administrator and install the code signing certificate:","pos":[10535,10679]},{"content":"Open a command prompt.","pos":[10688,10710]},{"pos":[10719,10746],"content":"Type <ph id=\"ph1\">`mmc`</ph> and press ENTER."},{"pos":[10755,10806],"content":"On the <bpt id=\"p1\">**</bpt>File<ept id=\"p1\">**</ept> menu, click <bpt id=\"p2\">**</bpt>Add/Remove Snap-in<ept id=\"p2\">**</ept>."},{"pos":[10815,10829],"content":"Click <bpt id=\"p1\">**</bpt>Add<ept id=\"p1\">**</ept>."},{"pos":[10838,10908],"content":"In the <bpt id=\"p1\">**</bpt>Add Standalone Snap-in<ept id=\"p1\">**</ept> dialog box, select <bpt id=\"p2\">**</bpt>Certificates<ept id=\"p2\">**</ept>."},{"pos":[10917,10931],"content":"Click <bpt id=\"p1\">**</bpt>Add<ept id=\"p1\">**</ept>."},{"pos":[10940,11031],"content":"In the <bpt id=\"p1\">**</bpt>Certificates Snap-in<ept id=\"p1\">**</ept> dialog box, select <bpt id=\"p2\">**</bpt>Computer account<ept id=\"p2\">**</ept> and click <bpt id=\"p3\">**</bpt>Next.<ept id=\"p3\">**</ept>"},{"pos":[11040,11096],"content":"In the <bpt id=\"p1\">**</bpt>Select Computer<ept id=\"p1\">**</ept> dialog box, click <bpt id=\"p2\">**</bpt>Finish<ept id=\"p2\">**</ept>."},{"pos":[11105,11160],"content":"On the <bpt id=\"p1\">**</bpt>Add/Remove Snap-in<ept id=\"p1\">**</ept> dialog box, click <bpt id=\"p2\">**</bpt>OK<ept id=\"p2\">**</ept>."},{"pos":[11169,11289],"content":"In the <bpt id=\"p1\">**</bpt>Console Root<ept id=\"p1\">**</ept> window, click <bpt id=\"p2\">**</bpt>Certificates (Local Computer)<ept id=\"p2\">**</ept> to view the certificate stores for the computer."},{"pos":[11298,11428],"content":"In the <bpt id=\"p1\">**</bpt>Actions<ept id=\"p1\">**</ept> pane, under Certificates, select <bpt id=\"p2\">**</bpt>More Actions<ept id=\"p2\">**</ept>, then <bpt id=\"p3\">**</bpt>All Tasks<ept id=\"p3\">**</ept>, and then <bpt id=\"p4\">**</bpt>Import<ept id=\"p4\">**</ept>:<ph id=\"ph1\">![</ph>import certificate"},{"pos":[11462,11518],"content":"Click <bpt id=\"p1\">**</bpt>Browse<ept id=\"p1\">**</ept> and find the certificate you purchased."},{"content":"Click <bpt id=\"p1\">**</bpt>OK<ept id=\"p1\">**</ept>.","pos":[11527,11540]},{"content":"The certificate should be installed in you <bpt id=\"p1\">**</bpt>Personal<ept id=\"p1\">**</ept> certificate store.","pos":[11541,11615]},{"pos":[11744,11766],"content":"Authentication and Use"},{"content":"The next step is to create a client tool on a provisioned workstation to submit reverse logistics requests.","pos":[11768,11875]},{"content":"You will need to create a third-party app with Microsoft account.","pos":[11876,11941]},{"content":"The app will use a browser to allow a user to enter credentials using a Microsoft account website.","pos":[11942,12040]},{"content":"That will grant access to your tool to get the appropriate token to call the Reverse Logistics API.","pos":[12041,12140]},{"content":"For more information about how to build the app, see <bpt id=\"p1\">[</bpt>Mobile and Windows desktop apps<ept id=\"p1\">](https://msdn.microsoft.com/library/hh826529.aspx)</ept>, and use \"dds.reverse<ph id=\"ph1\">\\_</ph>logistics\" scope (instead of \"wl.basic\") to get the appropriate token.","pos":[12141,12371]},{"content":"After your tool has the token, it can call the Reverse Logistics API with that token, your client certificate, and the target IMEI in order to retrieve the recovery key for the target device.","pos":[12373,12564]},{"content":"reverse logistocs authentication process","pos":[12568,12608]},{"pos":[12750,12767],"content":"API specification"},{"pos":[12851,12858],"content":"Request"},{"content":"Reverse Logistics API endpoint:","pos":[12860,12891]},{"pos":[12893,13012],"content":"POST <bpt id=\"p1\">&lt;</bpt>https://cs.dds.microsoft.com/Command/ExternalClientCert/AdministrativeUnprotect/%7BPartnerName%7D/%7BDeviceId%7D<ept id=\"p1\">&gt;</ept>"},{"content":"{PartnerName} should be replaced with an end-user readable string that will be included in an email to the user whose Microsoft account is protecting the phone.","pos":[13014,13174]},{"content":"{DeviceId} should be replaced with a string in one of the following formats (leaving the square brackets and replacing the text inside and including the curly braces):","pos":[13176,13343]},{"content":"ImeiOrMeid<ph id=\"ph1\">\\[</ph>{IMEI or MEID of the device}","pos":[13349,13389]},{"content":"Duid<ph id=\"ph1\">\\[</ph>{DUID of the device}","pos":[13396,13422]},{"content":"Include the Microsoft account user token in the “Authorization” header of the request.","pos":[13426,13512]},{"content":"The certificate provisioned with the Dashboard for your organization must be used as the client certificate for mutual HTTPS.","pos":[13514,13639]},{"pos":[13726,13734],"content":"Response"},{"content":"Response codes:","pos":[14567,14582]},{"content":"200: Success.","pos":[14588,14601]},{"content":"400: The request is malformed.","pos":[14606,14636]},{"content":"401: The request is unauthorized.","pos":[14641,14674]},{"content":"Your organization may not be provisioned properly, the user may not be provisioned with the organization, or there may be a problem or mismatch with the client certificate or the Microsoft account user token.","pos":[14675,14883]},{"content":"The response may include text giving a reason for the authorization problem.","pos":[14884,14960]},{"content":"404: The API path or device specified was not found.","pos":[14965,15017]},{"content":"500: An unexpected error.","pos":[15022,15047]},{"content":"If this persists, contact Microsoft for resolution of the issue.","pos":[15048,15112]},{"content":"503: Storage error.","pos":[15117,15136]},{"content":"If this persists, contact Microsoft for resolution of the issue.","pos":[15137,15201]}],"content":"---\nauthor: kpacquer\nDescription: 'Reset Protection helps you secure a device in case it is stolen. It must be enabled on the device during manufacturing time.'\nms.assetid: d9cd4f83-fb29-47cb-b26f-e82eb4d3bee8\nMSHAttr: 'PreferredLib:/library/windows/hardware'\ntitle: Reset protection\n---\n\n# Reset protection\n\n\nReset Protection helps you secure a device in case it is stolen. It must be enabled on the device during manufacturing time.\n\nReset Protection consists of the following parts:\n\n-   **Reset and reactivation protection** – The stolen device cannot be reused by resetting or flashing the device. When a user performs a factory reset on the device, they will be asked to enter the Microsoft Account credentials that are associated with that device. Additionally, if the device is flashed with a new image and Reset Protection is turned on, the Microsoft Account credentials that were associated with that device is required to finish OOBE and use the device.\n-   **Anti-rollback protection** – If Reset Protection is enabled, the stolen device cannot be flashed to an earlier version of the operating system that did not support Reset Protection.\n\nTo turn on Reset Protection, you must configure two secure UEFI variables:\n\n-   **ANTI\\_THEFT\\_ENABLED** –This variable needs to be set with a value that will be provided by Microsoft and indicates that the device can support Reset Protection. The operating system enables Reset Protection on the device based on this setting. This variable is in the 1A597235-6378-4910-9F8B-720FEE9357A3 namespace.\n-   **DBX** - This variable must contain the image hashes of the builds to which the device cannot be rolled back. These image hashes are provided by Microsoft. This variable is in the EFI\\_IMAGE\\_SECURITY\\_DATABASE\\_GUID namespace.\n\n## <span id=\"Turn_on_Reset_Protection_in_your_images\"></span><span id=\"turn_on_reset_protection_in_your_images\"></span><span id=\"TURN_ON_RESET_PROTECTION_IN_YOUR_IMAGES\"></span>Turn on Reset Protection in your images\n\n\nThere are two ways to turn on reset protection in your images:\n\n**Option 1: Enable it by using oeminput.xml**\n\nOn retail devices, you enable Reset Protection by adding the RESET\\_PROTECTION feature to the OEMInput.xml file. When you include this feature, the device’s UEFI secure boot keys for Reset Protection are provisioned as a scheduled task that will run once at first boot into main operating system and will not run again. For more info on the optional features that are available, see O[Optional features for building images](https://msdn.microsoft.com/library/windows/hardware/dn756780).\n\n**Note**  If you’re building a test image, use RESET\\_PROTECTION\\_INTERNAL instead.\n\n \n\n**Option 2: Enable when provisioning secure boot keys**\n\nReset Protection is enabled on a device by provisioning UEFI secure boot keys and is a two-step process:\n\n1.  **Anti-Rollback provisioning** -- The DBX variable must be updated to contain the hashes for the builds that did not support Reset Protection. Specifically, the sample scripts that create PK, KEK, DB and DBX variables will be modified to add in the DBX variable the list of hashes provided by Microsoft. The list of hashes will be supplied by Microsoft in a file called **OEM\\_RollbackHashes.bin**. The DBX variable must be signed with the OEM certificate.\n\n    The following excerpt includes the changes to the script that creates the DBX variable:\n\n    ``` syntax\n    write-progress -activity \"Making secure boot variables\" -status \"Creating DBX\"\n# add SHA256 hashes from the supplied file to the DBX variable\n    $hashes = Get-Content .\\OEM_RollbackHashes.bin\n    format-sb-hashes \"dbx\" $ownerGuid $hashes\n    ```\n\n2.  **Reset and Reactivation Protection provisioning** -- After setting the DBX variable, you must also set the ANTI\\_THEFT\\_ENABLED authenticated variable. The content of this variable will be provided by Microsoft in the **OEM\\_ResetProtection\\_Enable\\_Resource.bin** file. The name of the variable is ANTI\\_THEFT\\_ENABLED and the namespace GUID is 1A597235-6378-4910-9F8B-720FEE9357A3. You can set this in the same way as the secure boot keys.\n\n## <span id=\"How_do_I_update_a_retail_image_with_Reset_Protection_\"></span><span id=\"how_do_i_update_a_retail_image_with_reset_protection_\"></span><span id=\"HOW_DO_I_UPDATE_A_RETAIL_IMAGE_WITH_RESET_PROTECTION_\"></span>How do I update a retail image with Reset Protection?\n\n\nWhen you submit an update, Reset Protection should not be included as part of the update. However, when you build image, Reset Protection should be included in the oeminput.xml file. We recommend the following steps to update a retail image with Reset Protection enabled:\n\n1.  When you’re developing an image, the RESET\\_PROTECTION optional feature should be included in the oeminput.xml file.\n2.  Before you submit the packages for signing, you should remove the RESET\\_PROTECTION optional feature from the oeminput.xml file.\n3.  After you receive the packages signed by Microsoft, you must add the RESET\\_PROTECTION optional feature back to your oeminput.xml file.\n\n## <span id=\"Bootable_WIM_files_and_MMOS\"></span><span id=\"bootable_wim_files_and_mmos\"></span><span id=\"BOOTABLE_WIM_FILES_AND_MMOS\"></span>Bootable WIM files and MMOS\n\n\nWhen using Reset Protection on a device, the MMOS or bootable WIM files that support this device must be built on a version of the tools that support Reset Protection. We recommend that the version of the device image and the version of MMOS match.\n\n## <span id=\"Reverse_logistics\"></span><span id=\"reverse_logistics\"></span><span id=\"REVERSE_LOGISTICS\"></span>Reverse logistics\n\n\nWith reverse logistics, you can get information about the status of Reset Protection on a device, such as the device IMEI, or check if Reset Protection is currently enabled on the device. You can also use this to remove Reset Protection if you have the appropriate recovery key for that device. Reverse logistics can help you in refurbishment scenarios where Reset Protection is turned on, but you don’t have the Microsoft Account credentials that are required to turn it off. We’ve provided sample code on how to use reverse logistics in the [Portable Devices COM API Sample](https://code.msdn.microsoft.com/windowsdesktop/Portable-Devices-COM-API-fd4a5f7d).\n\n### <span id=\"How_to_get_started_using_reverse_logistics\"></span><span id=\"how_to_get_started_using_reverse_logistics\"></span><span id=\"HOW_TO_GET_STARTED_USING_REVERSE_LOGISTICS\"></span>How to get started using reverse logistics\n\nIn order to use Microsoft's automated reverse logistics program, organizations need to sign up for an account with the [Microsoft Dashboard](https://sysdev.microsoft.com/) and perform the following tasks:\n\n-   Purchase an Authenticode signing certificate.\n-   Install the certificate on all machines that will be used to submit requests.\n-   Assign an administrator(s) to manage the program.\n-   For each user in your company who will contribute submissions to the Dashboard, add the Microsoft account for the user and grant each user the **Reverse Logistics** permission. To grant permissions, click **Your Profile** and then click **Permissions.**\n\n### <span id=\"Register_your_company\"></span><span id=\"register_your_company\"></span><span id=\"REGISTER_YOUR_COMPANY\"></span>Register your company\n\nYour company may already have an account with the Microsoft Dashboard. In that case, you will need to find the administrator of your account with the Dashboard. To find the administrator, click **Administration** and then click **My Administrators**. We recommend adding a reverse logistics manager as an additional administrator so it's easier to approve users' reverse logistics requests. The administrators responsibilities include approving requests to join the company, approving request for permissions, and removing users after they leave the company.For more information, see [Manage users and permissions](https://msdn.microsoft.com/library/windows/hardware/br230781.aspx).\n\nIf your company does not yet have an account with then Dashboard, here is how to get started:\n\n-   [Get a code signing certificate](https://msdn.microsoft.com/library/windows/hardware/hh801887.aspx)\n    -   In order to use revers logistics, you **must** purchase a standard class 3 certificate, NOT an EV certificate.\n    -   Make sure you establish your company with the same name that you used to purchase the certificate. This is the name that will be exposed to users.\n-   [Establish a company](https://msdn.microsoft.com/library/windows/hardware/br230795.aspx)\n\nMake sure you save this certificate and that it is accessible. You will need to install it on multiple computers later in this section. We recommend that you save a copy of the certificate on a thumb drive, or something easily accessible.\n\n### <span id=\"Add_users_for_your_company\"></span><span id=\"add_users_for_your_company\"></span><span id=\"ADD_USERS_FOR_YOUR_COMPANY\"></span>Add users for your company\n\nAfter you register your company, add other users who need reverse logistics permission:\n\n-   The first person to register a company becomes an administrator for that company account.\n-   Subsequent users need to register by using a Microsoft account. On the top right-hand corner of the [Dashboard](https://sysdev.microsoft.com/), click **Register** to add yourself to your company and request the **Reverse Logistics** permission under **Additional Permissions Request**.\n-   The administrator receives notification and approves the request.\n\nFor more information about signing in to the Dashboard, see [Before you sign in](https://msdn.microsoft.com/library/windows/hardware/br230782.aspx).\n\n### <span id=\"Set_up_your_workstation_for_reverse_logistics\"></span><span id=\"set_up_your_workstation_for_reverse_logistics\"></span><span id=\"SET_UP_YOUR_WORKSTATION_FOR_REVERSE_LOGISTICS\"></span>Set up your workstation for reverse logistics\n\n### <span id=\"Prerequistes\"></span><span id=\"prerequistes\"></span><span id=\"PREREQUISTES\"></span>Prerequistes\n\n-   You need a workstation that runs Windows 7 or later and has browser access to the internet.\n-   Each reverse logistics submitter must have his or her own Microsoft account; account credentials should not be shared amongst multiple people.\n-   Only computers that have the certificate installed locally will be able to perform reverse logistics.\n\n### <span id=\"Process\"></span><span id=\"process\"></span><span id=\"PROCESS\"></span>Process\n\n1.  Plug in the thumb drive that contains the certificate you purchased.\n2.  On each computer where you plan to submit reverse logistics requests, sign in as a local Administrator and install the code signing certificate:\n    1.  Open a command prompt.\n    2.  Type `mmc` and press ENTER.\n    3.  On the **File** menu, click **Add/Remove Snap-in**.\n    4.  Click **Add**.\n    5.  In the **Add Standalone Snap-in** dialog box, select **Certificates**.\n    6.  Click **Add**.\n    7.  In the **Certificates Snap-in** dialog box, select **Computer account** and click **Next.**\n    8.  In the **Select Computer** dialog box, click **Finish**.\n    9.  On the **Add/Remove Snap-in** dialog box, click **OK**.\n    10. In the **Console Root** window, click **Certificates (Local Computer)** to view the certificate stores for the computer.\n    11. In the **Actions** pane, under Certificates, select **More Actions**, then **All Tasks**, and then **Import**:![import certificate](images/import-cert.png)\n    12. Click **Browse** and find the certificate you purchased.\n    13. Click **OK**. The certificate should be installed in you **Personal** certificate store.\n\n### <span id=\"Authentication_and_Use\"></span><span id=\"authentication_and_use\"></span><span id=\"AUTHENTICATION_AND_USE\"></span>Authentication and Use\n\nThe next step is to create a client tool on a provisioned workstation to submit reverse logistics requests. You will need to create a third-party app with Microsoft account. The app will use a browser to allow a user to enter credentials using a Microsoft account website. That will grant access to your tool to get the appropriate token to call the Reverse Logistics API. For more information about how to build the app, see [Mobile and Windows desktop apps](https://msdn.microsoft.com/library/hh826529.aspx), and use \"dds.reverse\\_logistics\" scope (instead of \"wl.basic\") to get the appropriate token.\n\nAfter your tool has the token, it can call the Reverse Logistics API with that token, your client certificate, and the target IMEI in order to retrieve the recovery key for the target device.\n\n![reverse logistocs authentication process](images/rlauthnprocess.png)\n\n### <span id=\"API_specification\"></span><span id=\"api_specification\"></span><span id=\"API_SPECIFICATION\"></span>API specification\n\n### <span id=\"Request\"></span><span id=\"request\"></span><span id=\"REQUEST\"></span>Request\n\nReverse Logistics API endpoint:\n\nPOST <https://cs.dds.microsoft.com/Command/ExternalClientCert/AdministrativeUnprotect/%7BPartnerName%7D/%7BDeviceId%7D>\n\n{PartnerName} should be replaced with an end-user readable string that will be included in an email to the user whose Microsoft account is protecting the phone.\n\n{DeviceId} should be replaced with a string in one of the following formats (leaving the square brackets and replacing the text inside and including the curly braces):\n\n-   ImeiOrMeid\\[{IMEI or MEID of the device}\\]\n-   Duid\\[{DUID of the device}\\]\n\nInclude the Microsoft account user token in the “Authorization” header of the request.\n\nThe certificate provisioned with the Dashboard for your organization must be used as the client certificate for mutual HTTPS.\n\n### <span id=\"Response\"></span><span id=\"response\"></span><span id=\"RESPONSE\"></span>Response\n\n```\n{\n  \"UnprotectResult\": \"{UnprotectResult}\"\n  \"RecoveryKey\": \"{RecoveryKey}\"\n}\n\nUnprotectResult will be a string value of the enum specified below:\n\n    /// <summary>\n    /// Result of the unprotect operation\n    /// </summary>\n    public enum UnprotectResult\n    {\n        /// <summary>\n        /// Device was not found in DDS\n        /// </summary>\n        DeviceNotFound,\n\n        /// <summary>\n        /// Device was already unprotected\n        /// </summary>\n        DeviceAlreadyUnprotected,\n\n        /// <summary>\n        /// Device has been unprotected\n        /// </summary>\n        DeviceUnprotected,\n\n        /// <summary>\n        /// IF we find more than 1 device, we don&#39;t currently have a way to resolve the conflict. So, we don&#39;t unprotect.\n        /// </summary>\n        MultipleDevicesFound,\n    }\n```\n\nResponse codes:\n\n-   200: Success.\n-   400: The request is malformed.\n-   401: The request is unauthorized. Your organization may not be provisioned properly, the user may not be provisioned with the organization, or there may be a problem or mismatch with the client certificate or the Microsoft account user token. The response may include text giving a reason for the authorization problem.\n-   404: The API path or device specified was not found.\n-   500: An unexpected error. If this persists, contact Microsoft for resolution of the issue.\n-   503: Storage error. If this persists, contact Microsoft for resolution of the issue.\n\n \n\n \n\n\n\n\n\n"}