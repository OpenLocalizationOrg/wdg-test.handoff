{"nodes":[{"content":"Preinstall Apps Using DISM","pos":[34,60]},{"content":"Preinstall Apps Using DISM","pos":[167,193]},{"content":"Preinstall Apps Using DISM","pos":[201,227]},{"content":"Interested in preinstalling Windows Store apps, but you aren’t an OEM?","pos":[230,300]},{"content":"For information about sideloading apps for organizations, see <bpt id=\"p1\">[</bpt>Sideload Apps with DISM<ept id=\"p1\">](sideload-apps-with-dism-s14.md)</ept>.","pos":[301,421]},{"content":"To pre-install Windows Store apps in your images, you’ll need to use the Windows Assessment and Deployment Kit (Windows ADK).","pos":[423,548]},{"content":"This section explains the steps involved in preinstalling apps as part of your images.","pos":[549,635]},{"pos":[769,791],"content":"Work with app packages"},{"content":"For offline provisioning of an app into an image, you can use either the Dism.exe tool or the DISM cmdlets in Windows PowerShell to add an app from a folder of unpacked files.","pos":[794,969]},{"content":"To extract the package files","pos":[973,1001]},{"content":"Browse to the folder where you saved the app packages that you downloaded from the Partner Dashboard.","pos":[1009,1110]},{"content":"Right-click each .zip folder containing your app package files.","pos":[1115,1178]},{"content":"Click <bpt id=\"p1\">**</bpt>Extract All<ept id=\"p1\">**</ept> and select a location to save the package file folders.","pos":[1179,1256]},{"content":"The folder contains the all of the unpacked files for the package, including a main package, any dependency packages, and the license file.","pos":[1262,1401]},{"content":"<bpt id=\"p1\">**</bpt>Important<ept id=\"p1\">**</ept>   Do not modify the folder once you have extracted the package files.","pos":[1403,1486]},{"content":"If you change, add, or remove any files in the folder, the app will fail either during installation or launch.","pos":[1487,1597]},{"content":"Even browsing the folder may cause problems.","pos":[1598,1642]},{"content":"You’ll need to use the license file from the package files to test your provisioned image.","pos":[1647,1737]},{"content":"Creating your own custom data file will not allow you to accurately test an app preinstalled by an OEM.","pos":[1738,1841]},{"content":"For offline provisioning of an app into an image, you can use either the Dism.exe tool or the DISM cmdlets in Windows PowerShell to add an app from a folder of unpacked files.","pos":[1843,2018]},{"content":"To preinstall a Store-signed app by using the Dism.exe tool","pos":[2022,2081]},{"content":"Open the Deployment Tools Command Prompt, installed with the Windows ADK, with administrator privileges.","pos":[2089,2193]},{"content":"From the Start screen, type <bpt id=\"p1\">**</bpt>Deployment and Imaging Tools Environment<ept id=\"p1\">**</ept>, right-click the icon, and select <bpt id=\"p2\">**</bpt>Run as Administrator<ept id=\"p2\">**</ept>.","pos":[2194,2326]},{"content":"Mount the offline image for servicing.","pos":[2331,2369]},{"content":"At the command prompt, type:","pos":[2370,2398]},{"content":"Add the app to the mounted image.","pos":[2518,2551]},{"content":"Use the /PackagePath option and the /DependencyPackagePath option to specify the location of the folder containing all of the unpacked files and the dependency files from the Store package.","pos":[2552,2741]},{"content":"/PackagePath should specify the root folder for the extracted folders.","pos":[2742,2812]},{"content":"The root folder contains the license.xml, AUMIDs.txt, and all of the package files.","pos":[2813,2896]},{"content":"At the command prompt, type:","pos":[2897,2925]},{"content":"Save changes and unmount the image.","pos":[3111,3146]},{"content":"At the command prompt, type:","pos":[3147,3175]},{"content":"To preinstall a Store-signed app by using Windows PowerShell","pos":[3261,3321]},{"content":"Open Windows PowerShell with administrator privileges.","pos":[3329,3383]},{"content":"You must be running Windows 10 or Windows 8.1 on the host PC or install a supported version of Windows PowerShell.","pos":[3384,3498]},{"content":"For more information, see <bpt id=\"p1\">[</bpt>How to Use DISM in Windows PowerShell<ept id=\"p1\">](http://go.microsoft.com/fwlink/p/?linkid=239927)</ept>.","pos":[3499,3614]},{"content":"Mount the image.","pos":[3619,3635]},{"content":"At the Windows PowerShell prompt, type:","pos":[3636,3675]},{"content":"Use the Add-AppxProvisionedPackage cmdlet in Windows PowerShell to preinstall the app.","pos":[3792,3878]},{"content":"Use the /PackagePath option and the /DependencyPackagePath option to specify the location of the folder containing all of the unpacked files and the dependency files from the Store package.","pos":[3879,4068]},{"content":"In Windows PowerShell, type:","pos":[4069,4097]},{"content":"Save changes and dismount the image.","pos":[4275,4311]},{"content":"At the Windows PowerShell prompt, type:","pos":[4312,4351]},{"content":"<bpt id=\"p1\">**</bpt>Note<ept id=\"p1\">**</ept>   Windows Store apps don't run in audit mode.","pos":[4431,4485]},{"content":"To test your deployment, run Windows and create a new user profile.","pos":[4486,4553]},{"content":"For more information about audit mode, see <bpt id=\"p1\">[</bpt>Understanding Audit mode<ept id=\"p1\">](http://go.microsoft.com/fwlink/p/?LinkId=311789)</ept> in the TechNet library.","pos":[4554,4696]},{"content":"<bpt id=\"p1\">**</bpt>Important<ept id=\"p1\">**</ept>   If you are preinstalling a mobile broadband device app, you must insert the SIM card in the PC before you run the specialize phase of Sysprep.","pos":[4701,4859]},{"content":"For more information about preinstalling a mobile broadband device app, see <bpt id=\"p1\">[</bpt>Preinstall the Necessary Components for a Mobile Broadband Application Experience<ept id=\"p1\">](#bkmk-broadband-intro)</ept>.","pos":[4860,5043]},{"pos":[5189,5214],"content":"Update or remove packages"},{"content":"You can remove a preinstalled app, including the license and custom data files, from a Windows image by using the DISM.exe tool or the DISM cmdlets in Windows PowerShell.","pos":[5217,5387]},{"content":"You should remove the old version of the app before installing a new one.","pos":[5388,5461]},{"content":"To remove a preinstalled app by using the Dism.exe tool","pos":[5465,5520]},{"content":"Open the Deployment Tools Command Prompt, installed with the Windows ADK, with administrator privileges.","pos":[5528,5632]},{"content":"From the Start screen, type <bpt id=\"p1\">**</bpt>Deployment and Imaging Tools Environment<ept id=\"p1\">**</ept>, right-click the icon, and select <bpt id=\"p2\">**</bpt>Run as Administrator<ept id=\"p2\">**</ept>.","pos":[5633,5765]},{"content":"Mount the offline image for servicing.","pos":[5770,5808]},{"content":"At the command prompt, type:","pos":[5809,5837]},{"content":"Find the full package name of the app that you want to remove.","pos":[5957,6019]},{"content":"At the command prompt, type:","pos":[6020,6048]},{"content":"Remove the app from the mounted image.","pos":[6139,6177]},{"content":"For example, at the command prompt, type:","pos":[6178,6219]},{"content":"<bpt id=\"p1\">**</bpt>Note<ept id=\"p1\">**</ept>   If the app isn't registered to a user profile in the image—for example if the image is generalized and hasn't been deployed—it's removed from the image.","pos":[6386,6549]},{"content":"If the Windows image has been booted and a user profile has been created, the provisioned app is registered for that user and must be removed by using the Remove-AppxPackage cmdlets after you remove the provisioning for the app.","pos":[6550,6778]},{"content":"If you want to update the app, you can preinstall the updated version of the Store-signed app.","pos":[6791,6885]},{"content":"At a command prompt, type:","pos":[6886,6912]},{"content":"Save changes and unmount the image.","pos":[7038,7073]},{"content":"At the command prompt, type:","pos":[7074,7102]},{"content":"To remove a provisioned app by using Windows PowerShell","pos":[7188,7243]},{"content":"Open Windows PowerShell with administrator privileges.","pos":[7251,7305]},{"content":"You must be running Windows 10 or Windows 8.x on the host PC or install a supported version of Windows PowerShell.","pos":[7306,7420]},{"content":"For more information, see <bpt id=\"p1\">[</bpt>How to Use DISM in Windows PowerShell<ept id=\"p1\">](http://go.microsoft.com/fwlink/?LinkId=239927)</ept>.","pos":[7421,7534]},{"content":"Mount the image.","pos":[7539,7555]},{"content":"At the Windows PowerShell prompt, type:","pos":[7556,7595]},{"content":"Find the full package name of the app you want to remove.","pos":[7712,7769]},{"content":"At the Windows PowerShell prompt, type:","pos":[7770,7809]},{"content":"Use the Add-AppxProvisionedPackage cmdlet in Windows PowerShell to remove the app.","pos":[7892,7974]},{"content":"In Windows PowerShell, type:","pos":[7975,8003]},{"content":"<bpt id=\"p1\">**</bpt>Note<ept id=\"p1\">**</ept>  If the app isn't registered to a user profile in the image—for example if the image is generalized and hasn't been deployed—it's removed from the image.","pos":[8160,8322]},{"content":"If the Windows image has been booted and a user profile has been created, the provisioned app is registered for that user and must be removed by using the Remove-AppxPackage cmdlets after you remove the provisioning for the app.","pos":[8323,8551]},{"content":"If you want to update the app, you can preinstall the updated version of the Store-signed app.","pos":[8560,8654]},{"content":"At the Windows PowerShell prompt, type:","pos":[8655,8694]},{"content":"Save changes and dismount the image.","pos":[8815,8851]},{"content":"At the Windows PowerShell prompt, type:","pos":[8852,8891]},{"pos":[9100,9121],"content":"Use custom data files"},{"content":"Apps that are preinstalled on a PC can access custom data specific to the installation.","pos":[9124,9211]},{"content":"This custom data is added to the app during preinstallation and becomes available at runtime.","pos":[9212,9305]},{"content":"Custom data enables developers to customize an app's features and functionality, including providing reporting capabilities.","pos":[9306,9430]},{"pos":[9559,9600],"content":"Add a custom data file to a Windows image"},{"content":"You must specify the custom data file when you preinstall the app by using the DISM tool and through Windows PowerShell using the <bpt id=\"p1\">**</bpt>Add-AppxProvisionedPackage<ept id=\"p1\">**</ept> cmdlet.","pos":[9602,9770]},{"content":"The following command shows how to do this using the DISM tool:","pos":[9771,9834]},{"content":"If a custom data file already exists in the data store for an app—for example, if the package has already been added to the image—the existing file is overwritten.","pos":[9988,10151]},{"content":"If the installation fails, the file isn't restored.","pos":[10152,10203]},{"content":"Note","pos":[10207,10211]},{"content":"You can release updates to an app through the Store without losing the custom data file.","pos":[10216,10304]},{"content":"However, if a user deletes the app, the custom data file is no longer available, even if the user reinstalls the app.","pos":[10305,10422]},{"pos":[10557,10595],"content":"Test custom data for preinstalled apps"},{"content":"Apps that are preinstalled on a PC can access custom data specific to the installation.","pos":[10597,10684]},{"content":"This custom data is added to the app during preinstallation and becomes available to the app at runtime.","pos":[10685,10789]},{"content":"Custom data enables developers to customize an app's features and functionality, including providing reporting capabilities.","pos":[10790,10914]},{"content":"The Custom.data file appears at the app's installed location.","pos":[10916,10977]},{"content":"The name Custom.data is hard-coded and can't be modified.","pos":[10978,11035]},{"content":"Your app can check for the existence of this file to determine if the app was preinstalled on the PC.","pos":[11036,11137]},{"content":"Here's an example of how to access the Custom.data file.","pos":[11138,11194]},{"content":"Your Custom.data file can include any content and be in any format your app requires.","pos":[11917,12002]},{"content":"The preinstallation process simply makes it available to your app.","pos":[12003,12069]},{"content":"Developers can supply the data file to the preinstallation partner, or you can agree to a format that enables the partner to generate the content.","pos":[12070,12216]},{"pos":[12342,12363],"content":"Test your custom data"},{"content":"When you're building and debugging your app in Microsoft Visual Studio, you can't access the Custom.data file from the app's installed location because the app isn't preinstalled yet.","pos":[12365,12548]},{"content":"You can simulate using your Custom.data file by putting a test Custom.data file in the app itself, and then loading and testing the app local file.","pos":[12549,12696]},{"content":"To do this, modify the code sample from:","pos":[12697,12737]},{"content":"to:","pos":[12829,12832]},{"content":"After you have verified your file format and content, you can change the location of the Custom.data file to the final location, as shown in the original example above.","pos":[12889,13057]},{"content":"To test your Custom.data file","pos":[13061,13090]},{"content":"Open the Deployment Tools Command Prompt, installed with the Windows ADK, with administrator privileges.","pos":[13098,13202]},{"content":"From the Start screen, type <bpt id=\"p1\">**</bpt>Deployment and Imaging Tools Environment<ept id=\"p1\">**</ept>, right-click the icon, and select <bpt id=\"p2\">**</bpt>Run as Administrator<ept id=\"p2\">**</ept>.","pos":[13203,13335]},{"content":"Add the application with the custom data file:","pos":[13340,13386]},{"content":"Where <ph id=\"ph1\">`/PackagePath:.\\CustomData_1.0.0.1_AnyCPU_Debug.appx`</ph> points to your local app test package, and where <ph id=\"ph2\">`/CustomDataPath:.\\Test.txt`</ph> points to your Custom.data file.","pos":[13553,13723]},{"content":"Be aware that the file name you provide here isn't used after the data is installed in your app.","pos":[13724,13820]},{"content":"The app now has a tile on the <bpt id=\"p1\">**</bpt>Start<ept id=\"p1\">**</ept> screen of the PC used to test the app.","pos":[13826,13904]},{"content":"The app should be able to access the Custom.data file.","pos":[13905,13959]},{"content":"If additional debugging is needed, attach a debugger after starting the app from the <bpt id=\"p1\">**</bpt>Start<ept id=\"p1\">**</ept> screen.","pos":[13960,14062]},{"pos":[14068,14170],"content":"<bpt id=\"p1\">**</bpt>Note<ept id=\"p1\">**</ept>   You might be required to sign out and sign in again to see the app on the <bpt id=\"p2\">**</bpt>Start<ept id=\"p2\">**</ept> screen."},{"content":"After you're done testing your app, you must remove the preinstalled package to continue using your Dev environment.","pos":[14183,14299]},{"content":"To remove the preinstalled package using Windows PowerShell, you can use the <bpt id=\"p1\">**</bpt>Get-AppxPackage<ept id=\"p1\">**</ept> cmdlet to provide the full app package name through the pipeline to the <bpt id=\"p2\">**</bpt>Remove-ProvisionedAppxPackage<ept id=\"p2\">**</ept> cmdlet:","pos":[14300,14510]},{"pos":[14584,14641],"content":"Where <ph id=\"ph1\">`*CustomData*`</ph> is the known part of your app's name"},{"pos":[14763,14824],"content":"Preinstall a Windows Store device app or mobile broadband app"},{"content":"You can preinstall the necessary components for a Windows Store device app or a mobile broadband app using the Deployment Image Servicing and Management (DISM) platform.","pos":[14827,14996]},{"pos":[14998,15139],"content":"<bpt id=\"p1\">**</bpt>Note<ept id=\"p1\">**</ept>   This article is intended for OEMs, who will be supporting a Windows Store device app or the mobile broadband app on their devices."},{"content":"For each type of app, two things should be preinstalled to provide the correct Windows Store device app or mobile broadband app:","pos":[15144,15272]},{"content":"Windows Store device app, preinstall:","pos":[15278,15315]},{"content":"The device metadata package","pos":[15324,15351]},{"content":"The app","pos":[15360,15367]},{"content":"Windows Store mobile broadband app, preinstall:","pos":[15372,15419]},{"content":"The service metadata package","pos":[15428,15456]},{"content":"The app","pos":[15465,15472]},{"content":"<bpt id=\"p1\">**</bpt>Important<ept id=\"p1\">**</ept>   Although metadata packages and the corresponding apps are parsed immediately after the OOBE process completes, a user might be able to launch the app before the metadata package is parsed.","pos":[15474,15678]},{"content":"In this case, the user will see an access denied error.","pos":[15679,15734]},{"content":"To avoid this, apply both the metadata package and the app to the system image.","pos":[15735,15814]},{"pos":[16053,16111],"content":"Preinstall the device metadata or service metadata package"},{"content":"To preinstall a device metadata or service metadata package","pos":[16116,16175]},{"content":"If you are preinstalling a Windows Store device app then you should have acquired the device metadata package.","pos":[16183,16293]},{"content":"If you are preinstalling a mobile broadband app then you should have acquired the service metadata package.","pos":[16294,16401]},{"pos":[16407,16527],"content":"<bpt id=\"p1\">**</bpt>Note<ept id=\"p1\">**</ept>   Device metadata packages and service metadata packages use the same file name extension (.devicemetadata-ms)."},{"content":"Copy the device metadata or service metadata package (devicemetadata-ms file) to your system image in the <bpt id=\"p1\">**</bpt>%ProgramData%<ph id=\"ph1\">\\\\</ph>Microsoft<ph id=\"ph2\">\\\\</ph>Windows<ph id=\"ph3\">\\\\</ph>DeviceMetadataStore<ept id=\"p1\">**</ept> folder.","pos":[16540,16712]},{"content":"You can do this in one of the following ways:","pos":[16713,16758]},{"content":"Online before running Sysprep","pos":[16768,16797]},{"content":"Offline after running Sysprep by using DISM.","pos":[16806,16850]},{"content":"To do this:","pos":[16851,16862]},{"content":"Mount the offline image for servicing.","pos":[16876,16914]},{"content":"Copy the metadata package files to the device metadata store of the mounted image.","pos":[17071,17153]},{"content":"For example, to copy the <bpt id=\"p1\">**</bpt>0ECF2029-2C6A-41AE-9E0A-63FFC9EAD877.devicemetadata-ms<ept id=\"p1\">**</ept> metadata package file to the device metadata store, <bpt id=\"p2\">**</bpt>ProgramData<ph id=\"ph1\">\\\\</ph>Microsoft<ph id=\"ph2\">\\\\</ph>Windows<ph id=\"ph3\">\\\\</ph>DeviceMetadataStore<ept id=\"p2\">**</ept>:","pos":[17154,17347]},{"content":"Save the changes and unmount the image.","pos":[17539,17578]},{"pos":[17695,17812],"content":"For more info about offline image servicing, see <bpt id=\"p1\">[</bpt>DISM Overview<ept id=\"p1\">](http://technet.microsoft.com/library/hh825236.aspx)</ept>."},{"pos":[17814,17924],"content":"For more info about service metadata, see <bpt id=\"p1\">[</bpt>Service metadata<ept id=\"p1\">](http://go.microsoft.com/fwlink/p/?LinkId=698640)</ept>."},{"pos":[18175,18238],"content":"Preinstall the Windows Store device app or mobile broadband app"},{"content":"To preinstall the Windows Store device app or mobile broadband app","pos":[18243,18309]},{"content":"Mount the offline image for servicing.","pos":[18317,18355]},{"content":"Add the Windows Store device app or mobile broadband app to the image.","pos":[18480,18550]},{"content":"Save the changes and unmount the image.","pos":[18672,18711]}],"content":"---\nauthor: Justinha\nDescription: Preinstall Apps Using DISM\nms.assetid: 707607d6-eb3a-4a5b-b52d-4d465d82f69d\nMSHAttr: 'PreferredLib:/library/windows/hardware'\ntitle: Preinstall Apps Using DISM\n---\n\n# Preinstall Apps Using DISM\n\n\nInterested in preinstalling Windows Store apps, but you aren’t an OEM? For information about sideloading apps for organizations, see [Sideload Apps with DISM](sideload-apps-with-dism-s14.md).\n\nTo pre-install Windows Store apps in your images, you’ll need to use the Windows Assessment and Deployment Kit (Windows ADK). This section explains the steps involved in preinstalling apps as part of your images.\n\n## <span id=\"BKMK_WorkWithAppPackages\"></span><span id=\"bkmk_workwithapppackages\"></span><span id=\"BKMK_WORKWITHAPPPACKAGES\"></span>Work with app packages\n\n\nFor offline provisioning of an app into an image, you can use either the Dism.exe tool or the DISM cmdlets in Windows PowerShell to add an app from a folder of unpacked files.\n\n**To extract the package files**\n\n1.  Browse to the folder where you saved the app packages that you downloaded from the Partner Dashboard.\n2.  Right-click each .zip folder containing your app package files. Click **Extract All** and select a location to save the package file folders.\n\n    The folder contains the all of the unpacked files for the package, including a main package, any dependency packages, and the license file.\n\n**Important**   Do not modify the folder once you have extracted the package files. If you change, add, or remove any files in the folder, the app will fail either during installation or launch. Even browsing the folder may cause problems.\n\n \n\nYou’ll need to use the license file from the package files to test your provisioned image. Creating your own custom data file will not allow you to accurately test an app preinstalled by an OEM.\n\nFor offline provisioning of an app into an image, you can use either the Dism.exe tool or the DISM cmdlets in Windows PowerShell to add an app from a folder of unpacked files.\n\n**To preinstall a Store-signed app by using the Dism.exe tool**\n\n1.  Open the Deployment Tools Command Prompt, installed with the Windows ADK, with administrator privileges. From the Start screen, type **Deployment and Imaging Tools Environment**, right-click the icon, and select **Run as Administrator**.\n2.  Mount the offline image for servicing. At the command prompt, type:\n\n    ``` syntax\n    Dism /Mount-Image /ImageFile:c:\\images\\myimage.wim /Index:1 /mountdir:c:\\test\\offline\n    ```\n\n3.  Add the app to the mounted image. Use the /PackagePath option and the /DependencyPackagePath option to specify the location of the folder containing all of the unpacked files and the dependency files from the Store package. /PackagePath should specify the root folder for the extracted folders. The root folder contains the license.xml, AUMIDs.txt, and all of the package files. At the command prompt, type:\n\n    ``` syntax\n    Dism /Image:c:\\test\\offline /Add-ProvisionedAppxPackage /PackagePath:c:\\downloads\\appxpackage /DependencyPackagePath:c:\\downloads\\appxpackagedependency\n    ```\n\n4.  Save changes and unmount the image. At the command prompt, type:\n\n    ``` syntax\n    Dism /Unmount-Image /mountdir:c:\\test\\offline /commit\n    ```\n\n**To preinstall a Store-signed app by using Windows PowerShell**\n\n1.  Open Windows PowerShell with administrator privileges. You must be running Windows 10 or Windows 8.1 on the host PC or install a supported version of Windows PowerShell. For more information, see [How to Use DISM in Windows PowerShell](http://go.microsoft.com/fwlink/p/?linkid=239927).\n2.  Mount the image. At the Windows PowerShell prompt, type:\n\n    ``` syntax\n    Mount-WindowsImage –ImagePath c:\\images\\myimage.wim –Index 1 –Path c:\\test\\offline\n    ```\n\n3.  Use the Add-AppxProvisionedPackage cmdlet in Windows PowerShell to preinstall the app. Use the /PackagePath option and the /DependencyPackagePath option to specify the location of the folder containing all of the unpacked files and the dependency files from the Store package. In Windows PowerShell, type:\n\n    ``` syntax\n    Add-AppxProvisionedPackage –Path c:\\test\\offline –FolderPath c:\\downloads\\appxpackage –DependencyPackagePath c:\\downloads\\appxpackagedependency\n    ```\n\n4.  Save changes and dismount the image. At the Windows PowerShell prompt, type:\n\n    ``` syntax\n    Dismount-WindowsImage –Path c:\\test\\offline -Save\n    ```\n\n**Note**   Windows Store apps don't run in audit mode. To test your deployment, run Windows and create a new user profile. For more information about audit mode, see [Understanding Audit mode](http://go.microsoft.com/fwlink/p/?LinkId=311789) in the TechNet library.\n\n \n\n**Important**   If you are preinstalling a mobile broadband device app, you must insert the SIM card in the PC before you run the specialize phase of Sysprep. For more information about preinstalling a mobile broadband device app, see [Preinstall the Necessary Components for a Mobile Broadband Application Experience](#bkmk-broadband-intro).\n\n \n\n## <span id=\"BKMK_UpdateOrRemovePackages\"></span><span id=\"bkmk_updateorremovepackages\"></span><span id=\"BKMK_UPDATEORREMOVEPACKAGES\"></span>Update or remove packages\n\n\nYou can remove a preinstalled app, including the license and custom data files, from a Windows image by using the DISM.exe tool or the DISM cmdlets in Windows PowerShell. You should remove the old version of the app before installing a new one.\n\n**To remove a preinstalled app by using the Dism.exe tool**\n\n1.  Open the Deployment Tools Command Prompt, installed with the Windows ADK, with administrator privileges. From the Start screen, type **Deployment and Imaging Tools Environment**, right-click the icon, and select **Run as Administrator**.\n2.  Mount the offline image for servicing. At the command prompt, type:\n\n    ``` syntax\n    Dism /Mount-Image /ImageFile:c:\\images\\myimage.wim /Index:1 /mountdir:c:\\test\\offline\n    ```\n\n3.  Find the full package name of the app that you want to remove. At the command prompt, type:\n\n    ``` syntax\n    Dism /Image:C:\\test\\offline /Get-ProvisionedAppxPackages\n    ```\n\n4.  Remove the app from the mounted image. For example, at the command prompt, type:\n\n    ``` syntax\n    Dism /Image:c:\\test\\offline /Remove-ProvisionedAppxPackage /PackageName:microsoft.devx.appx.app1_1.0.0.0_neutral_en-us_ac4zc6fex2zjp\n    ```\n\n    **Note**   If the app isn't registered to a user profile in the image—for example if the image is generalized and hasn't been deployed—it's removed from the image. If the Windows image has been booted and a user profile has been created, the provisioned app is registered for that user and must be removed by using the Remove-AppxPackage cmdlets after you remove the provisioning for the app.\n\n     \n\n5.  If you want to update the app, you can preinstall the updated version of the Store-signed app. At a command prompt, type:\n\n    ``` syntax\n    Dism /Image:c:\\test\\offline /Add-ProvisionedAppxPackage/FolderPath:c:\\downloads\\appxpackage\n    ```\n\n6.  Save changes and unmount the image. At the command prompt, type:\n\n    ``` syntax\n    Dism /Unmount-Image /mountdir:c:\\test\\offline /commit\n    ```\n\n**To remove a provisioned app by using Windows PowerShell**\n\n1.  Open Windows PowerShell with administrator privileges. You must be running Windows 10 or Windows 8.x on the host PC or install a supported version of Windows PowerShell. For more information, see [How to Use DISM in Windows PowerShell](http://go.microsoft.com/fwlink/?LinkId=239927).\n2.  Mount the image. At the Windows PowerShell prompt, type:\n\n    ``` syntax\n    Mount-WindowsImage –ImagePath c:\\images\\myimage.wim –Index 1 –Path c:\\test\\offline\n    ```\n\n3.  Find the full package name of the app you want to remove. At the Windows PowerShell prompt, type:\n\n    ``` syntax\n    Get-AppxProvisionedPackage –Path c:\\test\\offline\n    ```\n\n4.  Use the Add-AppxProvisionedPackage cmdlet in Windows PowerShell to remove the app. In Windows PowerShell, type:\n\n    ``` syntax\n    Remove-AppxProvisionedPackage –Path c:\\test\\offline –PackageName microsoft.devx.appx.app1_1.0.0.0_neutral_en-us_ac4zc6fex2zjp \n    ```\n\n**Note**  If the app isn't registered to a user profile in the image—for example if the image is generalized and hasn't been deployed—it's removed from the image. If the Windows image has been booted and a user profile has been created, the provisioned app is registered for that user and must be removed by using the Remove-AppxPackage cmdlets after you remove the provisioning for the app.\n\n \n\n1.  If you want to update the app, you can preinstall the updated version of the Store-signed app. At the Windows PowerShell prompt, type:\n\n    ``` syntax\n    Add- AppxProvisionedPackage –Path c:\\test\\offline –FolderPath c:\\downloads\\appxpackage\n    ```\n\n2.  Save changes and dismount the image. At the Windows PowerShell prompt, type:\n\n    ``` syntax\n    Dismount-WindowsImage –Path c:\\test\\offline -Save\n    ```\n\n## <span id=\"BKMK_UseCustomDateFiles\"></span><span id=\"bkmk_usecustomdatefiles\"></span><span id=\"BKMK_USECUSTOMDATEFILES\"></span>Use custom data files\n\n\nApps that are preinstalled on a PC can access custom data specific to the installation. This custom data is added to the app during preinstallation and becomes available at runtime. Custom data enables developers to customize an app's features and functionality, including providing reporting capabilities.\n\n### <span id=\"BKMK_AddCustomDataFile\"></span><span id=\"bkmk_addcustomdatafile\"></span><span id=\"BKMK_ADDCUSTOMDATAFILE\"></span>Add a custom data file to a Windows image\n\nYou must specify the custom data file when you preinstall the app by using the DISM tool and through Windows PowerShell using the **Add-AppxProvisionedPackage** cmdlet. The following command shows how to do this using the DISM tool:\n\n``` syntax\nDism /Image:C:\\test\\offline /Add-ProvisionedAppxPackage / FolderPath:f:\\Apps\\Fabrikam_KnowMyPC /CustomDataPath:f:\\Contoso_Promotion.xml\n```\n\nIf a custom data file already exists in the data store for an app—for example, if the package has already been added to the image—the existing file is overwritten. If the installation fails, the file isn't restored.\n\n**Note**  \nYou can release updates to an app through the Store without losing the custom data file. However, if a user deletes the app, the custom data file is no longer available, even if the user reinstalls the app.\n\n \n\n### <span id=\"BKMK_TestCustomDataFile\"></span><span id=\"bkmk_testcustomdatafile\"></span><span id=\"BKMK_TESTCUSTOMDATAFILE\"></span>Test custom data for preinstalled apps\n\nApps that are preinstalled on a PC can access custom data specific to the installation. This custom data is added to the app during preinstallation and becomes available to the app at runtime. Custom data enables developers to customize an app's features and functionality, including providing reporting capabilities.\n\nThe Custom.data file appears at the app's installed location. The name Custom.data is hard-coded and can't be modified. Your app can check for the existence of this file to determine if the app was preinstalled on the PC. Here's an example of how to access the Custom.data file.\n\n``` syntax\nvar outputDiv = document.getElementById(\"CustomData\");\nWindows.ApplicationModel.Package.current.installedLocation.getFileAsync\n     (\"microsoft.system.package.metadata\\\\Custom.data\").then(function (file) {\n         // Read the file\n         Windows.Storage.FileIO.readTextAsync(file).done(function (fileContent) {\n            outputDiv.innerHTML = \n                 \"App is preinstalled. CustomData contains:<br /><br />\"\n                 + fileContent;\n         },\n         function (error) {\n             outputDiv.innerText = \"Error reading CustomData \" + error;\n         });\n     },\n     function (error) {\n         outputDiv.innerText = \"CustomData was not available. App not preinstalled\";\n     });\n```\n\nYour Custom.data file can include any content and be in any format your app requires. The preinstallation process simply makes it available to your app. Developers can supply the data file to the preinstallation partner, or you can agree to a format that enables the partner to generate the content.\n\n### <span id=\"Test_your_custom_data\"></span><span id=\"test_your_custom_data\"></span><span id=\"TEST_YOUR_CUSTOM_DATA\"></span>Test your custom data\n\nWhen you're building and debugging your app in Microsoft Visual Studio, you can't access the Custom.data file from the app's installed location because the app isn't preinstalled yet. You can simulate using your Custom.data file by putting a test Custom.data file in the app itself, and then loading and testing the app local file. To do this, modify the code sample from:\n\n``` syntax\n(\"microsoft.system.package.metadata\\\\Custom.data\").then(function (file) {\n```\n\nto:\n\n``` syntax\n(\"Custom.data\").then(function (file) {\n```\n\nAfter you have verified your file format and content, you can change the location of the Custom.data file to the final location, as shown in the original example above.\n\n**To test your Custom.data file**\n\n1.  Open the Deployment Tools Command Prompt, installed with the Windows ADK, with administrator privileges. From the Start screen, type **Deployment and Imaging Tools Environment**, right-click the icon, and select **Run as Administrator**.\n2.  Add the application with the custom data file:\n\n    ``` syntax\n    dism /online /Add-ProvisionedAppxPackage /PackagePath:.\\CustomData_1.0.0.1_AnyCPU_Debug.appx /CustomDataPath:.\\Test.txt /SkipLicense\n    ```\n\n    Where `/PackagePath:.\\CustomData_1.0.0.1_AnyCPU_Debug.appx` points to your local app test package, and where `/CustomDataPath:.\\Test.txt` points to your Custom.data file. Be aware that the file name you provide here isn't used after the data is installed in your app.\n\n    The app now has a tile on the **Start** screen of the PC used to test the app. The app should be able to access the Custom.data file. If additional debugging is needed, attach a debugger after starting the app from the **Start** screen.\n\n    **Note**   You might be required to sign out and sign in again to see the app on the **Start** screen.\n\n     \n\n3.  After you're done testing your app, you must remove the preinstalled package to continue using your Dev environment. To remove the preinstalled package using Windows PowerShell, you can use the **Get-AppxPackage** cmdlet to provide the full app package name through the pipeline to the **Remove-ProvisionedAppxPackage** cmdlet:\n\n    `Get-AppxPackage *CustomData* | Remove-ProvisionedAppxPackage`\n\n    Where `*CustomData*` is the known part of your app's name\n\n## <span id=\"BKMK_broadband_intro\"></span><span id=\"bkmk_broadband_intro\"></span><span id=\"BKMK_BROADBAND_INTRO\"></span>Preinstall a Windows Store device app or mobile broadband app\n\n\nYou can preinstall the necessary components for a Windows Store device app or a mobile broadband app using the Deployment Image Servicing and Management (DISM) platform.\n\n**Note**   This article is intended for OEMs, who will be supporting a Windows Store device app or the mobile broadband app on their devices.\n\n \n\nFor each type of app, two things should be preinstalled to provide the correct Windows Store device app or mobile broadband app:\n\n-   Windows Store device app, preinstall:\n    1.  The device metadata package\n    2.  The app\n-   Windows Store mobile broadband app, preinstall:\n    1.  The service metadata package\n    2.  The app\n\n**Important**   Although metadata packages and the corresponding apps are parsed immediately after the OOBE process completes, a user might be able to launch the app before the metadata package is parsed. In this case, the user will see an access denied error. To avoid this, apply both the metadata package and the app to the system image.\n\n \n\n## <span id=\"Preinstall_the_device_metadata_or_service_metadata_package\"></span><span id=\"preinstall_the_device_metadata_or_service_metadata_package\"></span><span id=\"PREINSTALL_THE_DEVICE_METADATA_OR_SERVICE_METADATA_PACKAGE\"></span>Preinstall the device metadata or service metadata package\n\n\n**To preinstall a device metadata or service metadata package**\n\n1.  If you are preinstalling a Windows Store device app then you should have acquired the device metadata package. If you are preinstalling a mobile broadband app then you should have acquired the service metadata package.\n\n    **Note**   Device metadata packages and service metadata packages use the same file name extension (.devicemetadata-ms).\n\n     \n\n2.  Copy the device metadata or service metadata package (devicemetadata-ms file) to your system image in the **%ProgramData%\\\\Microsoft\\\\Windows\\\\DeviceMetadataStore** folder. You can do this in one of the following ways:\n\n    -   Online before running Sysprep\n    -   Offline after running Sysprep by using DISM. To do this:\n\n        1.  Mount the offline image for servicing.\n\n            ``` syntax\n            Dism /Mount-Image /ImageFile:C:\\test\\images\\myimage.wim /index:1 /MountDir:C:\\test\\offline\n            ```\n\n        2.  Copy the metadata package files to the device metadata store of the mounted image. For example, to copy the **0ECF2029-2C6A-41AE-9E0A-63FFC9EAD877.devicemetadata-ms** metadata package file to the device metadata store, **ProgramData\\\\Microsoft\\\\Windows\\\\DeviceMetadataStore**:\n\n            ``` syntax\n            copy 0ECF2029-2C6A-41AE-9E0A-63FFC9EAD877.devicemetadata-ms C:\\test\\offline\\ProgramData\\Microsoft\\Windows\\DeviceMetadataStore\n            ```\n\n        3.  Save the changes and unmount the image.\n\n            ``` syntax\n            dism /Unmount-Image /mountdir: c:\\test\\offline /commit\n            ```\n\n        For more info about offline image servicing, see [DISM Overview](http://technet.microsoft.com/library/hh825236.aspx).\n\nFor more info about service metadata, see [Service metadata](http://go.microsoft.com/fwlink/p/?LinkId=698640).\n\n## <span id=\"Preinstall_the_Windows_Store_device_app_or_mobile_broadband_app\"></span><span id=\"preinstall_the_windows_store_device_app_or_mobile_broadband_app\"></span><span id=\"PREINSTALL_THE_WINDOWS_STORE_DEVICE_APP_OR_MOBILE_BROADBAND_APP\"></span>Preinstall the Windows Store device app or mobile broadband app\n\n\n**To preinstall the Windows Store device app or mobile broadband app**\n\n1.  Mount the offline image for servicing.\n\n    ``` syntax\n    Dism /Mount-Image /ImageFile:C:\\test\\images\\myimage.wim /index:1 /MountDir:C:\\test\\offline\n    ```\n\n2.  Add the Windows Store device app or mobile broadband app to the image.\n\n    ``` syntax\n    dism /Image:<mounted folder> /Add-ProvisionedAppxPackage /FolderPath:<appxpackage path>\n    ```\n\n3.  Save the changes and unmount the image.\n\n    ``` syntax\n    dism /Unmount-Image /mountdir: c:\\test\\offline /commit\n    ```\n\n \n\n \n\n\n\n\n\n"}