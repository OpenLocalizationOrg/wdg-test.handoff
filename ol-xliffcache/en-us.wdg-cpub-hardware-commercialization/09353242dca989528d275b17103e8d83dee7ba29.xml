{"nodes":[{"content":"Lab 1b: Add an app to your image","pos":[273,305]},{"content":"Lab 1b: Add an app to your image","pos":[314,346]},{"content":"This content has been tested on Windows 10 IoT Core Build 10586.","pos":[350,414]},{"content":"Some of these procedures do not yet work on newer preview builds, including Windows 10 Anniversary SDK Preview Build 14295.","pos":[415,538]},{"content":"We're now going to take an app (like the sample <bpt id=\"p1\">[</bpt>Hello, World!<ept id=\"p1\">](http://go.microsoft.com/fwlink/?LinkID=532945)</ept>","pos":[542,652]},{"content":"app), package it up, and create a new image you can load onto new devices.","pos":[653,727]},{"pos":[730,895],"content":"<bpt id=\"p1\">**</bpt>Note<ept id=\"p1\">**</ept>  As we go through this manufacturing guide, ProjectA will start to resemble the SampleA image that's in C:<ph id=\"ph1\">\\\\</ph>IoT-ADK-AddonKit<ph id=\"ph2\">\\\\</ph>Source-arm<ph id=\"ph3\">\\\\</ph>Products<ph id=\"ph4\">\\\\</ph>SampleA."},{"pos":[996,1009],"content":"Prerequisites"},{"pos":[1011,1112],"content":"We'll use the ProjectA image we created from <bpt id=\"p1\">[</bpt>Lab 1a: Create a basic image<ept id=\"p1\">](create-a-basic-image.md)</ept>."},{"pos":[1264,1294],"content":"Create and test an Windows app"},{"content":"You can skip these steps if you've already created and tested your app.","pos":[1295,1366]},{"content":"Create an app.","pos":[1372,1386]},{"content":"This can be any app designed for IoT Core, saved as an Appx Package.","pos":[1387,1455]},{"content":"For our example, we use the <bpt id=\"p1\">[</bpt>Hello, World<ept id=\"p1\">](https://developer.microsoft.com/en-us/windows/iot/win10/samples/HelloWorld.htm)</ept> app.","pos":[1456,1583]},{"pos":[1589,1715],"content":"In Visual Studio, to save the Hello, World app as an Appx package, click <bpt id=\"p1\">**</bpt>Project &gt; Store &gt; Create App Packages<ept id=\"p1\">**</ept><ph id=\"ph1\"> &gt; </ph><bpt id=\"p2\">**</bpt>Next<ept id=\"p2\">**</ept>."},{"content":"Select:","pos":[1722,1729]},{"pos":[1737,1820],"content":"<bpt id=\"p1\">**</bpt>Output location: C:\\HelloWorld<ept id=\"p1\">**</ept> (or any other path that doesn't include spaces.)"},{"content":"Generate app bundle: Never","pos":[1834,1860]},{"pos":[1872,1894],"content":"Then click <bpt id=\"p1\">**</bpt>Create<ept id=\"p1\">**</ept>."},{"content":"Visual Studio creates the Appx file into C:\\HelloWorld\\HelloWorld_1.0.0.0_Debug_Test","pos":[1900,1984]},{"content":"Optional: (Test the app)[test-the-app.md].","pos":[1991,2033]},{"content":"Note, you may have already tested the app as part of building the project.","pos":[2034,2108]},{"pos":[2217,2232],"content":"Package the app"},{"content":"Create a package for an app","pos":[2236,2263]},{"pos":[2271,2342],"content":"Open <bpt id=\"p1\">**</bpt>C:<ph id=\"ph1\">\\\\</ph>IoT-ADK-AddonKit<ph id=\"ph2\">\\\\</ph>Tools<ph id=\"ph3\">\\\\</ph>IoTCoreShell<ept id=\"p1\">**</ept> as an administrator."},{"content":"Create a working folder for the app, for example:","pos":[2349,2398]},{"content":"This creates a new working folder at C:<ph id=\"ph1\">\\\\</ph>IoT-ADK-AddonKit<ph id=\"ph2\">\\\\</ph>Source-<ph id=\"ph3\">&amp;lt;</ph>arch<ph id=\"ph4\">&amp;gt;\\\\</ph>Packages<ph id=\"ph5\">\\\\</ph>Appx.HelloWorld that includes files that you'll use to help build the package.","pos":[2610,2778]},{"content":"Troubleshooting: If you get the message: \"The system cannot find the file specified\", it may be because the package has no defined dependencies.","pos":[2784,2928]},{"content":"From the IoT Core Shell, build the package.","pos":[2938,2981]},{"pos":[3040,3170],"content":"The package is built, appearing as <bpt id=\"p1\">**</bpt>C:<ph id=\"ph1\">\\\\</ph>IoT-ADK-AddonKit<ph id=\"ph2\">\\\\</ph>Build<ph id=\"ph3\">\\\\&amp;lt;</ph>arch<ph id=\"ph4\">&amp;gt;\\\\</ph>pkgs<ph id=\"ph5\">\\\\&amp;lt;</ph>your OEM name<ph id=\"ph6\">&amp;gt;</ph>.Appx.HelloWorld.cab<ept id=\"p1\">**</ept>."},{"content":"Watch for any build errors, and correct them - often these are a result of filenames in the package definition file being different from the actual filenames.","pos":[3176,3334]},{"pos":[3477,3504],"content":"Update the feature manifest"},{"content":"Add your app package to the feature manifest","pos":[3509,3553]},{"pos":[3561,3660],"content":"Open your feature manifest file, <bpt id=\"p1\">**</bpt>C:<ph id=\"ph1\">\\\\</ph>IoT-ADK-AddonKit<ph id=\"ph2\">\\\\</ph>Source-<ph id=\"ph3\">&amp;lt;</ph>arch<ph id=\"ph4\">&amp;gt;\\\\</ph>Packages<ph id=\"ph5\">\\\\</ph>OEMFM.xml<ept id=\"p1\">**</ept>"},{"content":"Create a new PackageFile section in the XML, with your package file listed, and give it a new FeatureID, such as \"Appx<ph id=\"ph1\">\\_</ph>HelloWorld\".","pos":[3666,3798]},{"content":"You'll now be able to add your app to any of your products by adding a reference to this feature manifest and Feature ID.","pos":[4654,4775]},{"pos":[4957,4997],"content":"Update the project's configuration files"},{"content":"Replace your product's default app with your own","pos":[5002,5050]},{"pos":[5058,5187],"content":"Open your product's test configuration file: <bpt id=\"p1\">**</bpt>C:<ph id=\"ph1\">\\\\</ph>IoT-ADK-AddonKit<ph id=\"ph2\">\\\\</ph>Source-<ph id=\"ph3\">&amp;lt;</ph>arch<ph id=\"ph4\">&amp;gt;\\\\</ph>Products<ph id=\"ph5\">\\\\</ph>ProductA<ph id=\"ph6\">\\\\</ph>TestOEMInput.xml<ept id=\"p1\">**</ept>."},{"content":"Make sure both your feature manifest, OEMFM.xml, and the feature manifest: OEMCommonFM.xml, are both listed in the AdditionalFMs section.","pos":[5193,5330]},{"content":"Add the FeatureIDs for both your app package, as well as the <bpt id=\"p1\">**</bpt>OEM<ph id=\"ph1\">\\_</ph>CustomCmd<ept id=\"p1\">**</ept> package, which is used to launch your app.","pos":[5847,5969]},{"content":"Remove the FeatureID for the OEM_AppxMain.","pos":[5970,6012]},{"content":"Remove the FeatureID for the IoT Core default app (IOT<ph id=\"ph1\">\\_</ph>BERTHA) and the IOT_ALLJOYN_APP either by using <ph id=\"ph2\">&amp;lt;</ph>!-- ... --<ph id=\"ph3\">&amp;gt;</ph> to comment it out, or delete it from the list:","pos":[6296,6465]},{"content":"Set the app to automatically install and set itself as the default app","pos":[7695,7765]},{"pos":[7773,7865],"content":"Open <bpt id=\"p1\">**</bpt>C:<ph id=\"ph1\">\\\\</ph>IoT-ADK-AddonKit<ph id=\"ph2\">\\\\</ph>Source-<ph id=\"ph3\">&amp;lt;</ph>arch<ph id=\"ph4\">&amp;gt;\\\\</ph>Products<ph id=\"ph5\">\\\\</ph>ProductA<ph id=\"ph6\">\\\\</ph>OEMCustomization.cmd<ept id=\"p1\">**</ept>"},{"content":"Recommended: Change the device's default username and password.","pos":[7871,7934]},{"content":"Remove the first set of REM statements from the code block starting with \"REM if exist..\", this allows the AppInstall.cmd command to automatically install your app.","pos":[7940,8104]},{"pos":[8859,8883],"content":"Build and test the image"},{"content":"From the IoT Core Shell, create the image:","pos":[8896,8938]},{"content":"This creates the product binaries at C:<ph id=\"ph1\">\\\\</ph>IoT-ADK-AddonKit<ph id=\"ph2\">\\\\</ph>Build<ph id=\"ph3\">\\\\&amp;lt;</ph>arch<ph id=\"ph4\">&amp;gt;\\\\</ph>ProductA<ph id=\"ph5\">\\\\</ph>Flash.FFU.","pos":[8997,9097]},{"content":"Troubleshooting: Check the logfiles at C:<ph id=\"ph1\">\\\\</ph>iot-adk-addonkit<ph id=\"ph2\">\\\\</ph>Build<ph id=\"ph3\">\\\\&amp;lt;</ph>arch<ph id=\"ph4\">&amp;gt;\\\\</ph>HelloWorld_Test.log, and search for \"fatal error\".","pos":[9103,9235]},{"content":"Install the image onto the Micro SD card.","pos":[9245,9286]},{"pos":[9294,9330],"content":"Start <bpt id=\"p1\">**</bpt>Windows IoT Core Dashboard<ept id=\"p1\">**</ept>"},{"pos":[9338,9414],"content":"<bpt id=\"p1\">**</bpt>Setup a new device<ept id=\"p1\">**</ept> <ph id=\"ph1\">&amp;gt;</ph> <bpt id=\"p2\">**</bpt>Custom<ept id=\"p2\">**</ept>, click Browse, and select your image."},{"pos":[9423,9578],"content":"Put the Micro SD card in the device, select it, accept the license terms, and click **Install**. \nThis replaces the previous image with your new image.","leadings":["","    "],"nodes":[{"content":"Put the Micro SD card in the device, select it, accept the license terms, and click <bpt id=\"p1\">**</bpt>Install<ept id=\"p1\">**</ept>.","pos":[0,96]},{"content":"This replaces the previous image with your new image.","pos":[98,151]}]},{"content":"Put the card into the IoT device and start it up.","pos":[9584,9633]},{"content":"After a short while, the device should start automatically, and you should see your app.","pos":[9639,9727]},{"pos":[9819,9829],"content":"Next steps"},{"content":"Lab 1c: Add a file and a registry setting to an image","pos":[9832,9885]},{"pos":[10030,10044],"content":"Related topics"},{"content":"Update apps on your IoT Core devices","pos":[10047,10083]}],"content":"---\nauthor: kpacquer\nDescription: 'We''re now going to take an app (like the sample Hello, World! app), and package it up so that it can be serviced after it reaches your customers.'\nms.assetid: a801d768-0397-4f85-b68f-bd85ddcc3f1f\nMSHAttr: 'PreferredLib:/library'\ntitle: 'Lab 1b: Add an app to your image'\n---\n\n# Lab 1b: Add an app to your image\n\n\\[This content has been tested on Windows 10 IoT Core Build 10586. Some of these procedures do not yet work on newer preview builds, including Windows 10 Anniversary SDK Preview Build 14295.\\]\n\nWe're now going to take an app (like the sample [Hello, World!](http://go.microsoft.com/fwlink/?LinkID=532945) app), package it up, and create a new image you can load onto new devices. \n\n**Note**  As we go through this manufacturing guide, ProjectA will start to resemble the SampleA image that's in C:\\\\IoT-ADK-AddonKit\\\\Source-arm\\\\Products\\\\SampleA.\n\n## <span id=\"Prerequisites\"></span><span id=\"prerequisites\"></span><span id=\"PREREQUISITES\"></span>Prerequisites\n\nWe'll use the ProjectA image we created from [Lab 1a: Create a basic image](create-a-basic-image.md).\n\n## <span id=\"Create_and_test_an_Windows_app\"></span><span id=\"create_and_test_an_windows_app\"></span><span id=\"CREATE_AND_TEST_AN_WINDOWS_APP\"></span>Create and test an Windows app\nYou can skip these steps if you've already created and tested your app.\n\n1.  Create an app. This can be any app designed for IoT Core, saved as an Appx Package. For our example, we use the [Hello, World](https://developer.microsoft.com/en-us/windows/iot/win10/samples/HelloWorld.htm) app.\n\n2.  In Visual Studio, to save the Hello, World app as an Appx package, click **Project > Store > Create App Packages** > **Next**. \n\n3.  Select: \n    - **Output location: C:\\HelloWorld** (or any other path that doesn't include spaces.)\n    \n    - **Generate app bundle: Never**\n    \n    Then click **Create**.\n\n    Visual Studio creates the Appx file into C:\\HelloWorld\\HelloWorld_1.0.0.0_Debug_Test \n\n4.  Optional: (Test the app)[test-the-app.md]. Note, you may have already tested the app as part of building the project. \n\n\n## <span id=\"Package_the_app\"></span><span id=\"package_the_app\"></span><span id=\"PACKAGE_THE_APP\"></span>Package the app\n\n**Create a package for an app**\n\n1.  Open **C:\\\\IoT-ADK-AddonKit\\\\Tools\\\\IoTCoreShell** as an administrator.\n\n\n2.  Create a working folder for the app, for example:\n\n    ``` syntax\n    newAppxPkg \"C:\\Users\\<UserName>\\Documents\\Visual Studio 2015\\Projects\\HelloWorld\\AppPackages\\HelloWorld_1.0.0.0_ARM_Debug_Test\\HelloWorld_1.0.0.0_ARM_Debug.appx\" Appx.HelloWorld\n    ```\n\n    This creates a new working folder at C:\\\\IoT-ADK-AddonKit\\\\Source-&lt;arch&gt;\\\\Packages\\\\Appx.HelloWorld that includes files that you'll use to help build the package.\n\n    Troubleshooting: If you get the message: \"The system cannot find the file specified\", it may be because the package has no defined dependencies.\n    \n3.  From the IoT Core Shell, build the package.\n\n    ``` syntax\n    buildpkg Appx.HelloWorld\n    ```\n\n    The package is built, appearing as **C:\\\\IoT-ADK-AddonKit\\\\Build\\\\&lt;arch&gt;\\\\pkgs\\\\&lt;your OEM name&gt;.Appx.HelloWorld.cab**.\n\n    Watch for any build errors, and correct them - often these are a result of filenames in the package definition file being different from the actual filenames.\n\n## <span id=\"Update_the_feature_manifest\"></span><span id=\"update_the_feature_manifest\"></span><span id=\"UPDATE_THE_FEATURE_MANIFEST\"></span>Update the feature manifest\n\n\n**Add your app package to the feature manifest**\n\n1.  Open your feature manifest file, **C:\\\\IoT-ADK-AddonKit\\\\Source-&lt;arch&gt;\\\\Packages\\\\OEMFM.xml**\n\n2.  Create a new PackageFile section in the XML, with your package file listed, and give it a new FeatureID, such as \"Appx\\_HelloWorld\".\n\n    ``` syntax\n    <?xml version=\"1.0\" encoding=\"utf-8\"?>\n    <FeatureManifest xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:xsd=\"http://www.w3.org/2001/XMLSchema\" xmlns=\"http://schemas.microsoft.com/embedded/2004/10/ImageUpdate\">\n      <BasePackages/>\n      <Features>\n        <OEM>\n          <!-- Feature definitions below -->\n          <PackageFile Path=\"%PKGBLD_DIR%\" Name=\"%OEM_NAME%.Appx.Main.cab\">\n            <FeatureIDs>\n              <FeatureID>OEM_AppxMain</FeatureID>\n            </FeatureIDs>\n          </PackageFile>\n        <PackageFile Path=\"%PKGBLD_DIR%\" Name=\"%OEM_NAME%.Appx.HelloWorld.cab\">\n            <FeatureIDs>\n              <FeatureID>OEM_AppxHelloWorld</FeatureID>\n            </FeatureIDs>\n          </PackageFile>\n        </OEM>\n        <OEMFeatureGroups/>\n      </Features>\n    </FeatureManifest>\n    ```\n\n    You'll now be able to add your app to any of your products by adding a reference to this feature manifest and Feature ID.\n\n## <span id=\"Update_the_project_s_configuration_files\"></span><span id=\"update_the_project_s_configuration_files\"></span><span id=\"UPDATE_THE_PROJECT_S_CONFIGURATION_FILES\"></span>Update the project's configuration files\n\n\n**Replace your product's default app with your own**\n\n1.  Open your product's test configuration file: **C:\\\\IoT-ADK-AddonKit\\\\Source-&lt;arch&gt;\\\\Products\\\\ProductA\\\\TestOEMInput.xml**.\n\n2.  Make sure both your feature manifest, OEMFM.xml, and the feature manifest: OEMCommonFM.xml, are both listed in the AdditionalFMs section.\n\n    ``` syntax\n    <AdditionalFMs>\n       <!-- Including BSP feature manifest -->\n       <AdditionalFM>%BSPSRC_DIR%\\RPi2\\Packages\\RPi2FM.xml</AdditionalFM>\n       <!-- Including OEM feature manifest -->\n       <AdditionalFM>%COMMON_DIR%\\Packages\\OEMCommonFM.xml</AdditionalFM>\n       <AdditionalFM>%SRC_DIR%\\Packages\\OEMFM.xml</AdditionalFM>\n       <!-- Including the test features -->\n       <AdditionalFM>%AKROOT%\\FMFiles\\arm\\IoTUAPNonProductionPartnerShareFM.xml</AdditionalFM>\n    </AdditionalFMs>\n    ```\n\n3.  Add the FeatureIDs for both your app package, as well as the **OEM\\_CustomCmd** package, which is used to launch your app. Remove the FeatureID for the OEM_AppxMain.\n\n    ``` syntax\n   <OEM>\n      <!-- Include BSP Features -->\n          <Feature>RPI2_DRIVERS</Feature>\n      <!-- Include OEM features -->\n      <Feature>OEM_AppxHelloWorld</Feature>\n      <Feature>OEM_CustomCmd</Feature>\n      <Feature>OEM_ProvAuto</Feature>\n   </OEM>\n    ```\n\n4.  Remove the FeatureID for the IoT Core default app (IOT\\_BERTHA) and the IOT_ALLJOYN_APP either by using &lt;!-- ... --&gt; to comment it out, or delete it from the list:\n\n    ``` syntax\n     <Microsoft>\n       <Feature>IOT_EFIESP</Feature>\n       <Feature>IOT_DMAP_DRIVER</Feature>\n       <Feature>IOT_CP210x_MAKERDRIVER</Feature>\n       <Feature>IOT_FTSER2K_MAKERDRIVER</Feature>\n       <!-- Following two required for Appx Installation -->\n       <Feature>IOT_UAP_OOBE</Feature>\n       <Feature>IOT_APP_TOOLKIT</Feature>\n       <!-- for Connectivity -->\n       <Feature>IOT_WEBB_EXTN</Feature>\n       <Feature>IOT_POWERSHELL</Feature>\n       <Feature>IOT_NETCMD</Feature>\n       <Feature>IOT_SSH</Feature>\n       <Feature>IOT_SIREP</Feature>\n       <!-- Enabling Test images -->\n       <Feature>IOT_DISABLE_UMCI</Feature>\n       <Feature>IOT_ENABLE_TESTSIGNING</Feature>\n       <Feature>IOT_TOOLKIT</Feature>\n       <!-- Debug Features -->\n       <Feature>IOT_KDSERIAL_SETTINGS</Feature>\n       <Feature>IOT_UMDFDBG_SETTINGS</Feature>\n       <Feature>IOT_WDTF</Feature>\n       <Feature>IOT_CRT140</Feature>\n       <Feature>IOT_DIRECTX_TOOLS</Feature>\n       <Feature>PRODUCTION_CORE</Feature>\n       <!-- \n          Sample Apps, remove this when you introduce OEM Apps\n          <Feature>IOT_BERTHA</Feature>\n          <Feature>IOT_ALLJOYN_APP</Feature>\n       -->\n       </Microsoft>\n\n    ```\n\n**Set the app to automatically install and set itself as the default app**\n\n1.  Open **C:\\\\IoT-ADK-AddonKit\\\\Source-&lt;arch&gt;\\\\Products\\\\ProductA\\\\OEMCustomization.cmd**\n\n2.  Recommended: Change the device's default username and password.\n\n3.  Remove the first set of REM statements from the code block starting with \"REM if exist..\", this allows the AppInstall.cmd command to automatically install your app.\n\n    ``` syntax\n    @echo off\n    REM OEM Customization Script file\n    REM This script if included in the image, is called everytime the system boots.\n\n    REM Enable Administrator User\n    net user Administrator p@ssw0rd /active:yes\n\n    if exist C:\\AppInstall\\AppInstall.cmd (\n    REM Enable Application Installation for onetime only, after this the files are deleted.\n    call C:\\AppInstall\\AppInstall.cmd > %temp%\\AppInstallLog.txt\n    if %errorlevel%== 0 (\n    REM Cleanup Application Installation Files. Change dir to root so that the dirs can be deleted\n    cd \\\n    rmdir /S /Q C:\\AppInstall\n    )\n    )\n    ```\n\n## <span id=\"Build_and_test_the_image\"></span><span id=\"build_and_test_the_image\"></span><span id=\"BUILD_AND_TEST_THE_IMAGE\"></span>Build and test the image\n\n\n****\n\n1.  From the IoT Core Shell, create the image:\n\n    ``` syntax\n    buildimage ProductA Test\n    ```\n\n    This creates the product binaries at C:\\\\IoT-ADK-AddonKit\\\\Build\\\\&lt;arch&gt;\\\\ProductA\\\\Flash.FFU.\n\n    Troubleshooting: Check the logfiles at C:\\\\iot-adk-addonkit\\\\Build\\\\&lt;arch&gt;\\\\HelloWorld_Test.log, and search for \"fatal error\".\n    \n2.  Install the image onto the Micro SD card.\n    -  Start **Windows IoT Core Dashboard**\n    -  **Setup a new device** &gt; **Custom**, click Browse, and select your image. \n    -  Put the Micro SD card in the device, select it, accept the license terms, and click **Install**. \n    This replaces the previous image with your new image.\n\n3.  Put the card into the IoT device and start it up.\n\n    After a short while, the device should start automatically, and you should see your app.\n\n## <span id=\"Next_steps\"></span><span id=\"next_steps\"></span><span id=\"NEXT_STEPS\"></span>Next steps\n\n[Lab 1c: Add a file and a registry setting to an image](add-a-registry-setting-to-an-image.md)\n\n ## <span id=\"Related_topics\"></span><span id=\"related_topics\"></span><span id=\"RELATED_TOPICS\"></span>Related topics\n\n[Update apps on your IoT Core devices](updating-iot-core-apps.md)"}