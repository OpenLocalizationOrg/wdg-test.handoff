{"nodes":[{"content":"Add a custom tool to the Windows RE boot options menu","pos":[34,87]},{"content":"Add a custom tool to the Windows RE boot options menu","pos":[194,247]},{"content":"Add a custom tool to the Windows RE boot options menu","pos":[255,308]},{"content":"You can add a custom troubleshooting or diagnostic tool to the Windows Recovery Environment (WinRE) image.","pos":[311,417]},{"content":"This tool is displayed in the Boot Options menu.","pos":[418,466]},{"content":"By developing your custom tool to run in WinRE, you can leverage the touch and on-screen keyboard support available in WinRE.","pos":[468,593]},{"content":"New for Windows 10: You won't be able to add WinRE optional components that aren't already in the default WinRE tools.","pos":[595,713]},{"content":"For example, if you have a app from Windows 8 that depended on the .NET optional components, you'll need to rewrite the app for Windows 10.","pos":[714,853]},{"content":"To add a custom tool","pos":[857,877]},{"content":"Extract and mount a Windows image (install.wim) and its corresponding WinRE image (winre.wim):","pos":[885,979]},{"pos":[1326,1429],"content":"For more information about these steps, see the topic: <bpt id=\"p1\">[</bpt>Customize Windows RE<ept id=\"p1\">](customize-windows-re.md)</ept>."},{"content":"In Notepad, create a configuration file that specifies the custom tool’s filename and parameters (if any):","pos":[1435,1541]},{"pos":[1850,2032],"content":"Where <bpt id=\"p1\">*</bpt>C:<ph id=\"ph1\">\\\\</ph>Tools<ph id=\"ph2\">\\\\</ph>OEMDiagnostics.exe<ept id=\"p1\">*</ept> is the custom troubleshooting or diagnostics tool, and where <bpt id=\"p2\">*</bpt>/param1<ept id=\"p2\">*</ept> and <bpt id=\"p3\">*</bpt>/param2<ept id=\"p3\">*</ept> are optional parameters used when running this custom tool."},{"pos":[2038,2118],"content":"**Note**  \nYou can only add one custom tool to the WinRE boot options menus.","leadings":["","    "],"nodes":[{"content":"Note","pos":[2,6]},{"content":"You can only add one custom tool to the WinRE boot options menus.","pos":[11,76]}]},{"content":"Save the file using UTF-8 coding.","pos":[2124,2157]},{"content":"Do not use ANSI:","pos":[2158,2174]},{"content":"Click <bpt id=\"p1\">**</bpt>File<ept id=\"p1\">**</ept>, and then click <bpt id=\"p2\">**</bpt>Save As<ept id=\"p2\">**</ept>.","pos":[2180,2223]},{"content":"In the <bpt id=\"p1\">**</bpt>Encoding<ept id=\"p1\">**</ept> box, select <bpt id=\"p2\">**</bpt>UTF-8<ept id=\"p2\">**</ept>, and save this file as <ph id=\"ph1\">`C:\\mount\\WinREConfig.xml`</ph>.","pos":[2224,2316]},{"content":"Create a <ph id=\"ph1\">\\\\</ph>Sources<ph id=\"ph2\">\\\\</ph>Recovery<ph id=\"ph3\">\\\\</ph>Tools folder in the WinRE mount folder, and then copy the custom tool and its configuration file into the new folder:","pos":[2322,2469]},{"content":"The custom tool and any associated folders must be in this folder so that it can continue to work after future WinRE upgrades.","pos":[2691,2817]},{"content":"Commit your customizations and unmount the WinRE image:","pos":[2823,2878]},{"content":"Optional: make a backup copy of the WinRE image.","pos":[2965,3013]},{"content":"You can often reuse the same customizations on multiple images.","pos":[3137,3200]},{"content":"Unmount and save the changes from the base Windows image:","pos":[3206,3263]},{"content":"To deploy the image","pos":[3350,3369]},{"content":"In Notepad, create a configuration file that describes the custom tool in the boot options menu.","pos":[3377,3473]},{"content":"Add descriptions for each language you support.","pos":[3474,3521]},{"content":"This example specifies both English and French language versions of the tool name and description:","pos":[3522,3620]},{"pos":[4103,4271],"content":"**Warning**  \nLimit the `<Name>` and `<Description>` values to approximately 30 characters or less to make sure that they appear correctly in the boot options menu.","leadings":["","    "],"nodes":[{"content":"Warning","pos":[2,9]},{"content":"Limit the <ph id=\"ph1\">`&lt;Name&gt;`</ph> and <ph id=\"ph2\">`&lt;Description&gt;`</ph> values to approximately 30 characters or less to make sure that they appear correctly in the boot options menu.","pos":[14,164]}]},{"content":"Save the file using UTF-8 coding:","pos":[4277,4310]},{"content":"Click <bpt id=\"p1\">**</bpt>File<ept id=\"p1\">**</ept>, and then click <bpt id=\"p2\">**</bpt>Save As<ept id=\"p2\">**</ept>.","pos":[4316,4359]},{"content":"In the <bpt id=\"p1\">**</bpt>Encoding<ept id=\"p1\">**</ept> box, select <bpt id=\"p2\">**</bpt>UTF-8<ept id=\"p2\">**</ept>, and save this file as <ph id=\"ph1\">`E:\\Recovery\\BootMenu\\AddDiagnosticsToolToBootMenu.xml`</ph>.","pos":[4360,4481]},{"pos":[4487,4561],"content":"Where <bpt id=\"p1\">*</bpt>E:<ph id=\"ph1\">\\\\</ph><ept id=\"p1\">*</ept> is the drive letter of a removable drive or network location."},{"content":"On your destination computer, during image deployment, but after you register the custom WinRE boot image and the Windows operating system, you must register the description of the custom tool:","pos":[4567,4760]},{"pos":[4887,4994],"content":"If the custom tool is registered properly, the output from running this command will be: <ph id=\"ph1\">`&lt;OEM Tool =  1&gt;`</ph>."},{"pos":[5000,5117],"content":"**Note**  \nFor more information about deploying Windows, see the [Deploy Windows RE](deploy-windows-re.md) topic.","leadings":["","    "],"nodes":[{"content":"Note","pos":[2,6]},{"content":"For more information about deploying Windows, see the <bpt id=\"p1\">[</bpt>Deploy Windows RE<ept id=\"p1\">](deploy-windows-re.md)</ept> topic.","pos":[11,113]}]},{"content":"To verify the custom tool appears in the Boot Options menu when launched from Windows","pos":[5121,5206]},{"content":"Restart the destination computer, and complete OOBE as your user.","pos":[5214,5279]},{"pos":[5285,5354],"content":"**Note**  \nIf you are prompted for a product key, click **Skip**.","leadings":["","    "],"nodes":[{"content":"Note","pos":[2,6]},{"content":"If you are prompted for a product key, click <bpt id=\"p1\">**</bpt>Skip<ept id=\"p1\">**</ept>.","pos":[11,65]}]},{"pos":[5363,5429],"content":"Click <bpt id=\"p1\">**</bpt>Start<ept id=\"p1\">**</ept> <ph id=\"ph1\">&amp;gt;</ph> <bpt id=\"p2\">**</bpt>PC settings<ept id=\"p2\">**</ept>, and then select <bpt id=\"p3\">**</bpt>General<ept id=\"p3\">**</ept>."},{"pos":[5435,5495],"content":"In the <bpt id=\"p1\">**</bpt>Advanced startup<ept id=\"p1\">**</ept> section, select <bpt id=\"p2\">**</bpt>Restart now<ept id=\"p2\">**</ept>."},{"pos":[5501,5543],"content":"The Windows <bpt id=\"p1\">**</bpt>Boot Options<ept id=\"p1\">**</ept> menu appears."},{"pos":[5549,5649],"content":"In the <bpt id=\"p1\">**</bpt>Boot Options<ept id=\"p1\">**</ept> menu, select <bpt id=\"p2\">**</bpt>Troubleshoot<ept id=\"p2\">**</ept>, and then click the <bpt id=\"p3\">**</bpt>Fabrikam Utility<ept id=\"p3\">**</ept> link."},{"pos":[5655,5794],"content":"The computer restarts in WinRE, and the tool that is specified in the <bpt id=\"p1\">*</bpt><ph id=\"ph1\">&amp;lt;</ph>RecoveryTools<ph id=\"ph2\">&amp;gt;</ph><ept id=\"p1\">*</ept> section of the WinREConfig.xml file, appears."},{"content":"Confirm that the custom tool works properly, and then close the tool.","pos":[5800,5869]},{"content":"If the custom tool does not appear on the Boot Options menu, you can try the following:","pos":[5875,5962]},{"content":"Verify the WinREConfig.xml and the AddDiagnosticsToolToBootMenu.xml files are saved using the UTF-8 encoding format.","pos":[5972,6088]},{"content":"Disable WinRE, register the custom tool again, and then enable WinRE.","pos":[6098,6167]},{"content":"For example:","pos":[6168,6180]},{"content":"To verify the custom tool appears in the WinRE recovery menu","pos":[6368,6428]},{"pos":[6436,6528],"content":"In the recovery menu, select <bpt id=\"p1\">**</bpt>Troubleshoot<ept id=\"p1\">**</ept>, and then click the <bpt id=\"p2\">**</bpt>Fabrikam Utility<ept id=\"p2\">**</ept> link."},{"content":"Confirm that the custom tool works properly, and then close the tool.","pos":[6534,6603]},{"pos":[6609,6628],"content":"Click <bpt id=\"p1\">**</bpt>Continue<ept id=\"p1\">**</ept>."},{"content":"The PC reboots into the operating system.","pos":[6634,6675]},{"pos":[6713,6727],"content":"Related topics"},{"content":"Windows Recovery Environment (Windows RE) Technical Reference","pos":[6731,6792]},{"content":"Customize Windows RE","pos":[6862,6882]},{"content":"Deploy Windows RE","pos":[6911,6928]},{"content":"Windows RE Troubleshooting Features","pos":[6954,6989]}],"content":"---\nauthor: Justinha\nDescription: Add a custom tool to the Windows RE boot options menu\nms.assetid: 474958cf-91bc-4c5c-8afd-22865e9bf4a5\nMSHAttr: 'PreferredLib:/library/windows/hardware'\ntitle: Add a custom tool to the Windows RE boot options menu\n---\n\n# Add a custom tool to the Windows RE boot options menu\n\n\nYou can add a custom troubleshooting or diagnostic tool to the Windows Recovery Environment (WinRE) image. This tool is displayed in the Boot Options menu.\n\nBy developing your custom tool to run in WinRE, you can leverage the touch and on-screen keyboard support available in WinRE.\n\nNew for Windows 10: You won't be able to add WinRE optional components that aren't already in the default WinRE tools. For example, if you have a app from Windows 8 that depended on the .NET optional components, you'll need to rewrite the app for Windows 10.\n\n**To add a custom tool**\n\n1.  Extract and mount a Windows image (install.wim) and its corresponding WinRE image (winre.wim):\n\n    ``` syntax\n    md c:\\mount\n    xcopy D:\\sources\\install.wim C:\\mount \n    md C:\\mount\\windows\n    Dism /mount-image /imagefile:C:\\mount\\install.wim /index:1 /mountdir:C:\\mount\\windows \n    md C:\\mount\\winre \n    Dism /mount-image /imagefile:c:\\mount\\windows\\windows\\system32\\recovery\\winre.wim /index:1 /mountdir:C:\\mount\\winre\n    ```\n\n    For more information about these steps, see the topic: [Customize Windows RE](customize-windows-re.md).\n\n2.  In Notepad, create a configuration file that specifies the custom tool’s filename and parameters (if any):\n\n    ``` syntax\n    <?xml version=\"1.0\" encoding=\"utf-8\"?>\n    <!-- WinREConfig.xml -->\n    <Recovery>\n       <RecoveryTools>\n          <RelativeFilePath>OEMDiagnostics.exe</RelativeFilePath>\n          <CommandLineParam>/param1 /param2</CommandLineParam>\n       </RecoveryTools>\n    </Recovery>\n    ```\n\n    Where *C:\\\\Tools\\\\OEMDiagnostics.exe* is the custom troubleshooting or diagnostics tool, and where */param1* and */param2* are optional parameters used when running this custom tool.\n\n    **Note**  \n    You can only add one custom tool to the WinRE boot options menus.\n\n    Save the file using UTF-8 coding. Do not use ANSI:\n\n    Click **File**, and then click **Save As**. In the **Encoding** box, select **UTF-8**, and save this file as `C:\\mount\\WinREConfig.xml`.\n\n3.  Create a \\\\Sources\\\\Recovery\\\\Tools folder in the WinRE mount folder, and then copy the custom tool and its configuration file into the new folder:\n\n    ``` syntax\n    md C:\\mount\\winre\\sources\\recovery\\tools\n    copy C:\\Tools\\OEMDiagnostics.exe C:\\mount\\winre\\sources\\recovery\\tools\n    copy C:\\mount\\WinREConfig.xml C:\\mount\\winre\\sources\\recovery\\tools\n    ```\n\n    The custom tool and any associated folders must be in this folder so that it can continue to work after future WinRE upgrades.\n\n4.  Commit your customizations and unmount the WinRE image:\n\n    ``` syntax\n    Dism /unmount-image /mountdir:C:\\mount\\winre /commit\n    ```\n\n5.  Optional: make a backup copy of the WinRE image.\n\n    ``` syntax\n    copy C:\\mount\\windows\\windows\\system32\\recovery\\winre.wim C:\\mount\\winre_amd64_backup.wim\n    ```\n\n    You can often reuse the same customizations on multiple images.\n\n6.  Unmount and save the changes from the base Windows image:\n\n    ``` syntax\n    Dism /unmount-image /mountdir:C:\\mount\\windows /commit\n    ```\n\n**To deploy the image**\n\n1.  In Notepad, create a configuration file that describes the custom tool in the boot options menu. Add descriptions for each language you support. This example specifies both English and French language versions of the tool name and description:\n\n    ``` syntax\n    <?xml version=\"1.0\" encoding=\"utf-8\"?>\n    <!-- AddDiagnosticsToolToBootMenu.xml -->\n    <BootShell>\n       <WinRETool locale=\"en-us\">\n             <Name>Fabrikam Utility</Name>\n             <Description>Troubleshoot your Fabrikam PC</Description>\n       </WinRETool>\n       <WinRETool locale=\"fr-fr\">\n          <Name>Utilité de Fabrikam</Name>\n          <Description>Dépannez votre PC de Fabrikam</Description>\n       </WinRETool>\n    </BootShell>\n    ```\n\n    **Warning**  \n    Limit the `<Name>` and `<Description>` values to approximately 30 characters or less to make sure that they appear correctly in the boot options menu.\n\n    Save the file using UTF-8 coding:\n\n    Click **File**, and then click **Save As**. In the **Encoding** box, select **UTF-8**, and save this file as `E:\\Recovery\\BootMenu\\AddDiagnosticsToolToBootMenu.xml`.\n\n    Where *E:\\\\* is the drive letter of a removable drive or network location.\n\n2.  On your destination computer, during image deployment, but after you register the custom WinRE boot image and the Windows operating system, you must register the description of the custom tool:\n\n    ``` syntax\n    Reagentc /setbootshelllink /configfile E:\\Recovery\\BootMenu\\AddDiagnosticsToolToBootMenu.xml\n    ```\n\n    If the custom tool is registered properly, the output from running this command will be: `<OEM Tool =  1>`.\n\n    **Note**  \n    For more information about deploying Windows, see the [Deploy Windows RE](deploy-windows-re.md) topic.\n\n**To verify the custom tool appears in the Boot Options menu when launched from Windows**\n\n1.  Restart the destination computer, and complete OOBE as your user.\n\n    **Note**  \n    If you are prompted for a product key, click **Skip**.   \n\n2.  Click **Start** &gt; **PC settings**, and then select **General**.\n\n3.  In the **Advanced startup** section, select **Restart now**.\n\n    The Windows **Boot Options** menu appears.\n\n4.  In the **Boot Options** menu, select **Troubleshoot**, and then click the **Fabrikam Utility** link.\n\n    The computer restarts in WinRE, and the tool that is specified in the *&lt;RecoveryTools&gt;* section of the WinREConfig.xml file, appears.\n\n5.  Confirm that the custom tool works properly, and then close the tool.\n\n    If the custom tool does not appear on the Boot Options menu, you can try the following:\n\n    -   Verify the WinREConfig.xml and the AddDiagnosticsToolToBootMenu.xml files are saved using the UTF-8 encoding format.\n\n    -   Disable WinRE, register the custom tool again, and then enable WinRE. For example:\n\n        ``` syntax\n        Reagentc /disable \n        Reagentc /setbootshelllink /configfile E:\\Recovery\\BootMenu\\AddDiagnosticsToolToBootMenu.xml\n        Reagentc /enable\n        ```\n**To verify the custom tool appears in the WinRE recovery menu**\n\n1.  In the recovery menu, select **Troubleshoot**, and then click the **Fabrikam Utility** link.\n\n2.  Confirm that the custom tool works properly, and then close the tool.\n\n3.  Click **Continue**.\n\n    The PC reboots into the operating system.\n\n## <span id=\"related_topics\"></span>Related topics\n\n\n[Windows Recovery Environment (Windows RE) Technical Reference](windows-recovery-environment--windows-re--technical-reference.md)\n\n[Customize Windows RE](customize-windows-re.md)\n\n[Deploy Windows RE](deploy-windows-re.md)\n\n[Windows RE Troubleshooting Features](windows-re-troubleshooting-features.md)\n\n \n\n \n\n\n\n\n\n\n"}