{"nodes":[{"content":"Download and install Windows PE (WinPE) so you can boot from a USB flash drive or an external USB hard drive","pos":[35,143]},{"content":"Download and install Windows PE (WinPE) so you can boot from a USB flash drive or an external USB hard drive","pos":[252,360]},{"content":"Download and install Windows PE (WinPE) so you can boot from a USB flash drive or an external USB hard drive","pos":[369,477]},{"content":"Boot your PC to a VHD file (\"native boot\") by using the BCDEdit tool.","pos":[480,549]},{"content":"If you are adding the VHD to a computer that already has a Windows 10 or Windows 8 installation, you will have to add a boot entry to the menu.","pos":[550,693]},{"content":"If you are adding the VHD to a computer that is running an older version of Windows, for example Windows Server 2008, you will have to update the system partition using the BCDboot tool and then modify the boot menu using the BCDedit tool.","pos":[694,933]},{"pos":[935,1013],"content":"Native boot for Windows 10 requires the <bpt id=\"p1\">**</bpt>.vhdx<ept id=\"p1\">**</ept> format, not the .vhd format."},{"pos":[1174,1207],"content":"Update the Boot Menu to Add a VHD"},{"content":"To update a BIOS-based computer to include a Windows 8 boot menu","pos":[1212,1276]},{"content":"Copy the .vhdx file to the destination computer.","pos":[1284,1332]},{"content":"For example, at a command prompt, type:","pos":[1333,1372]},{"content":"Use the DiskPart tool in Windows PE to attach the VHD on the destination computer.","pos":[1435,1517]},{"content":"You can attach a VHD by using the <bpt id=\"p1\">**</bpt>Attach vdisk<ept id=\"p1\">**</ept> command.","pos":[1518,1577]},{"content":"This enables the VHD so that it appears on the host as a disk drive instead of as a .vhdx file.","pos":[1578,1673]},{"content":"At a command prompt, type:","pos":[1674,1700]},{"content":"Use the BCDboot tool, located in the <bpt id=\"p1\">**</bpt><ph id=\"ph1\">\\\\</ph>System32<ept id=\"p1\">**</ept> directory of the VHD image or in Windows PE to copy the boot environment files and Boot Configuration Data (BCD) configuration from the <bpt id=\"p2\">**</bpt><ph id=\"ph2\">\\\\</ph>Windows<ept id=\"p2\">**</ept> directory in the VHD to the system partition.","pos":[1893,2140]},{"content":"On a computer that has BIOS firmware, the system partition is the active partition of the first hard disk.","pos":[2141,2247]},{"content":"For example, to use BCDboot from the VHD image, at a command prompt, type:","pos":[2248,2322]},{"content":"The BCDboot tool automatically imports information from the existing installation when updating the BCD.","pos":[2398,2502]},{"content":"The computer is now updated to include a Windows 8 boot environment.","pos":[2503,2571]},{"content":"You can now follow the steps in the section \"To add a native-boot VHD to an existing Windows 8 boot menu\" later in this topic.","pos":[2572,2698]},{"content":"To update a UEFI-based computer to include a Windows 8 boot menu","pos":[2702,2766]},{"content":"Copy the .vhdx file to the destination computer.","pos":[2774,2822]},{"content":"For example, at a command prompt, type:","pos":[2823,2862]},{"content":"Use the DiskPart tool in Windows PE to attach the VHD on the destination computer.","pos":[2925,3007]},{"content":"You can attach a VHD by using the <bpt id=\"p1\">**</bpt>Attach vdisk<ept id=\"p1\">**</ept> command.","pos":[3008,3067]},{"content":"This enables the VHD so that it appears on the host as a disk drive instead of as a .vhdx file.","pos":[3068,3163]},{"content":"At a command prompt, type:","pos":[3164,3190]},{"content":"On a UEFI-based computer, the system partition is hidden by default and must be assigned a drive letter before you run the BCDboot tool.","pos":[3383,3519]},{"content":"Use the DiskPart tool to locate the EFI system partition and assign a drive letter to it.","pos":[3520,3609]},{"content":"At a command prompt, type:","pos":[3610,3636]},{"pos":[3770,3861],"content":"Where <bpt id=\"p1\">*</bpt><ph id=\"ph1\">&amp;lt;</ph>x<ph id=\"ph2\">&amp;gt;</ph><ept id=\"p1\">*</ept> is the 100 megabyte (MB) EFI system partition that is formatted with FAT."},{"content":"Use the BCDboot tool, located in the <ph id=\"ph1\">\\\\</ph>System32 directory of the VHD image or in Windows PE to copy the boot environment files and BCD configuration from the <ph id=\"ph2\">\\\\</ph>Windows directory in the VHD to the system partition.","pos":[3867,4080]},{"content":"For example, to use BCDboot from the VHD image, at a command prompt, type:","pos":[4081,4155]},{"content":"The BCDboot tool automatically imports information from the existing installation when updating the BCD.","pos":[4231,4335]},{"content":"The computer is now updated with a Windows 10 boot environment.","pos":[4336,4399]},{"content":"You can now follow the steps to add a native-boot VHD to an existing boot menu.","pos":[4400,4479]},{"content":"To add a native-boot VHD to an existing Windows 8 boot menu","pos":[4483,4542]},{"content":"Back up your BCD store using the BCDedit tool with the <bpt id=\"p1\">**</bpt>/export<ept id=\"p1\">**</ept> option.","pos":[4550,4624]},{"content":"For example, at a command prompt, type:","pos":[4625,4664]},{"content":"Copy an existing boot entry for a Windows installation.","pos":[4701,4756]},{"content":"You will then modify the copy for use as the VHD boot entry.","pos":[4757,4817]},{"content":"At a command prompt, type:","pos":[4818,4844]},{"pos":[4925,5040],"content":"When the BCDedit command is completed successfully, it returns a {GUID} as output in the <bpt id=\"p1\">**</bpt>Command Prompt<ept id=\"p1\">**</ept> window."},{"content":"Locate the {GUID} in the command-prompt output for the previous command.","pos":[5046,5118]},{"content":"Copy the GUID, including the braces, to use in the following steps.","pos":[5119,5186]},{"content":"Set the <bpt id=\"p1\">**</bpt>device<ept id=\"p1\">**</ept> and <bpt id=\"p2\">**</bpt>osdevice<ept id=\"p2\">**</ept> options for the VHD boot entry.","pos":[5192,5259]},{"content":"At a command prompt, type:","pos":[5260,5286]},{"content":"Set the boot entry for the VHD as the default boot entry.","pos":[5432,5489]},{"content":"When the computer restarts, the boot menu will display all of the Windows installations on the computer and boot into the VHD after the operating-system selection countdown is completed.","pos":[5490,5676]},{"content":"At a command prompt, type:","pos":[5677,5703]},{"content":"Some x86-based systems require a boot configuration option for the kernel in order to detect certain hardware information and successfully native-boot from a VHD.","pos":[5761,5923]},{"content":"At a command prompt, type:","pos":[5924,5950]},{"pos":[6013,6146],"content":"For more information about how to use the BCDedit tool, see <bpt id=\"p1\">[</bpt>this Microsoft Web site<ept id=\"p1\">](http://go.microsoft.com/fwlink/?LinkId=128459)</ept>."},{"pos":[6184,6198],"content":"Related topics"},{"content":"BCDboot Command-Line Options","pos":[6202,6230]},{"content":"Boot to VHD (Native Boot): Add a Virtual Hard Disk to the Boot Menu","pos":[6278,6345]},{"content":"Understanding Virtual Hard Disks with Native Boot","pos":[6420,6469]}],"content":"---\nauthor: Justinha\nDescription: 'Download and install Windows PE (WinPE) so you can boot from a USB flash drive or an external USB hard drive'\nms.assetid: 1799a91f-493a-4509-9937-ad6901358240\nMSHAttr: 'PreferredLib:/library/windows/hardware'\ntitle: 'Download and install Windows PE (WinPE) so you can boot from a USB flash drive or an external USB hard drive'\n---\n\n# Download and install Windows PE (WinPE) so you can boot from a USB flash drive or an external USB hard drive\n\n\nBoot your PC to a VHD file (\"native boot\") by using the BCDEdit tool. If you are adding the VHD to a computer that already has a Windows 10 or Windows 8 installation, you will have to add a boot entry to the menu. If you are adding the VHD to a computer that is running an older version of Windows, for example Windows Server 2008, you will have to update the system partition using the BCDboot tool and then modify the boot menu using the BCDedit tool.\n\nNative boot for Windows 10 requires the **.vhdx** format, not the .vhd format.\n\n## <span id=\"Update_the_Boot_Menu_to_Add_a_VHD\"></span><span id=\"update_the_boot_menu_to_add_a_vhd\"></span><span id=\"UPDATE_THE_BOOT_MENU_TO_ADD_A_VHD\"></span>Update the Boot Menu to Add a VHD\n\n\n**To update a BIOS-based computer to include a Windows 8 boot menu**\n\n1.  Copy the .vhdx file to the destination computer. For example, at a command prompt, type:\n\n    ``` syntax\n    copy N:\\VHDs\\windows.vhdx C:\n    ```\n\n2.  Use the DiskPart tool in Windows PE to attach the VHD on the destination computer. You can attach a VHD by using the **Attach vdisk** command. This enables the VHD so that it appears on the host as a disk drive instead of as a .vhdx file. At a command prompt, type:\n\n    ``` syntax\n    diskpart\n    select vdisk file=c:\\windows.vhdx\n    attach vdisk\n    list volume\n    select volume <volume_number_of_attached_VHD>\n    assign letter=v\n    exit\n    ```\n\n3.  Use the BCDboot tool, located in the **\\\\System32** directory of the VHD image or in Windows PE to copy the boot environment files and Boot Configuration Data (BCD) configuration from the **\\\\Windows** directory in the VHD to the system partition. On a computer that has BIOS firmware, the system partition is the active partition of the first hard disk. For example, to use BCDboot from the VHD image, at a command prompt, type:\n\n    ``` syntax\n    cd v:\\windows\\system32\n    bcdboot v:\\windows\n    ```\n\nThe BCDboot tool automatically imports information from the existing installation when updating the BCD. The computer is now updated to include a Windows 8 boot environment. You can now follow the steps in the section \"To add a native-boot VHD to an existing Windows 8 boot menu\" later in this topic.\n\n**To update a UEFI-based computer to include a Windows 8 boot menu**\n\n1.  Copy the .vhdx file to the destination computer. For example, at a command prompt, type:\n\n    ``` syntax\n    copy N:\\VHDs\\windows.vhdx C:\n    ```\n\n2.  Use the DiskPart tool in Windows PE to attach the VHD on the destination computer. You can attach a VHD by using the **Attach vdisk** command. This enables the VHD so that it appears on the host as a disk drive instead of as a .vhdx file. At a command prompt, type:\n\n    ``` syntax\n    diskpart\n    select vdisk file=C:\\windows.vhdx\n    attach vdisk\n    list volume\n    select volume <volume_number_of_attached_VHD>\n    assign letter=v\n    exit\n    ```\n\n3.  On a UEFI-based computer, the system partition is hidden by default and must be assigned a drive letter before you run the BCDboot tool. Use the DiskPart tool to locate the EFI system partition and assign a drive letter to it. At a command prompt, type:\n\n    ``` syntax\n    diskpart\n    select disk 0\n    list partition\n    select partition <x>\n    assign letter=s\n    exit\n    ```\n\n    Where *&lt;x&gt;* is the 100 megabyte (MB) EFI system partition that is formatted with FAT.\n\n4.  Use the BCDboot tool, located in the \\\\System32 directory of the VHD image or in Windows PE to copy the boot environment files and BCD configuration from the \\\\Windows directory in the VHD to the system partition. For example, to use BCDboot from the VHD image, at a command prompt, type:\n\n    ``` syntax\n    cd v:\\windows\\system32\n    bcdboot v:\\windows\n    ```\n\nThe BCDboot tool automatically imports information from the existing installation when updating the BCD. The computer is now updated with a Windows 10 boot environment. You can now follow the steps to add a native-boot VHD to an existing boot menu.\n\n**To add a native-boot VHD to an existing Windows 8 boot menu**\n\n1.  Back up your BCD store using the BCDedit tool with the **/export** option. For example, at a command prompt, type: `bcdedit /export c:\\bcdbackup`\n\n2.  Copy an existing boot entry for a Windows installation. You will then modify the copy for use as the VHD boot entry. At a command prompt, type:\n\n    ``` syntax\n    bcdedit /copy {default} /d \"vhd boot (locate)\"\n    ```\n\n    When the BCDedit command is completed successfully, it returns a {GUID} as output in the **Command Prompt** window.\n\n3.  Locate the {GUID} in the command-prompt output for the previous command. Copy the GUID, including the braces, to use in the following steps.\n\n4.  Set the **device** and **osdevice** options for the VHD boot entry. At a command prompt, type:\n\n    ``` syntax\n    bcdedit /set {guid} device vhd=[locate]\\windows.vhdx\n    bcdedit /set {guid} osdevice vhd=[locate]\\windows.vhdx\n    ```\n\n5.  Set the boot entry for the VHD as the default boot entry. When the computer restarts, the boot menu will display all of the Windows installations on the computer and boot into the VHD after the operating-system selection countdown is completed. At a command prompt, type:\n\n    ``` syntax\n    bcdedit /default {guid}\n    ```\n\n6.  Some x86-based systems require a boot configuration option for the kernel in order to detect certain hardware information and successfully native-boot from a VHD. At a command prompt, type:\n\n    ``` syntax\n    bcdedit /set {guid} detecthal on\n    ```\n\nFor more information about how to use the BCDedit tool, see [this Microsoft Web site](http://go.microsoft.com/fwlink/?LinkId=128459).\n\n## <span id=\"related_topics\"></span>Related topics\n\n\n[BCDboot Command-Line Options](bcdboot-command-line-options-techref-di.md)\n\n[Boot to VHD (Native Boot): Add a Virtual Hard Disk to the Boot Menu](boot-to-vhd--native-boot--add-a-virtual-hard-disk-to-the-boot-menu.md)\n\n[Understanding Virtual Hard Disks with Native Boot](understanding-virtual-hard-disks-with-native-boot.md)\n\n \n\n \n\n\n\n\n\n\n"}